<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Text-Objects.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div class="line left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"Dispframe"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;Dispframe&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: Stream<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;text&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;prompt doit &rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>I am a dialog window</span></div>
<div class="line left">
<span class="medium bold"><br>Initialization</span></div>
<div class="line left">
<span class="small bold">classInit </span><span class="small">[prompt &larr; &rsquo;&#64257;&rsquo;◦1. doit &larr; &rsquo;&rsquo;◦1]</span></div>
<div class="line left">
<span class="small bold">frame &larr; r<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[text para: nil frame: r]</span></div>
<div class="line left">
<span class="small bold">init<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[text &larr; Textframe new.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self of: (String new: 16)]</span></div>
<div class="line left">
<span class="small bold">rect: r<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self init; frame &larr; r; clear]</span></div>
<div class="line left">
<span class="medium bold"><br>Scheduler</span></div>
<div class="line left">
<span class="small bold">eachtime </span><span class="small">| t<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[text window has: user mp⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[user kbck⇒[t&larr; self kbd⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[ [t≡nil⇒[] self space; print: nilⓢ t].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self prompt]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"> user bluebug⇒ [⇑false]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user anybug⇒[⇑false]]</span></div>
<div class="line left">
<span class="small bold">firsttime<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[text window has: user mp⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self outline; prompt]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑false]</span></div>
<div class="line left">
<span class="small bold">lasttime<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[ [self last=prompt⇒[self skip: ¬2; show]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑user bluebug≡false]</span></div>
<div class="line left">
<span class="small bold">leave</span></div>
<div class="line left">
<span class="medium bold"><br>Dialog</span></div>
<div class="line left">
<span class="small bold">ev </span><span class="small">| t<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[while⦂ [self cr. t &larr; self request: &rsquo;&rsquo;] do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self space; print: nil ⓢt]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑false]</span></div>
<div class="line left">
<span class="small bold">kbd </span><span class="small">| n t</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"false if user pauses, nil if ctrl-d, all input since prompt if "</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[while⦂ user kbck do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[t &larr; user kbd.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t=132⇒ [self append: &rsquo;done.&rsquo;; show. ⇑nil]; </span><span class="small italic">"ctl-d for done"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=8⇒ [self last=prompt⇒[] self skip: ¬1]; </span><span class="small italic">"backspace"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=30⇒ [n &larr; array◦(position to: 1 by:¬1) find: prompt.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">n=0⇒[self append: &rsquo;lost beginning&rsquo;; prompt]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t&larr; self last: n-1. self next&larr; doit; show. ⇑t];</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"> </span><span class="small italic">"do-it (LF)"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=145⇒ [self last=prompt⇒[] self skip: ¬1.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"ctl-w for backspace word"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (position&gt;0 and: self last tokenish) do⦂ [self skip: ¬1]];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=151⇒[self reset; prompt] </span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"ctl-x clears frame"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self next &larr; t]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self show. ⇑false]</span></div>
<div class="line left">
<span class="small bold">prompt </span><span class="small">[self cr; next&larr; prompt; show]</span></div>
<div class="line left">
<span class="small bold">read </span><span class="small">| t</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"false if ctrl-d, all input since prompt if "</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self next&larr; prompt; show.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">until⦂ [user kbck⇒[t&larr; self kbd] false] do⦂ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t≡nil⇒[⇑false] ⇑t]</span></div>
<div class="line left">
<span class="small bold">request: s</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"false if ctrl-d, all input since prompt if "</span><span class="small bold"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self append: s. ⇑self read]</span></div>
<div class="line left">
<span class="medium bold"><br>Image</span></div>
<div class="line left">
<span class="small bold">clear<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self reset. self show]</span></div>
<div class="line left">
<span class="small bold">moveto: pt<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(text window inset: ¬2⌾¬2) dragto: pt-(¬2⌾¬2)]</span></div>
<div class="line left">
<span class="small bold">outline<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[text window outline: 2]</span></div>
<div class="line left">
<span class="small bold">show </span><span class="small">| t [</span><span class="small bold"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text show: self contents.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">until⦂ text lastshown≥ position do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">position &lt; (t &larr; text scrolln: 1)⇒ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t &larr; array copy: t+1 to: position.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text show: t.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">position &larr; 0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self append: t.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"self dequeue: (text scrolln: 1).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text show: self contents"]]</span></div>
<div class="line left">
<span class="medium bold"><br>Access to Parts</span></div>
<div class="line left">
<span class="small bold">frame<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑text frame]</span></div>
<div class="line left">
<span class="small bold">text<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑text]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪Dispframe under: &rsquo;Text Objects&rsquo;.</span></div>
<div class="line left">
<span class="small">Dispframe classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Paragraph"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;Paragraph&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: Array<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;text runs alignment&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>Paragraphs implement pretty text.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">text is a String of the ascii characters.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">alignment specifies how the paragraph should be justified.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">runs is a String of run-coded format information.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">odd byte is run length (≤255)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">following byte is 16*format number +<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">1*bold 2*italic 4*underline 8*strikeout<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">longer runs are made from several of length 255.</span></div>
<div class="line left">
<span class="medium bold"><br>Initialization of parts</span></div>
<div class="line left">
<span class="small bold">copy </span><span class="small">[⇑self class new text: text runs: runs alignment: alignment]</span></div>
<div class="line left">
<span class="small bold">text: text<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[alignment &larr; 0]</span></div>
<div class="line left">
<span class="small bold">text: text alignment: alignment</span></div>
<div class="line left">
<span class="small bold">text: text runs: runs alignment: alignment</span></div>
<div class="line left">
<span class="medium bold"><br>Normal access</span></div>
<div class="line left">
<span class="small bold">◦x </span><span class="small">[⇑text◦x]</span></div>
<div class="line left">
<span class="small bold">asParagraph </span><span class="small">[⇑self]</span></div>
<div class="line left">
<span class="small bold">asStream </span><span class="small">[⇑text asStream]</span></div>
<div class="line left">
<span class="small bold">asVector </span><span class="small">[⇑text asVector]</span></div>
<div class="line left">
<span class="small bold">copy: a to: b</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">Return a copied subrange of this paragraph</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑self class new<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text: (text copy: a to: b)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs: (self run: a to: b)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">alignment: alignment]</span></div>
<div class="line left">
<span class="small bold">findString: str startingAt: start<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑text findString: str startingAt: start]</span></div>
<div class="line left">
<span class="small bold">length </span><span class="small">[⇑text length]</span></div>
<div class="line left">
<span class="small bold">replace: a to: b by: c   </span><span class="small">[</span><span class="small italic">"alters self - doesnt copy"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[runs≡nil and⦂ (c isnt: self class)⇒[]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs &larr; self runcat: (self run: 1 to: a-1)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">and: [c is: self class⇒ [c runs]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self makerun: c length val: [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs empty⇒[0]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs◦((self runfind: b)◦1+1)]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">and: (self run: b+1 to: text length)].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text &larr; text replace: a to: b by: [c is: self class⇒[c text] c]]</span></div>
<div class="line left">
<span class="small bold">subst: x for: y </span><span class="small italic">"runs are not supported yet here"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑text subst: x for: y]</span></div>
<div class="line left">
<span class="small bold">text </span><span class="small">[⇑text]</span></div>
<div class="line left">
<span class="small bold">textStyle </span><span class="small">[⇑DefaultTextStyle]</span></div>
<div class="line left">
<span class="medium bold"><br>Text alignment</span></div>
<div class="line left">
<span class="small bold">alignment </span><span class="small">[⇑alignment]</span></div>
<div class="line left">
<span class="small bold">alignment &larr; alignment</span></div>
<div class="line left">
<span class="small bold">center </span><span class="small">[alignment &larr; 2]</span></div>
<div class="line left">
<span class="small bold">flushleft </span><span class="small">[alignment &larr; 0]</span></div>
<div class="line left">
<span class="small bold">flushright </span><span class="small">[alignment &larr; 4]</span></div>
<div class="line left">
<span class="small bold">justify </span><span class="small">[alignment &larr; 1]</span></div>
<div class="line left">
<span class="medium bold"><br>Manipulation of format runs</span></div>
<div class="line left">
<span class="small bold">allBold </span><span class="small">[self maskrunsunder: 1 to: 1]</span></div>
<div class="line left">
<span class="small bold">allFont: n </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[n is: String⇒ [n &larr; (self textStyle fontnames find: n) - 1]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self maskrunsunder: 0360 to: n*16]</span></div>
<div class="line left">
<span class="small bold">allItalic </span><span class="small">[self maskrunsunder: 2 to: 2]</span></div>
<div class="line left">
<span class="small bold">makeBoldPattern </span><span class="small">| s i c<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[s &larr; text asStream.  i&larr; 0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">until⦂ [c&larr; s next⇒</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">" scan to bracket, bar or comment "</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[c=91⇒[true]; =124⇒[true]; =34⇒[true]; =25⇒[true] false]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">true]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"end"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">do⦂ [i&larr; i+1].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self maskrun: 1 to: i under: 1 to: 1]</span></div>
<div class="line left">
<span class="small bold">makerun: len val: val</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"Make up a solid run of value val"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">| str i<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[len=0⇒[⇑nullString]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">str &larr; String new: len-1/255+1*2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ i from: 1 to: str length by: 2 do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">str◦i &larr; [len&gt;255⇒[255] len].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">str◦(i+1) &larr; val.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len &larr; len-255].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑str]</span></div>
<div class="line left">
<span class="small bold">maskrun: i to: j under: m to: val </span><span class="small italic">"Alter my runs so that the bits selected by m become val."</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">| r k</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"Maybe merge this with mergestyle"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[r &larr; self run: i to: j.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ k from: 2 to: r length by: 2 do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[r◦k &larr; (r◦k land: 0377-m) + val].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs &larr; self runcat: (self run: 1 to: i-1) and: r and: (self run: j+1 to: text length)]</span></div>
<div class="line left">
<span class="small bold">maskrunsunder: m to: val<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self maskrun: 1 to: text length under: m to: val]</span></div>
<div class="line left">
<span class="small bold">run: a to: b </span><span class="small">| c</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"subrange of run"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[a&gt;b⇒[⇑nullString]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs≡nil⇒[⇑self makerun: 1+b-a val: 0]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">a &larr; self runfind: a.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">b &larr; self runfind: b.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c &larr; runs copy: a◦1 to: b◦1+1.</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"copy the sub-run"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(a◦1)=(b◦1)⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[c◦1 &larr; 1+ (b◦2)-(a◦2)]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c◦1 &larr; 1+(runs◦(a◦1))- (a◦2).</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"trim the end lengths"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c◦(c length-1) &larr; b◦2].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑c]</span></div>
<div class="line left">
<span class="small bold">runcat: r1 and: r2 and: r3 </span><span class="small">| i r olen len oc c nr [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">concatenate and compact 3 runs</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nr &larr; Stream new of: (String new: 30).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">oc &larr; false.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ i to: 3 do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">r &larr; [i=1⇒ [r1]; =2⇒ [r2] r3].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">r length=0⇒ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">r &larr; r asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (len &larr; r next) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c &larr; r next.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len = 0⇒ ["</span><span class="small italic">ignore empty runs (shouldn&rsquo;t be any)</span><span class="small">"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">oc = c⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(olen &larr; olen+len) ≤ 255⇒ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nr next &larr; 255; next &larr; oc.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">olen &larr; olen-255]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[oc⇒ [nr next &larr; olen; next &larr; oc] "</span><span class="small italic">first time thru</span><span class="small">"].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">olen &larr; len. oc &larr; c]].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[oc⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">leftovers</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nr next &larr; olen; next &larr; oc]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑nr contents]</span></div>
<div class="line left">
<span class="small bold">runcat: x to: y </span><span class="small">[⇑self runcat: x and: y and: &rsquo;&rsquo;]</span></div>
<div class="line left">
<span class="small bold">runfind: index </span><span class="small">| run</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"index into run"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[run&larr;1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (t &larr; index - (runs◦run)) &gt; 0 do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[index &larr; t. run &larr; run+2].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑run,index]</span></div>
<div class="line left">
<span class="small bold">runs</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"return runs or default if none"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[runs≡nil⇒[⇑self makerun: text length val: 0]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑runs]</span></div>
<div class="line left">
<span class="medium bold"><br>Bravo conversions</span></div>
<div class="line left">
<span class="small bold">applyBravo: s at: i to: j</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">| v ch t bslash cr [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"Alter runs of characters i through j according to trailer.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">see Ibis&lt;Bravo&gt;Trailer.Memo for further info.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">some functions may not be implemented, thus parsed and ignored</span><span class="small">.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">paragraph looks.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">implemented: justification (j), centering (c).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">ignored: left margin (l), first line left margin (d), right margin (z),<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">line leading (x), paragraph leading (e), vertical tab (y), keep (k), profile (q),<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">tab tables ( () )</span><span class="small">"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; s asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">cr &larr; 015.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bslash &larr; &rsquo;\&rsquo;◦1.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">until⦂ (ch &larr; s next) = bslash do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">ch ≡ false or⦂ ch = cr⇒ ["</span><span class="small italic">no more</span><span class="small">" ⇑self]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(t &larr; &rsquo;jcq&rsquo; find: ch) &gt; 0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t=1⇒ [self justify]; =2⇒ [self center]]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(t &larr; &rsquo;(ldzxeyk&rsquo; find: ch) &gt; 0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t=1⇒ [s skipTo: &rsquo;)&rsquo;◦1]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s integerScan]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">character looks.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">implemented: font (f), bold (bB), italic (iI), underline (uU).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">ignored: graphic (g), visible (v), overstrike (s), superscript (o), tabcolor (t)"<br></span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ ((ch &larr; s next) and⦂ ch ≠ cr) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">run length</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[ch ≥ 060 and⦂ ch ≤ 071 "isdigit"⇒ [s skip: ¬1] ch = 040]⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">i &larr; i + s integerScan]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(t &larr; &rsquo;bBiIuU&rsquo; find: ch) &gt; 0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self maskrun: i to: j under: ↪(1 1 2 2 4 4)◦t to: ↪(1 0 2 0 4 0)◦t]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(t &larr; &rsquo;fot&rsquo; find: ch) &gt; 0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">new value follows</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">v &larr; s integerScan.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t=1⇒ [self maskrun: i to: j under: 0360 to: (v lshift: 4)]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]</span></div>
<div class="line left">
<span class="small bold">bravoRuns: s </span><span class="small italic">"Encode the runs in a Bravo paragraph trailer onto a Stream"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">| i old len dif new bit bits<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">["assume Ctrl-Z is already there"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s append: [alignment=1⇒[&rsquo;j\g&rsquo;]; =2⇒[&rsquo;c\g&rsquo;] &rsquo;\g&rsquo;].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[runs≡nil ⇒ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len &larr; 0. old &larr; 0400.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bits &larr; ↪(1 2 4).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ i from: 1 to: runs length by: 2 do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[dif &larr; old lxor: (new &larr; runs◦(i+1)).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(dif land: 0367)=0 ⇒ </span><span class="small italic">"No changes"</span><span class="small"> [len &larr; len+(runs◦i)]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[i=1⇒[] len printon: s].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ bit to: 3 do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(dif land: bits◦bit)=0 ⇒ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s next &larr; ([(new land: bits◦bit)≠0 ⇒ [&rsquo;biu&rsquo;] &rsquo;BIU&rsquo;])◦bit].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(dif land: 0360)≠0 ⇒ </span><span class="small italic">"Font change"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[s append: &rsquo;f&rsquo;; print: (new lshift: ¬4); space]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">old &larr; new.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len &larr; runs◦i.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s cr]</span></div>
<div class="line left">
<span class="small bold">fromBravo </span><span class="small italic">"Find Bravo trailers and return a copy of self with them applied"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">| newpara newtext loc i j<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[newpara &larr; self copy.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">loc &larr; 1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (i &larr; (newtext &larr; newpara text) find: 032)≠0 do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[j &larr; newtext◦(i+1 to: newtext length) find: 015.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">newpara applyBravo: newtext◦(i+1 to: i+j) at: loc to: i-1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">newpara replace: i to: [i+j=newtext length⇒[i+j] i+j-1] by: &rsquo;&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">loc &larr; i+1]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑newpara]</span></div>
<div class="line left">
<span class="small bold">toBravo </span><span class="small">| s [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; (String new: text length*2) asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s append: text; next &larr; 032.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self bravoRuns: s.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑s contents asParagraph]</span></div>
<div class="line left">
<span class="medium bold"><br>Press printing</span></div>
<div class="line left">
<span class="small bold">fromPress: press value: s </span><span class="small">| len x [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[s next=0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">text is in DL</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len &larr; s nextword.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">amount to skip from where we are now to end of text</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">x &larr; [s limit &gt; 255⇒ ["</span><span class="small italic">control info came from DL</span><span class="small">" s limit] "</span><span class="small italic">from EL</span><span class="small">" 0].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">press data skip: 0-x-len.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text &larr;  press data next: len.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">press data skip: x]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text &larr; s nextString].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs &larr; s nextString.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">alignment &larr; s next.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs empty⇒ [runs &larr; nil]]</span></div>
<div class="line left">
<span class="small bold">hideData: complete </span><span class="small">| s [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; Stream new of: (String new: 150).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s next &larr; complete.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[complete=0⇒ [s nextword &larr; text length] s nextString &larr; text].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s nextString&larr; [runs≡nil⇒ [nullString] runs];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">next&larr; alignment.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑s contents]</span></div>
<div class="line left">
<span class="small bold">hidePress: press complete: c </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">not called by Form-Path-Image, but probably by Class printout</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">press skipcode: self pressCode data: (self hideData: c)]</span></div>
<div class="line left">
<span class="small bold">pressCode </span><span class="small">[⇑99]</span></div>
<div class="line left">
<span class="small bold">presson: press in: r </span><span class="small">[⇑self presson: press in: r style: self textStyle]</span></div>
<div class="line left">
<span class="small bold">presson: press in: r style: style </span><span class="small">| char pos s3 y chop [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"Output paragraph inside rectangle (page coordinates)"</span><span class="small"><br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"probably ParagraphScanner should handle this"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text length &gt; 0 and⦂ text◦1 = 014⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"formfeed --&gt; page break"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑self copy: 2 to: text length]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">y &larr; r corner y.</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"We change corner y later"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s3 &larr; ParagraphScanner new of: self to: press style: style.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s3 init in: r.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pos &larr; s3 position.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">chop &larr; [alignment=1⇒ [0] alignment].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (y and⦂ (char &larr; s3 scan)) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">char = 011 ⇒ [s3 tab]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">char = 040 or⦂ char = 015 ⇒</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"carriage return or exceeded max width and backed up to blank"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">y &larr; s3 printfrom: pos aligned: [char=040⇒[alignment] chop] skip: 1⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[r corner y &larr; y. s3 init in: r. pos &larr; s3 position]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">char ≡ true ⇒[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"exceeded max width with no blanks in line"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s3 backup.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">y &larr; s3 printfrom: pos aligned: 0 skip: 0⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[r corner y &larr; y. s3 init in: r. pos &larr; s3 position]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"user notify: &rsquo;unimplemented control char&rsquo;"</span><span class="small">].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"Put out trailing text if any"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">y and⦂ ((pos=s3 position) or⦂ (y &larr; s3 printfrom: pos aligned: chop skip: 0))⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">press append: text.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑y]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">press append: text◦(1 to: pos).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑self copy: pos + 1 to: text length]</span></div>
<div class="line left">
<span class="medium bold"><br>Filing</span></div>
<div class="line left">
<span class="small bold">readFrom: file </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">text &larr; file nextString.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs &larr; file nextString.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">alignment &larr; file next.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">runs empty⇒ [runs &larr; nil]]</span></div>
<div class="line left">
<span class="small bold">storeOn: file </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file nextString &larr; text.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[runs≡nil⇒ [file next &larr; 0] file nextString &larr; runs].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file next &larr; alignment]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪Paragraph under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Reader"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;Reader&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: Object<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;source collector token nextchar typetbl &rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;typetable &rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>Converts a string to tokens.  The collector defines what to do for each kind of token: see TokenCollector and Compressor for examples.  (P. Deutsch)</span></div>
<div class="line left">
<span class="medium bold"><br>Initialization</span></div>
<div class="line left">
<span class="small bold">classInit </span><span class="small">| strm type first last i </span><span class="small italic">"Initialize the type and mask tables"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[typetable&larr; String new: 256.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">strm&larr; Stream new of: ↪(<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">5 0 0377  </span><span class="small italic">"(initialize)"</span><span class="small"><br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">1 0101 0132  1 0141 0172  </span><span class="small italic">"upper and lower case letters"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">2 060 071  </span><span class="small italic">"digits"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">3 072 072  3 03 03  </span><span class="small italic">"colon, open colon"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">4 011 012  4 014 015  4 040 040  </span><span class="small italic">"TAB, LF, FF, CR, blank"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"5 is one-char tokens"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">6 042 042  6 031 031  </span><span class="small italic">"comment quote and ➲"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">7 047 047  </span><span class="small italic">"string quote"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">8 025 025  </span><span class="small italic">"high-minus"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">9 032 032  </span><span class="small italic">"&uarr;Z (format trailer)"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">10 036 036  </span><span class="small italic">"DOIT"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">11 050 051  </span><span class="small italic">"open and close paren"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (type&larr; strm next) do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[first&larr; strm next. last&larr; strm next.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ i from: (first+1 to: last+1) do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[typetable◦i&larr; type]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]</span></div>
<div class="line left">
<span class="small bold">of: s<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[typetbl&larr; typetable.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">token&larr; Stream default.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">source&larr; s asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self step]</span></div>
<div class="line left">
<span class="medium bold"><br>Main reader</span></div>
<div class="line left">
<span class="small bold">read<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑self readInto: TokenCollector default]</span></div>
<div class="line left">
<span class="small bold">readatom: ncolons </span><span class="small">| type s<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[token reset.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ [token next&larr; nextchar.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(nextchar&larr; source next)⇒[(type&larr; typetbl◦(nextchar+1))≤3]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">false]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[type=3⇒[ncolons&larr; ncolons+1]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s&larr; token contents.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">ncolons=0⇒[collector identifier: s];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&gt;1⇒[collector otheratom: s].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s length=1⇒[collector otheratom: s] </span><span class="small italic">": or ⦂ alone"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s◦s length=072⇒[collector keyword: s];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=03⇒[collector keyword: s].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">collector otheratom: s. </span><span class="small italic">"Colon wasn&rsquo;t last character"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]</span></div>
<div class="line left">
<span class="small bold">readInto: collector </span><span class="small">| x <br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[while⦂  nextchar  do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[x&larr; typetbl◦(nextchar+1).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"See classInit for the meanings of the type codes"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">x=4⇒ [collector separator: nextchar. nextchar&larr; source next];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=1⇒ [self readatom: 0];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=5⇒ [collector onechar: nextchar. nextchar&larr; source next];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=6⇒ [self upto: nextchar⇒[collector notify: &rsquo;Unmatched comment quote&rsquo;]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">collector comment: token contents];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=2⇒ [self readnum];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=11⇒ [[nextchar=050⇒[collector leftparen] collector rightparen].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextchar&larr; source next];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=7⇒ [self upto: nextchar⇒[collector notify: &rsquo;Unmatched string quote&rsquo;]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">collector string: token contents];</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=8⇒ [self readnum];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=9⇒ [self upto: 015⇒[collector notify: &rsquo;&uarr;Z without CR&rsquo;]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">collector trailer: token contents];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=10⇒ [⇑collector contents];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=3⇒ [self readatom: 1]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑collector contents]</span></div>
<div class="line left">
<span class="small bold">readnum </span><span class="small">| val d e<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[val&larr; self rdint: 025.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextchar=056⇒</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"check for decimal point"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self step.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextchar≡false or⦂ nextchar isdigit≡false⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[collector integer: val.  collector onechar: 056]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"was &lt;Integer&gt; .  "</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">d&larr; self rdint: ¬1.</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"fraction part"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[nextchar=0145⇒</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"check for e&lt;exponent&gt; "</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self step.  e&larr; self rdint: 025]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">e&larr; &rsquo;&rsquo;].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">collector float: val fraction: d exp: e]<br> </span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">collector integer: val]</span></div>
<div class="line left">
<span class="medium bold"><br>Internal readers</span></div>
<div class="line left">
<span class="small bold">rdint: char </span><span class="small italic">"Read an integer, allow char as first char"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[token reset.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[nextchar=char⇒[token next&larr; char. self step]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ nextchar do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[nextchar&lt;060⇒[⇑token contents]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextchar&gt;071⇒[⇑token contents]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">token next&larr; nextchar. nextchar&larr; source next].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑token contents]</span></div>
<div class="line left">
<span class="small bold">step<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[nextchar&larr; source next]</span></div>
<div class="line left">
<span class="small bold">upto: char </span><span class="small">| start </span><span class="small italic">"Knows about doubled &rsquo; in strings"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[start&larr; source position.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">token reset.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (nextchar&larr; source next) do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[[nextchar=char⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self step. char≠047⇒[⇑false] nextchar≠047⇒[⇑false]]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">token next&larr; nextchar].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"Ran off end, back up."</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">source skip: start - 1 - source position.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑true]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪Reader under: &rsquo;Text Objects&rsquo;.</span></div>
<div class="line left">
<span class="small">Reader classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"RemoteParagraph"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;RemoteParagraph&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: Object<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;file hipos lowpos&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>These instances refer to text stored on a file, typically residing on a remote<br>machine and accessed via the ether.  The representation has been chosen for<br>compactness, and the bias of ¬1000 keeps the two parts of the position in the<br>range of small integers (¬1024 to 1022) to reduce allocation and paging of objects.</span></div>
<div class="line left">
<span class="medium bold"><br>As yet unclassified</span></div>
<div class="line left">
<span class="small bold">asParagraph </span><span class="small">[</span><span class="small bold"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file position &larr; self position.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑Paragraph new readFrom: file]</span></div>
<div class="line left">
<span class="small bold">asString </span><span class="small">[⇑self asParagraph text]</span></div>
<div class="line left">
<span class="small bold">fromParagraph: p </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">write me (only once!) on file</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self position &larr; file position.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">p storeOn: file]</span></div>
<div class="line left">
<span class="small bold">fromString: s </span><span class="small">[self fromParagraph: s asParagraph]</span></div>
<div class="line left">
<span class="small bold">on: file</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"Refer me to a specific file"</span></div>
<div class="line left">
<span class="small bold">position </span><span class="small">[⇑(hipos+1000)*2000 + (lowpos+1000)]</span></div>
<div class="line left">
<span class="small bold">position&larr; p<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[p &larr; p intdiv: 2000.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">hipos&larr; (p◦1) asInteger -1000.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">lowpos&larr; (p◦2) asInteger -1000]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪RemoteParagraph under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Textframe"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;Textframe&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: Object<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;frame para style reply1 reply2 window&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>I display a paragraph on the screen in a frame clipped by a window</span></div>
<div class="line left">
<span class="medium bold"><br>Initialization</span></div>
<div class="line left">
<span class="small bold">para: para frame: frame<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[window&larr;frame.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">reply1&larr;reply2&larr;0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">style&larr;DefaultTextStyle]</span></div>
<div class="line left">
<span class="small bold">para: para frame: frame style: style<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[window&larr;frame.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">reply1&larr;reply2&larr;0]</span></div>
<div class="line left">
<span class="small bold">style: style</span></div>
<div class="line left">
<span class="medium bold"><br>Scheduling</span></div>
<div class="line left">
<span class="small bold">aboutToFrame<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"My frame is about to change.  I dont care."</span><span class="small">]</span></div>
<div class="line left">
<span class="small bold">takeCursor<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"Move the cursor to the center of my window."</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user cursorloc &larr; window center]</span></div>
<div class="line left">
<span class="medium bold"><br>Image</span></div>
<div class="line left">
<span class="small bold">asForm: pt </span><span class="small">| char ul ur f<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"put bits of character into a form -- when Form package in system"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[char &larr; self charofpt: pt. ul &larr; reply1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self ptofchar: char + 1. ur &larr; reply1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">f &larr; Form new size: ur x - ul x by: reply2 y - reply1 y.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">f translate: ul; scale: 1. ⇑f ]</span></div>
<div class="line left">
<span class="small bold">comp<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[window comp]</span></div>
<div class="line left">
<span class="small bold">copyto: path effect: effect </span><span class="small">| i oldmode</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"show clipped inside rect"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[  <br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">path is: Point ⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[oldmode &larr; style mode. style mode: effect. window translateto: path. self show. style mode: oldmode.]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">path is: Path ⇒ [for⦂ i to: path length do⦂ [ self copyto: path◦i effect: effect] ]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]</span></div>
<div class="line left">
<span class="small bold">corner </span><span class="small">[⇑frame corner]</span></div>
<div class="line left">
<span class="small bold">displayat: path effect: effect clippedBy: cliprect</span><span class="small">| i oldmode </span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"show clipped inside rect"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[  <br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">path is: Point ⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[oldmode &larr; style mode. style mode: effect. frame translateto: path. window &larr; cliprect. self show. style mode: oldmode.  ]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">path is: Path ⇒ [for⦂ i to: path length do⦂ [ self displayat: path◦i effect: effect] ]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]</span></div>
<div class="line left">
<span class="small bold">erase<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(window inset: (¬2⌾¬2)) clear]</span></div>
<div class="line left">
<span class="small bold">extent </span><span class="small">[⇑frame extent]</span></div>
<div class="line left">
<span class="small bold">frame </span><span class="small">[⇑frame]</span></div>
<div class="line left">
<span class="small bold">frame &larr; frame<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"Change my frame and window."</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window &larr; frame.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]</span></div>
<div class="line left">
<span class="small bold">height </span><span class="small">[⇑frame height]</span></div>
<div class="line left">
<span class="small bold">origin </span><span class="small">[⇑frame origin]</span></div>
<div class="line left">
<span class="small bold">outline<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[window border: 2 color: black]</span></div>
<div class="line left">
<span class="small bold">para </span><span class="small">[⇑para]</span></div>
<div class="line left">
<span class="small bold">showin: rect </span><span class="small">| old</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"show clipped inside rect"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[old &larr; window. window &larr; rect. self show. window &larr; old]</span></div>
<div class="line left">
<span class="small bold">size </span><span class="small">[⇑frame extent]</span></div>
<div class="line left">
<span class="small bold">style </span><span class="small">[⇑style]</span></div>
<div class="line left">
<span class="small bold">width </span><span class="small">[⇑frame width]</span></div>
<div class="line left">
<span class="small bold">window </span><span class="small">[⇑window]</span></div>
<div class="line left">
<span class="medium bold"><br>Text</span></div>
<div class="line left">
<span class="small bold">charnearpt: pt </span><span class="small">[user croak] primitive: 58</span></div>
<div class="line left">
<span class="small bold">charofpt: pt </span><span class="small">[user croak] primitive: 58</span></div>
<div class="line left">
<span class="small bold">dopressjst: pt<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"For building justified lines in Press Format files<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">[reply1 x &larr; trailingbits.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">reply1 y &larr; internalspaces.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">reply2 y &larr; heightofline.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">[reply2 x &lt; 0 ⇒[linenotjustified]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">⇑lastcharinline]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">user will have to back up in string to find last printing character<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">(at least non-space, cr, or tab)"</span><span class="small"><br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user croak] primitive: 64</span></div>
<div class="line left">
<span class="small bold">findmaxx: char<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[char is: Integer⇒[user croak]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self findmaxx: char asInteger] primitive: 63</span></div>
<div class="line left">
<span class="small bold">lastshown<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑reply1]</span></div>
<div class="line left">
<span class="small bold">lineheight<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑style lineheight]</span></div>
<div class="line left">
<span class="small bold">maxx: char<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self findmaxx: char. ⇑ reply1]</span></div>
<div class="line left">
<span class="small bold">measuretext: startx to: stopx string: string from: first to: last font: font<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">["Returns character index of character immediately following character<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">causing exception condition.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Reply1</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Exception code.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">1</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Encountered space, cr, tab, or ascii 0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">2</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Crossed stopx.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">3</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Both 1 and 2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">4</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Encountered last before hitting stopx or special character.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Reply2</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Leftx of character causing exception condition."<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user croak] primitive: 103</span></div>
<div class="line left">
<span class="small bold">ptofchar: char<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self selectchar: char. ⇑reply1]</span></div>
<div class="line left">
<span class="small bold">ptofpt: pt<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self charnearpt: pt. ⇑reply1]</span></div>
<div class="line left">
<span class="small bold">put: para at: pt<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self put: para at: pt centered: false]</span></div>
<div class="line left">
<span class="small bold">put: para at: pt centered: center<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[para &larr; para asParagraph.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window &larr; frame &larr; pt rect: 1000⌾1000.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self ptofchar: para length+1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window growto: reply2 + (4⌾0).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[center⇒ [window moveby: pt-window center]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window &larr; window inset: ¬3⌾¬2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window clear: white. self show]</span></div>
<div class="line left">
<span class="small bold">put: para at: pt maxextent: maxextent<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[para &larr; para asParagraph.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window &larr; frame &larr; Rectangle new origin: pt extent: maxextent.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self findmaxx: para length+1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window growto: reply2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window &larr; window inset: ¬3⌾¬2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window clear: white. self show]</span></div>
<div class="line left">
<span class="small bold">put: para centered: pt<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self put: para at: pt centered: true]</span></div>
<div class="line left">
<span class="small bold">rectofchar: char<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self selectchar: char. ⇑reply1 rect: reply2]</span></div>
<div class="line left">
<span class="small bold">scrolln: n<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑self charofpt: frame corner x ⌾ (frame origin y+(n*style lineheight))]</span></div>
<div class="line left">
<span class="small bold">selectchar: char<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[char is: Integer⇒[user croak]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self selectchar: char asInteger] primitive: 59</span></div>
<div class="line left">
<span class="small bold">show </span><span class="small">[user croak] primitive: 57</span></div>
<div class="line left">
<span class="small bold">show: para<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[para &larr; para asParagraph. self show]</span></div>
<div class="line left">
<span class="small bold">showline: first to: last lastx: lastx spaces: spaces trailingspaces: trailingspaces startrun: startrun firstrunlength: firstrunlength<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">["For use in conjunction with </span><span class="small bold">measuretext</span><span class="small"> primitive.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Characters </span><span class="small bold">first</span><span class="small"> through </span><span class="small bold">last</span><span class="small"> will be displayed, clipped by the </span><span class="small bold">frame</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">and </span><span class="small bold">window</span><span class="small">.  The </span><span class="small bold">lastx</span><span class="small"> should be the lastx of </span><span class="small bold">last</span><span class="small">.  If justification<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">is on in </span><span class="small bold">para</span><span class="small"> and </span><span class="small bold">spaces</span><span class="small"> is &gt; 0, the line will be justified.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Passing </span><span class="small bold">spaces</span><span class="small"> as 0 causes suppression of justificaton even if<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">justification is turned on in </span><span class="small bold">para</span><span class="small">; space characters will be displayed<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">normally even when </span><span class="small bold">spaces</span><span class="small"> is 0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small bold">Trailingspaces</span><span class="small"> is needed for justification.  </span><span class="small bold">Startrun</span><span class="small"> is an integer index<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">into the runs, indicating which run to start on.  </span><span class="small bold">Firstrunlength</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">is the number of characters remaining in run </span><span class="small bold">startrun</span><span class="small">.  Note that<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while runs in a paragraph are allocated as a string, </span><span class="small bold">startrun</span><span class="small"> will<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">be considered a word index.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small bold">maxascent</span><span class="small"> and </span><span class="small bold">maxdescent</span><span class="small"> in </span><span class="small bold">style</span><span class="small"> must be nonnil to avoid a croak."<br><br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user croak] primitive: 104</span></div>
<div class="line left">
<span class="medium bold"><br>Conversion</span></div>
<div class="line left">
<span class="small bold">makeParagraph </span><span class="small">["</span><span class="small italic">simulate ListPane for hardcopy</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">para≡nil⇒ [para &larr; &rsquo;NIL !&rsquo; asParagraph]]</span></div>
<div class="line left">
<span class="medium bold"><br>Printing</span></div>
<div class="line left">
<span class="small bold">hardcopy </span><span class="small">| pf [user displayoffwhile⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pf &larr; dp0 pressfile: &rsquo;frame.press&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window hardcopy: pf.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self hardcopy: pf.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pf close; toPrinter]]</span></div>
<div class="line left">
<span class="small bold">hardcopy: pf </span><span class="small">| r first last lasty len parag left right top bottom [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[para≡nil⇒ [self makeParagraph]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">parag &larr; para asParagraph.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">frame=window⇒ [parag presson: pf in: (pf transrect: window) style: style]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">left &larr; frame minX max: window minX.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">right &larr; window maxX min: frame maxX.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bottom &larr; window maxY min: frame maxY.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">top &larr; window minY max: frame minY.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">lasty &larr; top + 4. "slop for char finding and making print rect larger"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">first &larr; self charofpt: left+1 ⌾ lasty.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len &larr; parag length.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">frame minX ≥ left and⦂ frame maxX ≤ right⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"paragraph is inset and may be scrolled"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(parag copy: first to: len) presson: pf in: (<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pf transrect: (left ⌾ top rect: right ⌾ (bottom+4))) style: style]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">yuk, frame extends left or right so do it a line at a time for clipping</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (first &lt; len and⦂ lasty &lt; bottom) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">last &larr; (self charofpt: right-1 ⌾ lasty) min: len.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">r &larr; self rectofchar: last.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">lasty &larr; lasty + r height.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(parag copy: first to: last) presson: pf in:<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(pf transrect: (left ⌾ (r minY) rect: right ⌾ lasty)) style: style.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">first &larr; last+1]]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪Textframe under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"ParagraphEditor"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;ParagraphEditor&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: TextImage<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;oldEntity sel&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;on off &rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>This version of ParagraphEditor (for use in CodePanes) is based on TextImage</span></div>
<div class="line left">
<span class="medium bold"><br>Scheduling</span></div>
<div class="line left">
<span class="small bold">enter </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">begintypein &larr; false.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self show; select]</span></div>
<div class="line left">
<span class="small bold">leave </span><span class="small">[self complement: off]</span></div>
<div class="line left">
<span class="medium bold"><br>Editing</span></div>
<div class="line left">
<span class="small bold">again  </span><span class="small">| many<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[many&larr; user leftShiftKey.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self fintype⇒ [Scrap &larr; Scrap text. self select]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">many⇒[while⦂ self againOnce do⦂ []]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self againOnce⇒[] frame flash]</span></div>
<div class="line left">
<span class="small bold">againOnce  </span><span class="small">| t<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[t &larr; para findString: Deletion startingAt: c2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t=0⇒ [⇑false]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self unselect.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c1 &larr; t.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c2 &larr; c1 + Deletion length.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self replace: Scrap; selectAndScroll]</span></div>
<div class="line left">
<span class="small bold">copy </span><span class="small">[Scrap &larr; self selection]</span></div>
<div class="line left">
<span class="small bold">cut </span><span class="small">[self fintype; replace: nullString; complement. Scrap &larr; Deletion]</span></div>
<div class="line left">
<span class="small bold">paste </span><span class="small">[self fintype; replace: Scrap; selectAndScroll]</span></div>
<div class="line left">
<span class="small bold">realign </span><span class="small">[self align. sel &larr; on]</span></div>
<div class="line left">
<span class="small bold">undo </span><span class="small">[self fintype; replace: Deletion; complement]</span></div>
<div class="line left">
<span class="medium bold"><br>Public Messages</span></div>
<div class="line left">
<span class="small bold">contents </span><span class="small">[⇑para]</span></div>
<div class="line left">
<span class="small bold">Deletion &larr; s </span><span class="small">[Deletion &larr; s]</span></div>
<div class="line left">
<span class="small bold">fixframe: f </span><span class="small">| dy  [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dy &larr; [frame≡nil⇒ [0] self frameoffset].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window &larr; f copy.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">frame &larr; Rectangle new origin: window origin + (2⌾dy)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"> extent: window width-4 ⌾ 9999.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑window]</span></div>
<div class="line left">
<span class="small bold">formerly </span><span class="small">[⇑oldEntity]</span></div>
<div class="line left">
<span class="small bold">formerly: oldEntity</span></div>
<div class="line left">
<span class="small bold">frame&larr; f </span><span class="small">[self fixframe: f]</span></div>
<div class="line left">
<span class="small bold">kbd </span><span class="small">| more char "key struck on the keyboard"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[c1&lt;c2 and⦂ self checklooks⇒[⇑self show complement]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">more &larr; Set new string: 16.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[begintypein⇒[] Deletion &larr; self selection. begintypein &larr; c1].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (char &larr; user kbdnext) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">char<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=bs⇒ ["</span><span class="small italic">backspace</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">more empty⇒ [begintypein &larr; begintypein min: (c1 &larr; 1 max: c1-1)]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">more skip: ¬1];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=cut⇒ [self fintype. [c1=c2⇒[c2&larr; c1+1 min: para length+1]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self replace: nullString; complement. Scrap &larr; Deletion. ⇑self];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=paste⇒ [⇑self paste];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=ctlw⇒ ["</span><span class="small italic">ctl-w for backspace word</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[more empty⇒ [] self replace: more. more reset. c1 &larr; c2].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c1 &larr; 1 max: c1-1.</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ [c1&gt;1 and⦂ (para◦(c1-1)) tokenish] do⦂ [c1 &larr; c1-1].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">begintypein &larr; begintypein min: c1];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">=esc⇒ ["</span><span class="small italic">select previous type-in</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[more empty⇒[self unselect]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self replace: more. c1 &larr; c2].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self fintype.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c1 &larr; c2-Scrap length.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑self complement]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">just a normal character</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">more next&larr; char].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self replace: more.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c1 &larr; c2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self selectAndScroll]</span></div>
<div class="line left">
<span class="small bold">keyset</span></div>
<div class="line left">
<span class="small bold">Scrap &larr; s </span><span class="small">[Scrap &larr; s]</span></div>
<div class="line left">
<span class="small bold">scrollby: n </span><span class="small">| oldw [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">n &larr; (n * self lineheight) max: self frameoffset.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">frame moveby: 0⌾(0-n).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">n abs ≥ window height⇒ [self show; select]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">need only to reshow part of window</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">oldw &larr; window.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window &larr; [n &lt; 0⇒ [window inset: 0⌾0 and: 0⌾(0-n)]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window inset: 0⌾n and: 0⌾0].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window blt: window origin - (0⌾n) mode: storing.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[n&lt;0⇒ [window corner y &larr; window origin y - n]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window origin y &larr; window corner y - n].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self show; select.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">window &larr; oldw]</span></div>
<div class="line left">
<span class="small bold">scrollPos </span><span class="small">| t [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t &larr; self height - self lineheight.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t=0⇒ [⇑0.0]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑0.0 - self frameoffset / t]</span></div>
<div class="line left">
<span class="small bold">scrollTo: f </span><span class="small">[self scrollUp: self frameoffset + (f* self height) - 4]</span></div>
<div class="line left">
<span class="small bold">scrollUp: n </span><span class="small">[self scrollby: n/self lineheight]</span></div>
<div class="line left">
<span class="small bold">select: t </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self complement: off.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c1 &larr; c2 &larr; t.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self selectAndScroll]</span></div>
<div class="line left">
<span class="small bold">selectAndScroll </span><span class="small">| l dy c1y [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">l &larr; self lineheight.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self select.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c1y &larr; (self ptofchar: c1) y.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dy &larr; c1y - window minY.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[dy ≥ 0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dy &larr; c1y + l - 1 - window maxY max: 0]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dy≠ 0⇒ [self scrollby: (dy abs+l-1) / l * dy sign]]</span></div>
<div class="line left">
<span class="small bold">selecting </span><span class="small">| pt t [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t &larr; self charofpt: (pt &larr; user mp).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self complement: off; fintype.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[t=c1 and⦂ c1=c2⇒ [  "bugged hairline - maybe double-bug"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ [user redbug and⦂ t=(self charofpt: user mp)]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">do⦂ [].</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"wait for unclick or drawing selection"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user redbug≡false⇒[self selectword; select. ⇑true]]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sel &larr; on.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑super select: pt]</span></div>
<div class="line left">
<span class="small bold">selection </span><span class="small">[para text empty⇒ [⇑para copy] ⇑para copy: c1 to: c2-1]</span></div>
<div class="line left">
<span class="small bold">selectionAsStream </span><span class="small">[⇑Stream new of: para text from: c1 to: c2-1]</span></div>
<div class="line left">
<span class="small bold">show </span><span class="small">[self primshow. sel &larr; off]</span></div>
<div class="line left">
<span class="small bold">typing </span><span class="small">[self kbd]</span></div>
<div class="line left">
<span class="small bold">unselect </span><span class="small">[self complement: off]</span></div>
<div class="line left">
<span class="medium bold"><br>Private</span></div>
<div class="line left">
<span class="small bold">checklooks </span><span class="small">| t val mask [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t &larr; ↪(166 150 137 151   230 214 201 215<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">135 159 144 143 128 127 129 131 180 149<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">199 223 208 207 192 191 240 226) find: user kbck.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t=0⇒[⇑false]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user kbd.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[oldEntity⇒[] oldEntity &larr; para. para &larr; para copy].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t=25⇒[para &larr; para toBravo]; "ctl-T" <br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"> =26⇒[para &larr; para fromBravo]. "ctl-F" <br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">val &larr; ↪(1 2 4 256   ¬1 ¬2 ¬4 256  "ctl-b i - x   B I ¬ X"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">0 16 32 48 64 80 96 112 128 144  "ctl-0 1 ... 9"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">160 176 192 208 224 240)◦t.  "ctl-shift-0 1 ... 5"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[val=256⇒[mask&larr; 0377.  val&larr; 0]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"reset all"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">val&lt;0⇒[mask&larr; 0-val.  val&larr; 0]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"reset emphasis"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">val&gt;0 and⦂ val&lt;16⇒[mask&larr; val]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"set emphasis"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">mask&larr; 0360].</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"set font"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">para maskrun: c1 to: c2-1 under: mask to: val]</span></div>
<div class="line left">
<span class="small bold">classInit </span><span class="small">[on &larr; 1. off &larr; 0]</span></div>
<div class="line left">
<span class="small bold">complement </span><span class="small">[self complement: on]</span></div>
<div class="line left">
<span class="small bold">complement: nsel </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nsel = sel⇒ ["already that way"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nsel = on and⦂ (user rawkbck or⦂ user redbug)⇒ ["slippage"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sel &larr; nsel.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self reversefrom: c1 to: c2]</span></div>
<div class="line left">
<span class="small bold">frameoffset </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"a useful number"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑frame minY - window minY]</span></div>
<div class="line left">
<span class="small bold">height </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self selectchar: para length+1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑reply2 y - frame minY]</span></div>
<div class="line left">
<span class="small bold">primshow </span><span class="small">[user croak] primitive: 57</span></div>
<div class="line left">
<span class="small bold">replace: t </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[oldEntity⇒ [] oldEntity &larr; para. para &larr; para copy].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[begintypein⇒ [] Deletion &larr; self selection].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">para replace: c1 to: c2-1 by: t.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c2 &larr; c1 + t length.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self show]</span></div>
<div class="line left">
<span class="small bold">select </span><span class="small">[self selectIn: nil]</span></div>
<div class="line left">
<span class="small bold">selectIn: w </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sel &larr; off.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[c1≡nil⇒ [c1 &larr; c2 &larr; 1]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self complement: on]</span></div>
<div class="line left">
<span class="small bold">selectRange </span><span class="small">[⇑c1 to: c2-1]</span></div>
<div class="line left">
<span class="small bold">selectRange: r </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"self complement: off"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c1 &larr; r start.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c2 &larr; r stop<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"self complement: on"]</span></div>
<div class="line left">
<span class="small bold">selectword </span><span class="small">| a b dir t level open close s slen<br>[<br>"</span><span class="small italic">Select bracketed or word range, as a result of double-bug.</span><span class="small">"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">a&larr; b&larr; dir&larr; ¬1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; para text.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">slen &larr; s length.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">level &larr; 1.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">open &larr; &rsquo;([{&lt;&rsquo;&rsquo;"<br>&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">close &larr; &rsquo;)]}&gt;&rsquo;&rsquo;"<br>&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[c1≤1⇒[dir&larr;1. t&larr;c1]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">c1&gt; slen⇒[t&larr;c1-1]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t&larr;open find: (a&larr; para◦(c1-1)). t&gt;0⇒</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">delim on left</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[dir&larr;1. b&larr;close◦t. t&larr;c1-1]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">match to the right</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t&larr;close find: (a&larr; para◦c1). t&gt;0⇒</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">delim on right</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[dir&larr;¬1. b&larr;open◦t. t&larr;c1]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">match to the left</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">a&larr; ¬1. t&larr;c1].</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">no delims - select a token</span><span class="small">"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">until⦂ (level=0 or⦂ [dir=1⇒[t≥slen] t≤1]) do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[s◦(t&larr; t+dir) = b⇒ [level&larr; level-1];</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">leaving nest</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">= a⇒ [level&larr; level+1].</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">entering nest</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">a=¬1⇒[(s◦t) tokenish⇒</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">token check goes left </span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[t=1⇒[c1&larr; dir&larr; 1. t&larr; c2]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dir=¬1⇒[c1 &larr; t+1. dir&larr;1. t&larr;c2-1]</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">then right</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">level&larr; 0]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[level≠0⇒[t&larr; t+dir]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dir=1⇒[c2&larr; t min: slen+1] c1&larr; t+1<br>]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪ParagraphEditor under: &rsquo;Text Objects&rsquo;.</span></div>
<div class="line left">
<span class="small">ParagraphEditor classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"TextStyle"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;TextStyle&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: Object<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;fonts "&lt;Vector of Strings or Integers&gt; which are the fonts.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">An integer entry has a vertical offset in the high 8 bits, a 1 in<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">the 200-bit for descent, and another font number (zero-relative)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">in the bottom 4 bits"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">tabandspace "&lt;Integer&gt; =256*tabwidth + spacewidth"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">maxascent "&lt;Integer&gt; max ascent for this fontset"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">maxdescent "&lt;Integer&gt; max descent for this fontset"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">mode "&lt;Integer&gt; =0 for normal, =4 for white-on-black"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fontnames "&lt;Vector of Strings&gt; corresponding to the fonts"&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>I am a specification of how to display a paragraph.  I include a font set, a tab spacing, a space size, etc.  If I do not specify ascent and descent from the baseline, then each line displayed will adjust to its tallest characters.</span></div>
<div class="line left">
<span class="medium bold"><br>Initialization</span></div>
<div class="line left">
<span class="small bold">default<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[tabandspace &larr; mode &larr; 0. self mode: 0; tab: 20; space: 5.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">fonts &larr; Vector new: 16. fontnames &larr; Vector new: 16.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self setfont: 0 name: &rsquo;CREAM10&rsquo;.</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"Put default font in font 0"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]</span></div>
<div class="line left">
<span class="small bold">mode<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑ mode]</span></div>
<div class="line left">
<span class="small bold">mode: mode</span></div>
<div class="line left">
<span class="small bold">space<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑ (tabandspace land: 0377)]</span></div>
<div class="line left">
<span class="small bold">space: t<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[tabandspace &larr; (tabandspace land: 0177400) + (t land: 0377)]</span></div>
<div class="line left">
<span class="small bold">tab<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑ ((tabandspace land: 0177400) lshift: ¬8)]</span></div>
<div class="line left">
<span class="small bold">tab: t<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[tabandspace &larr; (tabandspace land: 0377) + (t lshift: 8)]</span></div>
<div class="line left">
<span class="medium bold"><br>Fonts</span></div>
<div class="line left">
<span class="small bold">fontfamily: n </span><span class="small">| s char<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"return the family name taken out of fontnames"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; Stream default.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ char from: fontnames ◦ n do⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[char isletter⇒ [s next &larr; char]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑s contents]]</span></div>
<div class="line left">
<span class="small bold">fontnames </span><span class="small">[⇑fontnames]</span></div>
<div class="line left">
<span class="small bold">fonts </span><span class="small">[⇑fonts]</span></div>
<div class="line left">
<span class="small bold">fontsize: n </span><span class="small">| s c size<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"return size from fontname"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">size &larr; 0. s &larr; (fontnames ◦ n) asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (c &larr; s next) isletter do⦂ [].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ [size &larr; size*10 + (c - 060). c &larr; s next] do⦂ [].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑size]</span></div>
<div class="line left">
<span class="small bold">setfont: n fromfile: name<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self setfont: n name: name fromstring: (dp0 oldFile: name + &rsquo;.strike.&rsquo;) contents]</span></div>
<div class="line left">
<span class="small bold">setfont: n name: name </span><span class="small">| ucn</span><span class="small bold"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[FontDict has: (ucn&larr; name asUppercase)⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self setfont: n name: ucn fromstring: FontDict◦ucn]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self setfont: n fromfile: name]</span></div>
<div class="line left">
<span class="small bold">setfont: n name: name fromstring: string<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"Should update maxascent, maxdescent"</span><span class="small bold"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[fontnames◦(n+1) &larr; name asUppercase.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">fonts◦(n+1) &larr; string.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">FontDict insert: fontnames◦(n+1) with: string]</span></div>
<div class="line left">
<span class="small bold">setoffsetfont: n from: m by: d<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[fonts◦n &larr; m + [d&lt;0⇒ [0200] 0] + (d lshift: 8)]</span></div>
<div class="line left">
<span class="small bold">writeset: styleindex<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self writeset: styleindex as: fontnames◦(styleindex+1)]</span></div>
<div class="line left">
<span class="small bold">writeset: styleindex as: name</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small bold"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"write out a formset on name with strike extention"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">name &larr; name + &rsquo;.strike.&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(dp0 file: name) append: fonts◦ (styleindex+1) ; close.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]</span></div>
<div class="line left">
<span class="medium bold"><br>Access</span></div>
<div class="line left">
<span class="small bold">heightofset: styleindex<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"Return height of formset in style"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑(fonts◦(styleindex+1) word: 6) +<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(fonts◦(styleindex+1) word: 7)]</span></div>
<div class="line left">
<span class="small bold">lineheight<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[((maxascent ≡ nil) or: (maxdescent ≡ nil)) ⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑((fonts◦1) word: 6) + ((fonts◦1) word: 7)]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑maxascent+maxdescent]</span></div>
<div class="line left">
<span class="small bold">maxascent<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[⇑ maxascent ]</span></div>
<div class="line left">
<span class="small bold">maxascent: maxascent</span></div>
<div class="line left">
<span class="small bold">maxdescent<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[ ⇑ maxdescent ]</span></div>
<div class="line left">
<span class="small bold">maxdescent: maxdescent</span></div>
<div class="line left">
<span class="small bold">maxwidthofset: styleindex<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"Return maximum width of formset in style"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑(fonts◦(styleindex+1) word: 4)]</span></div>
<div class="line left">
<span class="small bold">nameofset: styleindex<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"Return name of formset in style"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑(fontnames◦(styleindex+1))]</span></div>
<div class="line left">
<span class="small bold">strikeofset: styleindex<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[</span><span class="small italic">"Return strike of formset in style"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑(fonts◦(styleindex+1))]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪TextStyle under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"TokenCollector"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;TokenCollector&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: Object<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;sink parenstack&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>Provides standard token-collecting behavior for Reader .<br>See Reader-readInto: for more insight.  (P. Deutsch)</span></div>
<div class="line left">
<span class="medium bold"><br>Initialization</span></div>
<div class="line left">
<span class="small bold">default<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self to: (Vector new: 20)]</span></div>
<div class="line left">
<span class="small bold">to: v </span><span class="small italic">"Initialize"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[sink&larr; v asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">parenstack&larr; (Vector new: 5) asStream]</span></div>
<div class="line left">
<span class="medium bold"><br>Finalization</span></div>
<div class="line left">
<span class="small bold">contents </span><span class="small italic">"Close all parentheses first"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[until⦂ parenstack empty do⦂ [self rightparen].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑sink contents]</span></div>
<div class="line left">
<span class="small bold">next&larr; obj </span><span class="small">[sink next&larr; obj]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"subclasses can override easily"</span></div>
<div class="line left">
<span class="small bold">notify: errorString<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[user notify: errorString]</span></div>
<div class="line left">
<span class="medium bold"><br>Constructors</span></div>
<div class="line left">
<span class="small bold">comment: s</span></div>
<div class="line left">
<span class="small bold">float: i fraction: f exp: e<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self next&larr; (i+&rsquo;.&rsquo;+f+&rsquo;e&rsquo;+e) asFloat]</span></div>
<div class="line left">
<span class="small bold">identifier: s<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self next&larr; s unique]</span></div>
<div class="line left">
<span class="small bold">integer: s<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self next&larr; s asInteger]</span></div>
<div class="line left">
<span class="small bold">keyword: s<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self next&larr; s unique]</span></div>
<div class="line left">
<span class="small bold">leftparen<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[parenstack next&larr; sink.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sink&larr; (Vector new: 10) asStream]</span></div>
<div class="line left">
<span class="small bold">onechar: c </span><span class="small">| x<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[x&larr; String new: 1. x◦1&larr; c. self next&larr; x unique]</span></div>
<div class="line left">
<span class="small bold">otheratom: s<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self next&larr; s unique]</span></div>
<div class="line left">
<span class="small bold">rightparen<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[parenstack empty⇒[] </span><span class="small italic">"Error will be caught elsewhere"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">parenstack last next&larr; sink contents.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sink&larr; parenstack pop]</span></div>
<div class="line left">
<span class="small bold">separator: c</span></div>
<div class="line left">
<span class="small bold">string: s<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self next&larr; s]</span></div>
<div class="line left">
<span class="small bold">trailer: s</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪TokenCollector under: &rsquo;Text Objects&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"FieldNameCollector"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;FieldNameCollector&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: TokenCollector<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>This class collects identifiers as Strings (not UniqueStrings)<br>for scanning of class field names (Class.instvars)<br>by the compiler(Generator) and debugger(VariablePane)</span></div>
<div class="line left">
<span class="medium bold"><br>Valid fields</span></div>
<div class="line left">
<span class="small bold">identifier: s </span><span class="small">[sink next&larr; s]</span></div>
<div class="line left">
<span class="medium bold"><br>Invalid fields</span></div>
<div class="line left">
<span class="small bold">leftparen </span><span class="small">[self next&larr; &rsquo;(&rsquo;] "just for error message"</span></div>
<div class="line left">
<span class="small bold">next&larr; value<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[user notify: &rsquo;Invalid field name: &rsquo;+value asString]</span></div>
<div class="line left">
<span class="small bold">rightparen </span><span class="small">[self next&larr; &rsquo;)&rsquo;] "just for error message"</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪FieldNameCollector under: &rsquo;Text Objects&rsquo;.</span></div>
  </body>
</html>
