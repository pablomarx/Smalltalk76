'From Smalltalk 5.5k XM November 24 on 4 October 1990 at 11:41:27 pm.'\g"Axes"l15000z20000\gbf5 Class new title: 'Axes'	subclassof: Object	fields: 'origin window mode xScale yScale xaxis yaxis'	declare: '';	asFollows\gbf5 I display a pair of x-y axes with the following characteristics:	origin		the point at which the axes cross (screen coordinates)	window		the Rectangle in which I am displayed	mode			display mode: xoring, oring, storing, or erasing	xScale		(bits/large tick mark), (bits/small tick mark)	yScale		(bits/large tick mark), (bits/small tick mark)	xaxis			(a Rectangle, axis raster, underbits raster)	yaxis			(a Rectangle, axis raster, underbits raster)Notes:	Parts--relOrigin gives origin relative to inRect origin.	Change--no change is seen until a show. It may be necessary to unshow or at:		before showing an altered version, depending on mode or scale change.	Show--at:wrt: positions with-respect-to window origin.	Display--only at:* causes saving of covered bits and movement of axes.See example for a sample definition\giInit\gbf5 default [self mode: xoring; xScale: 0; yScale: 0]\gb8BParts\gbf5 finescale [(xScale2)  (yScale2)]\gb10B1b24Bmode [mode]\gb5Borigin [origin]\gb7BrelOrigin [origin-window origin]\gb10Bscale [(xScale1)  (yScale1)] "gives coarse only"\gb6B1b24B1iwindow [window]\gb7B1b7BxScale [xScale] "a Vector: (coarse, fine)"\gb7B1b7B1iyScale [yScale] "a Vector: (coarse, fine)"\gb7B1b7B1iChange\gbf5 mode: mode\gbxScale: k [self xScale: k finescale: k] "no finescale ticks"\gb10B29i21IxScale: k finescale: l | w a b r x [	w_user screenrect width.	a_00 rect: w5. b_a bitsIntoString. a clear: white.	[	k=0  [(02 extent: w1) comp "axis"]		(00 extent: 15) comp. "coarse tick"		[	l1 or lk  [] "otherwise draw short ticks (every l bits)"			for x from: l to: k-1 by: l do [(x1 extent: 13) comp]. ].		(02 extent: k1) clear: black. "axis"		r_00 rect: k5.		while r width<w do [ "duplicate"			r blt: r width0 mode: storing clippedBy: user screenrect.			r growby: r width0] ].	xScale_(k,l). xaxis_(a, a bitsIntoString, false).	a bitsFromString: b ]\gb32B1b2B115i6I28i13I22i43I100i6I44i12IyScale: k [self yScale: k finescale: k] "no finescale ticks"\gb10B30i20IyScale: k finescale: l | h a b r y [	h_user screenrect height.	a_00 rect: 5h. b_a bitsIntoString. a clear: white.	[	k=0  [(20 extent: 1h) comp "axis"]		(00 extent: 51) comp. "coarse tick"		[	l1 or lk  [] "otherwise draw short ticks (every l bits)"			for y from: l to: k-1 by: l do [(1y extent: 31) comp]. ].		(20 extent: 1k) clear: black. "axis"		r_00 rect: 5k.		while r height<h do [ "duplicate"			r blt: 0r height mode: storing clippedBy: user screenrect.			r growby: 0r height] ].	yScale_(k,l). yaxis_(a, a bitsIntoString, false).	a bitsFromString: b ]\gb35B116i6I28i13I22i43I100i6I45i12IShow\gbf5 at: origin | k z [	[ windownil  [window_user screenrect] ].	k_xScale1. z_window origin x.	xaxis1 moveto: ([k=0[z] z+(origin x-z \k)-k])(origin y-2).	k_yScale1. z_window origin y.	yaxis1 moveto: (origin x-2)([k=0[z] z+(origin y-z \k)-k]).	self savebits ]\gb16Bat: origin in: window [self at: origin]\gb22Bat: pt wrt: window [self at: pt+window origin] "pt with-respect-to window origin"\gb19B27ireshow [self at: origin; show] "redisplay on changed screen"\gb7B23b1Birestorebits [	[xaxis3 [(xaxis1 intersect: window) bitsFromString: xaxis3. xaxis3_false] ].	[yaxis3 [(yaxis1 intersect: window) bitsFromString: yaxis3. yaxis3_false] ]. ]\gb12Bsavebits [	xaxis3 _ (xaxis1 intersect: window) bitsIntoString.	yaxis3 _ (yaxis1 intersect: window) bitsIntoString. ]\gb9Bshow [	[ xaxis3  [] self savebits ].	xaxis1 bitsFromString: xaxis2 mode: mode clippedBy: window.	yaxis1 bitsFromString: yaxis2 mode: mode clippedBy: window.	mode=xoring  [ "xoring twice works right"		[ xScale10[(origin-(02) extent: 15) comp] ].		[ yScale10[(origin-(20) extent: 51) comp] ]. ]	mode=storing and yScale1=0  [ "redraw covered x-axis piece"		(origin-(20) extent: 51) comp ] ]\gb5B175i1I2i26I138i1I2i29Iunshow [self restorebits]\gb7BExample\gbf5 example"	Creating, showing, and changing an Axes	axes_Axes new default.	axes xScale: 15 finescale: 5. axes yScale: 16 finescale: 4.	axes mode: oring. axes mode: xoring. axes mode: erasing. axes mode: storing.	while user nobug do [].	axes at: user mp; show.	axes at: user mp in: user screenrect; show.	axes at: user mp in: Rectangle new fromuser; show.	axes at: 2020 wrt: Rectangle new fromuser; show.	axes show. axes unshow."\gb8B2i39I\gSystemOrganization classify: Axes under: 'Axes/Gridding'.\g"Grid"l15000z20000\gbf5 Class new title: 'Grid'	subclassof: Rectangle	fields: 'window tracker'	declare: '';	asFollows\gbf5 grid is defined by tiling the rectangle from its origin.the grid points may be shown and unshown (xoring), clipped by window.bugging returns the closest grid point to the mouse, relative to origin.	leftShiftKey causes display of coords of nearest grid point, at that point.	will not finish as long as either the leftShiftKey or the mouse button is down.	currently selected point is updated only while mouse button is down.	false is returned if a point outside the window is bugged.\giInit\gbf5 copy [ [self class new tracker: tracker copy; at: origin in: window copy; grid: self grid] ]\gb5B2b85Bdefault | v [	v_UnitViewer new readonly		units: (('grid', 10) inVector, ('pts', 1), ('picas', 12), ('inches', (72, 100))).	tracker_[ AttributeMenu init		title: 'x'; extract: x; assign: 'x_'; viewer: v copy;		title: 'y'; extract: y; assign: 'y_'; viewer: v copy ].	self origin: 00 corner: 1010;		grid: self extent; window: user screenrect. ]\gb8Binit [self default]\gb5BParts\gbf5 grid [self extent]\gbtracker [tracker]\gbwindow [window]\gbChange\gbf5 grid: g | u [	self extent_ g.	u_(tracker viewer1) units. u menu action1_g x. u attribute3_g x.	u_(tracker viewer2) units. u menu action1_g y. u attribute3_g y. ]\gb8Btracker: tracker\gbunits: u [self unitsx: u; unitsy: u.]\gb9Bunitsx: u [(tracker viewer1) units: u. self grid: self grid.]\gb10Bunitsy: u [(tracker viewer2) units: u. self grid: self grid.]\gb10Bwindow: window\gbShow\gbf5 at: pt [self moveto: pt]\gb7Bat: pt in: window [self at: pt]\gb18Blinebits | r save x pt b [	r_self linerect.	save_r bitsIntoString.	x_self grid x.	[	x1  [r clear: black]		r clear: white.		pt_r origin copy.		while pt x<r rightside do [			(pt extent: 1) comp.			pt x _ x+pt x. ] ].	b_r bitsIntoString.	r bitsFromString: save.	b ]\gb26B249b2Blinerect [window origin extent: window width1]\gbreshow [self at: origin; show] "redisplay on changed screen"\gb7B23b1Bishow | pt r a b x y [	(origin-(20) extent: 51) comp.	(origin-(02) extent: 15) comp.	a_origin-window origin.	x_self grid x. y_self grid y.	pt_a x\x  (a y\y) + window origin.	r_self linerect. b_self linebits.	while pt y<window bottom do [		r moveto: pt; bitsFromString: b mode: xoring clippedBy: window.		pt_pt+(0self height). ]. ]\gb5Bunshow [self show "since xoring"]\gb7B11i14IBug\gbf5 bug | pt old [	old_pt_false. tracker reset.	while true do [		user leftShiftKey  [			[ old  [ tracker has: user mp  [tracker Bug] self flash: old ] ].			user anybug and (pt_self mp)  [				old=pt  []				tracker unshow show: pt at: pt+origin.				old_pt. ] ]		[ old  [tracker unshow] ].		user anybug  [ old_false. (pt_self mp)  [self flash: pt] ]		old  [old] pt ] ]\gb4B368b10Bflash: pt [ (pt+origin-2 extent: 5) flash ]\gb10Bmp | pt g offset [	window has: (pt_user mp)  [		g_self grid.		offset_(origin x\g x)(origin y\g y).		pt_g/2+pt-offset.		pt_((pt x|g x)(pt y|g y))-((origin x|g x)(origin y|g y)).		window has: pt+origin  [pt]		false ]	false ]\gb17B196b3B4b6B4b6BExample\gbf5 example [] "Y_Grid init.Y window: Rectangle new fromuser.Y unshow.Y grid: 812.Y at: user mp.Y show.Y bug .Y unitsx: ( ('units', nil) inVector, ('cm', (28.35, 100)), ('pts', 1) ).Y unitsy: ( ('units', nil) inVector, ('picas', 12), ('pts', 1) ).Rectangle new fromuser clear: white."\gb8B\gSystemOrganization classify: Grid under: 'Axes/Gridding'.\g 