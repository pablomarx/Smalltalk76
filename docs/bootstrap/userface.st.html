<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>userface.st</title>
	<link rel="stylesheet" type="text/css" href="../font.css"/>
  </head>
  <body>
    <div class="line center">
<span class="small"><br></span><span class="small">↪</span><span class="medium bold">TERMINAL I/O</span><span class="small">↪</span></div>
<div class="line left">
<span class="medium bold"><br>Class new title: &rsquo;UserView&rsquo;;<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;screenrect </span><span class="small">↪</span><span class="small italic">&lt;Rectangle&gt; current screen size</span><span class="small">↪</span><span class="medium bold"><br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">vtab </span><span class="small">↪</span><span class="small italic">&lt;Integer=0mod2&gt; offset from hardware top</span><span class="small">↪</span><span class="medium bold"><br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">htab </span><span class="small">↪</span><span class="small italic">&lt;Integer=0mod16&gt; offset from hardware left</span><span class="small">↪</span><span class="medium bold"><br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">scale </span><span class="small">↪</span><span class="small italic">&lt;Integer=1 or 2&gt; 2 means double bits mode</span><span class="small">↪</span><span class="medium bold"><br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">color </span><span class="small">↪</span><span class="small italic">&lt;Integer=0 or 1&gt; 1 means reverse field</span><span class="small">↪</span><span class="small italic"><br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">screenfile </span><span class="small">↪</span><span class="small italic">&lt;File&gt; for saving current bitmap</span><span class="small">↪</span><span class="small italic"><br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">disp </span><span class="small">↪</span><span class="small italic">&lt;Dispframe&gt; default message stream</span><span class="small">↪</span><span class="medium bold"><br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">sched </span><span class="small">↪</span><span class="small italic">&lt;PriorityScheduler&gt; tasks for this view</span><span class="small">↪</span><span class="medium bold">&rsquo;<br></span><span class="small"><br>↪</span><span class="small italic">screen overlays</span><span class="small">↪<br>UserView understands: &rsquo;</span><span class="small underline">install</span><span class="small"><br></span><span class="tab"></span><span class="small">[user close.  self reconfigure.  user &larr; self open]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">reconfigure</span><span class="small"> [] primitive: 62&rsquo;</span><span class="tab"></span><span class="small">↪</span><span class="small italic">tell OOZE and others</span><span class="small">↪<br>UserView understands: &rsquo;</span><span class="small underline">close</span><span class="small"><br></span><span class="tab"></span><span class="small">[screenfile open.</span><span class="tab"></span><span class="tab"></span><span class="small">↪</span><span class="small italic">write out the old bitmap</span><span class="small">↪<br></span><span class="tab"></span><span class="small">screenfile write: screenrect height*(screenrect width+15/16)/256<br></span><span class="tab"></span><span class="tab"></span><span class="small">from:   mem◦066.<br></span><span class="tab"></span><span class="small">screenfile close]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">open</span><span class="small"><br></span><span class="tab"></span><span class="small">[screenfile open.</span><span class="tab"></span><span class="tab"></span><span class="small">↪</span><span class="small italic">read in the new bitmap</span><span class="small">↪<br></span><span class="tab"></span><span class="small">screenfile read: screenrect height*(screenrect width+15/16)/256<br></span><span class="tab"></span><span class="tab"></span><span class="small">to:   mem◦066.<br></span><span class="tab"></span><span class="small">screenfile close]&rsquo;<br><br>↪</span><span class="small italic">terminal interaction</span><span class="small">↪<br>UserView understands: &rsquo;</span><span class="small underline">kbd</span><span class="small"> [!kbMap◦self rawkbd]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">kbck</span><span class="small"><br></span><span class="tab"></span><span class="small">[self rawkbck?[!kbMap◦self rawkbck] !false ]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">rawkbd</span><span class="small"> [] primitive: 63&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">rawkbck</span><span class="small"> [] primitive: 64&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">buttons</span><span class="small"><br></span><span class="tab"></span><span class="small">[!7-(mem◦0177030 land: 7)]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">redbug</span><span class="small"> [!self buttons=4]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">yellowbug</span><span class="small"> [!self buttons=1]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">bluebug</span><span class="small"> [!self buttons=2]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">anybug</span><span class="small"> [!self buttons&gt;0]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">keyset</span><span class="small"><br></span><span class="tab"></span><span class="small">[!037-((mem◦0177030 lshift: ¬3) land: 37)]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">mp</span><span class="small"><br></span><span class="tab"></span><span class="small">[!Point new x: mem◦0424-htab y: mem◦0425-vtab]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">cursorloc</span><span class="small"> &larr; pt<br></span><span class="tab"></span><span class="small">[mem◦0426 &larr; pt x+htab. mem◦0427 &larr; pt y+vtab]&rsquo;<br><br>↪</span><span class="small italic">display control</span><span class="small">↪<br>UserView understands: &rsquo;</span><span class="small underline">loadcursorbitsfrom:</span><span class="small"> bitstr | i<br></span><span class="tab"></span><span class="small">[for⦂ i to: 16 do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[mem◦(0430+i) &larr; bitstr word: i]]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">displayoffwhile⦂</span><span class="small"> expr | t v<br></span><span class="tab"></span><span class="small">[t &larr; mem◦067. mem◦067 &larr; 60.<br></span><span class="tab"></span><span class="small">v &larr; expr eval. mem◦067 &larr; t. !v]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">restoredisplay</span><span class="small"><br></span><span class="tab"></span><span class="small">[mem◦067 &larr; screenrect height/2]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">screenextent:</span><span class="small"> extent </span><span class="small underline">tab:</span><span class="small"> tab<br></span><span class="tab"></span><span class="small">[mem◦065 &larr; (0400*(tab x/16))+(extent x/16|2).<br></span><span class="tab"></span><span class="small">mem◦067 &larr; extent y/2. mem◦063 &larr; tab y/2.<br></span><span class="tab"></span><span class="small">htab &larr; tab x|16. vtab &larr; tab y|2.<br></span><span class="tab"></span><span class="small">screenrect &larr; 0@0 rect: (extent x|32)@(extent y|2).<br></span><span class="tab"></span><span class="small">self reconfigure]&rsquo;<br><br>↪</span><span class="small italic">system messages</span><span class="small">↪<br>UserView understands: &rsquo;</span><span class="small underline">ev</span><span class="small"> [disp ev]&rsquo;<br>UserView understands: &rsquo;request: s [!disp request: s]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">show:</span><span class="small"> str<br></span><span class="tab"></span><span class="small">[disp append: str; show]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">cr</span><span class="small"> [disp </span><span class="small underline">cr</span><span class="small">]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">clearshow:</span><span class="small"> str<br></span><span class="tab"></span><span class="small">[disp clear; append: str; show]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">notify:</span><span class="small"> str<br></span><span class="tab"></span><span class="small">[self restoredisplay. disp append: str; cr; show.<br></span><span class="tab"></span><span class="small">disp append: thisContext sender trace; show.<br></span><span class="tab"></span><span class="small">thisContext sender debug. self restart]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">restart</span><span class="small"><br></span><span class="tab"></span><span class="small">[self restart⦂ [disp ev]]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">restart⦂</span><span class="small"> code<br></span><span class="tab"></span><span class="small">[code sender &larr; nil.<br></span><span class="tab"></span><span class="small">thisContext sender &larr; nil.</span><span class="tab"></span><span class="tab"></span><span class="small">↪</span><span class="small italic">release caller chain</span><span class="small">↪<br></span><span class="tab"></span><span class="small">CodeKeeper &larr; (Vector new: 10) asStream.</span><span class="tab"></span><span class="tab"></span><span class="small">↪</span><span class="small italic">release held code</span><span class="small">↪<br></span><span class="tab"></span><span class="small">disp cr; append: &rsquo;&rsquo; ** restart&rsquo;&rsquo;; show.<br></span><span class="tab"></span><span class="small">while⦂ true do⦂ [code eval]]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">screenrect</span><span class="small"> [!screenrect]&rsquo;<br><br>↪</span><span class="small italic">window scheduling</span><span class="small">↪<br>UserView understands: &rsquo;</span><span class="small underline">schedule:</span><span class="small"> window<br></span><span class="tab"></span><span class="small">[sched≡nil?<br></span><span class="tab"></span><span class="tab"></span><span class="small">[(sched &larr; Vector new: 1)◦1 &larr; window]<br></span><span class="tab"></span><span class="small">sched &larr; sched , window]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">unschedule:</span><span class="small"> window<br></span><span class="tab"></span><span class="small">[0&lt;(t&larr; sched find: window)?<br></span><span class="tab"></span><span class="tab"></span><span class="small">[sched &larr; sched◦(1 to: t-1) concat: sched◦(t+1 to: sched length)]]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">sched</span><span class="small"> [!sched]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">run</span><span class="small"> | s<br></span><span class="tab"></span><span class="small">[while⦂ (screenrect has: user mp) do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[for⦂ s from: sched do⦂ [s startup]]]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">printon:</span><span class="small"> strm<br></span><span class="tab"></span><span class="small">[strm append: &rsquo;&rsquo;a UserView&rsquo;&rsquo;]&rsquo;<br><br>↪</span><span class="small italic">OOZE save/load</span><span class="small">↪<br>UserView understands: &rsquo;</span><span class="small underline">OutLd</span><span class="small"> [] primitive: 85&rsquo;<br></span><span class="tab"></span><span class="small">↪returns true from call; false from OS resume↪<br>UserView understands: &rsquo;</span><span class="small underline">InLd:</span><span class="small"> fileid<br></span><span class="tab"></span><span class="small">[user notify: &rsquo;&rsquo;file problem&rsquo;&rsquo;] primitive: 86&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">overlay:</span><span class="small"> fileid<br></span><span class="tab"></span><span class="small">[self OutLd?[self InLd: fileid]]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">quit</span><span class="small"> | t<br></span><span class="tab"></span><span class="small">[t &larr; Vector new: 5; all &larr; 0.  self overlay: t]&rsquo;<br>UserView understands: &rsquo;</span><span class="small underline">Swat</span><span class="small"> [] primitive: 90&rsquo;<br></span></div>
<div class="line center">
<span class="small"><br>↪</span><span class="medium bold">PARAGRAPH EDITOR</span><span class="small">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="small">Smalltalk define "Peditorstuff as "Peditorstuff &larr; SymbolTable new.<br>Peditorstuff insertall: "(bs del esc doit paste typing editmenu<br></span><span class="tab"></span><span class="tab"></span><span class="small">Scrap Deletion ctlchars runvals p1 p2 selon oldpara oldheight)<br></span><span class="tab"></span><span class="small">with: "(010 0177 033 036 02 typing editmenu<br></span><span class="tab"></span><span class="tab"></span><span class="small">Scrap Deletion ctlchars runvals p1 p2 selon oldpara oldheight).</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;ParagraphEditor&rsquo;;<br></span><span class="tab"></span><span class="medium bold">subclassof: Textframe;<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;loc1 loc2&rsquo;;<br></span><span class="tab"></span><span class="medium bold">sharing: &rsquo;Peditorstuff&rsquo;<br></span><span class="small">ParagraphEditor understands: &rsquo;</span><span class="small underline">enter:</span><span class="small"> window<br></span><span class="tab"></span><span class="small">[frame &larr; window inset: 4 @ 2 and: 2 @ 2.<br></span><span class="tab"></span><span class="small">oldpara &larr; oldheight &larr; false. self show]&rsquo;<br>ParagraphEditor understands: &rsquo;</span><span class="small underline">leave</span><span class="small"><br></span><span class="tab"></span><span class="small">[self comp: p1 to: p2]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span class="small underline">kbd:</span><span class="small"> boss | more char<br></span><span class="tab"></span><span class="small">[more &larr; Stream default.<br></span><span class="tab"></span><span class="small">while⦂ user kbck do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[(char &larr; user kbd)=del? []<br></span><span class="tab"></span><span class="tab"></span><span class="small">char=bs? [more empty?[loc1 &larr; 1 max: loc1-1].</span><span class="tab"></span><span class="tab"></span><span class="small">↪backspace↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">more skip: ¬1]<br></span><span class="tab"></span><span class="tab"></span><span class="small">more next&larr; char].<br></span><span class="tab"></span><span class="small">self replace: more contents]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span class="small underline">redbug:</span><span class="small"> boss | a t drag2<br></span><span class="tab"></span><span class="small">[t &larr; self charnearpt: user mp.<br></span><span class="tab"></span><span class="small">t=loc1 and: loc1=loc2 ? [self selectword]</span><span class="tab"></span><span class="tab"></span><span class="small">↪ double-bug ↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">[loc1=t?[drag2 &larr; false]<br></span><span class="tab"></span><span class="tab"></span><span class="small">drag2 &larr; true. loc2=t?[]</span><span class="tab"></span><span class="tab"></span><span class="small">↪ pick up old selection ↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">self comp: p1 to: p2. loc1 &larr; loc2 &larr; t.</span><span class="tab"></span><span class="tab"></span><span class="small">↪ start new selection ↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">p2 &larr; 1@0 + (p1 &larr; reply1).<br></span><span class="tab"></span><span class="tab"></span><span class="small">self comp: p1 to: p2].<br></span><span class="tab"></span><span class="small">while⦂ user redbug do⦂</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪ draw out selection ↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">[a &larr; reply1.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[loc1=loc2?[drag2 &larr; t≥loc2]].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[drag2? [ [t&lt;loc1?[t&larr;loc1. a&larr;self ptofchar: t]].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self comp: a to: p2. loc2 &larr; t. p2 &larr; a]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[t&gt;loc2?[t&larr;loc2. a&larr;self ptofchar: t]].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self comp: p1 to: a. loc1 &larr; t. p1 &larr; a].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[p1=p2?[self comp: p1 to: (p2 &larr; 1@0 + p1)]].<br></span><span class="tab"></span><span class="tab"></span><span class="small">t &larr; self charnearpt: user mp]]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span class="small underline">replace:</span><span class="small"> t<br></span><span class="tab"></span><span class="small">[</span><span class="tab"></span><span class="small">[oldpara?[] oldpara &larr; para].<br></span><span class="tab"></span><span class="small">para &larr; para replace: loc1 to: loc2-1 by: t.<br></span><span class="tab"></span><span class="small">loc1 &larr; loc2 &larr; loc1 + t length.<br></span><span class="tab"></span><span class="small">self show]&rsquo;<br>ParagraphEditor understands: &rsquo;</span><span class="small underline">selection</span><span class="small"><br></span><span class="tab"></span><span class="small">[!para copy: loc1 to: loc2-1]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span class="small underline">show</span><span class="small"><br></span><span class="tab"></span><span class="small">[super show.<br></span><span class="tab"></span><span class="small">[loc1≡nil? [loc1&larr;loc2&larr;1]].<br></span><span class="tab"></span><span class="small">user kbck?[] self select]&rsquo;<br>ParagraphEditor understands: &rsquo;</span><span class="small underline">select</span><span class="small"><br></span><span class="tab"></span><span class="small">[p1 &larr; self ptofchar: loc1.<br></span><span class="tab"></span><span class="small">p2 &larr; [loc2=loc1?[1@0 + p1] self ptofchar: loc2].<br></span><span class="tab"></span><span class="small">self comp: p1 to: p2]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span class="small underline">comp:</span><span class="small"> a </span><span class="small underline">to:</span><span class="small"> b | t</span><span class="tab"></span><span class="tab"></span><span class="small">↪complement from a to b↪<br></span><span class="tab"></span><span class="small">[</span><span class="tab"></span><span class="small">[a y&lt;b y?[] </span><span class="small">(a y=b y) and: (a</span><span class="small"> x&lt;b x)?[] t&larr;a. a&larr;b. b&larr;t].</span><span class="tab"></span><span class="tab"></span><span class="small">↪in case they were reversed↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">[a y &lt; b y?<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[(a rect: (window corner x-4) @ (a y+self lineheight)) comp.</span><span class="tab"></span><span class="small">↪top line↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small"> a &larr; (window origin x+4) @ (a y+self lineheight).<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small"> a y &lt; b y?<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[(a rect: (window corner x-4) @ b y) comp]</span><span class="tab"></span><span class="small">↪middle (if any)↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">]].<br></span><span class="tab"></span><span class="tab"></span><span class="small">a y &gt; b y?[]<br></span><span class="tab"></span><span class="tab"></span><span class="small">(a x @ b y rect: b x @ (b y + self lineheight)) comp.</span><span class="tab"></span><span class="small">↪bottom (or only)↪]&rsquo;<br><br>ParagraphEditor understands: &rsquo;</span><span class="small underline">selectword</span><span class="small"> | a b dir t level open close<br></span><span class="tab"></span><span class="small">[self comp: p1 to: p2.<br></span><span class="tab"></span><span class="small">a&larr; b&larr; dir&larr; ¬1.<br></span><span class="tab"></span><span class="small">open &larr; &rsquo;&rsquo;([{&lt; &rsquo;&rsquo;&rsquo;&rsquo;↪<br>&rsquo;&rsquo;.</span><span class="tab"></span><span class="small">close &larr; &rsquo;&rsquo;)]}&gt; &rsquo;&rsquo;&rsquo;&rsquo;↪<br>&rsquo;&rsquo;.</span><span class="tab"></span><span class="tab"></span><span class="small">[loc1&gt;para length?[]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">loc1≤1?[dir&larr;1]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">t&larr;open find: (a&larr;para◦(loc1-1)). t&gt;0?</span><span class="tab"></span><span class="tab"></span><span class="small">↪delim on left↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[dir&larr;1. b&larr;close</span><span class="small">◦t</span><span class="small">.</span><span class="tab"></span><span class="tab"></span><span class="small">↪match to the right↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">a=b?[a&larr;¬2]]</span><span class="tab"></span><span class="tab"></span><span class="small">↪non-nesting↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">t&larr;close find: (a&larr;para◦loc1). t&gt;0?</span><span class="tab"></span><span class="tab"></span><span class="small">↪delim on right↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[dir&larr;¬1. b&larr;open</span><span class="small">◦t</span><span class="small">.</span><span class="tab"></span><span class="tab"></span><span class="small">↪match to the left↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">a=b?[a&larr;¬2]]</span><span class="tab"></span><span class="tab"></span><span class="small">↪non-nesting↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">a&larr; ¬1].</span><span class="tab"></span><span class="tab"></span><span class="small">↪no delims - select a token↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">t&larr;loc1-1. level&larr;1.<br></span><span class="tab"></span><span class="tab"></span><span class="small">until⦂ [t≤1?[] t≥para length?[] level=0?[] false] do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[para◦(t&larr; t+dir) = b? [level&larr; level-1];</span><span class="tab"></span><span class="tab"></span><span class="small">↪leaving nest↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">= a? [level&larr; level+1].</span><span class="tab"></span><span class="tab"></span><span class="small">↪entering nest↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">a=¬1?[(para</span><span class="small">◦t</span><span class="small">) tokenish?[]</span><span class="tab"></span><span class="tab"></span><span class="small">↪token check goes left ↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">dir=¬1?[loc1 &larr; t+1. dir&larr;1. t&larr;loc2]</span><span class="tab"></span><span class="small">↪then right↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">level&larr; 0]]<br></span><span class="tab"></span><span class="small">[dir=1?[loc2&larr; t] loc1&larr; t+1].<br></span><span class="tab"></span><span class="small">self select]&rsquo;<br>Integer understands: &rsquo;tokenish</span><span class="tab"></span><span class="tab"></span><span class="small">↪test for token-chars↪<br></span><span class="tab"></span><span class="small">[self isletter?[!true]</span><span class="tab"></span><span class="small">↪lower-case↪<br></span><span class="tab"></span><span class="small"> self isdigit?[!true]</span><span class="tab"></span><span class="small">↪digits↪<br></span><span class="tab"></span><span class="small"> !&rsquo;&rsquo;¬.:⦂&rsquo;&rsquo; has: self]&rsquo;</span><span class="tab"></span><span class="small">↪also high-minus and dot↪<br></span></div>
<div class="line center">
<span class="small"><br>↪</span><span class="medium bold">CLASS EDITOR</span><span class="small">↪</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ClassEditor&rsquo;;<br></span><span class="tab"></span><span class="medium bold">subclassof: ParagraphEditor;<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;class selector&rsquo;<br></span><span class="small">ClassEditor understands: &rsquo;</span><span class="small underline">firsttime</span><span class="small"><br></span><span class="tab"></span><span class="small">[window has: user mp?<br></span><span class="tab"></span><span class="tab"></span><span class="small">[window outline. self enter: window]<br></span><span class="tab"></span><span class="small">!false]&rsquo;<br>ClassEditor understands: &rsquo;</span><span class="small underline">eachtime</span><span class="small"><br></span><span class="tab"></span><span class="small">[window has: user mp?<br></span><span class="tab"></span><span class="tab"></span><span class="small">[user kbck?[self kbd: nil]<br></span><span class="tab"></span><span class="tab"></span><span class="small">user anybug?<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[user redbug?[!self redbug: nil]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">user yellowbug?[self yellowbug: nil]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">user bluebug?[window &larr; Rectangle new fromuser.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self firsttime]]]<br></span><span class="tab"></span><span class="small">user yellowbug?[self close. !false]<br></span><span class="tab"></span><span class="small">user anybug?[self leave. !false]]&rsquo;<br>ClassEditor understands: &rsquo;</span><span class="small underline">lasttime</span><span class="small"><br></span><span class="tab"></span><span class="small">[self leave]&rsquo;<br><br>ClassEditor understands: &rsquo;</span><span class="small underline">class:</span><span class="small"> class </span><span class="small underline">selector:</span><span class="small"> selector<br></span><span class="tab"></span><span class="tab"></span><span class="small underline">para:</span><span class="small"> para </span><span class="small underline">window:</span><span class="small"> window<br></span><span class="tab"></span><span class="small">[para &larr; para asParagraph. style &larr; DefaultTextStyle.<br></span><span class="tab"></span><span class="small">self enter: window]&rsquo;<br>ClassEditor understands: &rsquo;</span><span class="small underline">yellowbug:</span><span class="small"> boss<br></span><span class="tab"></span><span class="small">[class understands: para]&rsquo;<br>ClassEditor understands: &rsquo;</span><span class="small underline">close</span><span class="small"><br></span><span class="tab"></span><span class="small">[(window inset: ¬2 @ ¬2) clear: backround.<br></span><span class="tab"></span><span class="small">user unschedule: self]&rsquo;<br><br>Class understands: &rsquo;</span><span class="small underline">edit:</span><span class="small"> selector<br></span><span class="tab"></span><span class="small">[user schedule: (ClassEditor new class: self selector: selector<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">para: (self code: selector) window: Rectangle new fromuser)]&rsquo;<br><br>Dispframe understands: &rsquo;firsttime<br></span><span class="tab"></span><span class="small">[text window has: user mp?<br></span><span class="tab"></span><span class="tab"></span><span class="small">[text window outline. self cr; append: &rsquo;&rsquo;&#64257;&rsquo;&rsquo;; show]<br></span><span class="tab"></span><span class="small">!false]&rsquo;<br>Dispframe understands: &rsquo;eachtime<br></span><span class="tab"></span><span class="small">[text window has: user mp?<br></span><span class="tab"></span><span class="tab"></span><span class="small">[user kbck?[t&larr; self read.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self print: [t≡nil?[self doit] nilⓢt].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self cr; append: &rsquo;&rsquo;&#64257;&rsquo;&rsquo;; show]]<br></span><span class="tab"></span><span class="small">user anybug?[!false]]&rsquo;<br>Dispframe understands: &rsquo;lasttime<br></span><span class="tab"></span><span class="small">[self skip: [¬2 max: 0-position]; show]&rsquo;<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 12pt; text-align: left">
<span class="small"><br>******  NOT DONE BEYOND HERE ******<br><br>↪OTHER PARAGRAPH STUFF↪<br>ParagraphEditor understands: &rsquo;kbdlook | t c<br></span><span class="tab"></span><span class="small">[(c&larr; user rawkbck)&gt;170?<br></span><span class="tab"></span><span class="tab"></span><span class="small">[t&larr; ctlchars find: c.<br></span><span class="tab"></span><span class="tab"></span><span class="small">t&gt;0?[kbd. changed &larr; true.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">para changestyle: runvals◦t from: loc1+1 to: loc2]<br></span><span class="tab"></span><span class="tab"></span><span class="small">!false]<br></span><span class="tab"></span><span class="small">!false]&rsquo;<br>Peditorstuff insertall: "(ctlchars runvals) with: "(<br></span><span class="tab"></span><span class="tab"></span><span class="small">(226 233 224 173 242</span><span class="tab"></span><span class="tab"></span><span class="small">↪ctl-  b i ... - r↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">176 177 178 179 180 181 182 183 184 185</span><span class="tab"></span><span class="small">↪ctl-  0 thru 9↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">193 194 195 196 197 198)</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪ctl-  A thru F↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">(1 2 4 8 ¬1<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">0 1 2 3 4 5 6 7 8 9<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">10 11 12 13 14 15)<br></span><span class="tab"></span><span class="tab"></span><span class="small">).<br>"t &larr; Peditorstuff◦"runvals.<br></span><span class="tab"></span><span class="small">for i &larr; 6 to t length do<br></span><span class="tab"></span><span class="tab"></span><span class="small">(t[a] &larr; 16*t[a]).</span><span class="tab"></span><span class="tab"></span><span class="small">↪font number left 4 bits↪<br><br>ParagraphEditor understands: &rsquo;readchange<br></span><span class="tab"></span><span class="small">[self cleanup. changed&larr;false. !para]&rsquo;<br>ParagraphEditor understands: &rsquo;fixframe: x<br></span><span class="tab"></span><span class="small">[!x]&rsquo;<br>ParagraphEditor understands: &rsquo;close: x []&rsquo;<br>ParagraphEditor understands: &rsquo;outside: x [!false]&rsquo;<br>ParagraphEditor understands: &rsquo;asParagraph</span><span class="tab"></span><span class="small">[!para]&rsquo;<br>ParagraphEditor understands: &rsquo;changed</span><span class="tab"></span><span class="small">[!changed]&rsquo;<br>ParagraphEditor understands: &rsquo;selection</span><span class="tab"></span><span class="small">[!para copy: loc1 to: loc2-1]&rsquo;<br><br></span></div>
<div class="line center">
<span class="small"><br>↪</span><span class="medium bold">WINDOW FRAME AND CONTROL</span><span class="small">↪<br></span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;UserWindow&rsquo;;<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;frame contents title&rsquo;;<br></span><span class="tab"></span><span class="medium bold">sharing: Userstuff<br></span><span class="small">UserWindow understands: &rsquo;frame: f contents: contents<br></span><span class="tab"></span><span class="small">[frame &larr; contents fixframe f. self show]&rsquo;<br>UserWindow understands: &rsquo;of: c<br></span><span class="tab"></span><span class="small">[self frame: Rectangle new fromuser contents: c]&rsquo;<br>UserWindow understands: &rsquo;show<br></span><span class="tab"></span><span class="small">[self showin: user screenrect]&rsquo;<br>UserWindow understands: &rsquo;showin: r | a<br></span><span class="tab"></span><span class="tab"></span><span class="small">[(a &larr; frame intersect: r) empty? []<br></span><span class="tab"></span><span class="tab"></span><span class="small">a color: dkgray mode: storing.<br></span><span class="tab"></span><span class="tab"></span><span class="small">((frame inset: p1 and: p2) intersect: r) color: white mode: storing.<br></span><span class="tab"></span><span class="tab"></span><span class="small">contents enter: r.<br></span><span class="tab"></span><span class="tab"></span><span class="small">whitey show: contents title clipped: r]<br><br>UserWindow understands: &rsquo;firsttime<br></span><span class="tab"></span><span class="small">[frame has: user mp? [self show] !false]&rsquo;<br>UserWindow understands: &rsquo;eachtime<br></span><span class="tab"></span><span class="small">[frame has: user mp?<br></span><span class="tab"></span><span class="tab"></span><span class="small">[user buttonck?<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[user redbug?[!contents redbug: self]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">user yellowbug?[!contents yellowbug: self]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">user bluebug?[!contents bluebug: self]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">user kbck?[contents kbd: self]<br></span><span class="tab"></span><span class="tab"></span><span class="small">user keysetck?[contents keyset: self]]<br></span><span class="tab"></span><span class="small">contents outside: self?[]<br></span><span class="tab"></span><span class="small">user buttonck?[frame has mp?[] !false]<br></span><span class="tab"></span><span class="small">user kbck?[user kbd; user flash] ↪flush typing outside↪]&rsquo;<br>UserWindow understands: &rsquo;lasttime<br></span><span class="tab"></span><span class="small">[!contents leave]&rsquo;<br><br>UserWindow understands: &rsquo;newframe<br></span><span class="tab"></span><span class="small">[while⦂ user buttonck do⦂ [].<br></span><span class="tab"></span><span class="small">frame &larr; Rectangle new origin: (a&larr; user mp) corner: a.<br></span><span class="tab"></span><span class="small">while⦂ user buttonck do⦂ <br></span><span class="tab"></span><span class="tab"></span><span class="small">[frame color: dkgray mode: xoring.<br></span><span class="tab"></span><span class="tab"></span><span class="small">frame &larr; contents fixframe: (frame growto: user mp). <br></span><span class="tab"></span><span class="tab"></span><span class="small">frame color: dkgray mode: xoring].<br></span><span class="tab"></span><span class="small">frame color: dkgray mode: storing.<br></span><span class="tab"></span><span class="small">whitey show: contents title.<br></span><span class="tab"></span><span class="small">windowSched fillholes: (oldframe nonintersect: frame).<br></span><span class="tab"></span><span class="small">!frame]&rsquo;<br>UserWindow understands: &rsquo;close<br></span><span class="tab"></span><span class="small">[contents close: self]&rsquo;<br>UserWindow understands: &rsquo;movegrow<br></span><span class="tab"></span><span class="small">[frame color: white mode: storing.<br></span><span class="tab"></span><span class="small">frame &larr; self newframe.<br></span><span class="tab"></span><span class="small">"a &larr; frame inset p1 p2.<br></span><span class="tab"></span><span class="small">a paint 12 white.<br></span><span class="tab"></span><span class="small">contents enter a inset p3 p4]&rsquo;<br>↪***↪<br>UserWindow evals ["p1 &larr; point 3 fontheight+4. "p2 &larr; point 3 3.<br></span><span class="tab"></span><span class="tab"></span><span class="small">"p3 &larr; point 4 2. "p4 &larr; point 4 0. "p5 &larr; point 3 2.<br></span><span class="tab"></span><span class="tab"></span><span class="small">"whitey &larr; textframe rectangle p1 p1]&rsquo;<br></span></div>
<div class="line center">
<span class="small"><br>↪</span><span class="medium bold">FORMATTED TEXT</span><span class="small">↪</span><span class="medium bold"><br></span></div>
<div class="line left">
<span class="small">Paragraph understands: &rsquo;runfind b | a</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪**index into run**↪<br></span><span class="tab"></span><span class="small">[a&larr;1.<br></span><span class="tab"></span><span class="small">while⦂ true do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[runs◦a≥b? [!a , b]</span><span class="tab"></span><span class="tab"></span><span class="small">↪return run, index↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">b &larr; b-(runs◦a). a &larr; a+2]]&rsquo;<br>Paragraph understands: &rsquo;runs</span><span class="tab"></span><span class="tab"></span><span class="small">↪**subrange of run**↪<br></span><span class="tab"></span><span class="small">[%[?["a &larr; :.</span><span class="tab"></span><span class="tab"></span><span class="small">↪indexed by text, not run↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">%to?<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["b &larr; [%end?["c&larr;runs length-1. point c runs[c]]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self runfind :]. %].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">a&gt;text length?[!&rsquo;&rsquo;] "a &larr; self runfind a.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"c &larr; runs[a x to b x+1].</span><span class="tab"></span><span class="tab"></span><span class="small">↪copy the sub-run↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">c length=0?[!c]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">a x = b x?[0= c[1]&larr; 1+ b y-a y ?[!&rsquo;&rsquo;] !c]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">c[1] &larr; 1+runs[a x] - a y.</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪trim the end lengths↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">c[c length-1] &larr; b y.  !c]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">%]. !runs[self runfind a x+1]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">!runs]&rsquo;<br>string understands "runcat</span><span class="tab"></span><span class="tab"></span><span class="small">↪**concatenate runs**↪<br></span><span class="tab"></span><span class="small">["x&larr;:. x length=0?[] self length=0?[!x]<br></span><span class="tab"></span><span class="tab"></span><span class="small">self[self length]=x[2]?<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[!self[1 to self length-2]+<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[makerun self[self length-1]+x[1] x[2]]+<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">x[3 to x length]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">!self + x]&rsquo;<br>Paragraph understands: &rsquo;asString [!text]&rsquo;<br>Paragraph understands: &rsquo;[</span><span class="tab"></span><span class="tab"></span><span class="small">↪**subranges and subscripting of text**↪<br></span><span class="tab"></span><span class="small">["a&larr;:.<br></span><span class="tab"></span><span class="tab"></span><span class="small">%to?["b&larr;:. %].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">%replace?["c&larr;:.</span><span class="tab"></span><span class="small">↪**alters self; doesn&rsquo;t copy↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"runs &larr; self runs[1 to a-1]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">runcat [c is string?[makerun c length self runs[b]] c runs]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">runcat self runs[b+1 to end].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"text &larr; text[a to b] replace<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[c is string?[c] c text]]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">%changestyle?["c&larr;:.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"runs &larr; self runs[1 to a-1]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">runcat [self mergestyle c into self runs[a to b]]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">runcat self runs[b+1 to end]]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">%&larr;?[%all?[text[a to b] &larr; all :]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">text[a to b] &larr; :]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">!paragraph with text[a to b] self runs[a to b]]↪**copy align**↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">%]. %&larr;?[!text[a]&larr;:]<br></span><span class="tab"></span><span class="tab"></span><span class="small">!text[a]]&rsquo;<br>Paragraph understands: &rsquo;mergestyle<br></span><span class="tab"></span><span class="small">["a&larr;:. %into. "b&larr;:.<br></span><span class="tab"></span><span class="tab"></span><span class="small">for c&larr; 2 to b length by 2 do<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[b[c] &larr; [a=¬1? [0]</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪reset↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">0&lt;a≤017? [a &- b[c]]</span><span class="tab"></span><span class="tab"></span><span class="small">↪toggle emphasis↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">a+017 &* b[c]]].</span><span class="tab"></span><span class="small">↪new font↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">!b]<br><br>"makerun &larr; function [run len str] ["len&larr;:. "run&larr;:.<br></span><span class="tab"></span><span class="tab"></span><span class="small">len=0?[!&rsquo;&rsquo;] "str&larr;stream. repeat do<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[run&lt;256?[str&larr;len. str&larr;run. !str contents]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">str&larr;255. str&larr;run. "len&larr;len-255]]&rsquo;<br>paragraphⓢinitcode &larr;<br></span><span class="tab"></span><span class="small">["alignment &larr; 0. %with?["text &larr; :.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"runs &larr; [%onerun?[makerun text length :] :]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">"text &larr; string 0]&rsquo;<br>Paragraph understands: &rsquo;runshow | strm i</span><span class="tab"></span><span class="tab"></span><span class="small">↪**print a run**↪<br></span><span class="tab"></span><span class="small">[strm &larr; stream. for⦂ i from: (1 to: runs length by: 2) do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[strm append: (runs◦i) asString; append: &rsquo;.&rsquo;.<br></span><span class="tab"></span><span class="tab"></span><span class="small">strm append: (runs◦(i+1)) asString; append: &rsquo;, &rsquo;]<br></span><span class="tab"></span><span class="small">!strm contents]&rsquo;<br></span></div>
<div class="line center">
<span class="small"><br>↪</span><span class="medium bold">MENUS</span><span class="small">↪</span><span class="medium bold"><br></span></div>
<div class="line left">
<span class="small">"menu &larr; class [[pt i bits][str text thisline frame but][pt2][]] [] [] []&rsquo;<br><br>menuⓢinitcode &larr;<br></span><span class="tab"></span><span class="small">["str&larr;:. "but&larr;:.<br></span><span class="tab"></span><span class="small">"text &larr; textframe rectangle "pt&larr;point 0 0 point 1000 1000 with str.<br></span><span class="tab"></span><span class="small">for i to str length+1 do<br></span><span class="tab"></span><span class="tab"></span><span class="small">["pt &larr; pt max text ptofchar i]<br></span><span class="tab"></span><span class="small">textⓢframe growto pt+point 4 text fontheight.<br></span><span class="tab"></span><span class="small">textⓢpara center.<br></span><span class="tab"></span><span class="small">"frame &larr; textⓢframe inset "pt2&larr;point ¬2 ¬2 pt2.<br></span><span class="tab"></span><span class="small">"thisline&larr;rectangle textⓢ frameⓢorigin<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">point textⓢframeⓢextent x text fontheight]&rsquo;<br>menu understands: &rsquo;bug<br></span><span class="tab"></span><span class="small">["pt&larr;mp-thisline center.</span><span class="tab"></span><span class="tab"></span><span class="small">↪center prev item on mouse↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">textⓢframe moveby pt. thisline moveby pt.<br></span><span class="tab"></span><span class="tab"></span><span class="small">frame moveby pt. "bits &larr; frame makebuff.</span><span class="tab"></span><span class="tab"></span><span class="small">↪save background↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">frame paint 12 ¬1. text show.<br></span><span class="tab"></span><span class="tab"></span><span class="small">0=mouse 7?[frame loadbuff bits. !0]</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪accidental bug returns 0↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">thisline comp.<br></span><span class="tab"></span><span class="tab"></span><span class="small">repeat do [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">frame has "pt&larr;mp?</span><span class="tab"></span><span class="tab"></span><span class="small">↪in the menu↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[button but?</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪button still down↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[thisline has pt?[]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">text charnearpt pt. "pt&larr;text reply.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">thisline comp. thisline moveto</span><span class="tab"></span><span class="small">↪selection follows mouse↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small"> point textⓢframeⓢorigin x pt y.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">thisline comp]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">frame loadbuff bits.</span><span class="tab"></span><span class="small">↪restore background, return index↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">!1+[thislineⓢorigin-frameⓢorigin]y/text fontheight]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">thisline comp. </span><span class="tab"></span><span class="tab"></span><span class="small">↪he left the menu↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">repeat do [button but?[frame has mp?[thisline comp. done]]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">frame loadbuff bits. !0]</span><span class="tab"></span><span class="small">↪return 0 for abort↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">]]&rsquo;<br>menu understands: &rsquo;rebug<br></span><span class="tab"></span><span class="small">[showcursor [but=1?[bug2cursor] bug3cursor]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">repeat do [button but?[done]]</span><span class="tab"></span><span class="tab"></span><span class="small">↪wait for button down again↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">!self bug]&rsquo;</span></div>
<div class="line center">
<span class="small"><br>↪</span><span class="medium bold">BRAVO CONVERSION</span><span class="small">↪</span><span class="medium bold"><br></span></div>
<div class="line left">
<span class="small">"bravo2para &larr; function [a b c f ff i p q s st]<br></span><span class="tab"></span><span class="tab"></span><span class="small">["f&larr;:. f end?[!false]<br></span><span class="tab"></span><span class="tab"></span><span class="small">"a &larr; f upto 26. f next.</span><span class="tab"></span><span class="tab"></span><span class="small">↪pick up ascii↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">"p &larr; paragraph.<br></span><span class="tab"></span><span class="tab"></span><span class="small">"b &larr; f upto 13. f next.</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪pick up trailer↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">"s &larr; stream of b. "st &larr; stream.<br></span><span class="tab"></span><span class="tab"></span><span class="small">repeat do<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["c &larr; s next.</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪scan for useful para info↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">c=&rsquo;c&rsquo;[1]?[p center]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">c=&rsquo;j&rsquo;[1]?[p justify]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">c=&rsquo;\&rsquo;[1]?[done]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">st &larr; c]</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪stache rest for later bravo output↪<br></span><span class="tab"></span><span class="tab"></span><span class="small">↪pⓢtrailer &larr; st contents.↪ st reset.<br></span><span class="tab"></span><span class="tab"></span><span class="small">"ff&larr; "len &larr; "run &larr; 0. "q&larr;1.<br></span><span class="tab"></span><span class="tab"></span><span class="small">repeat do<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[s end?[done]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"c &larr; s next.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">0&lt; "i&larr; &rsquo;bBiIuUnNfoy&rsquo;[1 to 11] find c ?<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["[["run &larr; run+1]</span><span class="tab"></span><span class="tab"></span><span class="small">["run &larr; run-1]</span><span class="tab"></span><span class="tab"></span><span class="small">↪bold↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["run &larr; run+2]</span><span class="tab"></span><span class="tab"></span><span class="small">["run &larr; run-2]</span><span class="tab"></span><span class="tab"></span><span class="small">↪italic↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["run &larr; run+4]</span><span class="tab"></span><span class="tab"></span><span class="small">["run &larr; run-4]</span><span class="tab"></span><span class="tab"></span><span class="small">↪underline↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["run &larr; run+8]</span><span class="tab"></span><span class="tab"></span><span class="small">["run &larr; run-8]</span><span class="tab"></span><span class="tab"></span><span class="small">↪strikeout↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["run &larr; [run &* 017] + 16*"ff&larr; scannum s]</span><span class="tab"></span><span class="small">↪font↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["r&larr;scannum s. "run &larr; [run &* 017] + </span><span class="tab"></span><span class="tab"></span><span class="small">↪super/sub script↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">16*[r=0?[ff] r&gt;128?[11] 10]]</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">↪later vary by font↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[scannum s]]</span><span class="tab"></span><span class="tab"></span><span class="small">↪tab color↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[i] eval]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">060≤c≤071?[s skip ¬1. "r &larr; scannum s.</span><span class="tab"></span><span class="small">↪get run length↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"len &larr; len+r.</span><span class="tab"></span><span class="tab"></span><span class="small">↪later merge across ignored changes↪<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">st &larr; makerun r run]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">[0&lt; "r&larr; a length-len?<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[st &larr; makerun r run]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">pⓢchars &larr; a. pⓢruns &larr; st contents.  !p]&rsquo;<br>"scannum &larr; function [f c i] ["f&larr;:. "i&larr;0.<br></span><span class="tab"></span><span class="small">repeat do<br></span><span class="tab"></span><span class="tab"></span><span class="small">["c&larr;f next.<br></span><span class="tab"></span><span class="tab"></span><span class="small">060≤c≤071?["i&larr; [10*i] + c-060]<br></span><span class="tab"></span><span class="tab"></span><span class="small">f skip ¬1. done]<br></span><span class="tab"></span><span class="small">!i]&rsquo;<br><br></span></div>
  </body>
</html>
