<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Juniper.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"JuniperFileController"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;JuniperFileController&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: File<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fLongFileHandle<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fShortFileHandle<br></span><span class="tab" val="79"></span><span class="medium bold">&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: gJuniperConstants;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>JUNIPER FILE CONTROLLER</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">implementationNotes<br></span><span class="small">[<br>"<br>FIELDS<br></span><span class="small bold">fLongFileHandle</span><span class="small"> : a LongInteger representing the unique identifier for the file.<br></span><span class="small bold">fShortFileHandle</span><span class="small"> : an Integer representing the identifier for the file during a particular transaction.<br>"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>FILE REDEFINITIONS (restricted)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">allocatePage<br></span><span class="small">"...returns a new packet (Pacbuf) to be used as the data buffer in a JuniperPageBuffer."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑ ((self interface) newPacket)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">close<br></span><span class="small">"...closes the file on the Juniper file system."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">self doAction: sCloseFile requestPrs: nil.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">endFile: pPageBuffer<br></span><span class="small">"...adjusts the file length, writes pPageBuffer (a JuniperPageBuffer) on the file, and returns pPageBuffer."<br>[<br></span><span class="tab" val="79"></span><span class="small">self length: ( ((pPageBuffer pageNumber)-1)*(pPageBuffer dataLength)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">+ pPageBuffer length<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> ).  "1"<br></span><span class="tab" val="79"></span><span class="small">self writePage: pPageBuffer.  "2"<br></span><span class="tab" val="79"></span><span class="small">⇑ pPageBuffer<br>]<br>"<br>1. Set the file length to the total number of bytes in the file.<br>2. Write the page on Juniper.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">entryClass<br></span><span class="small">"...returns the class of objects managed by JuniperFileController objects."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑ JuniperPageBuffer<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Get: pPageBuffer<br></span><span class="small">"...reads the data from the page whose number is that specified by pPageBuffer (a JuniperPageBuffer) if such a page exists.  Otherwise pPageBuffer should contains data to be written on the file at the appropriate place."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tNextPageNumber tNewPageNumber i<br>[<br></span><span class="tab" val="79"></span><span class="small">tNewPageNumber &larr; pPageBuffer pageNumber.<br></span><span class="tab" val="79"></span><span class="small">tNewPageNumber ≤ lastpn and⦂ (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">lastpn &gt; 1 or⦂ self length &gt; 0)⇒ [ ⇑ (self Read: pPageBuffer) ]<br></span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">tNextPageNumber &larr; lastpn + 1.<br></span><span class="tab" val="79"></span><span class="small">[ tNewPageNumber = tNextPageNumber ⇒ [ ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self length: (tNewPageNumber-1) * (pPageBuffer dataLength).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ i from: tNextPageNumber to: (tNewPageNumber-1) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ pPageBuffer pageNumber: i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pPageBuffer &larr; self writePage: pPageBuffer.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">].<br><br></span><span class="tab" val="79"></span><span class="small">pPageBuffer pageNumber: tNewPageNumber.<br></span><span class="tab" val="79"></span><span class="small">pPageBuffer length: 0.<br></span><span class="tab" val="79"></span><span class="small">⇑ pPageBuffer<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lastFullPage </span><span class="small">[⇑self length / self entryClass new dataLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length<br></span><span class="small">"...returns the number of bytes (an Integer) in the file."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tResult</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">tResult &larr; self doAction: sReadLength requestPrs: nil.  "1"<br></span><span class="tab" val="79"></span><span class="small">⇑ (tResult longInteger: 1)  "2"<br>]<br>"<br>1. Issue a &rsquo;read length&rsquo; command to Juniper.<br>2. Return the length from the result parameter block.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length: pLength<br></span><span class="small">"...sets the number of bytes in the file to the integer pLength (an Integer)."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span class="small">tRequest longInteger: 1 &larr; pLength.  "2"<br></span><span class="tab" val="79"></span><span class="small">self doAction: sSetLength requestPrs: tRequest.  "3"<br></span><span class="tab" val="79"></span><span class="small">lastpn &larr; self pageFrom: pLength.  "4"<br>]<br>"<br>1. Create a new request parameter block.<br>2. Set the length parameter to pLength.<br>3. Issue a &rsquo;set length&rsquo; command to Juniper.<br>4. Determine the number of the last page of the file and assign it to the superClass field lastpn.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">open<br></span><span class="small">"...opens the file on the Juniper file system."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest tResult<br>[<br></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span class="small">tRequest nextDataBlockString &larr; fLongFileHandle.  "2"<br></span><span class="tab" val="79"></span><span class="small">tResult &larr; (self interface) doAction: sOpenFile requestPrs: tRequest.  "3"<br></span><span class="tab" val="79"></span><span class="small">fShortFileHandle &larr; tResult parameter: 1.  "4"<br></span><span class="tab" val="79"></span><span class="small">self findLastPage.  "5"<br>]<br>"<br>1. Create a new request parameter block.<br>2. Set the long file handle parameter.<br>3. Issue an &rsquo;open file&rsquo; command to Juniper.<br>4. Set the superClass field serialNumber to the short file handle returned by Juniper in the result parameter block.<br>5. Set the number of the last page of the file.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Read: pPageBuffer<br></span><span class="small">"...returns false if the page number of pPageBuffer (a JuniperPageBuffer) is greater than the page number of the last page of the file; otherwise, the data for that page is read from the Juniper file system into the packet of pPageBuffer."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest tResult pn</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ (pn &larr; pPageBuffer pageNumber) &gt; lastpn  ⇒  [ ⇑ false ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">lastpn=1 and⦂ self empty⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pPageBuffer length: 0. "⇑ self Get: pPageBuffer" ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tRequest parameter: 1 &larr; (pn - 1).  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tResult &larr; self doAction: sReadPage requestPrs: tRequest.  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pPageBuffer page: (tResult packet).  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pPageBuffer length: (tResult parameter: 1).  "6"<br></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">⇑ pPageBuffer  "7"<br>]<br>"<br>1. Return false if the page number of pPageBuffer is greater than that of the last page of the file.<br>2. Create a new request parameter block.<br>3. Set the page number parameter to that of pPageBuffer less 1.  Juniper page numbers start at 0.<br>4. Issue a &rsquo;read page&rsquo; request.<br>5. Set the pPageBuffer packet to that of the result parameter block.<br>6. Set the length of pPageBuffer to that returned in the result parameter block.<br>7. Return pPageBuffer modified.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Write: pPageBuffer<br></span><span class="small">"...adjusts the length of the file if pPageBuffer is the last page, sends the data buffered in pPageBuffer (a JuniperPageBuffer) to the Juniper file system, and returns pPageBuffer."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tPageNumber<br>[<br></span><span class="tab" val="79"></span><span class="small">tPageNumber &larr; pPageBuffer pageNumber.<br></span><span class="tab" val="79"></span><span class="small">[ tPageNumber &lt; lastpn ⇒ [ ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ tPageNumber &gt; (lastpn+1) ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ ⇑ self error: &rsquo;invalid page number&rsquo; ]  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self length:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">( (tPageNumber-1)*(pPageBuffer dataLength)+(pPageBuffer length)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">).  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">self writePage: pPageBuffer.  "4"<br></span><span class="tab" val="79"></span><span class="small">⇑ pPageBuffer  "5"<br>]<br>"<br>1. If the page number of pPageBuffer is less than the last page number of the file, do not readjust the file length.<br>2. If the page number of pPageBuffer is greater than the next available page number for the file, invoke error handling.<br>3. If pPageBuffer is the last page of the file or will immediately follow the last page of the file, adjust the file length.<br>4. Send the data to Juniper.<br>5. Return pPageBuffer unmodified.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">writePage: pPageBuffer<br></span><span class="small">"...sends the data buffered in pPageBuffer (a JuniperPageBuffer) to the Juniper file system provided the buffer is not empty."<br></span><span class="tab" val="79"></span><span class="small">| tRequest<br>[<br></span><span class="tab" val="79"></span><span class="small">[ (pPageBuffer length = 0) ⇒ [ ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tRequest &larr; JuniperRequestParameterBlock new.  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tRequest<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">packet &larr; pPageBuffer page;  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">leader: 1 &larr; 0;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">leader: 2 &larr; 0;  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">parameter: 1 &larr; ((pPageBuffer pageNumber) - 1).  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self doAction: sWritePage requestPrs: tRequest.  "6"<br></span><span class="tab" val="79"></span><span class="small">].<br>]<br>"<br>1. If there is no data in pPageBuffer do nothing.<br>2. Create a new request parameter block.<br>3. Set the packet to that of pPageBuffer.  This contains the data to be written on the Juniper file.<br>4. Set the authentication key and reserved word to 0.<br>5. Set the page number parameter to that of pPageBuffer less 1.  Juniper page numbers start at 0.<br>6. Issue a &rsquo;write page&rsquo; request.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>MISC (internal)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">doAction: pAction requestPrs: pRequest<br></span><span class="small">"...the specified request, pAction, (selected from gJuniperConstants) with its corresponding request parameter block, pRequest ( a JuniperRequestParameter Block), is issued to the Juniper file server (through the file interface).  If no errors are found, a JuniperResultParameterBlock is returned; otherwise, error handling is invoked.  If no request parameters are required, pRequest can be specified as nil."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ pRequest ≡ nil ⇒ [ pRequest &larr; self newRequestParameterBlock. ]  "1"<br></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">pRequest shortFileHandle &larr; fShortFileHandle.  "2"<br></span><span class="tab" val="79"></span><span class="small">⇑ ((self interface) doAction: pAction requestPrs: pRequest)  "3"<br>]<br>"<br>1. Create a new request parameter block if one is not specified.<br>2. Set the short file handle parameter.<br>3. Issue the request to the Juniper interface and return the result parameter block.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">interface<br></span><span class="small">"...returns the JuniperInterface controlling the file."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑ directory<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">longFileHandle: pLongFileHandle<br></span><span class="small">"...sets the file&rsquo;s long file handle."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">fLongFileHandle &larr; pLongFileHandle.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">newRequestParameterBlock<br></span><span class="small">"...initializes and returns a new JuniperRequestParameterBlock."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑ ((self interface) newRequestParameterBlock)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪JuniperFileController under: &rsquo;Juniper&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"JuniperInterface"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;JuniperInterface&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: FileDirectory<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo; <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fName<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fPassword<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fDefaultDirectory<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fJuniperSocket<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fTimer<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fExceptionHandler<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fSpecialError<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fOpenIndicator<br></span><span class="tab" val="79"></span><span class="medium bold">&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: gJuniperConstants;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>JUNIPER INTERFACE</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">implementationNotes<br></span><span class="small">[<br>"<br>FIELDS<br></span><span class="small bold">fName </span><span class="small">:</span><span class="small bold"> </span><span class="small">a String representing the name of an account on the Juniper file system.<br></span><span class="small bold">fPassword </span><span class="small">: a String representing the password of the same account.<br></span><span class="small bold">fDefaultDirectory</span><span class="small"> : a String representing the directory to be used as the default if one is not specified as part of a file name.<br></span><span class="small bold">fJuniperSocket</span><span class="small"> : a JuniperSocket used to interface to the etherWorld mechanism.<br></span><span class="small bold">fTimer</span><span class="small"> : a Timer used to periodically send noop commands when the interface is open to prevent timeout.<br></span><span class="small bold">fExceptionHandler</span><span class="small"> : an ExceptionHandler to invoke when a transaction is aborted.<br></span><span class="small bold">fSpecialError</span><span class="small"> : an error code to ignore on a command request.<br></span><span class="small bold">fOpenIndicator</span><span class="small"> : the interface status: true means open; nil means not open.<br>"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>USER CALLABLE</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">close<br></span><span class="small">"...ends the current transaction and closes the interface."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">|  tResult</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ fOpenIndicator ≡ nil ⇒ [ ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tResult &larr; self doAction: sLogout requestPrs: nil.  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">show: (tResult nextDataBlockString).  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">super close.  "4"<br></span><span class="tab" val="79"></span><span class="small">].<br>]<br>"<br>1. If the interface is not open, do nothing.<br>2. Issue a logout command.<br>3. Display the logout message returned by Juniper.<br>4. delete self from externalViews, Release timers, fields, etc.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">closeTransaction<br></span><span class="small">"...closes the current transaction leaving the user logged in with all open files still open, and all read and write locks still in effect."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">self doAction: sCloseTransaction requestPrs: nil.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">directory: pDirectory<br></span><span class="small">"...specifies the directory name to be added to any file name that does not begin with a directory name."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">fDefaultDirectory &larr; pDirectory.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">exceptionHandler: pExceptionHandler<br></span><span class="small">"...specifies an exception handler to be invoked if any subsequent request discovers that the expected transaction has been closed.  If no exception handler is set, a notify window is displayed."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">fExceptionHandler &larr; pExceptionHandler.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">name: pName password: pPassword<br></span><span class="small">"...specifies the name and password of an account on the Juniper file system.  This account will be logged into whenever the interface is opened."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">fName &larr; pName.<br></span><span class="tab" val="79"></span><span class="small">fPassword &larr; pPassword.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">obsolete </span><span class="small">[⇑fOpenIndicator ≡ nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">open<br></span><span class="small">"...opens the interface allowing access to files on the Juniper file system.  A new transaction is started."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tResult</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ fOpenIndicator ≡ true  ⇒ [ ]  "1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">E wakeup.  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self release.  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fJuniperSocket &larr; JuniperSocket new hostName: self server.  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tResult &larr; self login: (self userName) password: (self userPassword).  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">cr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">show: (tResult nextDataBlockString).  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self timerOn.  "7"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">super open.  "8"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fOpenIndicator &larr; true.  "9"<br></span><span class="tab" val="79"></span><span class="small">].<br>]<br>"<br>1. If the interface is already open, do nothing.<br>2. Make sure that the EtherWorld mechanism is in a valid state.<br>3. Release the interface to insure a valid initial state.  (An invalid state can occur from  an error on some statement in a previous invocation of &rsquo;open&rsquo;).<br>4. Create and initialize a JuniperSocket (parameterize server name?).<br>5. Issue a login command.<br>6. Display the login message that is returned by Juniper.<br>7. Turn on a timer to issue periodic noop commands to prevent timeout.<br>8. Do predefined open operations.<br>9. Set the interface status to &rsquo;open&rsquo;.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">release<br></span><span class="small">"...leaves the interface in a valid state after an error."<br>[<br></span><span class="tab" val="79"></span><span class="small">fOpenIndicator &larr; nil.  "1"<br></span><span class="tab" val="79"></span><span class="small">self timerOff.  "2"<br></span><span class="tab" val="79"></span><span class="small">[ fJuniperSocket ≡ nil ⇒ [ ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fJuniperSocket close.  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fJuniperSocket &larr; nil.  "4"<br></span><span class="tab" val="79"></span><span class="small">].<br>]<br>"<br>1. Set the interface status to &rsquo;not open&rsquo;.<br>2. Turn off the timer.<br>3. Close the JuniperSocket if it exists.<br>4. Release the JuniperSocket field.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">versionNumbers </span><span class="small">[⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>FILE DIRECTORY (restricted)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Delete: pFile<br></span><span class="small">"...deletes from the Juniper file system the file whose file name is specified by pFile (a JuniperFileController)."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span class="small">tRequest nextDataBlockString &larr; (self checkDirectory: (pFile name)).  "2"<br></span><span class="tab" val="79"></span><span class="small">self doAction: sDestroyFile requestPrs: tRequest.  "3"<br>]<br>"<br>1. Create a new request parameter block.<br>2. Get the file name from pFile, add the default directory name to it if necessary, and write it in the request parameter block.<br>3. Issue a &rsquo;destroy file&rsquo; request.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">entryClass<br></span><span class="small">"...returns the file class handled by the JuniperInterface."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑ JuniperFileController<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Find: pFile<br></span><span class="small">"...sends a &rsquo;look up file&rsquo; request to the Juniper file server.  If the file is found, its name and long file handle are set in pFile (a JuniperFileController). Otherwise false is returned."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest tResult</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">fSpecialError &larr; sFileNotFound.  "1"<br></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.  "2"<br></span><span class="tab" val="79"></span><span class="small">tRequest nextDataBlockString &larr; (self checkDirectory: (pFile name)).  "3"<br></span><span class="tab" val="79"></span><span class="small">tResult &larr; self doAction: sLookupFile requestPrs: tRequest.  "4"<br></span><span class="tab" val="79"></span><span class="small">[ fSpecialError ≡ true ⇒ [ fSpecialError &larr; nil.  ⇑ false ]  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fSpecialError &larr; nil.  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pFile<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">longFileHandle: tResult nextDataBlockString;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">name: tResult nextDataBlockString.  "7"<br></span><span class="tab" val="79"></span><span class="small">].<br>]<br>"<br>1. Set the error handling mechanism to ignore a &rsquo;file not found&rsquo; error.<br>2. Create a new request parameter block.<br>3. Get the file name from pFile, add the default directory name to it if necessary, and write it in the request parameter block.<br>4. Issue a &rsquo;look up file&rsquo; request and get the result parameter block.<br>5. If a &rsquo;file not found&rsquo; error was encountered, reset the error handling mechanism and return false.<br>6. (no error encountered) Reset the error handling mechanism.<br>7. Set the long file handle and name (from the result parameter block) in pFile.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Insert: pFile<br></span><span class="small">"...issues a &rsquo;create file&rsquo; request to the Juniper file server and sets the returned long file handle and name in pFile (a JuniperFileController)."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest tResult</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span class="small">tRequest longInteger: 2 &larr; 0 "user rawtotalsecs".  "1.5"<br></span><span class="tab" val="79"></span><span class="small">tRequest nextDataBlockString &larr; (self checkDirectory: (pFile name)).  "2"<br></span><span class="tab" val="79"></span><span class="small">tRequest nextDataBlockString &larr; &rsquo;&rsquo;.  "3"<br></span><span class="tab" val="79"></span><span class="small">tResult &larr; self doAction: sCreateFile requestPrs: tRequest.  "4"<br></span><span class="tab" val="79"></span><span class="small">pFile<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">longFileHandle: tResult nextDataBlockString;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">name: tResult nextDataBlockString.  "5"<br>]<br>"<br>1. Create a new request parameter block.<br>1.5 Set creation date (to default (current) -- later some specific date&time?)<br>2. Get the file name from pFile, add the default directory name to it if necessary, and write it in the request parameter block.<br>3. Blank the file server field of the request parameter block.<br>4. Issue a &rsquo;create file&rsquo; request and get the result parameter block.<br>5. Set the long file handle and name (from the result parameter block) in pFile.<br>" </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Match: entries to: strm </span><span class="small">| entry pat ents name i p lastname [<br></span><span class="tab" val="79"></span><span class="small">"search for Files matching patterns"<br></span><span class="tab" val="79"></span><span class="small">for⦂ pat from: entries do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">name &larr; self checkDirectory: pat name.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i &larr; name find: &rsquo;*&rsquo;◦1. p &larr; name find: &rsquo;#&rsquo;◦1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i &larr; [p=0⇒ [i] i=0⇒ [p] i min: p].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i=0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(self Find: pat)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"exact name found"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">strm next &larr; pat]]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"pattern match over range of first to last possible matches"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pat &larr; self makeEntry: name.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">entry &larr; self makeEntry: (name copy: 1 to: i-1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">lastname &larr; name copy: 1 to: i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">lastname◦i &larr; 0377.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ ((entry &larr; self nextFile: entry) and⦂ entry name &lt; lastname) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pat match: entry⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">strm next &larr; entry.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"copy entry since nextFile smashes into it"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">entry &larr; self makeEntry: entry name]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextFile: pFile<br></span><span class="small">"same as LookupFile (Find:), but it pertains to the file whose name is lexically next after the fileName specified in the request.  If the file is found, its name and long file handle are set in pFile (a JuniperFileController). Otherwise (no next file) false is returned."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest tResult</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">fSpecialError &larr; sFileNotFound.  "1"<br></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.  "2"<br></span><span class="tab" val="79"></span><span class="small">tRequest nextDataBlockString &larr; (self checkDirectory: (pFile name)).  "3"<br></span><span class="tab" val="79"></span><span class="small">tResult &larr; self doAction: sNextFile requestPrs: tRequest.  "4"<br></span><span class="tab" val="79"></span><span class="small">[ fSpecialError ≡ true ⇒ [ fSpecialError &larr; nil.  ⇑ false ]  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fSpecialError &larr; nil.  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pFile<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">longFileHandle: tResult nextDataBlockString;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">name: tResult nextDataBlockString.  "7"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑pFile<br></span><span class="tab" val="79"></span><span class="small">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Rename: oldFile from: newFile<br></span><span class="small">"renames a file on Juniper"</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest newName</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.<br></span><span class="tab" val="79"></span><span class="small">tRequest nextDataBlockString &larr; oldFile name.<br></span><span class="tab" val="79"></span><span class="small">tRequest nextDataBlockString &larr; (newName &larr; self checkDirectory: newFile name).<br></span><span class="tab" val="79"></span><span class="small">self doAction: sRenameFile requestPrs: tRequest.<br></span><span class="tab" val="79"></span><span class="small">oldFile name: newName.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">server </span><span class="small">["should be an instance variable?" ⇑&rsquo;Juniper&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>JUNIPER COMMAND INTERFACE (restricted)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">checkResult: pResult<br></span><span class="small">"...is sent by doAction and doLogin to check the result of a Juniper request.  pResult is a result parameter block (JuniperResultParameterBlock) containing the packet (Pacbuf) returned as a result of the request."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ ((pResult packet) ≡ false or⦂ pResult pupType = 4) or⦂ (pResult resultCode = sCommandNak and⦂ (pResult parameter: 1) = sTransactionAborting) ⇒  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ [ fExceptionHandler ≡ nil ⇒ [ ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fExceptionHandler trap.  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">  ].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self error: &rsquo;No Juniper Transaction&rsquo;.  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ (pResult resultCode)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">= sCommandAck ⇒ [ ⇑ true ];  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">= sCommandNak ⇒  "7"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ self checkRetry: (pResult parameter: 1) ⇒ [ ⇑ false ]  "8"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ (pResult parameter: 1) = fSpecialError ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ fSpecialError &larr; true.  ⇑ true ]  "9"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self error: (pResult nextDataBlockString).  "10"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ true  "11"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">].<br>]<br>"<br>1. JuniperSocket sendRequest: and sendLogin: return false if no response is received from Juniper.<br>2. Invoke error handling if there is no response from Juniper.<br>3. Juniper returns an error pup (packet pup type  = 4) if the transaction has been aborted.<br>4. If the transaction has been aborted and there is an exception handler, then trap to the handler.<br>5. Invoke error handling if control is returned or if there is no exception handler.<br>6. Return true if a &rsquo;command acknowledged&rsquo; was returned (this means success with no result parameters).<br>7. If a &rsquo;command not acknowledged&rsquo; was returned,  an error condition exists.<br>8. Check for a retryable error and return false if so.<br>9. If the error is the same as that specified in the special error indicator, then indicate it and return true.<br>10. If not, invoke error handling.<br>11. Return true if a &rsquo;command not acknowledged&rsquo; was not returned (this means success with result parameters).<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span class="small bold">checkRetry: pErrorCode<br></span><span class="small">"...is sent by checkResult to test for a retryable error.  Returns true if so; false otherwise."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ pErrorCode<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">= sSequenceNumberGap ⇒ [ ⇑ true ];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">= sRecoveryUnderWay ⇒ [ ⇑ true ];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">= sTransactionClosing ⇒ [ ⇑ true ];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">= sCongestion ⇒ [ ⇑ true ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ false<br></span><span class="tab" val="79"></span><span class="small">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">doAction: pAction requestPrs: pRequest<br></span><span class="small">"...corresponds to the Pine Protocol function.  The specified request, pAction, (selected from gJuniperConstants) with its corresponding request parameter block, pRequest (a JuniperRequestParameterBlock), is issued to the Juniper file server (through JuniperSocket sendRequest:). A packet is returned and inserted into a result parameter block and checked for error conditions.  If no errors are found, the result parameter block (a JuniperResultParameterBlock) is returned; otherwise, error handling is invoked.  If no request parameters are required, pRequest can be specified as nil."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tResult</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ fOpenIndicator ≡ nil ⇒ [ self open. ]  "1"<br></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">[ pRequest ≡ nil ⇒ [ pRequest &larr; self newRequestParameterBlock. ]  "2"<br></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">fTimer disable.  "3"<br></span><span class="tab" val="79"></span><span class="small">pRequest opcode &larr; pAction.  "4"<br></span><span class="tab" val="79"></span><span class="small">pRequest pupType &larr; sRequest.  "5"<br></span><span class="tab" val="79"></span><span class="small">tResult &larr; JuniperResultParameterBlock new.  "6"<br></span><span class="tab" val="79"></span><span class="small">tResult packet &larr; (fJuniperSocket sendRequest: (pRequest packet)).  "7"<br></span><span class="tab" val="79"></span><span class="small">fTimer reset.  "8"<br></span><span class="tab" val="79"></span><span class="small">[ self checkResult: tResult ⇒ [ ⇑ tResult ]  "9"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ (self doAction: pAction requestPrs: pRequest)  "10"<br></span><span class="tab" val="79"></span><span class="small">].<br>]<br>"<br>1. Make sure the JuniperInterface is open.<br>2. Create a request parameter block if none was specified.<br>3. Disable the timer to insure that a noop command is not sent while the current request is in progress.<br>4. Set the command code in the packet.<br>5. Set the packet pup type to &rsquo;request&rsquo;.<br>6. Create a result parameter block.<br>7. Send the request to the JuniperSocket with the packet from the request parameter block; set the result packet in the result parameter block.<br>8. Reset the timer.<br>9. Check the result; if valid, return it.<br>10. If false is returned, then a retryable error was encountered so retry the command.<br>" </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">doLogin: pRequest<br></span><span class="small">"...is sent by login:password: with pRequest (a JuniperRequestParameter Block) set.  doLogin: issues a login request, checks for errors, and retries if necessary.  If no error occurs, a JuniperResultParameterBlock is returned; otherwise, error handling is invoked."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tResult<br>[<br></span><span class="tab" val="79"></span><span class="small">tResult &larr; JuniperResultParameterBlock new.  "1"<br></span><span class="tab" val="79"></span><span class="small">tResult packet &larr; (fJuniperSocket sendLogin: (pRequest packet)).  "2"<br></span><span class="tab" val="79"></span><span class="small">[ self checkResult: tResult ⇒ [ ⇑ tResult ]  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ (self doLogin: pRequest)  "4"<br></span><span class="tab" val="79"></span><span class="small">].<br>]<br>"<br>1. Create a new result parameter block.<br>2. Issue a login request and set the result packet in the result parameter block.<br>3. Check the result and return it if there is no error.<br>4. Retry the request if there is a retryable error.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">error:  pMessage<br></span><span class="small">"...is sent by checkResult if an error is encountered on a Juniper request.  (pMessage is a String containing an appropriate error message.)  The error message is formed and a notify window is displayed."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tMessage<br>[<br></span><span class="tab" val="79"></span><span class="small">tMessage &larr; Stream default.<br></span><span class="tab" val="79"></span><span class="small">tMessage append: pMessage.<br></span><span class="tab" val="79"></span><span class="small">super error: (tMessage contents).<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">newPacket<br></span><span class="small">"...returns a new packet (Pacbuf) from the JuniperSocket."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ fJuniperSocket ≡ nil ⇒ [ self open. ]<br></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">⇑ (fJuniperSocket freePacket)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">newRequestParameterBlock<br></span><span class="small">"...initializes and returns a new JuniperRequestParameterBlock."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequestParameterBlock</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ fJuniperSocket ≡ nil ⇒ [ self open. ]  "1"<br></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">tRequestParameterBlock &larr; JuniperRequestParameterBlock new.  "2"<br></span><span class="tab" val="79"></span><span class="small">tRequestParameterBlock<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">packet &larr; (fJuniperSocket freePacket);  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">dataBlockLength &larr; 0;  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">leader: 1 &larr; 0;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">leader: 2 &larr; 0.  "5"<br></span><span class="tab" val="79"></span><span class="small">⇑ tRequestParameterBlock  "6"<br>]<br>"<br>1. Open the interface if it is not already.<br>2. Create a new request parameter block.<br>3. Create a new packet and set it in the request parameter block.<br>4. Set the data block length to 0.<br>5. Set the authentication key and reserved word to 0.<br>6. Return the initialized request parameter block.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>TIMER (internal)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">noOp</span><span class="tab" val="79"></span><span class="small bold"><br></span><span class="small">"...sends a noop command to the Juniper file server.  It&rsquo;s only effect is to reset the timout mechanism of the server."<br></span><span class="tab" val="79"></span><span class="small">| tPacket<br>[<br></span><span class="tab" val="79"></span><span class="small">tPacket &larr; fJuniperSocket freePacket.  "1"<br></span><span class="tab" val="79"></span><span class="small">tPacket pupType &larr; sNoop.  "2"<br></span><span class="tab" val="79"></span><span class="small">tPacket dataString &larr; &rsquo;&rsquo;.  "3"<br></span><span class="tab" val="79"></span><span class="small">fJuniperSocket setAddressesAndComplete: tPacket; timerOff.  "4"<br>]<br>"<br>1. Get a new packet (Pacbuf).<br>2. Set packet pup type to &rsquo;noop&rsquo;.<br>3. Set the dataString to the empty string.  This has the necessary effect of setting the packet length to 0.<br>4. Send the packet.  It is necessary to bypass the normal JuniperSocket interface (sendRequest:) because no acknowledgement is returned for the noop.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">timerOff<br></span><span class="small">"...disables fTimer and sets it to nil."<br>[<br></span><span class="tab" val="79"></span><span class="small">[ fTimer ≡ nil ⇒ [ ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fTimer disable.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">fTimer &larr; nil.<br></span><span class="tab" val="79"></span><span class="small">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">timerOn<br></span><span class="small">"...assigns fTimer to a new timer object that wakes up every 100 seconds (6000 1/60 seconds) and issues a &rsquo;noop&rsquo; command to Juniper.  This  is used to prevent Juniper from timing out during periods of inactivity."<br>[<br></span><span class="tab" val="79"></span><span class="small">self timerOff.  "1"<br></span><span class="tab" val="79"></span><span class="small">fTimer &larr; Timer new.  "2"  <br></span><span class="tab" val="79"></span><span class="small">fTimer for: 6000 action⦂ [ self noOp.  user show: &rsquo;.&rsquo;.  fTimer reset. ].  "3"<br></span><span class="tab" val="79"></span><span class="small">user cr.<br></span><span class="tab" val="79"></span><span class="small">fTimer reset.  "4"<br>]<br>"<br>1. Make sure that the current timer is released.<br>2. Create a new timer.<br>3. Set the timer interval to 100 seconds.  The action of the timer is to send a noop, show a dot in the dispFrame, and reset.<br>4. Activate the timer.<br>" </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>MISC (internal)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">checkDirectory: pFileName </span><span class="small">| ps </span><span class="small bold"><br></span><span class="small">"...returns a string that has the default directory name added to the beginning of pFileName (a String) unless pFileName already begins with a directory name in which case it is returned unchanged. max length of ~58"</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">ps &larr; (String new: 60) asStream.<br><br></span><span class="tab" val="79"></span><span class="small">[pFileName length &gt; 0 and⦂ (pFileName◦1) = (&rsquo;&lt;&rsquo;◦1)⇒ []<br></span><span class="tab" val="79"></span><span class="small">ps append: &rsquo;&lt;&rsquo;; append: self directory; append: &rsquo;&gt;&rsquo;].<br><br></span><span class="tab" val="79"></span><span class="small">ps append: pFileName.<br></span><span class="tab" val="79"></span><span class="small">[ps last = (&rsquo;.&rsquo;◦1)⇒ [ps skip: ¬1]].<br></span><span class="tab" val="79"></span><span class="small">⇑ps contents<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">directory<br></span><span class="small">"...Returns a string specifying the default file name directory.  The default directory is fDefaultDirectory if it is not nil, otherwise it is self name"</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ fDefaultDirectory ≡ nil ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ ⇑ self userName<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ fDefaultDirectory<br></span><span class="tab" val="79"></span><span class="small">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash: pString<br></span><span class="small">"...returns a hash value for pString (a String)."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tHash1 tHash2 i<br>[<br></span><span class="tab" val="79"></span><span class="small">tHash1 &larr; 0.  tHash2 &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: 1 to: (pString length) by: 2 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ tHash1 &larr; tHash1 lxor: (UpperCase◦(pString◦i+1)).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tHash2 &larr; tHash2 lxor:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ i = (pString length) ⇒ [ 040 ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">UpperCase◦(pString◦(i+1)+1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">⇑ (tHash1*256 + tHash2)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">login: pName password: pPassword<br></span><span class="small">"...sets the necessary request parameters and invokes doLogin to issue a login request.  pName (a String) specifies the name of an account on the Juniper file system.  pPassword (a String) specifies the password of the account."</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">| tRequest</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">tRequest &larr; self newRequestParameterBlock.  "1"<br></span><span class="tab" val="79"></span><span class="small">tRequest<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">leader: 3 &larr; sLogin;  "2"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">leader: 4 &larr; 512;  "3"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">leader: 5 &larr; 7;  "4"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">leader: 6 &larr; (self hash: pPassword);  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextDataBlockString &larr; pName;  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pupType &larr; sCustodian.  "7"<br></span><span class="tab" val="79"></span><span class="small">⇑ (self doLogin: tRequest)  "8"<br>]<br>"<br>1. Create a new request parameter block.<br>2. Set the command to Login.<br>3. Set the number of bytes per page to 512.<br>4. Set the Juniper version number to 7 (Nov 80).<br>5. Set the hashed account password to pPassword hashed.<br>6. Set the account name to pName.<br>7. Set the packet pup type to custodian.<br>8. Issue the request and return the result.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">userName<br></span><span class="small">"...returns the account name or a default (a String)."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ fName ≡ nil ⇒ [ ⇑ super userName ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ fName<br></span><span class="tab" val="79"></span><span class="small">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">userPassword<br></span><span class="small">"...returns the account password or a default (a String)."</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[ fPassword ≡ nil ⇒ [ ⇑ super userPassword ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ fPassword<br></span><span class="tab" val="79"></span><span class="small">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>CLASS INIT</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit<br></span><span class="small">"...initializes the constants in gJuniperConstants<br>(see [ivy] &lt;Juniper&gt;4.4&gt; CommonPineDefs.mesa).<br>Do the following to initialize:<br>Smalltalk declare: ↪gJuniperConstants as: (SymbolTable new init: 256).<br>JuniperInterface classInit."<br></span><span class="tab" val="79"></span><span class="small">| tIndex tConstant<br>[<br></span><span class="tab" val="79"></span><span class="small">for⦂ tConstant from: (self juniperConstants) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[</span><span class="tab" val="79"></span><span class="small">[ tConstant is: Integer ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ tIndex &larr; tConstant. ]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">gJuniperConstants declare: tConstant as: tIndex.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tIndex &larr; tIndex+1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">juniperConstants<br></span><span class="small">"...returns the set of constants used to specify requests to and to  interpret results from the Juniper file system."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑<br></span><span class="tab" val="79"></span><span class="small">↪(<br>0250  "PineMsgType (Pup types)"<br>sRequest sResult sUnsolicited sCustodian sSync sPineAck sNoop<br><br>5  "DataRequest"<br>sReadPage sWritePage sSetLength sReadLength sCloseFile sDestroyAnonymousFile sReadData sWriteData sReadAttribute sWriteAttribute sSetWriteLock sSetReadLock sReleaseReadLock<br><br>32  "TransactionRequest"<br>sChangePassword sRoom sOpenFile sCreateAnonymousFile sFindFile sLockQuery sTransCompletionQuery<br><br>42  "ActivityRequest"<br>sLogout sCloseTransaction sAbortTransaction sLoginRequest<br><br>60  "DirectoryRequest"<br>sLookupFile sCreateFile sDestroyFile sRenameFile sNextFile sNextFewFiles<br><br>1  "ResultCode"<br>sCommandNak sCommandAck sHeresData sHeresEntry sHeresFileList sHeresLFH sHeresFile sHeresLength sLoginResponse sLogoutResponse sTransactionClosed sTransCompletionInfo sResourceData sHeresRoom<br><br>0  "Unsolicited Code"<br>sTransactionAborted sReadLockBroken<br><br>8  "CustodianCode"<br>sLogin sAddServer sResourceLocation<br><br>42  "PineErrorCode"<br><br>"TransTroubleCode"<br>sUnimplementedFeature sIllegalLoginAttempt sSoftwareVersionMismatch sNoSuchUser sPasswordMismatch sBytesPerPageUnacceptable sServerTooBusy sOutOfSpace sNoFilesHere sNoDirectoryHere sIllegalFileName sFileNotFound sFileAlreadyExists sTransactionAborting sNoSuchOpenFile sBigFilesNotImplemented sIllegalAttribute sReadAttributeProtectionError sUserAskedForIt sWriteAttributeProtectionError sPackNotOnDrive sTooManyOpenFiles sProtectionViolation sFileNotOnPack sPackFull sFileRefOutOfBounds sFileSizeExcessive sByteRangeExcessive sPackNotOnMachine sNoSuchTransaction sBrokenLock sInconvenientUnwind<br><br>"Retryable"<br>sSequenceNumberGap sRecoveryUnderWay sTransactionClosing sCongestion<br><br>120 "UserDetected"<br>sBlockTooLarge sNoRouteToServer sServerUnknown sBadBytesPerPage sInvalidRequest sPupGlitch sUnableToDecrypt sNoResponseToRequest sNewServerUnwilling sTransactionInUnknownState sBadTimeForRequests<br></span><span class="tab" val="79"></span><span class="small">  )<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>TEST / DIAGNOSTIC</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">test<br></span><span class="small">["<br></span><span class="tab" val="79"></span><span class="small">dpj &larr; nil.<br></span><span class="tab" val="79"></span><span class="small">dpj &larr; JuniperInterface new.<br></span><span class="tab" val="79"></span><span class="small">dpj release.<br></span><span class="tab" val="79"></span><span class="small">dpj open.<br></span><span class="tab" val="79"></span><span class="small">dpj close.<br></span><span class="tab" val="79"></span><span class="small">| f  [ dpj open.  f &larr; dpj file: &rsquo;test.test&rsquo;.<br>until⦂ [ f end ] do⦂ [ user show: (f next) inString. ]. f close. dpj close. ]<br><br>JuniperSocket howMany 2 1 2 2 2  11 Timer howMany  33  NameUser howMany 1 1 1<br>"] </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪JuniperInterface under: &rsquo;Juniper&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">JuniperInterface classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"JuniperPageBuffer"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;JuniperPageBuffer&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: EtherFilePage<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fLength<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fPageNumber<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fSerialNumber<br></span><span class="tab" val="79"></span><span class="medium bold">&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>JUNIPER PAGE BUFFER</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">implementationNotes<br></span><span class="small">[<br>"<br>FIELDS<br></span><span class="small bold">fLength</span><span class="small"> : an Integer specifiying the number of bytes in the page buffer.<br></span><span class="small bold">fPageNumber</span><span class="small"> : an Integer specifying the number of the page buffer.<br></span><span class="small bold">fSerialNumber</span><span class="small"> : an Integer specifying the serial number of the page buffer. <br>"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>FILE PAGE OPERATIONS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length<br></span><span class="small">"...returns the number of bytes in the page buffer."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ fLength<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length: pLength<br></span><span class="small">"...sets the number of bytes in the page buffer."<br>[<br></span><span class="tab" val="79"></span><span class="small">fLength &larr; pLength.<br></span><span class="tab" val="79"></span><span class="small">super length: pLength.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pageNumber<br></span><span class="small">"...returns the page number of the page buffer."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ fPageNumber<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pageNumber: pPageNumber<br></span><span class="small">"...sets the page number of the page buffer."<br>[<br></span><span class="tab" val="79"></span><span class="small">fPageNumber &larr; pPageNumber.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">serialNumber<br></span><span class="small">"...returns the serial number of the page buffer."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ fSerialNumber<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">serialNumber: pSerialNumber<br></span><span class="small">"...sets the serial number of the page buffer."<br>[<br></span><span class="tab" val="79"></span><span class="small">fSerialNumber &larr; pSerialNumber.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪JuniperPageBuffer under: &rsquo;Juniper&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"JuniperParameterBlock"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;JuniperParameterBlock&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fPacket<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">fDataBlockPosition<br></span><span class="tab" val="79"></span><span class="medium bold">&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>JUNIPER PARAMETER BLOCK</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>DOCUMENTATION</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">implementationNotes<br></span><span class="small">[<br>"<br>FIELDS<br></span><span class="small bold">fPacket</span><span class="small"> : a Pacbuf for sending request commands and parameters to the Juniper file server.<br></span><span class="small bold">fDataBlockPosition</span><span class="small"> : an Integer specifying the current position in the data block of fPacket.<br>"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>OPERATIONS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dataBlockAdvance: pIncrement<br></span><span class="small">"...advances the data block position by pIncrement (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span class="small">fDataBlockPosition &larr; fDataBlockPosition + pIncrement.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dataBlockGet<br></span><span class="small">"...returns the current data block as a Stream."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ ( (Stream new)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">of: (fPacket pupString)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">from: fDataBlockPosition<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">to: ( 4 + (fPacket pupLength) - 2 )<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dataBlockLength<br></span><span class="small">"...returns the number of bytes (an Integer) in the data block."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ ((fPacket pupLength) - 42)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dataBlockLength &larr; pLength<br></span><span class="small">"...sets the number of bytes in the data block to pLength (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span class="small">fPacket pupLength &larr; pLength + 42.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">leader: pIndex<br></span><span class="small">"...returns the leader word (an Integer) specified by pIndex (an Integer) from the packet."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ (fPacket word: (12 + pIndex))<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">leader: pIndex &larr; pValue<br></span><span class="small">"...sets pValue (an Integer) in the packet at the leader word specified by pIndex (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span class="small">fPacket word: (12 + pIndex) &larr; pValue.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">packet<br></span><span class="small">"...returns the packet (a Pacbuf)."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ fPacket<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">packet &larr; pPacket<br></span><span class="small">"...sets the packet to pPacket (a Pacbuf) and resets the data block position."<br>[<br></span><span class="tab" val="79"></span><span class="small">fPacket &larr; pPacket.<br></span><span class="tab" val="79"></span><span class="small">fDataBlockPosition &larr; 45.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pupType<br></span><span class="small">"...returns the pup type (an Integer) of the packet."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ (fPacket pupType)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pupType &larr; pPupType<br></span><span class="small">"...sets the pup type of the packet to pPupType (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span class="small">fPacket pupType &larr; pPupType.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪JuniperParameterBlock under: &rsquo;Juniper&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"JuniperRequestParameterBlock"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;JuniperRequestParameterBlock&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: JuniperParameterBlock<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>JUNIPER REQUEST PARAMETER BLOCK</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>OPERATIONS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">longInteger: pPosition &larr; pValue<br></span><span class="small">"...sets pValue (4 bytes of long integer) in the packet at the parameter position specified by pPosition (an Integer)."<br></span><span class="tab" val="79"></span><span class="small">| tString tPosition<br>[<br></span><span class="tab" val="79"></span><span class="small">tString &larr; fPacket pupString.<br></span><span class="tab" val="79"></span><span class="small">tPosition &larr; (pPosition + 16)*2 - 1.<br></span><span class="tab" val="79"></span><span class="small">( (Stream new) of: tString from: tPosition to: (tPosition+3)<br></span><span class="tab" val="79"></span><span class="small">) nextNumber: 4 &larr; pValue.<br></span><span class="tab" val="79"></span><span class="small">tString<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">swap: tPosition with: tPosition+2;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">swap: tPosition+1 with: tPosition+3.<br>]<br>"<br>1. the two words of a Juniper long integers are stored in reverse order from those in Smalltalk.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextDataBlockString &larr; pString<br></span><span class="small">"...sets pString (a String) in the data block at the current position and advances the position."<br></span><span class="tab" val="79"></span><span class="small">| tDataBlock tString tLength tMaxLength<br>[<br></span><span class="tab" val="79"></span><span class="small">fPacket pupLength &larr; 554.  "1"<br></span><span class="tab" val="79"></span><span class="small">tDataBlock &larr; self dataBlockGet.  "2"<br></span><span class="tab" val="79"></span><span class="small">tLength &larr; pString length.  "3"<br></span><span class="tab" val="79"></span><span class="small">tMaxLength &larr; (tLength+1) land: 0177776.  "4"<br></span><span class="tab" val="79"></span><span class="small">tDataBlock<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextword &larr; tLength;  "5"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextword &larr; tMaxLength;  "6"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">append: pString;  "7"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">next: (tMaxLength - tLength) &larr; 0.  "8"<br></span><span class="tab" val="79"></span><span class="small">self dataBlockAdvance: (4 + tMaxLength).  "9"<br>]<br>"<br>1. Set the length of the packet to the maximum size.  The length of each string in the data block is specified in the data block itself.<br>2. Get the data block (as a Stream) from the current position to the end.<br>3. Get the length of pString.<br>4. Determine the length of pString including padding needed to make its length even.<br>5. Set the length of pString in the data block (2 bytes).<br>6. Set the length of pString with padding in the data block (2 bytes).<br>7. Set pString in the data block.<br>8. Add padding in the data block.<br>9. Advance the current data block position past length, maximum length, and pString.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">opcode &larr; pOpcode<br></span><span class="small">"...sets the request opcode field in the packet to pOpcode (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span class="small">fPacket word: 16 &larr; pOpcode.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">parameter: pIndex &larr; pValue<br></span><span class="small">"...sets pValue (an Integer) in the packet at the request parameter field specified by pIndex (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span class="small">fPacket word: (16+pIndex) &larr; pValue.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">shortFileHandle &larr; pShortFileHandle<br></span><span class="small">"...sets the request short file handle field in the packet to pShortFileHandle (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span class="small">fPacket word: 15 &larr; pShortFileHandle.<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪JuniperRequestParameterBlock under: &rsquo;Juniper&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"JuniperResultParameterBlock"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;JuniperResultParameterBlock&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: JuniperParameterBlock<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>JUNIPER RESULT PARAMETER BLOCK</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>OPERATIONS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">longInteger: pPosition<br></span><span class="small">"...returns the 4 bytes of long integer in the packet at the parameter position specified by pPosition (an Integer)."<br></span><span class="tab" val="79"></span><span class="small">| tArray tPosition<br>[<br></span><span class="tab" val="79"></span><span class="small">tPosition &larr; (pPosition + 15)*2 - 1.<br></span><span class="tab" val="79"></span><span class="small">tArray &larr;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">( (Stream new)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">of: (fPacket pupString) from: tPosition to: (tPosition+3)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">) next: 4.<br></span><span class="tab" val="79"></span><span class="small">tArray<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">swap: 1 with: 3;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">swap: 2 with: 4.  "1"<br></span><span class="tab" val="79"></span><span class="small">⇑ ((tArray asStream) nextNumber: 4)<br>]<br>"<br>1. Juniper long integers are stored in reverse order from those in Smalltalk.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextDataBlockString<br></span><span class="small">"...returns the string in the data block at the current position and advances the position."<br></span><span class="tab" val="79"></span><span class="small">| tDataBlock tString tLength tMaxLength<br>[<br></span><span class="tab" val="79"></span><span class="small">tDataBlock &larr; self dataBlockGet.  "1"<br></span><span class="tab" val="79"></span><span class="small">tLength &larr; tDataBlock nextword.  "2"<br></span><span class="tab" val="79"></span><span class="small">tMaxLength &larr; tDataBlock nextword.  "3"<br></span><span class="tab" val="79"></span><span class="small">tString &larr; tDataBlock next: tLength.  "4"<br></span><span class="tab" val="79"></span><span class="small">self dataBlockAdvance: (4 + tMaxLength).  "5"<br></span><span class="tab" val="79"></span><span class="small">⇑ tString  "6"<br>]<br>"<br>1. Get the data block (as a Stream) from the current position to the end.<br>2. Get the length of the next string.<br>3. Get the length of the string including possible padding.<br>4. Get the next string from the data block.<br>5. Position the data block past the length, maximum length, string, and padding.<br>6. Return the string.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">parameter: pIndex<br></span><span class="small">"...returns from the packet the result parameter (an Integer) specified by pIndex (an Integer)."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ (fPacket word: (15+pIndex))<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">resultCode<br></span><span class="small">"...returns the result code (an Integer) from the result packet."<br>[<br></span><span class="tab" val="79"></span><span class="small">⇑ (fPacket word: 15)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪JuniperResultParameterBlock under: &rsquo;Juniper&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"JuniperSocket"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;JuniperSocket&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: RetransmitSocket<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;seqNum outPac loginPending notWaiting result outAck&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>A Socket for communicating with the Juniper File Server. <br>Derived from the class WSocket, jfs, 2/79.<br>see Classes WoodstockFile, WoodstockFilePage, and WoodstockFileDirectory</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization/Termination</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">net: pNet host: pHost <br></span><span class="small">"start with the well known Juniper listener, leave filterInput false"</span><span class="small bold"><br></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">super net: pNet host: pHost soc: 0100 asInt32.<br></span><span class="tab" val="79"></span><span class="small">self retransmit: 3 every: 500.  "8 sec"<br></span><span class="tab" val="79"></span><span class="small">outAck &larr; self freePacket.  "for the outgoing pineAck"<br></span><span class="tab" val="79"></span><span class="small">outAck pupType &larr; 0255.<br></span><span class="tab" val="79"></span><span class="small">outAck pupID1 &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">outAck dataString &larr; &rsquo;&rsquo;.  "also sets length; need to set addresses later"<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Socket</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sendLogin: outPac <br></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">Special routine to send login, wait for ack, retransmit.<br></span><span class="tab" val="79"></span><span class="small italic">Need to reset seqNum, and get new Juniper socket number.<br></span><span class="tab" val="79"></span><span class="small italic">Will return the Juniper response packet, or else a false.</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">frnSocNum high: 0 low: 0100.<br></span><span class="tab" val="79"></span><span class="small">self setOutAddBlock.  filterInput &larr; false.<br></span><span class="tab" val="79"></span><span class="small">outPac pupID0 &larr; 0. outPac pupID1 &larr; seqNum &larr; 0.  <br></span><span class="tab" val="79"></span><span class="small">notWaiting &larr; false.<br></span><span class="tab" val="79"></span><span class="small">loginPending &larr; true.<br></span><span class="tab" val="79"></span><span class="small">self setAddressesAndComplete: outPac.<br></span><span class="tab" val="79"></span><span class="small">until⦂ [notWaiting] do⦂ [ ].<br></span><span class="tab" val="79"></span><span class="small">"all done"<br></span><span class="tab" val="79"></span><span class="small">⇑result.<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sendRequest: outPac <br></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">General routine to send request packets, wait for ack, retransmit.<br></span><span class="tab" val="79"></span><span class="small italic">Will return the Juniper response packet, or else a false.</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">notWaiting &larr; false.<br></span><span class="tab" val="79"></span><span class="small">outPac pupID0 &larr; (seqNum &larr; seqNum + 1).  <br></span><span class="tab" val="79"></span><span class="small">self setAddressesAndComplete: outPac.<br></span><span class="tab" val="79"></span><span class="small">until⦂ [notWaiting] do⦂ [ ].<br></span><span class="tab" val="79"></span><span class="small">"all done"<br></span><span class="tab" val="79"></span><span class="small">⇑result.<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">socProcess: Ipac | temp<br></span><span class="tab" val="79"></span><span class="small">["</span><span class="small italic">Juniper has responded, we&rsquo;re running at a high level"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">loginPending ⇒ "handle this special case"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">["watch out, src has not been checked"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">((frnNet ≠ Ipac sourceNet) or⦂ (frnHost ≠ Ipac sourceHost)) or⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">((0251 ≠ Ipac pupType) or⦂ (0 ≠ Ipac pupID0)) ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">["discard it"  "Ipac &larr; self freePacket: Ipac"]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"this must be it!"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">frnSocNum high: Ipac sourceSoc0 low: Ipac sourceSoc1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self setOutAddBlock. self setAddresses: outAck.  "for later use"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"generate an ack" outAck pupID0 &larr; 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self completePup: outAck.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">loginPending&larr;false.  notWaiting &larr; filterInput &larr; true.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">result &larr; Ipac.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br><br></span><span class="tab" val="79"></span><span class="small">"src. and dest. should have been checked ??)"<br><br></span><span class="tab" val="79"></span><span class="small">Ipac pupType = 0251⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"might be a retransmission of a previous Juniper response or what we want.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">acknowledge in either case then see whether we want to keep the result"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">outAck pupID0 &larr; Ipac pupID0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self completePup: outAck.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">notWaiting or⦂ seqNum ≠ Ipac pupID0⇒ ["Ipac &larr; self freePacket: Ipac"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">notWaiting&larr;true.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">result &larr; Ipac]<br><br></span><span class="tab" val="79"></span><span class="small">"Ipac pupType = 0255 ⇒ [Ipac&larr;self freePacket: Ipac]" "discard pineack"<br></span><span class="tab" val="79"></span><span class="small">notWaiting≡false and⦂ ((Ipac pupType = 4) and⦂ (Ipac word: 23) = 2) ⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"no socket at Juniper"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self timerOff.  notWaiting&larr;true.   result&larr;Ipac. ].<br></span><span class="tab" val="79"></span><span class="small">"Ipac &larr; self freePacket: Ipac."<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">timerFired  <br></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">This piece of code only runs when a timer fires!<br></span><span class="tab" val="79"></span><span class="small italic">Thus, there is mutual exclusion between this and other timer code.<br></span><span class="tab" val="79"></span><span class="small italic">Runs below the ethernet input.   Don&rsquo;t do an active return<br></span><span class="tab" val="79"></span><span class="small italic">Timer sometimes fires even though its been disabled!</span><span class="small">"<br><br></span><span class="tab" val="79"></span><span class="small">notWaiting⇒ [] <br></span><span class="tab" val="79"></span><span class="small">self timerOn⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">go ahead and retransmit.....</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self completePup: outPac<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small">notWaiting &larr; true. result &larr; false.<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪JuniperSocket under: &rsquo;Juniper&rsquo;.</span></div>
  </body>
</html>
