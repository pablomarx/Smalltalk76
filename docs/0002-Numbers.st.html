<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Numbers.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"Natural"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">VariableLengthClass new title: &rsquo;Natural&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: String<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;Naturalzero &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">bytesize: 8;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>A Natural consists of digits between 0 and 255. Accessing beyond the end gives zeroes. This Class is intended to be used by people who implement nicer numbers such as LargeInteger or Rational, thus some of the messages are hard to use because they smash existing Naturals. These messages are only used on Naturals that were created by the programmer using the message.<br>Since we want to eventually have the result of a LargeInteger operation to return a SmallInteger if possible, Natural numbers do not respond to the same set of arithmetic messages as Integers. All of the messages for Natural numbers are preceeded by "nat".</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natadd: arg </span><span class="small">| shorter longer i z sum<br></span><span class="tab" val="79"></span><span class="small">["returns a Natural number"<br></span><span class="tab" val="79"></span><span class="small">z &larr; MachineDouble init.<br></span><span class="tab" val="79"></span><span class="small">[self length &lt; arg length  ⇒ [longer &larr; arg. shorter &larr; self]<br></span><span class="tab" val="79"></span><span class="small">longer &larr; self. shorter &larr; arg].<br></span><span class="tab" val="79"></span><span class="small">sum &larr; Natural new: (longer length).<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: longer length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[z increaseby: longer ◦ i. z increaseby: shorter ◦ i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">sum ◦ i &larr; z extract].<br></span><span class="tab" val="79"></span><span class="small">[z low ≠ 0 ⇒ [ sum &larr; sum growby: 1. sum last &larr; z low]].<br></span><span class="tab" val="79"></span><span class="small">⇑sum]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natcompare: arg </span><span class="small">| i len<br></span><span class="tab" val="79"></span><span class="small">"speeded up for Integer args, same speed for LargeInteger (Natural) args"<br></span><span class="tab" val="79"></span><span class="small">[len &larr; self length.<br></span><span class="tab" val="79"></span><span class="small">arg length &lt; len⇒ [⇑3]; &gt; len⇒[⇑1]<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: len to: 1 by: ¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[(arg◦i) &lt; (self◦i)⇒[⇑3];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt; (self◦i)⇒[⇑1]].<br></span><span class="tab" val="79"></span><span class="small">⇑2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natdiv: arg </span><span class="small">| quo rem ql d div dh dnh z z2 dl q i j k l carry digit flag<br></span><span class="tab" val="79"></span><span class="small">["returns a vector of (quotient, remainder)"<br></span><span class="tab" val="79"></span><span class="small">l &larr; ((self length) - (arg length) + 1).<br></span><span class="tab" val="79"></span><span class="small">[l≤0 ⇒[⇑(Naturalzero, self)]].<br></span><span class="tab" val="79"></span><span class="small">d &larr; 8 - (arg last hibit).<br></span><span class="tab" val="79"></span><span class="small">rem &larr; self natnormalize: d. "makes a copy and shifts"<br></span><span class="tab" val="79"></span><span class="small">div &larr; arg natnormalize: d. "shifts so high order word is &gt;127"<br></span><span class="tab" val="79"></span><span class="small">quo &larr; Natural new: l.<br></span><span class="tab" val="79"></span><span class="small">dl &larr; div length - 1.<br></span><span class="tab" val="79"></span><span class="small">ql &larr; l.<br></span><span class="tab" val="79"></span><span class="small">dh &larr; div◦dl.<br></span><span class="tab" val="79"></span><span class="small">dnh &larr; [dl=1 ⇒[0](div◦(dl-1))].<br></span><span class="tab" val="79"></span><span class="small">z &larr; MachineDouble init.<br></span><span class="tab" val="79"></span><span class="small">z2 &larr; MachineDouble new.<br></span><span class="tab" val="79"></span><span class="small">for⦂ k to: ql do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"maintain quo*arg+rem=self"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[j &larr; rem length + 1 - k.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z high &larr; rem◦j.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[z high = dh ⇒ [q &larr; ¬1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z low &larr; rem◦(j-1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">q &larr; z mdiv: dh.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z low &larr; [j&lt;3⇒[0]rem◦(j-2)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z2 gets: q mtimes: dnh.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">flag &larr; true.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ ((z &lt; z2) and⦂ flag) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[q &larr; q unsignedadd: ¬1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> z2 decreaseby: dnh.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> [z2 high &lt; dh ⇒ [flag &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z2 high &larr; z2 high - dh]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">l &larr; j - dl.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z2 init.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">carry &larr; 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ i to: div length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[z gets: q mtimes: (div◦i).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z2 increaseby: rem◦l.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z2 decreaseby: carry.  "subtract q * div from rem"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z2 decreaseby: z low.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">carry &larr; z high.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">rem◦l &larr; z2 extract.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">l &larr; l+1].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[z2 low = 255 ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[q &larr; q unsignedadd: ¬1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">l &larr; j - dl.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z init.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ i to: div length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[z increaseby: rem◦l.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z increaseby: (div◦i).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">rem◦l &larr; z extract.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">l &larr; l+1]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">quo◦(quo length + 1 - k) &larr; q.].<br></span><span class="tab" val="79"></span><span class="small">rem &larr; rem natunnormalize: d lookfirst: dl.<br></span><span class="tab" val="79"></span><span class="small">[quo last = 0 ⇒ [ql&lt;2⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">quo &larr; quo growby: ¬1]].<br></span><span class="tab" val="79"></span><span class="small">⇑(quo,rem)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natdivideandCarry: arg extra: pair </span><span class="small">| i len z<br></span><span class="tab" val="79"></span><span class="small">["arg is an integer &lt; 256 - returns remainder, smashes self to quotient - pair is a 2-vector of len (index of high order non-zero word in self) and a MachineDouble - be careful!!!"<br></span><span class="tab" val="79"></span><span class="small">z &larr; pair ◦ 2.<br></span><span class="tab" val="79"></span><span class="small">z high &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">len &larr; pair ◦ 1.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: len to: 1 by: ¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[z low &larr; self ◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self ◦ i &larr; (z mdiv: arg)].<br></span><span class="tab" val="79"></span><span class="small">[self ◦ len = 0 ⇒[len &larr; len - 1. len=0⇒[len &larr; 1]]].<br></span><span class="tab" val="79"></span><span class="small">pair ◦ 1 &larr; len.<br></span><span class="tab" val="79"></span><span class="small">⇑z high]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natnormalize: n </span><span class="small">| x i r f digit<br></span><span class="tab" val="79"></span><span class="small">["n is the number of bits to shift by. The Natural number returned will be written over repeatedly, so we must make a new one."<br></span><span class="tab" val="79"></span><span class="small">r &larr; (Natural new: (self length+1)).<br></span><span class="tab" val="79"></span><span class="small">x &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">f &larr; n-8.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: r length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[digit &larr; self ◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">r◦i &larr; (digit lshift: n) lor: x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">x &larr; digit lshift: f.].<br></span><span class="tab" val="79"></span><span class="small">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natsubtract: arg </span><span class="small">| shorter longer i z sum sl al ng lastdigit<br></span><span class="tab" val="79"></span><span class="small">["returns an Integer that is created by this operation"<br></span><span class="tab" val="79"></span><span class="small"> sl &larr; self length. al &larr; arg length.<br></span><span class="tab" val="79"></span><span class="small"> z &larr; MachineDouble init.<br></span><span class="tab" val="79"></span><span class="small"> [sl = al ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[i &larr; sl.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ (((self ◦i)=(arg◦i)) and⦂ (i&gt;1)) do⦂ [i &larr; i - 1].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">sl &larr; i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self◦i unsignedlessthan: arg◦i ⇒[longer &larr; arg. ng &larr; true. shorter &larr; self]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">longer &larr; self. shorter &larr; arg. ng &larr; false]<br></span><span class="tab" val="79"></span><span class="small">  sl &lt; al  ⇒ [longer &larr; arg. shorter &larr; self. ng &larr; true. sl &larr; al]<br></span><span class="tab" val="79"></span><span class="small">  longer &larr; self. shorter &larr; arg. ng &larr; false].<br></span><span class="tab" val="79"></span><span class="small"> sum &larr; Natural new: longer length. lastdigit &larr; 1.<br></span><span class="tab" val="79"></span><span class="small"> for⦂ i to: longer length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[z increaseby: longer ◦ i. z decreaseby: shorter ◦ i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> (sum ◦ i &larr; z extract)≠0⇒[lastdigit&larr;i]].<br></span><span class="tab" val="79"></span><span class="small"> [lastdigit=longer length⇒[] z &larr; (Natural new: lastdigit).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ i to: lastdigit do⦂ [z◦i &larr; sum◦i]. sum &larr; z].<br></span><span class="tab" val="79"></span><span class="small"> ⇑LargeInteger new bytes: sum neg: ng]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nattimes: arg </span><span class="small">| prod z pl carry digit i j k<br></span><span class="tab" val="79"></span><span class="small">[[((self length) = 1) and⦂ ((self◦1) = 0) ⇒ [⇑Naturalzero]].<br></span><span class="tab" val="79"></span><span class="small">pl &larr; (self length) + arg length.<br></span><span class="tab" val="79"></span><span class="small">prod &larr; (Natural new: pl).<br></span><span class="tab" val="79"></span><span class="small">z &larr; MachineDouble new.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: pl do⦂ [prod ◦ i &larr; 0].<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[k &larr; i - 1. carry &larr; 0. digit &larr; self ◦ i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">digit ≠ 0 ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[for⦂ j to: arg length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[z gets: digit mtimes: (arg ◦ j).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z increaseby: carry. k &larr; k + 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">z increaseby: (prod ◦ k).  "k=i+j-1"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">prod◦k&larr; z low.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">carry &larr; z high]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">prod◦(k+1)&larr;carry]].<br></span><span class="tab" val="79"></span><span class="small">(prod◦pl) = 0 ⇒ [⇑ prod growby: ¬1]<br></span><span class="tab" val="79"></span><span class="small">⇑prod]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natunnormalize: n lookfirst: a </span><span class="small">| x i r f digit<br></span><span class="tab" val="79"></span><span class="small">[n &larr; 0 - n.<br></span><span class="tab" val="79"></span><span class="small">x &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">f &larr; n+8.<br></span><span class="tab" val="79"></span><span class="small">i &larr; a.<br></span><span class="tab" val="79"></span><span class="small">digit &larr; self◦i.<br></span><span class="tab" val="79"></span><span class="small">while⦂ ((((digit lshift: n) lor: x)=0) and⦂ (i≠1)) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[x &larr; digit lshift: f.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i &larr; i - 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">digit &larr; self ◦ i].<br></span><span class="tab" val="79"></span><span class="small">r &larr; (Natural new: i).<br></span><span class="tab" val="79"></span><span class="small">a &larr; i.<br></span><span class="tab" val="79"></span><span class="small">x &larr; (self◦1) lshift: n.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: a do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[digit &larr; self ◦ (i+1).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">r◦i &larr; (digit lshift: f) lor: x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">x &larr; digit lshift: n.].<br></span><span class="tab" val="79"></span><span class="small">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>As yet unclassified</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ n<br></span><span class="tab" val="79"></span><span class="small">[super length &lt; n ⇒ [⇑0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> ⇑(super◦n)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asInteger<br></span><span class="tab" val="79"></span><span class="small">[self length=1⇒[⇑self◦1]<br></span><span class="tab" val="79"></span><span class="small"> ⇑LargeInteger new bytes: self neg: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit<br></span><span class="tab" val="79"></span><span class="small">[Naturalzero&larr;Natural new: 1.<br></span><span class="tab" val="79"></span><span class="small"> Naturalzero◦1&larr;0.<br></span><span class="tab" val="79"></span><span class="small"> ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isLarge<br></span><span class="tab" val="79"></span><span class="small">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm </span><span class="small">[self printon: strm base: 10]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm base: b </span><span class="small">| p z n b2 x "only works if b≤10"<br></span><span class="tab" val="79"></span><span class="small">[p &larr; Stream default.<br></span><span class="tab" val="79"></span><span class="small">z &larr; (self length, MachineDouble new).<br></span><span class="tab" val="79"></span><span class="small">n &larr; Natural new: super length.<br></span><span class="tab" val="79"></span><span class="small">b2 &larr; b*b.<br></span><span class="tab" val="79"></span><span class="small">self copyto: n.<br></span><span class="tab" val="79"></span><span class="small">until⦂ (((z ◦ 1) = 1) and⦂ ((n◦1)&lt;b2)) do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[x &larr; (n natdivideandCarry: b2 extra: z).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> p next&larr; (x\b)+060.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> p next&larr; (x/b)+060].<br></span><span class="tab" val="79"></span><span class="small">(n◦1) printon: strm base: b.<br></span><span class="tab" val="79"></span><span class="small">strm append: p contents reverse]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">species<br></span><span class="tab" val="79"></span><span class="small">[⇑Natural]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Natural under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">Natural classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Number"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Number&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Numbers in general</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≠ arg<br></span><span class="tab" val="79"></span><span class="small">[⇑((self=arg) ≡ false)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&lt; n </span><span class="small">[⇑self - n &lt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= n </span><span class="small">[⇑self - n = 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&gt; n </span><span class="small">[⇑self - n &gt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">abs </span><span class="small">[self&lt;0⇒[⇑self * ¬1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">between: min and: max<br></span><span class="tab" val="79"></span><span class="small">[⇑[min≤self and⦂ self≤max]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">compare: i<br></span><span class="tab" val="79"></span><span class="small">[self &lt; i⇒ [⇑1]<br></span><span class="tab" val="79"></span><span class="small">self = i⇒ [⇑2]<br></span><span class="tab" val="79"></span><span class="small">⇑3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">factorial  </span><span class="small italic">"I only work for positive integer values"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self=0⇒[⇑1]<br></span><span class="tab" val="79"></span><span class="small">⇑self * (self-1) factorial]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">log2 </span><span class="small">| i cnt </span><span class="small italic">"floor of log base 2"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self &lt; 0 ⇒[⇑(self * ¬1) log2]<br></span><span class="tab" val="79"></span><span class="small">self &lt; 1 ⇒[⇑((self/self) / self) log2 * ¬1]<br></span><span class="tab" val="79"></span><span class="small">i &larr; 1. cnt &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">while⦂ self ≥ i do⦂ [i &larr; i+i. cnt &larr; cnt+1].<br></span><span class="tab" val="79"></span><span class="small">⇑cnt-1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">max: arg<br></span><span class="tab" val="79"></span><span class="small">[self&lt;arg⇒[⇑arg]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">min: arg<br></span><span class="tab" val="79"></span><span class="small">[self&gt;arg⇒[⇑arg]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sign<br></span><span class="tab" val="79"></span><span class="small">[⇑[self=0⇒ [0]; &lt;0⇒ [¬1] 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asPoint<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"Return a Point with me as both coordinates."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑self ⌾ self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asPtX </span><span class="small italic">"pretend to be a Point for Point +-*/"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asPtY </span><span class="small italic">"pretend to be a Point for Point +-*/"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asRectangle<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"Return a Rectangle with me as all coordinates."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑self ⌾ self rect: self ⌾ self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asRectCorner </span><span class="small italic">"pretend to be a Rectangle for Rectangle +-*/"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asRectOrigin </span><span class="small italic">"pretend to be a Rectangle for Rectangle +-*/"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">base8 </span><span class="small">| s<br></span><span class="tab" val="79"></span><span class="small">[s &larr; Stream default. s append: &rsquo;0&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">self printon: s base: 8. ⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">base: b </span><span class="small">| s<br></span><span class="tab" val="79"></span><span class="small">[s &larr; Stream default.<br></span><span class="tab" val="79"></span><span class="small">self printon: s base: b. ⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm </span><span class="small">[self printon: strm base: 10]</span><span class="tab" val="79"></span><span class="small">"default print radix"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Subscripts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">cansubscript: a<br></span><span class="tab" val="79"></span><span class="small">[⇑self asInteger cansubscript: a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">subscripts: a<br></span><span class="tab" val="79"></span><span class="small">[⇑a◦self asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">subscripts: a &larr; val<br></span><span class="tab" val="79"></span><span class="small">[⇑a◦self asInteger &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Intervals, Points</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">⌾ y<br></span><span class="tab" val="79"></span><span class="small">[⇑Point new x: self y: y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">for: n </span><span class="small">[⇑Interval new from: self to: self+(n-1) by: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">to: x<br></span><span class="tab" val="79"></span><span class="small">[⇑Interval new from: self to: x by: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">to: x by: y<br></span><span class="tab" val="79"></span><span class="small">[⇑Interval new from: self to: x by: y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">within: int </span><span class="small">[⇑int start ≤ self and⦂ self ≤ int stop]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">~ x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"synonym for </span><span class="small bold">to:</span><span class="small"> "</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[⇑Interval new from: self to: x by: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isLarge<br></span><span class="tab" val="79"></span><span class="small">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isNumber</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Number under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Date"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Date&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Number<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;day year&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;monthnames secsinday &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Implements dates. (Steve Weyer)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">monthnames &larr; ↪(<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">January February March April May June<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">July August September October November December).<br></span><span class="tab" val="79"></span><span class="small">secsinday &larr; 24*60*60]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Setting state</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">day: day month: month year: year </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[year &lt; 100⇒ [year &larr; 1900 + year]].<br></span><span class="tab" val="79"></span><span class="small">(month &larr; self whichmonth: month)≡false⇒ [user notify: &rsquo;illegal month&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">day &lt; 1 or⦂ day &gt; (self daysinmonth: month)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;illegal day in month&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">day &larr; day + (self monthday: month)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">day: day year: year </span><span class="small">| d<br></span><span class="tab" val="79"></span><span class="small">[while⦂ day &gt; (d &larr; self daysinyear) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">year &larr; year + 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">day &larr; day - d].<br></span><span class="tab" val="79"></span><span class="small">while⦂ day ≤ 0 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">year &larr; year - 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">day &larr; day + self daysinyear].<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">default </span><span class="small">["</span><span class="small italic">today</span><span class="small">" ⇑user now◦1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fromDays: d </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">d = days since Jan 1 1901. There are 1461 days in a 4-year cycle.<br></span><span class="tab" val="79"></span><span class="small italic">2000 is a leap year, so no extra correction is necessary.<br></span><span class="tab" val="79"></span><span class="small italic">day:year: will fix things up</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">d &larr; d asInteger intdiv: 1461.<br></span><span class="tab" val="79"></span><span class="small">self day: 1+ (d◦2) asSmall year: 1901+ ((d◦1) asSmall *4)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Aspects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asSeconds </span><span class="small">"Seconds since the beginning of time (local time)" [<br></span><span class="tab" val="79"></span><span class="small">⇑secsinday * (self - (Date new day: 1 year: 1901))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">day </span><span class="small">[⇑day]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dayinmonth </span><span class="small">[⇑day - (self monthday: self month)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dayinyear </span><span class="small">[⇑day]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">daysinmonth </span><span class="small">[⇑self daysinmonth: self month]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">daysinmonth: m </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑↪(31 28 31 30 31 30 31 31 30 31 30 31)◦m + [m=2⇒ [self leap] 0]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">daysinyear </span><span class="small">[⇑365 + self leap]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">daysleft </span><span class="small">[⇑self daysinyear - day]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">day&larr; day</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small">[⇑(year lshift: 3) lxor: day]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">leap </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">year \ 4 = 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">year \ 100 = 0⇒ [year \ 400 = 0⇒ [⇑1] ⇑0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑1]<br></span><span class="tab" val="79"></span><span class="small">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">month </span><span class="small">| m leap [<br></span><span class="tab" val="79"></span><span class="small">leap &larr; self leap.<br></span><span class="tab" val="79"></span><span class="small">for⦂ m from: 12 to: 1 by: ¬1 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(↪(0 31 59 90 120 151 181 212 243 273 304 334)◦m +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[m &gt; 2⇒ [leap] 0] "self monthday: m") &lt; day⇒ [⇑m]].<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;illegal month&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">monthday: m </span><span class="small italic">"Return first day-in-year of m&rsquo;th month"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑↪(0 31 59 90 120 151 181 212 243 273 304 334)◦m +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[m &gt; 2⇒ [self leap] 0]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">monthname </span><span class="small">[⇑monthnames◦self month]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">weekday </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑↪(Tuesday Wednesday Thursday Friday Saturday Sunday Monday)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">◦self weekdayIndex]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">weekdayIndex | a d </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[day ≤ (self monthday: 3)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">a &larr; year-1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">d &larr; 306]<br></span><span class="tab" val="79"></span><span class="small">a &larr; year.<br></span><span class="tab" val="79"></span><span class="small">d &larr; ¬59 - self leap].<br></span><span class="tab" val="79"></span><span class="small">"Tuesday=1,..., Monday=7"<br></span><span class="tab" val="79"></span><span class="small">⇑d + day + a + (a/4) + (a/400) - (a/100) \ 7 + 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">whichmonth: m </span><span class="small">| a </span><span class="small italic">"M may be a (partial) month name, or a number.  Return the month number, or false"</span><span class="small"> [<br></span><span class="tab" val="79"></span><span class="small">m Is: String⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">m &larr; m + &rsquo;*&rsquo;.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ a to: 12 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"first partial match"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">m match: monthnames◦a⇒ [⇑a]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑false]<br></span><span class="tab" val="79"></span><span class="small"> ⇑m ≥ 1 and⦂ m ≤ 12]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">year </span><span class="small">[⇑year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">year&larr; year</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">+ days </span><span class="small">| t [</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">days &larr; day + days.<br></span><span class="tab" val="79"></span><span class="small">t &larr; Date new.<br></span><span class="tab" val="79"></span><span class="small">days &gt; 0 and⦂ days &lt; 366⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">same year</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">t day &larr; days; year &larr; year.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑t]<br></span><span class="tab" val="79"></span><span class="small">⇑t day: days year: year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">- date<br></span><span class="tab" val="79"></span><span class="small">[date is: Date⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">year = date year⇒ [⇑day - date day]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑(year-1 / 4) - (date year / 4) +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">day + date daysleft + (year-1 - date year * 365)]<br></span><span class="tab" val="79"></span><span class="small">⇑self + (0 - date)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&lt; date </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">year = date year⇒ [⇑day &lt; date day]<br></span><span class="tab" val="79"></span><span class="small">⇑year &lt; date year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= date </span><span class="small">[⇑day = date day and⦂ year = date year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&gt; date </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">year = date year⇒ [⇑day &gt; date day]<br></span><span class="tab" val="79"></span><span class="small">⇑year &gt; date year]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">previous: di </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"e.g. previous: 6 (Sunday) returns Date which is previous closest Sunday.<br></span><span class="tab" val="79"></span><span class="small">note: di=self weekdayIndex returns self+0"<br></span><span class="tab" val="79"></span><span class="small">⇑self + (0 - (7 + self weekdayIndex - di \ 7))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Printing and reading</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">from: s </span><span class="small">[self readfrom: s asVector "asSet" viewer format: nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm </span><span class="small">[self printon: strm format: ↪(1 2 3 040 3 1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm format: f </span><span class="small">| i m [<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">f is print format.<br></span><span class="tab" val="79"></span><span class="small italic">1-3</span><span class="tab" val="79"></span><span class="small italic">positions to print day,month,year respectively<br></span><span class="tab" val="79"></span><span class="small italic">4</span><span class="tab" val="79"></span><span class="small italic">character separator<br></span><span class="tab" val="79"></span><span class="small italic">5</span><span class="tab" val="79"></span><span class="small italic">month format (1 month #, 2 first 3 chars, 3 entire name)<br></span><span class="tab" val="79"></span><span class="small italic">6</span><span class="tab" val="79"></span><span class="small italic">year format (1 year #, 2 year #\100)</span><span class="small">"<br><br></span><span class="tab" val="79"></span><span class="small">m &larr; self month.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: 3 do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[f◦i<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">=1⇒ [day - (self monthday: m) printon: strm];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">=2⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">f◦5<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">=1⇒ [m printon: strm];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">=2⇒ [strm append: monthnames◦m◦(1 to: 3)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">strm append: monthnames◦m]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">([f◦6=1⇒ [year] year\100]) printon: strm].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i&lt;3⇒ [strm next &larr; f◦4 "</span><span class="small italic">separator</span><span class="small">"]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">readfrom: strm<br></span><span class="tab" val="79"></span><span class="small">[self readfrom: strm format: ↪(1 2 3)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">readfrom: strm format: order </span><span class="small">| dmy i [<br></span><span class="tab" val="79"></span><span class="small">strm ∢ ↪today⇒ [⇑self default]<br></span><span class="tab" val="79"></span><span class="small">[order ≡ nil⇒ [order &larr; ↪(1 2 3)]].<br></span><span class="tab" val="79"></span><span class="small">dmy &larr; Vector new: 3.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: 3 "dmy length" do⦂ [dmy◦(order◦i) &larr; strm next].<br></span><span class="tab" val="79"></span><span class="small">self day: dmy◦1 month: dmy◦2 year: dmy◦3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Date under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">Date classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Float"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Float&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Number<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;halfpi sqrt2 twopi fourthpi degreesPerRadian pi radiansPerDegree ln2 &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">bytesize: 16;<br></span><span class="tab" val="79"></span><span class="medium bold">veryspecial: 3;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>These floating-point numbers are good for about 8 or 9 digits of accuracy, and the range is between plus and minus 10&uarr;4000.  Here are some valid floating-point examples:<br></span><span class="tab" val="79"></span><span class="small italic">8.0   13.3   0.3   2.5e6   1.27e¬300   ¬12.987654e2412<br>Mainly: use shift-minus, no imbedded blanks, little e for tens power, and a digit on both sides of the decimal point.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≤ arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self≤arg asFloat] primitive: 73</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≠ arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self≠arg asFloat] primitive: 76</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≥ arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self≥arg asFloat] primitive: 75</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">* arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self*arg asFloat] primitive: 69</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">+ arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self+arg asFloat] primitive: 67</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">- arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self-arg asFloat] primitive: 68</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">/ arg<br></span><span class="tab" val="79"></span><span class="small">[0.0=arg⇒[user notify: &rsquo;Attempt to divide by 0.0&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">⇑self/arg asFloat] primitive: 70</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&lt; arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self&lt;arg asFloat] primitive: 71</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= arg<br></span><span class="tab" val="79"></span><span class="small">[arg isNumber⇒ [⇑self = arg asFloat] ⇑false] primitive: 72</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&gt; arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self&gt;arg asFloat] primitive: 74</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small">[⇑(self fpart * 100) asInteger lxor: self ipart asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">near: n </span><span class="small">[⇑self near: n within: 1.0e¬4]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">near: n within: eps </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"for testing near equality, e.g. error convergence"<br></span><span class="tab" val="79"></span><span class="small">⇑(self - n) abs ≤ eps]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">negated </span><span class="small">[⇑0.0-self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sameAs: arg  </span><span class="small italic">"arg assumed to be of same class as self"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self=arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">\ arg</span><span class="tab" val="79"></span><span class="small italic">"By analogy with integers"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self&lt;0.0⇒[⇑(self/arg) ipart+1.0*arg+self]<br></span><span class="tab" val="79"></span><span class="small">⇑self-((self/arg) ipart*arg)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">| arg</span><span class="tab" val="79"></span><span class="small italic">"By analogy with integers"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑(self/arg) ipart*arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asDegrees</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"self assumed to be in radians"</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[⇑self / radiansPerDegree]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asDirection </span><span class="small">[⇑self cos ⌾ self sin]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asFloat</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asInteger</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"Return an Integer = self ipart"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self asLarge] primitive: 78</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asLarge </span><span class="small">| me digits nat i "convert to LargeInteger"<br></span><span class="tab" val="79"></span><span class="small">[self&lt;0⇒[⇑(0.0-self) asLarge negated]<br></span><span class="tab" val="79"></span><span class="small"> digits &larr; Stream default.<br></span><span class="tab" val="79"></span><span class="small"> [self=0.0⇒[digits next&larr; 0]<br></span><span class="tab" val="79"></span><span class="small">  me &larr; self ipart.<br></span><span class="tab" val="79"></span><span class="small">  while⦂ me≥1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[digits next &larr; (me\256.0) asInteger.<br></span><span class="tab" val="79"></span><span class="small"> </span><span class="tab" val="79"></span><span class="small"> me &larr; me/256.0]].<br></span><span class="tab" val="79"></span><span class="small"> digits &larr; digits contents.<br></span><span class="tab" val="79"></span><span class="small"> nat &larr; Natural new: digits length.<br></span><span class="tab" val="79"></span><span class="small"> for⦂ i to: digits length do⦂ [nat◦i &larr; digits◦i].<br></span><span class="tab" val="79"></span><span class="small"> ⇑LargeInteger new bytes: nat neg: false]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asRadians</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"self assumed to be in degrees"</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[⇑self * radiansPerDegree]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy </span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fpart </span><span class="small">[user croak] primitive: 77</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">ipart</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"Returns a Float with zero fractional part"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self-self fpart]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">recopy </span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">round<br></span><span class="tab" val="79"></span><span class="small">[⇑(self + [self &lt; 0⇒ [¬0.5] 0.5]) asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Math functions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">arctan </span><span class="small">| theta term y eps i  "return angle in degrees good to .02 degrees."<br></span><span class="tab" val="79"></span><span class="small">[self = 1.0 ⇒ [⇑ 45.0].<br></span><span class="tab" val="79"></span><span class="small"> self = ¬1.0 ⇒ [⇑ ¬45.0].<br></span><span class="tab" val="79"></span><span class="small"> [self*self &gt;1.0 ⇒[theta &larr; halfpi. y &larr; ¬1.0/(self*self).  term &larr; ¬1.0/(self abs).]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">theta &larr; 0.0. y &larr; 0.0 - (self*self).  term &larr; self abs].<br><br></span><span class="tab" val="79"></span><span class="small">i &larr; 1.  eps &larr; 0.0001. <br></span><span class="tab" val="79"></span><span class="small">while⦂ term abs &gt; eps do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[theta &larr; theta + term.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> term &larr; term*y*(i asFloat)/((i+2) asFloat).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> i &larr; i+2].<br><br></span><span class="tab" val="79"></span><span class="small">theta &larr; (self sign asFloat)*theta* 360.0 / twopi.<br></span><span class="tab" val="79"></span><span class="small">⇑ theta] </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">cos  </span><span class="small italic">"for angles in radians"</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[self&lt;0.0⇒[⇑(self+halfpi) sin]</span><span class="small italic"><br></span><span class="tab" val="79"></span><span class="small">⇑(halfpi-self) sin]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">exp </span><span class="small">| a n1 x x2 P Q [<br></span><span class="tab" val="79"></span><span class="small">"see Computer Approximations, pp. 96-104, p. 205 (EXPB 1065)"<br><br></span><span class="tab" val="79"></span><span class="small">self abs &gt; 9212.0 "1.0e4001 ln"⇒ [user notify: &rsquo;exp overflow&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">x &larr; self / ln2.<br></span><span class="tab" val="79"></span><span class="small">(n1 &larr; Float new "2.0 ipow: x asInteger")<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">instfield: 1 &larr; x asInteger * 2.<br></span><span class="tab" val="79"></span><span class="small">[(x &larr; x fpart) ≥ 0.5⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">n1 &larr; n1 * sqrt2.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">x &larr; x - 0.5]].<br></span><span class="tab" val="79"></span><span class="small">x2 &larr; x*x.<br></span><span class="tab" val="79"></span><span class="small">"compute 2.0 power: x"<br></span><span class="tab" val="79"></span><span class="small">P &larr; Q &larr; 0.0.<br></span><span class="tab" val="79"></span><span class="small">"↪(0.25250428525576241933744e4 0.28875563776168927289e2) reverse copy"<br></span><span class="tab" val="79"></span><span class="small">for⦂ a from: ↪(28.875564 2525.0429) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">P &larr; (P*x2) + a].<br></span><span class="tab" val="79"></span><span class="small">"↪(0.72857336028361108885189e4 0.375021654220866600213e3 0.1e1) reverse copy"<br></span><span class="tab" val="79"></span><span class="small">for⦂ a from: ↪(1.0 375.02165 7285.7336) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">Q &larr; (Q*x2) + a].<br></span><span class="tab" val="79"></span><span class="small">⇑n1 * ((Q + (x*P))/(Q - (x*P)))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">ipow: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"fixed powers in log n steps"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[x=0⇒ [⇑1.0]<br></span><span class="tab" val="79"></span><span class="small">x=1⇒ [⇑self]<br></span><span class="tab" val="79"></span><span class="small">x&gt;1⇒ [⇑((self*self) ipow: x/2)*(self ipow: x\2)]<br></span><span class="tab" val="79"></span><span class="small">⇑1.0/(self ipow: 0-x)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">ln </span><span class="small">| a x x2 n P [<br></span><span class="tab" val="79"></span><span class="small">"see Computer Approximations, pp. 105-111, p. 227 (LOGE 2663)"<br><br></span><span class="tab" val="79"></span><span class="small">self ≤ 0.0⇒ [user notify: &rsquo;ln not valid for &rsquo; + self asString]<br><br></span><span class="tab" val="79"></span><span class="small">x &larr; self + 0.0.<br></span><span class="tab" val="79"></span><span class="small">"exponent"<br></span><span class="tab" val="79"></span><span class="small">n &larr; ln2 * (((x instfield: 1) / 2) asFloat - 0.5).<br></span><span class="tab" val="79"></span><span class="small">"mantissa between 0.5 and 1.0".<br></span><span class="tab" val="79"></span><span class="small">x instfield: 1 &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">x &larr; x * sqrt2.<br></span><span class="tab" val="79"></span><span class="small">x &larr; (x - 1.0) / (x + 1.0).<br></span><span class="tab" val="79"></span><span class="small">x2 &larr; x*x.<br></span><span class="tab" val="79"></span><span class="small">P &larr; 0.0.<br></span><span class="tab" val="79"></span><span class="small">"↪(0.2000000000046727e1 0.666666635059382 0.4000059794795<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0.28525381498 0.2376245609) reverse copy"<br></span><span class="tab" val="79"></span><span class="small">for⦂ a from: ↪(0.23762456 0.28525381 0.40000598 0.66666664 2.0) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">P &larr; (P*x2) + a].<br></span><span class="tab" val="79"></span><span class="small">⇑n + (x * P)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">log: base </span><span class="small">[⇑self ln / base asFloat ln]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">neg</span><span class="small bold italic"> </span><span class="small italic">"Obsolete - use </span><span class="small bold">negated,</span><span class="small italic"> which is uniform for all Numbers"</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[⇑self negated]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sin </span><span class="small">| x x2 sum const  </span><span class="small italic">"for angles in radians"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self&lt;0.0⇒[⇑self negated sin negated];</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">" normalize to 0≤self≤(pi/4) "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt;twopi⇒[⇑(self\twopi) sin];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt;pi⇒[⇑(self-pi) sin negated];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt;halfpi⇒[⇑(pi-self) sin]<br></span><span class="tab" val="79"></span><span class="small">sum &larr; x &larr; self.<br></span><span class="tab" val="79"></span><span class="small">x2 &larr; x*x.<br></span><span class="tab" val="79"></span><span class="small">for⦂ const from:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"Now compute the series"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">↪(¬0.1666666664 0.0083333315 ¬1.98409e¬4 2.7526e¬6 ¬2.39e¬8)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">do⦂ [sum &larr; const*(x &larr; x*x2)+sum]<br></span><span class="tab" val="79"></span><span class="small">⇑sum]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sqrt </span><span class="small">| guess i<br></span><span class="tab" val="79"></span><span class="small">[self≤0.0⇒[self=0.0⇒[⇑0.0] user notify: &rsquo;sqrt invalid for x&lt;0.&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">guess &larr; self+0.0.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"copy x"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">guess instfield: 1 &larr; (guess instfield: 1)/4*2.</span><span class="tab" val="79"></span><span class="small italic">"and halve expt for first guess"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: 5 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[guess &larr; (self-(guess*guess)) / (guess*2.0) + guess]<br></span><span class="tab" val="79"></span><span class="small">⇑guess]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tan </span><span class="small">| x x2 sum const  </span><span class="small italic">"for angles in radians"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self&lt;0.0⇒[⇑self negated tan negated];</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">" normalize to 0≤self≤(pi/4) "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt;pi⇒[⇑(self\pi) tan];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt;halfpi⇒[⇑(self-halfpi) tan negated];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt;fourthpi⇒[⇑1.0/(halfpi-self) tan]<br></span><span class="tab" val="79"></span><span class="small">sum &larr; x &larr; self.<br></span><span class="tab" val="79"></span><span class="small">x2 &larr; x*x.<br></span><span class="tab" val="79"></span><span class="small">for⦂ const from:</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"Now compute the series"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">↪(0.3333314036 0.1333923995 0.0533740603 0.0245650893 0.0029005250 0.0095168091)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">do⦂ [sum &larr; const*(x &larr; x*x2)+sum]<br></span><span class="tab" val="79"></span><span class="small">⇑sum]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">absprinton: strm digits: digits   </span><span class="small italic">"print me using digits significant figures"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">| fuzz x exp q i<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"x is myself normalized to [1.0, 10.0), exp is my exponent"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">exp &larr; [self&lt;1.0⇒ [0-(10.0/self epart: 10.0)] self epart: 10.0].<br></span><span class="tab" val="79"></span><span class="small">x &larr; self/(10.0 ipow: exp).<br></span><span class="tab" val="79"></span><span class="small italic">"round the last digit to be printed"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">fuzz &larr; 10.0 ipow: 1-digits.  x &larr; 0.5*fuzz+x.<br></span><span class="tab" val="79"></span><span class="small italic">"check if rounding has unnormalized x"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[x≥10.0⇒[x&larr;x/10.0.  exp&larr;exp+1]].<br></span><span class="tab" val="79"></span><span class="small">[exp&lt;6 and⦂ exp&gt;¬4⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[q &larr; 0.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"decimal notation"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">exp&lt;0⇒ [strm append: &rsquo;0.0000&rsquo;◦(1 to: 1-exp)]].<br></span><span class="tab" val="79"></span><span class="small">q &larr; exp. exp &larr; 0].</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"scientific notation"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">use fuzz to track significance"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">while⦂ x≥fuzz do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[i &larr; x asInteger.  strm next &larr; 060+i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">x &larr; x-i * 10.0.  fuzz &larr; fuzz*10.0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">exp &larr; exp-1.  exp=¬1⇒ [strm append: &rsquo;.&rsquo;]].<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">append additional zeros if necessary</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">while⦂ exp≥¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[strm next &larr; 060.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">exp &larr; exp-1.  exp=¬1⇒ [strm append: &rsquo;.&rsquo;]].<br></span><span class="tab" val="79"></span><span class="small">q≠0⇒[strm append: &rsquo;e&rsquo;; print: q]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">epart: base </span><span class="small">| x</span><span class="tab" val="79"></span><span class="small italic">"gives floor log.base self"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self&lt;base⇒ [⇑0]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"self assumed positive"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">self&lt;(base*base)⇒ [⇑1]<br></span><span class="tab" val="79"></span><span class="small">x &larr; 2*(self epart: base*base).</span><span class="tab" val="79"></span><span class="small italic">"binary recursion like ipow"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑x + ((self/(base ipow: x)) epart: base)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm<br></span><span class="tab" val="79"></span><span class="small">[self printon: strm digits: 8]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm digits: digits   </span><span class="small italic">"print me using digits significant figures"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self&gt;0.0⇒[self absprinton: strm digits: digits]<br></span><span class="tab" val="79"></span><span class="small">self=0.0⇒[strm append: &rsquo;0.0&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">strm append: &rsquo;¬&rsquo;. (0.0-self) absprinton: strm digits: digits]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">roundTo: d<br></span><span class="tab" val="79"></span><span class="small">[⇑(self/d+[self&lt;0.0⇒[¬0.5] 0.5]) ipart*d]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">constants from Computer Approximations, pp. 182-183</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">pi = 3.14159265358979323846264338327950288<br></span><span class="tab" val="79"></span><span class="small">pi/2 = 1.57079632679489661923132169163975144<br></span><span class="tab" val="79"></span><span class="small">pi/4 = 0.78539816339744830961566084581987572<br></span><span class="tab" val="79"></span><span class="small">pi*2 = 6.28318530717958647692528676655900576<br></span><span class="tab" val="79"></span><span class="small">pi/180 = 0.01745329251994329576923690768488612<br></span><span class="tab" val="79"></span><span class="small">2.0 ln = 0.69314718055994530941723212145817657<br></span><span class="tab" val="79"></span><span class="small">2.0 sqrt = 1.41421356237309504880168872420969808"<br><br></span><span class="tab" val="79"></span><span class="small">pi &larr; 3.141592654.<br></span><span class="tab" val="79"></span><span class="small">halfpi &larr; pi/2.0.<br></span><span class="tab" val="79"></span><span class="small">fourthpi &larr; pi/4.0.<br></span><span class="tab" val="79"></span><span class="small">twopi &larr; pi*2.0.<br><br></span><span class="tab" val="79"></span><span class="small">radiansPerDegree &larr; pi/180.0.<br></span><span class="tab" val="79"></span><span class="small">degreesPerRadian &larr; 180.0/pi.<br><br></span><span class="tab" val="79"></span><span class="small">ln2 &larr;0.6931471806.<br></span><span class="tab" val="79"></span><span class="small">sqrt2 &larr; 1.414213562]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Float under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">Float classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Integer"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Integer&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Number<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;digitbuffer &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">bytesize: 16;<br></span><span class="tab" val="79"></span><span class="medium bold">veryspecial: 1;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: BitMasks;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: ByteCodes;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Integers are 16-bit numbers, stored in two-s complement form.  The allowable range is from ¬32768 to +32767.  You can type them in octal by typing a leading zero, as in 0377.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≤ arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[⇑t neg ≡ false]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self ≤ t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≠ arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[arg isNumber⇒<br></span><span class="tab" val="79"></span><span class="small"> [t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small">  t isLarge⇒[⇑true]<br></span><span class="tab" val="79"></span><span class="small">  ⇑self ≠ t]<br></span><span class="tab" val="79"></span><span class="small"> ⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≥ arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[⇑t neg]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self ≥ t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">* arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[arg is: Integer⇒[⇑self asLarge*arg]<br></span><span class="tab" val="79"></span><span class="small"> t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[⇑self asLarge*arg]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self*t] primitive: 21</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">+ arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[arg is: Integer⇒[⇑self asLarge+arg]<br></span><span class="tab" val="79"></span><span class="small"> t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[⇑self asLarge+arg]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self + t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">- arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[arg is: Integer⇒[⇑self asLarge-arg]<br></span><span class="tab" val="79"></span><span class="small"> t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[⇑self asLarge-arg]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self - t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">/ arg<br></span><span class="tab" val="79"></span><span class="small">[0=arg⇒[user notify: &rsquo;Attempt to divide by 0&rsquo;]<br></span><span class="tab" val="79"></span><span class="small"> arg isLarge⇒[⇑self asLarge/arg]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self / arg asInteger] primitive: 22</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&lt; arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[t neg ≡ false]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self &lt; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[arg isNumber⇒<br></span><span class="tab" val="79"></span><span class="small"> [t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small">  t isLarge⇒[⇑false]<br></span><span class="tab" val="79"></span><span class="small">  ⇑self = t]<br></span><span class="tab" val="79"></span><span class="small"> ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&gt; arg </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[t &larr; arg asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[⇑t neg]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self &gt; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">compare: arg </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">arg is: Integer⇒ [self &lt; arg⇒ [⇑1]; = arg⇒ [⇑2] ⇑3]<br></span><span class="tab" val="79"></span><span class="small">⇑self natcompare: arg bytes "4 - (arg bytes natcompare: self)"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">even<br></span><span class="tab" val="79"></span><span class="small">[⇑(self land: 1) = 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">intdiv: arg<br></span><span class="tab" val="79"></span><span class="small">[arg is: Integer ⇒[⇑(self/arg),(self\arg)]<br></span><span class="tab" val="79"></span><span class="small"> arg is: LargeInteger ⇒ [⇑self asLarge intdiv: arg]<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;I give up&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">negate<br></span><span class="tab" val="79"></span><span class="small">[⇑0-self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">negated </span><span class="small">[⇑0-self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sameAs: arg  </span><span class="small italic">"arg assumed to be of same class as self"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self=arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">unsignedadd: y<br></span><span class="tab" val="79"></span><span class="small">["treat numbers as unsigned 8-bit quantities."<br></span><span class="tab" val="79"></span><span class="small">⇑((self + y) land: 0377)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">unsignedlessthan: y<br></span><span class="tab" val="79"></span><span class="small">["treat numbers as unsigned 8-bit quantities."<br></span><span class="tab" val="79"></span><span class="small">⇑self &lt; y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">\ arg</span><span class="tab" val="79"></span><span class="small italic">"mod"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[0=arg⇒[user notify: &rsquo;Attempt to divide by 0&rsquo;]<br></span><span class="tab" val="79"></span><span class="small"> arg isLarge⇒[⇑self asLarge\arg]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self \ arg asInteger] primitive: 26</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">| arg</span><span class="tab" val="79"></span><span class="small italic">"truncate"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self/arg*arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Bit Manipulation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">allmask: b </span><span class="small">[⇑b = (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">anymask: b </span><span class="small">[⇑0 ≠ (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bits: int </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"int is an Interval:  0 is leftmost bit, 15 is rightmost"<br></span><span class="tab" val="79"></span><span class="small">⇑self field: (int length "width" * 16) +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">15 - int stop "displacement from right"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">field: fld </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[t &larr; fld asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[user notify: &rsquo;Field descriptor too large&rsquo;]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self field: t] primitive: 36</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">field: fld &larr; val </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[t &larr; fld asInteger.<br></span><span class="tab" val="79"></span><span class="small"> t isLarge⇒[user notify: &rsquo;Field descriptor too large&rsquo;]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self field: t &larr; val asSmall] primitive: 37</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small italic">"used to find large integers in dictionaries"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hibit </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[for⦂ i to: 16 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[(self land: (biton◦(17-i)))≠0⇒[⇑17-i]]<br></span><span class="tab" val="79"></span><span class="small">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">land: arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self land: arg asSmall] primitive: 23</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lor: arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self lor: arg asSmall] primitive: 24</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lshift: arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self lshift: arg asSmall] primitive: 25</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lxor: arg<br></span><span class="tab" val="79"></span><span class="small">[⇑self lxor: arg asSmall] primitive: 35</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nomask: b </span><span class="small">[⇑0 = (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asFloat </span><span class="small">[user croak] primitive: 34</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asInteger </span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asLarge </span><span class="small">| me digits "convert to LargeInteger"<br></span><span class="tab" val="79"></span><span class="small">[me &larr; self bytes.<br></span><span class="tab" val="79"></span><span class="small">digits &larr; Natural new: me length.<br></span><span class="tab" val="79"></span><span class="small">digits◦1 &larr; me◦1.<br></span><span class="tab" val="79"></span><span class="small">[digits length = 2 ⇒ [digits◦2 &larr; me◦2]].<br></span><span class="tab" val="79"></span><span class="small">⇑LargeInteger new bytes: digits neg: self neg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asNatural </span><span class="small">| t<br></span><span class="tab" val="79"></span><span class="small">[t &larr; Natural new: self length.<br></span><span class="tab" val="79"></span><span class="small"> t◦1&larr;self◦1.<br></span><span class="tab" val="79"></span><span class="small"> [t length &gt; 1 ⇒ [t◦2&larr;self◦2]].<br></span><span class="tab" val="79"></span><span class="small"> ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asObject </span><span class="small">[user croak] primitive: 81</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asSmall</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">inString </span><span class="small">| t<br></span><span class="tab" val="79"></span><span class="small">[t &larr; String new: 1. t◦1 &larr; self. ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">oneToMeAsStream</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"used by for-loops"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑Stream new of: (Interval new from: 1 to: self by: 1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">unique<br></span><span class="small">[<br>⇑ self inString unique.<br>]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">unsigned </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">self &lt; 0⇒ [⇑65536.0 + self asFloat]<br></span><span class="tab" val="79"></span><span class="small">⇑self asFloat]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Subscripts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">cansubscript: a<br></span><span class="tab" val="79"></span><span class="small">[⇑self≥1 and⦂ self≤a length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">instfield:</span><span class="tab" val="79"></span><span class="small bold"> i</span><span class="tab" val="79"></span><span class="small italic">"small integer gives trouble"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[i = 1 ⇒[⇑self] user notify: &rsquo;arg too big&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">subscripts: a<br></span><span class="tab" val="79"></span><span class="small">[self cansubscript: a⇒[⇑a◦self]<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;Subscript out of bounds: &rsquo; + self asString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">subscripts: a &larr; val </span><span class="small">| t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[self cansubscript: a⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[t &larr; val asInteger.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> (a is: String) and⦂ (t isnt: Integer)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[user notify: &rsquo;Improper store (non-char into String?)&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> ⇑a◦self &larr; t]<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;Subscript out of bounds: &rsquo; + self asString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">absprinton: strm </span><span class="small">| rem<br></span><span class="tab" val="79"></span><span class="small">[rem &larr; self\10.<br></span><span class="tab" val="79"></span><span class="small">[self&gt;9⇒ [self/10 absprinton: strm]].<br></span><span class="tab" val="79"></span><span class="small">strm next &larr; rem+060]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm<br></span><span class="tab" val="79"></span><span class="small">[self&lt;0⇒[self=¬32768⇒[strm append: &rsquo;¬32768&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">strm append:&rsquo;¬&rsquo;. (0-self) printon: strm base: 10]<br></span><span class="tab" val="79"></span><span class="small">self printon: strm base: 10]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm base: b </span><span class="small">| rem i x<br></span><span class="tab" val="79"></span><span class="small">[[0&gt;(x&larr;self)⇒[i &larr; 1.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">digitbuffer◦1 &larr; 040000\b*2+self-0100000\b. </span><span class="small italic">"get it?"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">x &larr; (040000/b*2+(self-0100000/b))]<br></span><span class="tab" val="79"></span><span class="small">i &larr; 0].<br></span><span class="tab" val="79"></span><span class="small">while⦂ x≥b do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[digitbuffer◦(i&larr;i+1) &larr; x\b.  x &larr; x/b].<br></span><span class="tab" val="79"></span><span class="small">strm next &larr; 060+x.<br></span><span class="tab" val="79"></span><span class="small">while⦂ i≠0 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[strm next &larr; 060+(digitbuffer◦i).  i &larr; i-1].<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Characters</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asLowercase<br></span><span class="tab" val="79"></span><span class="small">[0101 ≤ self⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self ≤ 0132⇒ [⇑self + 040]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asUppercase<br></span><span class="tab" val="79"></span><span class="small">[0141 ≤ self⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self ≤ 0172⇒ [⇑self - 040]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">compareChar: c </span><span class="small">| a<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"⇑self asLowercase compare: c asLowercase"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">a&larr; self.    </span><span class="small italic">"written in-line for speed"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[0101≤a⇒[a≤0132⇒[a&larr;a+040]]].<br></span><span class="tab" val="79"></span><span class="small">[0101≤c⇒[c≤0132⇒[c&larr;c+040]]].<br></span><span class="tab" val="79"></span><span class="small">a&lt;c⇒[⇑1] a=c⇒[⇑2] ⇑3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isalphanumeric<br></span><span class="tab" val="79"></span><span class="small">[self isletter⇒[⇑true]</span><span class="tab" val="79"></span><span class="small italic">"lower-case"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑self isdigit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isdigit <br></span><span class="tab" val="79"></span><span class="small">[self ≥ 060⇒</span><span class="tab" val="79"></span><span class="small italic">" 0 "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[⇑self ≤ 071]</span><span class="tab" val="79"></span><span class="small italic">" 9 "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isletter<br></span><span class="tab" val="79"></span><span class="small">[self ≥ 0141⇒</span><span class="tab" val="79"></span><span class="small italic">" a "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[⇑self ≤ 0172]</span><span class="tab" val="79"></span><span class="small italic">" z "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">self ≥ 0101⇒</span><span class="tab" val="79"></span><span class="small italic">" A "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[⇑self ≤ 0132]</span><span class="tab" val="79"></span><span class="small italic">" Z "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tokenish</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"test for token-chars"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self isletter⇒[⇑true]</span><span class="tab" val="79"></span><span class="small italic">"lower-case"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small"> self isdigit⇒[⇑true]</span><span class="tab" val="79"></span><span class="small italic">"digits"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small"> ⇑&rsquo;¬.:⦂&rsquo; has: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Copying and Purging</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy </span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">purge </span><span class="small">[user croak] primitive: 44</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">recopy </span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit </span><span class="small italic">"Initialize the digit buffer"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[digitbuffer &larr; String new: 16]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compiler Bytecodes</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asCompilerCode  </span><span class="small">"</span><span class="small italic">I am a byte code.  Return the corresponding compiler code</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">[self&lt;16⇒[⇑self+codeLoadField  "</span><span class="small italic">inst field</span><span class="small">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;32⇒[⇑self-16+codeLoadTemp  "</span><span class="small italic">temp</span><span class="small">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;64⇒[⇑self-32+codeLoadLit  "</span><span class="small italic">literal</span><span class="small">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;111⇒[⇑self-64+codeLoadLitInd  "</span><span class="small italic">indirect literal</span><span class="small">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;208⇒[⇑self  "</span><span class="small italic">context relative or constant ... not all values here are legal</span><span class="small">"];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;256⇒[⇑self-208+codeSendLit  "</span><span class="small italic">selector</span><span class="small">"]<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;unexpected byte&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asRemoteCode: generator<br></span><span class="tab" val="79"></span><span class="small">[self&lt;256⇒ [⇑super asRemoteCode: generator]<br></span><span class="tab" val="79"></span><span class="small">(self land: 0177400)≤codeLoadTemp⇒ [⇑ParsedFieldReference new var: self];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">=codeLoadLitInd⇒ [⇑ParsedObjectReference new var: self]<br></span><span class="tab" val="79"></span><span class="small">⇑super asRemoteCode: generator]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bfpSize<br></span><span class="tab" val="79"></span><span class="small">[⇑[self&lt;0⇒ [2]; &gt;8⇒ [2] 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">emitBfp: code on: stack<br></span><span class="tab" val="79"></span><span class="small">[stack pop: 1.<br></span><span class="tab" val="79"></span><span class="small">0=self⇒ [code next &larr; toPop]<br></span><span class="tab" val="79"></span><span class="small">1≤self and⦂ self≤8⇒ [code next &larr; self+toShortBfp-1] </span><span class="small italic">"short bfp"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">code emitLong: toLongBfp by: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">emitBytes: code  </span><span class="small">| c t</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[self&lt;256⇒ [code next &larr; self]<br></span><span class="tab" val="79"></span><span class="small">c &larr; self lshift: ¬8. t &larr; self land: 0377.<br></span><span class="tab" val="79"></span><span class="small">↪(16 16 32 48 48)◦c &gt; t⇒ [code next &larr; ↪(0 16 32 64 208)◦c+t]<br></span><span class="tab" val="79"></span><span class="small">code next &larr; toLoadFieldLong+c-1; next &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">emitForValue: code on: stack<br></span><span class="tab" val="79"></span><span class="small">[[self=toSuper⇒ [code next &larr; toLoadSelf] self emitBytes: code].<br></span><span class="tab" val="79"></span><span class="small">stack push: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">emitJmp: code on: stack<br></span><span class="tab" val="79"></span><span class="small">[0=self⇒ []<br></span><span class="tab" val="79"></span><span class="small">1≤self and⦂ self≤8⇒ [code next &larr; self+toShortJmp-1] </span><span class="small italic">"short jmp"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">code emitLong: toLongJmp by: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">emitsLoad<br></span><span class="tab" val="79"></span><span class="small">[self&lt;256⇒ [⇑self&lt;toSmashPop] ⇑self&lt;codeSendLit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">emittedVariable<br></span><span class="tab" val="79"></span><span class="small">[[self&lt;256⇒[self≤toSuper] self&lt;codeSendLit]⇒[] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findMacros: macros compilerTemps: compilerTemps </span><span class="small">| i j assignment<br></span><span class="tab" val="79"></span><span class="small">[self&lt;codeLoadTemp or⦂ self&gt;(codeLoadTemp+255)⇒[]<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">this temp is not compiler-generated</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">j &larr; self-codeLoadTemp+1.<br></span><span class="tab" val="79"></span><span class="small">compilerTemps◦j≡false⇒[]<br></span><span class="tab" val="79"></span><span class="small">compilerTemps◦j≡nil⇒[compilerTemps◦j &larr; false]<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">The temp isn&rsquo;t compiler-generated after all!!  Nil out the macro</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: macros position to: 2 by: ¬2 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[assignment &larr; macros◦(i-1) ◦ (macros◦i).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">assignment var=self⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[macros◦i &larr; nil.  macros◦(i-1) &larr; nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">compilerTemps◦j &larr; false.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑nil]].<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;couldnt find bad macro&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">firstPush</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isField<br></span><span class="tab" val="79"></span><span class="small">[⇑self≥codeLoadField and⦂ self&lt;codeLoadTemp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">jmpSize<br></span><span class="tab" val="79"></span><span class="small">[⇑[self=0⇒ [0]; &lt;0⇒ [2]; &gt;8⇒ [2] 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm indent: level precedence: p forValue: v decompiler: decompiler<br></span><span class="tab" val="79"></span><span class="small">[v≡false⇒[]<br></span><span class="tab" val="79"></span><span class="small">self&lt;112⇒[user notify: &rsquo;unknown code&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;128⇒[strm append: ↪(&rsquo;sender&rsquo; &rsquo;self&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo; &rsquo;?&rsquo;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&rsquo;¬1&rsquo; &rsquo;0&rsquo; &rsquo;1&rsquo; &rsquo;2&rsquo; &rsquo;10&rsquo; &rsquo;nil&rsquo; &rsquo;false&rsquo; &rsquo;true&rsquo;)◦(self-111)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">=133⇒[strm append: &rsquo;thisContext&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">=134⇒[strm append: &rsquo;super&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;167⇒[user notify: &rsquo;unknown code&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;208⇒[strm append: SpecialOops◦(self-166)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;256⇒[user notify: &rsquo;unknown code&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;512⇒[strm append: (decompiler instvar: self)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;768⇒[strm append: (decompiler temp: self)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;1024⇒[strm append: (decompiler literal: self)];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;1280⇒[strm append: (decompiler literalIndirect: self)]<br></span><span class="tab" val="79"></span><span class="small">strm append: (decompiler selector: self)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sizeForValue<br></span><span class="tab" val="79"></span><span class="small">[self&lt;256 or⦂</span><span class="tab" val="79"></span><span class="small">↪(16 16 32 48 48)◦(self lshift: ¬8) &gt; (self land: 0177)⇒ [⇑1]<br></span><span class="tab" val="79"></span><span class="small">⇑2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>LargeInteger Compatability</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ n | t<br></span><span class="tab" val="79"></span><span class="small">["behave like a Natural"<br></span><span class="tab" val="79"></span><span class="small">n = 1 ⇒ [self &lt; 0 ⇒ [⇑((((self land: 0377) lxor: 0377) + 1) land: 0377)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑self land: 0377]<br></span><span class="tab" val="79"></span><span class="small">n = 2 ⇒ [self &lt; 0 ⇒ [t &larr; ((self lshift: ¬8) lxor: 0377).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(self land: 0377) = 0 ⇒[⇑((t+1) land: 0377)]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ self lshift: ¬8]<br></span><span class="tab" val="79"></span><span class="small">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bytes<br></span><span class="tab" val="79"></span><span class="small">["behave like a LargeInteger - negative integers behave like positive naturals"<br></span><span class="tab" val="79"></span><span class="small">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isInt<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">last<br></span><span class="tab" val="79"></span><span class="small">[⇑self◦self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length<br></span><span class="tab" val="79"></span><span class="small">["behave like a Natural"<br></span><span class="tab" val="79"></span><span class="small">(self ≥ 256) or⦂ (self ≤ ¬256) ⇒ [⇑2]<br></span><span class="tab" val="79"></span><span class="small">⇑1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natcompare: arg </span><span class="small">| i len [<br></span><span class="tab" val="79"></span><span class="small">len &larr; self length.<br></span><span class="tab" val="79"></span><span class="small">arg length &lt; len⇒[⇑3]; &gt; len⇒[⇑1]<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: len to: 1 by: ¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[(self◦i)&gt;(arg◦i)⇒[⇑3];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;(arg◦i)⇒[⇑1]].<br></span><span class="tab" val="79"></span><span class="small">⇑2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">natnormalize: n </span><span class="small">| x i r f digit<br></span><span class="tab" val="79"></span><span class="small">["n is the number of bits to shift by. The Natural number returned will be written over repeatedly, so we must make a new one."<br></span><span class="tab" val="79"></span><span class="small">r &larr; (Natural new: (self length+1)).<br></span><span class="tab" val="79"></span><span class="small">x &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">f &larr; n-8.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: r length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[digit &larr; self ◦i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">r◦i &larr; (digit lshift: n) lor: x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">x &larr; digit lshift: f.].<br></span><span class="tab" val="79"></span><span class="small">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">neg<br></span><span class="tab" val="79"></span><span class="small">["behave like a LargeInteger"<br></span><span class="tab" val="79"></span><span class="small">(self &lt; 0)⇒[⇑true]⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>As yet unclassified</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asInt32 </span><span class="small">[⇑ Int32 new high: 0 low: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">between: min and: max<br></span><span class="tab" val="79"></span><span class="small">[⇑self≥min and⦂ self≤max]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Integer under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">Integer classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"LargeInteger"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;LargeInteger&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Number<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;bytes</span><span class="tab" val="79"></span><span class="medium bold">"A Natural number (digits are 0 to 255)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold"> neg</span><span class="tab" val="79"></span><span class="medium bold">"The sign" &rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>LargeInteger is a class of Numbers with integral values of arbitrary precision. The values are stored as a Natural number that has digits between 0 and 255. The real work is done in Natural, which uses MachineDouble for single digit calculations. The first element of bytes contains the lowest precision digit.<br>All of the Bit Manipulation messages behave like the integer is represented in twos complement and then truncates the number to 16 bits before operating upon it. The value is always a Small integer.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bit: index </span><span class="small">| byte<br></span><span class="tab" val="79"></span><span class="small">"Return bit number i in the binary representation of this number. Bit number 1 is the low order bit"<br></span><span class="tab" val="79"></span><span class="small">[byte &larr; bytes◦(1+((index-1)/8)).<br></span><span class="tab" val="79"></span><span class="small"> ⇑(byte lshift: (0-((index-1)\8))) land: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bytes<br></span><span class="tab" val="79"></span><span class="small">[⇑bytes]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bytes: bytes neg: neg<br></span><span class="tab" val="79"></span><span class="small">[while⦂ bytes isLarge do⦂ [bytes&larr;bytes bytes]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hibit<br></span><span class="tab" val="79"></span><span class="small">"Return the index of the high order bit of the binary representation of this number"<br></span><span class="tab" val="79"></span><span class="small">[⇑bytes last hibit+(8*(bytes length-1))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">neg<br></span><span class="tab" val="79"></span><span class="small">[⇑neg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">neg &larr; neg </span><span class="small">|  "Smashes sign - be careful!"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≤ arg </span><span class="small">[(self compare: arg)&lt;3⇒[⇑self] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">≥ arg </span><span class="small">[(self compare: arg)&gt;1⇒[⇑self] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">* arg </span><span class="small">| as r<br></span><span class="tab" val="79"></span><span class="small">["take care of sign. Arithmetic is done in Natural numbers. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">if arg is Small, it behaves as a LargeInteger."<br></span><span class="tab" val="79"></span><span class="small">as &larr; arg neg.<br></span><span class="tab" val="79"></span><span class="small">r &larr; bytes nattimes: arg bytes.<br></span><span class="tab" val="79"></span><span class="small">⇑LargeInteger new bytes: r neg: ((neg≡as)≡false)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">+ arg </span><span class="small">| as r<br></span><span class="tab" val="79"></span><span class="small">["take care of sign. Arithmetic is done in Natural numbers. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">if arg is Small, it behaves as a LargeInteger."<br></span><span class="tab" val="79"></span><span class="small">as &larr; arg neg.<br></span><span class="tab" val="79"></span><span class="small">neg ≡ as ⇒[r&larr;bytes natadd: arg bytes. ⇑LargeInteger new bytes: r neg: neg]<br></span><span class="tab" val="79"></span><span class="small">r &larr; bytes natsubtract: arg bytes.<br></span><span class="tab" val="79"></span><span class="small">neg ⇒ [⇑ r negate].<br></span><span class="tab" val="79"></span><span class="small">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">- arg </span><span class="small">| as r<br></span><span class="tab" val="79"></span><span class="small">["take care of sign. Arithmetic is done in Natural numbers. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">if arg is Small, it behaves as a LargeInteger."<br></span><span class="tab" val="79"></span><span class="small">as &larr; arg neg.<br></span><span class="tab" val="79"></span><span class="small">neg ≡ as ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[r &larr; bytes natsubtract: arg bytes.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">neg ⇒ [⇑ r neg&larr; (r neg ≡ false)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑r]<br></span><span class="tab" val="79"></span><span class="small">r&larr;bytes natadd: arg bytes.<br></span><span class="tab" val="79"></span><span class="small">⇑LargeInteger new bytes: r neg: neg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">/ arg<br></span><span class="tab" val="79"></span><span class="small">[⇑(self intdiv: arg)◦1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&lt; arg </span><span class="small">[(self compare: arg)=1⇒[⇑self] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= arg<br></span><span class="tab" val="79"></span><span class="small">[arg isNumber⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[(self compare: arg)=2⇒[⇑self] ⇑false]<br></span><span class="tab" val="79"></span><span class="small"> ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&gt; arg </span><span class="small">[(self compare: arg)=3⇒[⇑self] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">abs </span><span class="small">"Return the positive magnitude (absolute value) of this LargeInteger"</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[⇑LargeInteger new bytes: bytes neg: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">compare: arg </span><span class="small">| i a<br></span><span class="tab" val="79"></span><span class="small">[[(((bytes length = 1) and⦂ (bytes◦1=0)) and⦂ (arg bytes length =1)) and⦂ (arg bytes◦1=0)⇒[⇑2]].<br></span><span class="tab" val="79"></span><span class="small">neg⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[arg neg⇒[⇑arg bytes natcompare: bytes] ⇑1]<br></span><span class="tab" val="79"></span><span class="small">arg neg⇒[⇑3]<br></span><span class="tab" val="79"></span><span class="small">⇑bytes natcompare: arg bytes]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">even </span><span class="small">| <br></span><span class="tab" val="79"></span><span class="small">[⇑(((bytes ◦ 1) land: 1) = 0)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">intdiv: arg </span><span class="small">| quo rem ng qr z<br></span><span class="tab" val="79"></span><span class="small">["returns a vector of (quotient, remainder)"<br></span><span class="tab" val="79"></span><span class="small">qr &larr; bytes natdiv: arg bytes.<br></span><span class="tab" val="79"></span><span class="small">quo &larr; qr◦1.<br></span><span class="tab" val="79"></span><span class="small">rem &larr; (qr◦2) asInteger.<br></span><span class="tab" val="79"></span><span class="small">ng &larr; (neg≡arg neg)≡false.<br></span><span class="tab" val="79"></span><span class="small">[quo last = 0 ⇒ [quo length&lt;2⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">quo &larr; quo growby: ¬1]].<br></span><span class="tab" val="79"></span><span class="small">qr◦1&larr;(LargeInteger new bytes: quo neg: ng).<br></span><span class="tab" val="79"></span><span class="small">qr◦2 &larr; [ng and⦂ 0≠rem⇒ [arg abs-rem] rem].<br></span><span class="tab" val="79"></span><span class="small">⇑qr]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">negate<br></span><span class="tab" val="79"></span><span class="small">[⇑LargeInteger new bytes: bytes neg: (neg≡false)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">negated<br></span><span class="tab" val="79"></span><span class="small">[⇑LargeInteger new bytes: bytes neg: neg≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">\ arg<br></span><span class="tab" val="79"></span><span class="small">[⇑(self intdiv: arg)◦2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asFloat</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"Built for comfort, not for speed"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self asString asFloat]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asInteger<br></span><span class="tab" val="79"></span><span class="small">[bytes length&gt;2⇒[⇑self]<br></span><span class="tab" val="79"></span><span class="small"> self≤077777 and: self≥0100000⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[⇑self asSmall]<br></span><span class="tab" val="79"></span><span class="small"> ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asLarge</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asSmall </span><span class="small">| t<br></span><span class="tab" val="79"></span><span class="small">[t &larr; (bytes◦1).<br></span><span class="tab" val="79"></span><span class="small"> [bytes length &gt; 1 ⇒ [t &larr; (t field: 0210 &larr; (bytes◦2))]].<br></span><span class="tab" val="79"></span><span class="small"> neg ⇒[t = ¬32768⇒[⇑¬32768] ⇑0-t]<br></span><span class="tab" val="79"></span><span class="small"> ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isLarge</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm base: b<br></span><span class="tab" val="79"></span><span class="small">[[neg ⇒ [strm append: &rsquo;¬&rsquo;]].<br></span><span class="tab" val="79"></span><span class="small">bytes printon: strm base: b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Bit Manipulation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">allmask: b </span><span class="small">[⇑b = (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">anymask: b </span><span class="small">[⇑0 ≠ (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">field: n<br></span><span class="tab" val="79"></span><span class="small">[⇑self asSmall field: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">field: n &larr; val<br></span><span class="tab" val="79"></span><span class="small">[⇑self asSmall field: n &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small">[⇑bytes hash]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">land: n<br></span><span class="tab" val="79"></span><span class="small">[⇑self asSmall land: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lshift: n<br></span><span class="tab" val="79"></span><span class="small">[⇑self asSmall lshift: n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nomask: b </span><span class="small">[⇑0 = (self land: b)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪LargeInteger under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"MachineDouble"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;MachineDouble&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Number<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;high low&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;low4 low8 high4 high8 &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>MachineDouble is intended to be used by people who are implementing multiple precision arithmetic. It is hard to use - be careful! These are not ordinary numbers.<br>A MachineDouble behaves like a double precision register on an 8-bit machine. Accessing and setting the high and low words of the register are legitimate. Extract returns the low word and shifts the register right by one word, while propagating the sign. This turns out to be very convenient for addition and subtraction to propagate carries and borrows. Sometimes it does too much, but it is faster than using two other messages. Arithmetic is all unsigned, but decreaseby:, when answer is negative, uses twos complement notation to represent borrows.<br>On the NoteTaker, each half of the MachineDouble will be a complete 15-bit unsigned quantity. Obtaining the low or high half may return a negative number that should be considered to be positive (unsigned). The unsignedadd: and unsignedlessthan: messages to integers allow such numbers to be used without creating large integers.<br>This class will be Nova-coded soon.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">extract </span><span class="small">| x<br></span><span class="tab" val="79"></span><span class="small">["returns low, moves high down and propagates sign."<br></span><span class="tab" val="79"></span><span class="small">x &larr; low.<br></span><span class="tab" val="79"></span><span class="small">low &larr; high.<br></span><span class="tab" val="79"></span><span class="small">high &larr; [(low land: 0200)=0 ⇒[0] 0377].<br></span><span class="tab" val="79"></span><span class="small">⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">high<br></span><span class="tab" val="79"></span><span class="small">[⇑high]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">high &larr; high<br></span><span class="tab" val="79"></span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">low<br>   </span><span class="small">[⇑low]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">low &larr; low<br>   </span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Arithmetic</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&lt; arg<br></span><span class="tab" val="79"></span><span class="small">[high = arg high⇒[⇑low &lt; arg low]<br></span><span class="tab" val="79"></span><span class="small">⇑high &lt; arg high]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">decreaseby: y </span><span class="small">| x "y is a positive &lt;256 integer"<br></span><span class="tab" val="79"></span><span class="small">[x &larr; low - y.<br></span><span class="tab" val="79"></span><span class="small">[x &lt; 0 ⇒[high &larr; (high-1) land: 0377]].<br></span><span class="tab" val="79"></span><span class="small">low &larr; x land: 0377.<br></span><span class="tab" val="79"></span><span class="small">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">gets: x mtimes: y </span><span class="small">| xh xl yh yl p1 p2<br></span><span class="tab" val="79"></span><span class="small">["x and y are 8-bit positive #&rsquo;s.<br>      Does single precision unsigned multiplication<br>      returning a double precision result."<br>    xh &larr; x field: high4.<br>    xl &larr; x field: low4.<br>    yh &larr; y field: high4.<br>    yl &larr; y field: low4.<br>    low &larr; yl * xl.<br>    high &larr; yh * xh.<br>    p2 &larr; yh * xl.<br>    p1 &larr; (p2 + (yl * xh)).<br>    high &larr; high + (p1 lshift: ¬4).<br>    low &larr; ((p1 land: 017) lshift: 4) + low.<br>    [low ≥ 256 ⇒ [high &larr; high + 1. low &larr; low - 256.]].<br>    ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">increaseby: y </span><span class="small">| x "y is a positive &lt;256 integer"<br></span><span class="tab" val="79"></span><span class="small">[x &larr; low + y.<br></span><span class="tab" val="79"></span><span class="small">[x &gt; 255 ⇒[high &larr; (high+1) land: 0377]].<br></span><span class="tab" val="79"></span><span class="small">low &larr; x land: 0377.<br></span><span class="tab" val="79"></span><span class="small">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">mdiv: y </span><span class="small">| x<br></span><span class="tab" val="79"></span><span class="small">["Ignores y high (assumes it to be zero. Also assumes that y &gt; x high.<br>      This does a single precision unsigned divide into a double precision dividend<br>      that results in a single precision quotient (returned) and<br>      a single precision remainder(placed in self high)."<br><br></span><span class="tab" val="79"></span><span class="small">high &lt; 128 ⇒ [x &larr; (high lshift: 8) + low.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">high &larr; x\y.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑x/y.]<br></span><span class="tab" val="79"></span><span class="small">high &gt; y ⇒ [user notify: &rsquo;illegal MachineDouble division&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">x &larr; ((high lshift: 1) + (low lshift: ¬7)) - y.<br></span><span class="tab" val="79"></span><span class="small">high &larr; x lshift: ¬1.<br></span><span class="tab" val="79"></span><span class="small">low &larr; (low field: 027 &larr; x).<br></span><span class="tab" val="79"></span><span class="small">⇑((self mdiv: y) + 128)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>As yet unclassified</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asInt </span><span class="small">| n i "may return a negative number"<br></span><span class="tab" val="79"></span><span class="small">[⇑((high lshift: 8) lor: low)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit<br></span><span class="tab" val="79"></span><span class="small">["low4 is a field description for the low order 4 bits of an Integer<br>      high4 is a field description for the high order 4 bits of an 8-bit Integer"<br></span><span class="tab" val="79"></span><span class="small">low4 &larr; 0100.<br>    high4 &larr; 0104]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init<br></span><span class="tab" val="79"></span><span class="small">[low &larr; 0. high &larr; 0. ⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm </span><span class="small">| <br></span><span class="tab" val="79"></span><span class="small">[strm append: &rsquo;[MachineDouble 0&rsquo;.<br>     high printon: strm base: 8.<br>     strm append: &rsquo; 0&rsquo;.<br>     low printon: strm base: 8.<br>     strm append: &rsquo;]&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪MachineDouble under: &rsquo;Numbers&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">MachineDouble classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Time"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Time&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;h m s&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Implements times of day.  Still needs a lot of work.  (Steve Weyer)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Setting state</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">default </span><span class="small">["</span><span class="small italic">right now</span><span class="small">" ⇑user now◦2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fromSeconds: sec </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"seconds since midnight (adjusted for time zone and DST)"<br></span><span class="tab" val="79"></span><span class="small">sec &larr; sec asInteger intdiv: 3600.<br></span><span class="tab" val="79"></span><span class="small">h &larr; (sec◦1) asSmall.<br></span><span class="tab" val="79"></span><span class="small">sec &larr; (sec◦2) asSmall.<br></span><span class="tab" val="79"></span><span class="small">m &larr; sec / 60.<br></span><span class="tab" val="79"></span><span class="small">s &larr; sec \ 60]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hours: h</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">minutes: m</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">seconds: s</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm </span><span class="small italic">"Format is h:mm:ss am/pm"</span><span class="small"> [<br></span><span class="tab" val="79"></span><span class="small">strm print: [h&gt;12⇒[h-12]; &lt;1⇒[12] h];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">append: [m &lt; 10⇒ [&rsquo;:0&rsquo;] &rsquo;:&rsquo;]; print: m;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">append: [s &lt; 10⇒ [&rsquo;:0&rsquo;] &rsquo;:&rsquo;]; print: s;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">space append: [h&lt;12⇒[&rsquo;am&rsquo;] &rsquo;pm&rsquo;]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Aspects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asSeconds </span><span class="small">[⇑3600 * h + (60*m+s)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hours </span><span class="small">[⇑h]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Time under: &rsquo;Numbers&rsquo;.</span></div>
  </body>
</html>
