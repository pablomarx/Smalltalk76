<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Sets-and-Dictionaries.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"ClassOrganizer"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ClassOrganizer&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: Object<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;globalComment commentVector groupVector&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;default &rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>ClassOrganizers contain the formatting information for printing classes.  Each String in commentVector describes a category comprising the messages contained in the Vector which is the corresponding entry in groupVector.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit<br></span><span class="tab"></span><span class="small">[default &larr; &rsquo;As yet unclassified&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init: sortedVec<br></span><span class="tab"></span><span class="small">[self globalComment &larr; &rsquo;This class has not yet been commented&rsquo;.<br></span><span class="tab"></span><span class="small">commentVector &larr; &rsquo;As yet unclassified&rsquo; inVector.<br></span><span class="tab"></span><span class="small">groupVector &larr; sortedVec inVector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asStream </span><span class="small">| v t<br></span><span class="tab"></span><span class="small">[v &larr; Stream new of: (Vector new: 200).<br></span><span class="tab"></span><span class="small">for⦂ t from: groupVector do⦂ [v append: t].<br></span><span class="tab"></span><span class="small">⇑v contents asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">categories </span><span class="small">[⇑commentVector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">category: str </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[i &larr; commentVector find: str.<br></span><span class="tab"></span><span class="small">i=0⇒[user notify: &rsquo;No such category: &rsquo;+str]<br></span><span class="tab"></span><span class="small">⇑groupVector◦i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classify: selector under: heading </span><span class="small">| s h n<br></span><span class="tab"></span><span class="small">[selector is: Vector⇒<br></span><span class="tab"></span><span class="tab"></span><span class="small">[for⦂ s from: selector do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[self classify: s under: heading]]<br></span><span class="tab"></span><span class="small">s &larr; commentVector find: heading.<br></span><span class="tab"></span><span class="small">s&gt;0 and⦂ (groupVector◦s has: selector)⇒[⇑self]<br></span><span class="tab"></span><span class="small">[h &larr; self invert: selector⇒<br></span><span class="tab"></span><span class="tab"></span><span class="small">[heading=default⇒[⇑self]<br></span><span class="tab"></span><span class="small"> </span><span class="tab"></span><span class="small"> n &larr; commentVector find: h.<br></span><span class="tab"></span><span class="tab"></span><span class="small"> groupVector◦n &larr; groupVector◦n delete: selector]].<br></span><span class="tab"></span><span class="small">[s=0⇒ [s &larr; self insert: heading]].<br></span><span class="tab"></span><span class="small">groupVector◦s &larr; groupVector◦s insertSorted: selector.<br></span><span class="tab"></span><span class="small">n &larr; commentVector find: default.<br></span><span class="tab"></span><span class="small">n&gt;0 and⦂ (groupVector◦n) length=0⇒<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self deleteCategory: n]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">delete: selector </span><span class="small">| i</span><span class="tab"></span><span class="tab"></span><span class="small italic">"delete this from all categories"</span><span class="small"><br></span><span class="tab"></span><span class="small">[for⦂ i to: groupVector length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[groupVector◦i has: selector⇒<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[groupVector◦i &larr; (groupVector◦i) delete: selector.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">(groupVector◦i) length=0 and⦂ commentVector◦i=default⇒<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[self deleteCategory: i]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">deleteCategory: index<br></span><span class="tab"></span><span class="small">[groupVector &larr; groupVector without: index.<br></span><span class="tab"></span><span class="small">commentVector &larr; commentVector without: index]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">globalComment </span><span class="small">[⇑globalComment asParagraph text]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">globalCommentItself </span><span class="small">[<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">used only by </span><span class="small bold">Class archiveOn:changesOnly:</span><span class="small">" ⇑globalComment]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">globalComment &larr; globalComment </span><span class="small">"</span><span class="small italic">String or RemoteParagraph</span><span class="small">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">has: sel </span><span class="small">| t<br></span><span class="tab"></span><span class="small">[for⦂ t from: groupVector do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[t has: sel⇒[⇑true]]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: heading </span><span class="small">| di dgroup hi  </span><span class="small italic">"force default category to end, delete if empty"</span><span class="small"><br></span><span class="tab"></span><span class="small">[[(di&larr;commentVector find: default)&gt;0⇒ [dgroup &larr; groupVector◦di]].<br></span><span class="tab"></span><span class="small">commentVector &larr; (commentVector without: di), heading.<br></span><span class="tab"></span><span class="small">groupVector &larr; (groupVector without: di), (Vector new: 0).<br></span><span class="tab"></span><span class="small">hi &larr; commentVector length.<br></span><span class="tab"></span><span class="small">di=0 or⦂ dgroup length=0⇒ [⇑hi]<br></span><span class="tab"></span><span class="small">commentVector &larr; commentVector, default.<br></span><span class="tab"></span><span class="small">groupVector &larr; groupVector, dgroup.<br></span><span class="tab"></span><span class="small">⇑hi]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">invert: selector </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[for⦂ i to: groupVector length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[groupVector◦i has: selector⇒[⇑commentVector◦i]]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion to text</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asParagraph </span><span class="small">| s i<br></span><span class="tab"></span><span class="small">[s &larr; Stream default.<br></span><span class="tab"></span><span class="small">s print: self globalComment.<br></span><span class="tab"></span><span class="small">for⦂ i to: commentVector length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[s cr; print: ((commentVector◦i) inVector concat: groupVector◦i)]<br></span><span class="tab"></span><span class="small">⇑s contents asParagraph]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fromParagraph: para </span><span class="small">| t i j g<br></span><span class="tab"></span><span class="small">[user displayoffwhile⦂<br></span><span class="tab"></span><span class="small">[t &larr; para asVector.<br></span><span class="tab"></span><span class="small">self globalComment &larr; t◦1.<br></span><span class="tab"></span><span class="small">commentVector &larr; Vector new: t length-1.<br></span><span class="tab"></span><span class="small">groupVector &larr; Vector new: t length-1.<br></span><span class="tab"></span><span class="small">for⦂ i to: t length-1 do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[g &larr; t◦(i+1).<br></span><span class="tab"></span><span class="tab"></span><span class="small">commentVector◦i &larr; g◦1.<br></span><span class="tab"></span><span class="tab"></span><span class="small">until⦂ 0=(j&larr; g find: ↪&larr;) do⦂</span><span class="tab"></span><span class="tab"></span><span class="small italic">"reconstitute &larr; suffixes"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[g &larr; g replace: j-1 to: j by: (g◦(j-1)+&rsquo;&larr;&rsquo;) unique inVector]<br></span><span class="tab"></span><span class="tab"></span><span class="small">groupVector◦i &larr; (g copy: 2 to: g length) sort]<br></span><span class="tab"></span><span class="small">]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪ClassOrganizer under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">ClassOrganizer classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Dict"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Dict&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: Object<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>a model for dictionary-index classes</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialize</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init: initialSize </span><span class="small">"</span><span class="small italic">default is to ignore</span><span class="small">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Name-Value Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ name </span><span class="small">| entry ["</span><span class="small italic">find</span><span class="small">"<br></span><span class="tab"></span><span class="small">entry &larr; self find: name⇒ [⇑entry value]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ name &larr; value </span><span class="small">[ "</span><span class="small italic">replace or insert</span><span class="small">"<br></span><span class="tab"></span><span class="small">⇑self write: (self newEntry name: name value: value)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: name with: value </span><span class="small">[<br></span><span class="tab"></span><span class="small">⇑self insert: (self newEntry name: name value: value)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lookup: name </span><span class="small">[⇑self◦name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">replace: name with: value </span><span class="small">[<br></span><span class="tab"></span><span class="small">⇑self replace: (self newEntry name: name value: value)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Entry Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">contents </span><span class="small">[⇑self match: &rsquo;*&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">create: entry </span><span class="small">[⇑self insert: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">delete: entry </span><span class="small">[<br></span><span class="tab"></span><span class="small">self Find: (entry &larr; self makeEntry: entry)⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">self Delete: entry.<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑entry]<br></span><span class="tab"></span><span class="small">⇑self error: &rsquo;not deleted (not found)&rsquo; entry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">exists: entry </span><span class="small">["</span><span class="small italic">doesn&rsquo;t initialize too much</span><span class="small">"<br></span><span class="tab"></span><span class="small">⇑self Find: (self makeEntry: entry)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">find: entry </span><span class="small">[<br></span><span class="tab"></span><span class="small">self Find: (entry &larr; self makeEntry: entry)⇒ [⇑self found: entry]<br></span><span class="tab"></span><span class="small">⇑self error: &rsquo;not found&rsquo; entry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">found: entry </span><span class="small">["</span><span class="small italic">found, fill it in from dictionary</span><span class="small">" ⇑self nextEntry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">get: entry </span><span class="small">["</span><span class="small italic">find or insert</span><span class="small">"<br></span><span class="tab"></span><span class="small">self Find: (entry &larr; self makeEntry: entry)⇒ [⇑self found: entry]<br></span><span class="tab"></span><span class="small">self Insert: entry.<br></span><span class="tab"></span><span class="small">⇑entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: entry </span><span class="small">[<br></span><span class="tab"></span><span class="small">self Find: (entry &larr; self makeEntry: entry)⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑self error: &rsquo;not inserted (already found)&rsquo; entry: entry]<br></span><span class="tab"></span><span class="small">self Insert: entry.<br></span><span class="tab"></span><span class="small">⇑entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">list </span><span class="small">[self list: &rsquo;*&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">list: entries </span><span class="small">[self match: entries to: user]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">match: entries </span><span class="small">| set [<br></span><span class="tab"></span><span class="small">set &larr; Set new vector: 50.<br></span><span class="tab"></span><span class="small">self match: entries to: set.<br></span><span class="tab"></span><span class="small">⇑set contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">match: entries to: strm </span><span class="small">| entry nentries [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">return a Set of entries which match those in entries<br></span><span class="tab"></span><span class="small italic">(can include exact values and patterns and ranges)</span><span class="small">"<br></span><span class="tab"></span><span class="small">[(entries is: Vector) or⦂ (entries Is: Set)⇒ [] entries &larr; entries inVector].<br></span><span class="tab"></span><span class="small">nentries &larr; Set new vector: entries length.<br></span><span class="tab"></span><span class="small">for⦂ entry from: entries do⦂ [nentries next &larr; self makeEntry: entry].<br></span><span class="tab"></span><span class="small">⇑self Match: nentries to: strm]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">read: entry </span><span class="small">[⇑self find: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">rename: entry newName: name </span><span class="small">| nentry ["not tested"<br></span><span class="tab"></span><span class="small">self Find: (nentry &larr; self makeEntry: name)⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑self error: &rsquo;already exists&rsquo; error: nentry]<br></span><span class="tab"></span><span class="small">self Find: (entry &larr; self makeEntry: entry)⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">self Rename: entry from: nentry.<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑entry]<br></span><span class="tab"></span><span class="small">⇑self error: &rsquo;not found&rsquo; entry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">replace: entry </span><span class="small">[<br></span><span class="tab"></span><span class="small">self Find: (entry &larr; self makeEntry: entry)⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">self Replace: entry.<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑entry]<br></span><span class="tab"></span><span class="small">⇑self error: &rsquo;not replaced (not found)&rsquo; entry: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">retrieve: entry </span><span class="small">[⇑self find: entry "match:?"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">store: entry </span><span class="small">[⇑self write: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">write: entry </span><span class="small">["</span><span class="small italic">replace or insert</span><span class="small">"<br></span><span class="tab"></span><span class="small">[self Find: (entry &larr; self makeEntry: entry)⇒ [self Replace: entry]<br></span><span class="tab"></span><span class="small">self Insert: entry].<br></span><span class="tab"></span><span class="small">⇑entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Stream Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">append: dict </span><span class="small">| entry [for⦂ entry from: dict do⦂ [self write: entry]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asStream </span><span class="small">"</span><span class="small italic">leave position where it is</span><span class="small">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next </span><span class="small">[<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">return next entry or false</span><span class="small">" <br></span><span class="tab"></span><span class="small">⇑self nextEntry: self newEntry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">position </span><span class="small">["</span><span class="small italic">current position (name)</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">position &larr; name </span><span class="small">[⇑self Position &larr; self makeEntry: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Position &larr; entry </span><span class="small">[<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">position to name, or position to insert place and return false if not found.<br></span><span class="tab"></span><span class="small italic">subclass had better define position&larr; or Position&larr; (preferably)<br></span><span class="tab"></span><span class="small italic">otherwise circularity results!!!</span><span class="small">"<br></span><span class="tab"></span><span class="small">⇑self position &larr; entry name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">reset </span><span class="small">["</span><span class="small italic">position to beginning</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Entry Creation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">entryClass </span><span class="small">["</span><span class="small italic">a subclass of DictionaryEntry</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">makeEntry: entry </span><span class="small">"</span><span class="small italic">entry or name</span><span class="small">" | cl [<br></span><span class="tab"></span><span class="small">cl &larr; self entryClass.<br></span><span class="tab"></span><span class="small">cl≡false or⦂ (entry Is: cl)⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"entry should not be converted or is the correct type" ⇑entry]<br><br></span><span class="tab"></span><span class="small">"convert entry from a name to an entry with that name"<br></span><span class="tab"></span><span class="small">⇑self newEntry name: entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">newEntry </span><span class="small">[⇑[(self entryClass new) dictionary: self; init]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextEntry: entry </span><span class="small">[<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">return next name and value in entry, or false.<br></span><span class="tab"></span><span class="small italic">if insert or delete occurs after previous next, may be problem</span><span class="small">"<br></span><span class="tab"></span><span class="small">⇑entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Entry Operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Delete: entry </span><span class="small">["</span><span class="small italic">entry found (next), delete it</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">entrySize: entry </span><span class="small">["</span><span class="small italic">storage size of entry, constant or variable</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">error: e entry: entry </span><span class="small">["entry error: e" ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Find: entry </span><span class="small">["</span><span class="small italic">is entry in dictionary?</span><span class="small">" ⇑self Position &larr; entry]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Insert: entry </span><span class="small">["</span><span class="small italic">entry not found, insert it (next)</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Match: entries to: strm </span><span class="small">| entry pat ents [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">default (unordered) is to compare entire dictionary with entries</span><span class="small">"<br></span><span class="tab"></span><span class="small">self reset.<br></span><span class="tab"></span><span class="small">for⦂ entry from: self do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">ents &larr; entries asStream.<br></span><span class="tab"></span><span class="tab"></span><span class="small">while⦂ (ents and⦂ (pat &larr; ents next)) do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">pat match: entry⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">ents &larr; false.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">strm next &larr; entry<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">]<br></span><span class="tab"></span><span class="tab"></span><span class="small">]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Rename: entry from: nentry </span><span class="small">[<br></span><span class="tab"></span><span class="small">self Delete: entry; Insert: (entry name: nentry name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Replace: entry </span><span class="small">["</span><span class="small italic">entry found (next), replace it&rsquo;s value</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>File-Based dictionary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">close </span><span class="small">[<br></span><span class="tab"></span><span class="small">self obsolete⇒ []<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">possible cleanup before a release</span><span class="small">"<br></span><span class="tab"></span><span class="small">[self file⇒ [self file close]].<br></span><span class="tab"></span><span class="small">self release]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">file </span><span class="small">["</span><span class="small italic">return my file</span><span class="small">" ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">obsolete </span><span class="small">["</span><span class="small italic">is my information obsolete (should I regenerate it)?</span><span class="small">"<br></span><span class="tab"></span><span class="small">self file⇒ [⇑self file obsolete]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">open</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">release </span><span class="small">"</span><span class="small italic">obsolete and deallocate storage, especially if connected to an external view,<br></span><span class="tab"></span><span class="small italic">e.g. a File</span><span class="small">" [self file⇒ [self file release]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">reopen </span><span class="small">["</span><span class="small italic">reinitialize, especially if a File is involved</span><span class="small">" self open]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Dict under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"DictionaryEntry"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;DictionaryEntry&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: Object<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>a model for entries --what to retrieve with and store in dictionaries</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialize</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dictionary: dict</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">name: name</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Other</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dictionary </span><span class="small">["</span><span class="small italic">what dictionary did I come from?</span><span class="small">" ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">match: entry </span><span class="small">[<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">does self (some kind of pattern) match entry?</span><span class="small">" self subError] </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Filing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fileSize </span><span class="small">["</span><span class="small italic">size in characters for filing</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">readFrom: file </span><span class="small">["</span><span class="small italic">inverse of </span><span class="small bold">storeOn:</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">storeOn: file </span><span class="small">["store </span><span class="small bold">self</span><span class="small"> as </span><span class="small bold">fileSize</span><span class="small"> characters on </span><span class="small bold">file</span><span class="small">" self subError]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪DictionaryEntry under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"HashSet"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;HashSet&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: Object<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;objects&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>HashSets are pure sets of objects with no associated values.  However, since they allow callers to determine the location of objects in the hash table, subclasses such as Dictionary and MessageDict can provide parallel tables to hold values.  Such subclasses must intercept growto: and reorder their own tables then.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy </span><span class="small italic">"⇑ a copy of me"</span><span class="small"><br></span><span class="tab"></span><span class="small">[⇑self class new copyfrom: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copyfrom: hset </span><span class="small italic">"take on state of hset"</span><span class="small"><br></span><span class="tab"></span><span class="small">[objects &larr; hset objects copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init<br></span><span class="tab"></span><span class="small">[self init: 4]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init: size<br></span><span class="tab"></span><span class="small">[objects &larr; Vector new: (size max: 2)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asStream<br></span><span class="tab"></span><span class="small">[⇑self contents asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">contents </span><span class="small">| obj strm<br></span><span class="tab"></span><span class="small">[strm &larr; (Vector new: objects length) asStream.<br></span><span class="tab"></span><span class="small">for⦂ obj from: objects do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[obj≡nil⇒[] strm next&larr; obj]<br></span><span class="tab"></span><span class="small">⇑strm contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">size </span><span class="small">[⇑objects length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">find: obj </span><span class="small">| i</span><span class="tab"></span><span class="small italic">"⇑index if found, else false"</span><span class="small"><br></span><span class="tab"></span><span class="small">[i &larr; self findornil: obj.<br></span><span class="tab"></span><span class="small">objects◦i=obj⇒[⇑i] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findorerror: name </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[i &larr; self findornil: name.<br></span><span class="tab"></span><span class="small">objects◦i=name⇒ [⇑i]<br></span><span class="tab"></span><span class="small italic">"allow the user to put a correct value into i"</span><span class="small"><br></span><span class="tab"></span><span class="small">user notify: name asString+&rsquo; cannot be found&rsquo;. ⇑i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">has: obj<br></span><span class="tab"></span><span class="small">[⇑objects◦(self findornil: obj)=obj]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Insertion and deletion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">delete: obj </span><span class="small">| i j l<br></span><span class="tab"></span><span class="small">[obj is: Vector⇒[for⦂ i from: obj do⦂ [self delete: i]]<br></span><span class="tab"></span><span class="small">i&larr; self findorerror: obj.<br></span><span class="tab"></span><span class="small">objects◦i&larr; nil.<br></span><span class="tab"></span><span class="small">l&larr; objects length.<br></span><span class="tab"></span><span class="small">until⦂ objects◦(i&larr; [i=l⇒[1] i+1])≡nil do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[i=(j&larr; self findornil: objects◦i)⇒[]<br></span><span class="tab"></span><span class="tab"></span><span class="small">self swap: i with: j]<br></span><span class="tab"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: obj </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[self findorinsert: obj. ⇑obj]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insertall: objs </span><span class="small">| x<br></span><span class="tab"></span><span class="small">[for⦂ x from: objs do⦂ [self insert: x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Growing and shrinking</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">packprobes </span><span class="small">| tot n l i obj t</span><span class="tab"></span><span class="tab"></span><span class="small italic">"⇑(fullness, avg #probes)"</span><span class="small"><br></span><span class="tab"></span><span class="small">[tot &larr; n &larr; 0. l &larr; objects length.<br></span><span class="tab"></span><span class="small">for⦂ i to: l do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[(obj&larr; objects◦i)≡nil⇒[]<br></span><span class="tab"></span><span class="tab"></span><span class="small">t &larr; obj hash \ l.<br></span><span class="tab"></span><span class="tab"></span><span class="small">tot &larr; tot + [i &lt; t⇒ [l - t + i] i - t].<br></span><span class="tab"></span><span class="tab"></span><span class="small">n&larr; n+1]<br></span><span class="tab"></span><span class="small">n=0⇒[⇑(1,1)]<br></span><span class="tab"></span><span class="small">⇑((n asFloat/l) , (tot asFloat/n))]<br></span><span class="small italic">"Class md packprobes(0.4921875 2.53968255 )"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">shrink </span><span class="small">| table oldtable<br></span><span class="tab"></span><span class="small">[oldtable &larr; self.<br></span><span class="tab"></span><span class="small">table &larr; oldtable growto: (2 max: oldtable size/2).<br></span><span class="tab"></span><span class="small">until⦂ table size=oldtable size do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[(oldtable size-table size) print.  user show: &rsquo; &rsquo;.<br></span><span class="tab"></span><span class="tab"></span><span class="small">oldtable &larr; table.<br></span><span class="tab"></span><span class="tab"></span><span class="small">table &larr; oldtable growto: (2 max: oldtable size/2)]<br></span><span class="tab"></span><span class="small">⇑table]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findorinsert: obj </span><span class="small">| i</span><span class="tab"></span><span class="tab"></span><span class="small italic">"insert if not found, "</span><span class="small"><br></span><span class="tab"></span><span class="small">[i &larr; self findornil: obj.<br></span><span class="tab"></span><span class="small">objects◦i=obj⇒[⇑i]  </span><span class="small italic">"found it"</span><span class="small"><br></span><span class="tab"></span><span class="small">self sparse⇒[objects◦i &larr; obj. ⇑i]  </span><span class="small italic">"insert if room"</span><span class="small"><br></span><span class="tab"></span><span class="small">self growto: objects length*2.</span><span class="tab"></span><span class="small italic">"grow"</span><span class="small"><br></span><span class="tab"></span><span class="small">⇑self findorinsert: obj </span><span class="small italic">"and insert"</span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findornil: obj </span><span class="small">| i loc</span><span class="tab"></span><span class="small italic">"⇑index if found or available slot"</span><span class="small"><br></span><span class="tab"></span><span class="small">[loc &larr; obj hash\objects length.<br></span><span class="tab"></span><span class="small">for⦂ i to: objects length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[loc &larr; [loc=objects length⇒[1] loc+1].</span><span class="tab"></span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">objects◦loc ≡ nil⇒ [⇑loc]<br></span><span class="tab"></span><span class="tab"></span><span class="small">objects◦loc = obj⇒ [⇑loc]]<br></span><span class="tab"></span><span class="small">⇑1 </span><span class="small italic">"table full - caller must check for hit"</span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growto: t1 </span><span class="small">| t2 t3  "faster insert for growing"<br></span><span class="tab"></span><span class="small">[t2 &larr; self class new init: t1.<br></span><span class="tab"></span><span class="small">[t1 &lt; objects length ⇒[<br></span><span class="tab"></span><span class="tab"></span><span class="small">for⦂ t3 from: self do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[t2 insert: t3]]<br></span><span class="tab"></span><span class="small">for⦂ t3 from: self do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[t2 rawinsert: t3]].<br></span><span class="tab"></span><span class="small">objects &larr; t2 objects]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">objects </span><span class="small">[⇑objects]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">objects&larr; objects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">rawinsert: t1 </span><span class="small">| t2 "assumes there </span><span class="small bold">is</span><span class="small"> room for the new one"<br></span><span class="tab"></span><span class="small">[t2 &larr; self findornil: t1.<br></span><span class="tab"></span><span class="small">objects ◦ t2 &larr; t1.<br></span><span class="tab"></span><span class="small">⇑t2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">rehash </span><span class="small">| i copy<br></span><span class="tab"></span><span class="small">[copy &larr; HashSet new init: self size.</span><span class="tab"></span><span class="small italic">"create a copy"</span><span class="small"><br></span><span class="tab"></span><span class="small">for⦂ i to: objects length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[objects◦i≡nil⇒[]<br></span><span class="tab"></span><span class="tab"></span><span class="small"> copy insert: objects◦i]</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small italic">"hash each entry into it"</span><span class="small"><br></span><span class="tab"></span><span class="small">objects &larr; copy objects]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sparse </span><span class="small">| i n<br></span><span class="tab"></span><span class="small">[</span><span class="small italic">"⇑true if (1 max: 1/4 of table) is nil"</span><span class="small"><br></span><span class="tab"></span><span class="small">n &larr; objects length.<br></span><span class="tab"></span><span class="small">for⦂ i to: objects length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[objects◦i≡nil⇒[(n&larr;n-4)≤0⇒[⇑true]]]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">swap: i with: j<br></span><span class="tab"></span><span class="small">[objects swap: i with: j]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪HashSet under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Dictionary"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Dictionary&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: HashSet<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;values&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Dictionaries are sets with associated values.  They are very handy but not terribly efficient.  Most of their work is done by HashSet.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copyfrom: dict<br></span><span class="tab"></span><span class="small">[self objects &larr; dict objects copy.<br></span><span class="tab"></span><span class="small">values &larr; dict values copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init: size<br></span><span class="tab"></span><span class="small">[values &larr; Vector new: size. super init: size]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ name<br></span><span class="tab"></span><span class="small">[⇑values◦(self findorerror: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ name &larr; val<br></span><span class="tab"></span><span class="small">[⇑values◦(self findorerror: name) &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lookup: name </span><span class="small">| x<br></span><span class="tab"></span><span class="small">[x &larr; self find: name⇒ [⇑values◦x] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Inserting and Deleting</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">clean </span><span class="small">| name</span><span class="tab"></span><span class="small italic">"release unreferenced entries"</span><span class="small"><br></span><span class="tab"></span><span class="small">[for⦂ name from: self do⦂</span><span class="tab"></span><span class="tab"></span><span class="small italic">"slick, huh"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">[(self◦name) refct = 1 ⇒ [self delete: name]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">delete: name<br></span><span class="tab"></span><span class="small">[name is: Vector⇒[super delete: name]<br></span><span class="tab"></span><span class="small">values◦(self findorerror: name)&larr; nil.<br></span><span class="tab"></span><span class="small">super delete: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: name with: value<br></span><span class="tab"></span><span class="small">[self insert: name.<br></span><span class="tab"></span><span class="small">values◦(self findorerror: name) &larr; value]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insertall: names</span><span class="tab"></span><span class="tab"></span><span class="small italic">"default value is nil"</span><span class="small"><br></span><span class="tab"></span><span class="small">[self insertall: names with: (Vector new: names length)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insertall: names with: vals </span><span class="small">| i</span><span class="tab"></span><span class="tab"></span><span class="small italic">"insert many entries"</span><span class="small"><br></span><span class="tab"></span><span class="small">[for⦂ i to: names length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self insert: names◦i with: vals◦i]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tally: name </span><span class="small">| x<br></span><span class="tab"></span><span class="small">[x &larr; self find: name⇒ [⇑values◦x&larr; values◦x+1]<br></span><span class="tab"></span><span class="small">self insert: name with: 1. ⇑1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">with: names values: vals </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[for⦂ i to: names length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self insert: names◦i with: vals◦i]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growto: size </span><span class="small">| name copy<br></span><span class="tab"></span><span class="small">[copy &larr; self class new init: size.</span><span class="tab"></span><span class="small italic">"create a copy of the new size"</span><span class="small"><br></span><span class="tab"></span><span class="small">for⦂ name from: self do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[copy insert: name with: self◦name]</span><span class="tab"></span><span class="small italic">"hash each entry into it"</span><span class="small"><br></span><span class="tab"></span><span class="small">self copyfrom: copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">rehash </span><span class="small">| i copy<br></span><span class="tab"></span><span class="small">[copy &larr; Dictionary new init: self size.</span><span class="tab"></span><span class="small italic">"create a copy"</span><span class="small"><br></span><span class="tab"></span><span class="small">for⦂ i to: objects length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[objects◦i≡nil⇒[]<br></span><span class="tab"></span><span class="tab"></span><span class="small"> copy insert: objects◦i with: values◦i]</span><span class="tab"></span><span class="small italic">"hash each entry into it"</span><span class="small"><br></span><span class="tab"></span><span class="small">self copyfrom: copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">swap: i with: j<br></span><span class="tab"></span><span class="small">[values swap: i with: j.<br></span><span class="tab"></span><span class="small">super swap: i with: j]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">values </span><span class="small">[⇑values]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Inversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asInvertedVector </span><span class="small">| s i v  </span><span class="small italic">"in form ((value, object), ...)"</span><span class="small"><br></span><span class="tab"></span><span class="small">[s &larr; (Vector new: objects length) asStream.<br></span><span class="tab"></span><span class="small">for⦂ i to: objects length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[objects◦i≡nil⇒ []<br></span><span class="tab"></span><span class="tab"></span><span class="small">v &larr; Vector new: 2. v◦1&larr;values◦i. v◦2&larr;objects◦i.<br></span><span class="tab"></span><span class="tab"></span><span class="small">s next &larr; v].<br></span><span class="tab"></span><span class="small">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">invert<br></span><span class="tab"></span><span class="small">[⇑self invertto: (Dictionary new init: objects length)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">invert: obj </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[for⦂ i to: values length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[values◦i=obj⇒ [⇑objects◦i]]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">invertto: dict </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[for⦂ i to: objects length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[objects◦i≡nil⇒ []<br></span><span class="tab"></span><span class="tab"></span><span class="small">dict insert: values◦i with: objects◦i].<br></span><span class="tab"></span><span class="small">⇑dict]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Dictionary under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"MessageDict"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;MessageDict&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: HashSet<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;methods "&lt;Vector of Strings&gt; which are the compiled methods for each message"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">literals "&lt;Vector of Vectors&gt; which hold pointers to literals used in the methods"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">code "&lt;Vector of Strings&gt; which are the source text for each message"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">backpointers "&lt;Vector of Vectors&gt; which are the tables of text location vs pc for each message"&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>MessageDicts hold the source code and compiled methods for each message to a class.  The source code is a packed paragraph (see Paragraph packIntoString).  The methods contain pointers to literals, and must be specially freed.  If a method is being executed during its redefinition, its release must be delayed (its literals gets held in CodeKeeper).  Finally, MessageDicts must be copied to be grown, so that current use is not disturbed.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copyfrom: dict<br></span><span class="tab"></span><span class="small">[self objects &larr; dict objects copy.<br></span><span class="tab"></span><span class="small">methods &larr; dict methods copy.<br></span><span class="tab"></span><span class="small">code &larr; dict code copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init: size<br></span><span class="tab"></span><span class="small">[methods &larr; Vector new: size.<br></span><span class="tab"></span><span class="small">code &larr; Vector new: size.<br></span><span class="tab"></span><span class="small">super init: size]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Inserting and Deleting</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">close </span><span class="small">| i</span><span class="tab"></span><span class="tab"></span><span class="small italic">"recycle all code and literals pointed to"</span><span class="small"><br></span><span class="tab"></span><span class="small">[for⦂ i to: methods length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[methods◦i≡nil⇒[]<br></span><span class="tab"></span><span class="tab"></span><span class="small">self freeMethod: methods◦i]<br></span><span class="tab"></span><span class="small">self init]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">delete: name </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[i &larr; self findorerror: name.<br></span><span class="tab"></span><span class="small">self freeMethod: methods◦i.<br></span><span class="tab"></span><span class="small">methods◦i&larr; code◦i&larr; nil.<br></span><span class="tab"></span><span class="small">super delete: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: name method: m literals: l<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">code: c backpointers: b </span><span class="small">| i copy<br></span><span class="tab"></span><span class="small">[i &larr; self find: name⇒</span><span class="tab"></span><span class="tab"></span><span class="small italic">"if name is already there"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">[self freeMethod: methods◦i.<br></span><span class="tab"></span><span class="tab"></span><span class="small">self holdLiterals: l.<br></span><span class="tab"></span><span class="tab"></span><span class="small">methods◦i &larr; m. code◦i &larr; c]</span><span class="tab"></span><span class="tab"></span><span class="small italic">"then insert it, and return self"</span><span class="small"><br></span><span class="tab"></span><span class="small">copy &larr; [self sparse⇒[self] <br></span><span class="tab"></span><span class="tab"></span><span class="small">self growto: methods length*2].</span><span class="tab"></span><span class="tab"></span><span class="small italic">"Otherwise, copy if necessary"</span><span class="small"><br></span><span class="tab"></span><span class="small">copy objects◦(copy findornil: name) &larr; name.</span><span class="tab"></span><span class="small italic">"and insert"</span><span class="small"><br></span><span class="tab"></span><span class="small">⇑copy insert: name method: m literals: l<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">code: c backpointers: b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">purge: sel </span><span class="small">[</span><span class="small italic">"demand purging invalidates checkpointing"</span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">code<br></span><span class="tab"></span><span class="small">[⇑code]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">code: name<br></span><span class="tab"></span><span class="small">[⇑code◦(self findorerror: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">code: name &larr; str<br></span><span class="tab"></span><span class="small">[⇑code◦(self findorerror: name) &larr; str]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">invert: method </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[for⦂ i to: methods length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[methods◦i≡method⇒ [⇑objects◦i]].<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">literals: name<br></span><span class="tab"></span><span class="small">[⇑self literalsIn: methods◦(self findorerror: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">method: name<br></span><span class="tab"></span><span class="small">[⇑methods◦(self findorerror: name)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">methodorfalse: name </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[i &larr; self find: name⇒[⇑methods◦i] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">methods<br></span><span class="tab"></span><span class="small">[⇑methods]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Code aspect of Strings</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">freeLiterals: v </span><span class="small">| m i t</span><span class="tab"></span><span class="tab"></span><span class="small italic">"lower refct of all literals"</span><span class="small"><br></span><span class="tab"></span><span class="small">[v length=0⇒[]<br></span><span class="tab"></span><span class="small">m &larr; v nail.<br></span><span class="tab"></span><span class="small">for⦂ i to: v length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[t &larr; mem◦(m+i-1). v◦i &larr; nil. mem◦(m+i-1) &larr; t]<br></span><span class="tab"></span><span class="small">v unNail]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">freeMethod: m </span><span class="small">| v c i t</span><span class="tab"></span><span class="tab"></span><span class="small italic">"method pointed to by some vector (dict or keeper)<br></span><span class="tab"></span><span class="tab"></span><span class="small italic">and (upon entry) by m.  If any other owners, refct will be &gt;2.<br></span><span class="tab"></span><span class="tab"></span><span class="small italic">*Expects Interpreter to nil args on callers stack*"</span><span class="small"><br></span><span class="tab"></span><span class="small">[m refct&gt;2⇒[MethodKeeper next&larr; m]</span><span class="tab"></span><span class="tab"></span><span class="small italic">"keep it"</span><span class="small"><br></span><span class="tab"></span><span class="small">v&larr; self literalsIn: m.</span><span class="tab"></span><span class="tab"></span><span class="small italic">"free its literals"</span><span class="small"><br></span><span class="tab"></span><span class="small">v length=0⇒[]<br></span><span class="tab"></span><span class="small">c &larr; v nail.</span><span class="tab"></span><span class="tab"></span><span class="small italic">"fasten seat belts"</span><span class="small"><br></span><span class="tab"></span><span class="small">for⦂ i to: v length do⦂</span><span class="tab"></span><span class="tab"></span><span class="small italic">"lower refct of each literal"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">[t &larr; mem◦(c+i-1). v◦i &larr; nil. mem◦(c+i-1) &larr; t]<br></span><span class="tab"></span><span class="small">v unNail]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">freeMethods </span><span class="small">| v i</span><span class="tab"></span><span class="tab"></span><span class="small italic">"Free kept methods no longer used"</span><span class="small"><br></span><span class="tab"></span><span class="small">[v&larr; MethodKeeper contents.<br></span><span class="tab"></span><span class="small">MethodKeeper&larr; (Vector new: 10) asStream.<br></span><span class="tab"></span><span class="small">for⦂ i to: v length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self freeMethod: v◦i]<br></span><span class="tab"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">holdLiterals: v </span><span class="small">| m i t</span><span class="tab"></span><span class="tab"></span><span class="small italic">"raise refct of all literals"</span><span class="small"><br></span><span class="tab"></span><span class="small">[v≡nil⇒[] v length=0⇒[]<br></span><span class="tab"></span><span class="small">m &larr; v nail.<br></span><span class="tab"></span><span class="small">for⦂ i to: v length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[t &larr; v◦i. mem◦(m+i-1) &larr; ¬1. v◦i &larr; t]<br></span><span class="tab"></span><span class="small">v unNail]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">holdMethods: v </span><span class="small">| i </span><span class="small italic">"a random insertion just to make it legal form"</span><span class="small"><br></span><span class="tab"></span><span class="small">[for⦂ i to: v length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self insert: i method: v◦i literals: nil code: nil backpointers: nil]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">literalsIn: method </span><span class="small">| i v</span><span class="tab"></span><span class="tab"></span><span class="small italic">"return the literal vector imbedded in this method"</span><span class="small"><br></span><span class="tab"></span><span class="small">[method≡nil⇒[⇑Vector new: 0]<br></span><span class="tab"></span><span class="small">method length&lt;8⇒[⇑Vector new: 0]<br></span><span class="tab"></span><span class="small">method◦2=41⇒[⇑Vector new: 0]<br></span><span class="tab"></span><span class="small">v &larr; Vector new: method◦6-6/2.<br></span><span class="tab"></span><span class="small">for⦂ i to: v length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[v◦i &larr; (method word: 3+i) asObject]<br></span><span class="tab"></span><span class="small">⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growto: size </span><span class="small">| name copy i<br></span><span class="tab"></span><span class="small">[copy &larr; MessageDict new init: size.</span><span class="tab"></span><span class="small italic">"create a copy of the new size"</span><span class="small"><br></span><span class="tab"></span><span class="small">for⦂ name from: self do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[i &larr; self findorerror: name.</span><span class="tab"></span><span class="tab"></span><span class="small italic">"hash each entry into it"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">copy &larr; copy insert: name method: methods◦i<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">literals: [literals≡nil⇒[nil] literals◦i]  code: code◦i backpointers: nil]<br></span><span class="tab"></span><span class="small">⇑copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">swap: i with: j<br></span><span class="tab"></span><span class="small">[methods swap: i with: j.<br></span><span class="tab"></span><span class="small">code swap: i with: j.<br></span><span class="tab"></span><span class="small">super swap: i with: j]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪MessageDict under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"SymbolTable"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;SymbolTable&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: Dictionary<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>I associate each of my objects with an object reference</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">ref: name<br></span><span class="tab"></span><span class="small">[⇑super◦name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">ref: name &larr; val<br></span><span class="tab"></span><span class="small">[⇑super◦name &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ name<br></span><span class="tab"></span><span class="small">[⇑(super◦name) value]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">allCallsOn: selector from: classNames </span><span class="small">| className s w cl sel<br></span><span class="tab"></span><span class="small">[[selector is: Vector⇒ [] selector &larr; selector inVector].<br></span><span class="tab"></span><span class="small">s &larr; Stream default.<br></span><span class="tab"></span><span class="small">user displayoffwhile⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[for⦂ className from: classNames do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[cl &larr; self◦className.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">for⦂ sel from: selector do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[w &larr; cl whosends: sel. w length=0⇒ []<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">s append: className; append: &rsquo;⇒&rsquo;; append: w asString; cr]]].<br></span><span class="tab"></span><span class="small">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">allRefs  </span><span class="small italic">"what methods reference my variables (I am probably &rsquo;Undeclared&rsquo;)"</span><span class="small"><br></span><span class="tab"></span><span class="small">[⇑self allRefsTo: self contents from: user classNames]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">allRefsTo: symbol from: classNames </span><span class="small">| s<br></span><span class="tab"></span><span class="small">[[symbol is: Vector⇒ [] symbol &larr; symbol inVector].<br></span><span class="tab"></span><span class="small">⇑Smalltalk allCallsOn: (symbol transform⦂ s to⦂ (self ref: s)) from: classNames]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">invert: obj </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[for⦂ i to: values length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[nil≡(values◦i)⇒[]<br></span><span class="tab"></span><span class="tab"></span><span class="small">obj ≡ (values◦i) value ⇒[⇑objects◦i]]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">invertRef: obj </span><span class="small">| i<br></span><span class="tab"></span><span class="small">[for⦂ i to: values length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[obj≡(values◦i)⇒[⇑objects◦i]]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lookup: name </span><span class="small">| r<br></span><span class="tab"></span><span class="small">[r&larr;super lookup: name⇒[⇑r value] ⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lookupRef: name<br></span><span class="tab"></span><span class="small">[⇑super lookup: name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Insertion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ name &larr; x<br></span><span class="tab"></span><span class="small">[⇑(super◦name) value &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">declare: name</span><span class="tab"></span><span class="small italic">"Take ref(s) and value(s) from Undeclared, if name(s) there"</span><span class="small"><br></span><span class="tab"></span><span class="small">[self declare: name from: Undeclared]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">declare: name as: x </span><span class="small">| a s<br></span><span class="tab"></span><span class="small">[name is: Vector⇒<br></span><span class="tab"></span><span class="tab"></span><span class="small">[s &larr; x asStream. for⦂ a from: name do⦂ [self declare: a as: s next]]<br></span><span class="tab"></span><span class="small">self declare: name.<br></span><span class="tab"></span><span class="small">self◦name &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">declare: name from: symTab </span><span class="small">| a </span><span class="small italic">"take name(s), ref(s) and value(s) from symTab"</span><span class="small"><br></span><span class="tab"></span><span class="small">[name is: Vector⇒ [for⦂ a from: name do⦂ [self declare: a from: symTab]]<br></span><span class="tab"></span><span class="small">self has: name⇒ []<br></span><span class="tab"></span><span class="small">symTab has: name⇒<br></span><span class="tab"></span><span class="tab"></span><span class="small">[super insert: name with: (symTab ref: name).<br></span><span class="tab"></span><span class="tab"></span><span class="small">symTab delete: name]<br></span><span class="tab"></span><span class="small">self insert: name with: nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">define: name as: x</span><span class="tab"></span><span class="tab"></span><span class="small italic">"synonym"</span><span class="small"><br></span><span class="tab"></span><span class="small">[⇑self declare: name as: x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: name with: x<br></span><span class="tab"></span><span class="small">[</span><span class="tab"></span><span class="small">[self has: name⇒[]<br></span><span class="tab"></span><span class="tab"></span><span class="small">super insert: name with: ObjectReference new].<br></span><span class="tab"></span><span class="small">self◦name &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: name withref: ref<br></span><span class="tab"></span><span class="small">[super insert: name with: ref]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Growing and shrinking</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growto: size </span><span class="small">| name copy<br></span><span class="tab"></span><span class="small">[copy &larr; self class new init: size.</span><span class="tab"></span><span class="small italic">"create a copy of the new size"</span><span class="small"><br></span><span class="tab"></span><span class="small">for⦂ name from: self do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[copy insert: name withref: (self ref: name)]</span><span class="tab"></span><span class="small italic">"hash each entry into it"</span><span class="small"><br></span><span class="tab"></span><span class="small">self copyfrom: copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">rehash </span><span class="small">| i copy<br></span><span class="tab"></span><span class="small">[copy &larr; SymbolTable new init: self size.</span><span class="tab"></span><span class="small italic">"create a copy"</span><span class="small"><br></span><span class="tab"></span><span class="small">for⦂ i to: objects length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[objects◦i≡nil⇒[]<br></span><span class="tab"></span><span class="tab"></span><span class="small"> copy insert: objects◦i withref: values◦i]</span><span class="tab"></span><span class="small italic">"hash each entry into it"</span><span class="small"><br></span><span class="tab"></span><span class="small">self copyfrom: copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪SymbolTable under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"SystemOrganizer"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;SystemOrganizer&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: ClassOrganizer<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Provides an organization for the classes in the system just as ClassOrganizer organizes the messages within a class.  (In fact, the only difference is the filout/printing messages.)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Filout and printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">filoutAll </span><span class="small">| cat<br></span><span class="tab"></span><span class="small">[for⦂ cat from: commentVector do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self filoutCategory: cat]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">filoutCategory: cat </span><span class="small">| all a [user displayoffwhile⦂ [<br></span><span class="tab"></span><span class="small">all &larr; self superclassOrder: cat.<br></span><span class="tab"></span><span class="small">(dp1 file: (cat+&rsquo;.st.&rsquo;) asFileName) filoutclass: all.<br></span><span class="tab"></span><span class="small">for⦂ a from: all do⦂ [(Smalltalk◦a) noChanges]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printAll </span><span class="small">| cat<br></span><span class="tab"></span><span class="small">[for⦂ cat from: commentVector do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self printCategory: cat]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printCategory: cat </span><span class="small">[user displayoffwhile⦂ [<br></span><span class="tab"></span><span class="small">(dp0 file: (cat+&rsquo;.press&rsquo;) asFileName) printoutclass: (self superclassOrder: cat)]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">superclassOrder: cat </span><span class="small">| all lis a i c sup  "Arrange classes in superclass order so they can be filed in"<br></span><span class="tab"></span><span class="small">[lis&larr; (self category: cat) copy. all &larr; (Vector new: lis length) asStream.<br></span><span class="tab"></span><span class="small">while⦂ lis length&gt;0 do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[i&larr; 1.<br></span><span class="tab"></span><span class="tab"></span><span class="small">until⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[a&larr; lis◦i. sup&larr; c&larr; Smalltalk◦a.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">until⦂ "Make sure it doesn&rsquo;t have an as yet unprinted superclass"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[sup&larr; sup superclass.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">sup≡nil⇒[true]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">lis has: sup title unique]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">do⦂ [].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">sup≡nil]<br></span><span class="tab"></span><span class="tab"></span><span class="small">do⦂ [i&larr; i+1].<br></span><span class="tab"></span><span class="tab"></span><span class="small">all next &larr; a.<br></span><span class="tab"></span><span class="tab"></span><span class="small">lis&larr; lis delete: a].<br></span><span class="tab"></span><span class="small">⇑all contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪SystemOrganizer under: &rsquo;Sets and Dictionaries&rsquo;.</span></div>
  </body>
</html>
