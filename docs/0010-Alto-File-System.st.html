<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Alto-File-System.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div class="line left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"AltoFile"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;AltoFile&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: File<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;leader pageAddresses&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">sharing: AltoFilePool;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>A File found on an Alto Model 31(44) disk</span></div>
<div class="line left">
<span class="medium bold"><br>Dictionary</span></div>
<div class="line left">
<span class="small bold">close </span><span class="small">["to look at at reopen" type &larr; self updateLeader: (self read: 0)]</span></div>
<div class="line left">
<span class="small bold">entryClass </span><span class="small">[⇑AltoFilePage]</span></div>
<div class="line left">
<span class="small bold">open </span><span class="small">["</span><span class="small italic">don&rsquo;t find last page immediately.  for later close</span><span class="small">" type &larr; read]</span></div>
<div class="line left">
<span class="medium bold"><br>DictionaryEntry</span></div>
<div class="line left">
<span class="small bold">fileSize </span><span class="small">["sn, version, fn, leader, name" ⇑11 + (name length lor: 1)]</span></div>
<div class="line left">
<span class="small bold">init </span><span class="small">[super init.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pageAddresses &larr; AltoFileAddressTable new]</span></div>
<div class="line left">
<span class="small bold">readFrom: s </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"read file description from SysDir"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">serialNumber &larr; s next: 4.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s skip: 4 "self version: s nextword. s skip: 2".<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">leader &larr; directory virtualToReal: s nextword.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">name &larr; s nextString.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s padNext]</span></div>
<div class="line left">
<span class="small bold">storeOn: s </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s append: serialNumber;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextword &larr; 1; nextword &larr; 0;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextword &larr; (directory realToVirtual: leader);<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextString &larr; name; padNext &larr; 0]</span></div>
<div class="line left">
<span class="medium bold"><br>File</span></div>
<div class="line left">
<span class="small bold">classInit </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">before filing in:</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Smalltalk declare: ↪AltoFilePool as: (SymbolTable new init: 32)"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">AltoFilePool<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">declare: ↪(CRR CCR CCW CWW "</span><span class="small italic">disk commands</span><span class="small">")<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">as: ↪(044100 044120 044130 044150);<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">declare: ↪(<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dfmask "</span><span class="small italic">bit means active directory entry</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">boffset "</span><span class="small italic">byte offset of bit table in DiskDescriptor</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirname) as: ↪(02000 040 &rsquo;SysDir.&rsquo; );<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">declare: ↪(nextp backp numch pagen vn) as: ↪(1 2 4 5 6)]</span></div>
<div class="line left">
<span class="small bold">doCommand: com page: page error: e </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">error &larr; nullString.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self dskprim: directory diskNumber address: page address command: com<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page: page page⇒ [⇑page]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">error &larr; self errorString: error "</span><span class="small italic">set by </span><span class="small bold">dskprim:...</span><span class="small">".<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑self error: e]</span></div>
<div class="line left">
<span class="small bold">endFile: page </span><span class="small">| nextPage pn [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[page≡false⇒ ["</span><span class="small italic">free all of file</span><span class="small">" pn &larr; ¬1]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[page full⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextPage &larr; self Write: page.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">if page was a full last page, next is an empty (and now last) page</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextPage lastPage⇒ [⇑nextPage]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page &larr; self read: page pageNumber+1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page empty⇒ [⇑page]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page length: 0]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">write last page</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page header: nextp &larr; 0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self Write: page.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">free rest of file</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pn &larr; page pageNumber].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">lastpn &larr; false "</span><span class="small italic">reset by readPage:</span><span class="small">".<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (lastpn≡false and⦂ (nextPage &larr; self read: (pn &larr; pn+1))) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextPage init; freePage;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">doCommand: CWW error: &rsquo;endFile:&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">directory deallocate: nextPage].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[page⇒ [pageAddresses position &larr; (lastpn &larr; page pageNumber)]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑page]</span></div>
<div class="line left">
<span class="small bold">findLastPage </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self read: 20000.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑lastpn]</span></div>
<div class="line left">
<span class="small bold">Get: page </span><span class="small">| p pn [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pn &larr; page pageNumber.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self Read: page⇒ [⇑page]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">page now contains last page</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ p from: lastpn to: pn-1 do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page pageNumber: p; length: page dataLength.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">this writes current and allocates next (empty) page</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page &larr; self Write: page].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑page]</span></div>
<div class="line left">
<span class="small bold">Read: page </span><span class="small">| pn p palen [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pn &larr; page pageNumber.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[pageAddresses⇒ [palen &larr; pageAddresses length]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pn = 0⇒ [palen &larr; 0]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑false].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ p from: (palen min: pn) to: pn do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">set up page for checking</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">zeroed by machine code</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">header: nextp &larr; [p &lt; palen⇒ [pageAddresses◦(p+1)] 0];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">header: backp &larr; [p=0⇒ [0]; =1⇒[leader] pageAddresses◦(p-1)];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">length: [p &lt; palen⇒ [page dataLength] 0];"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pageNumber: p;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">address: [p=0⇒ [leader] pageAddresses◦p];<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">doCommand: CCR error: &rsquo;readPage:&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page lastPage⇒ [(lastpn &larr; p) &lt; pn⇒ [⇑false]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">p ≥ palen and⦂ pageAddresses⇒[pageAddresses◦(p+1) &larr; page header: nextp]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">no need to store if already known or no page table</span><span class="small">"].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑page]</span></div>
<div class="line left">
<span class="small bold">sameFile </span><span class="small">| page s [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(page &larr; self newPage: 0) address: leader.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">if any of following  tests fail, File will be reinitialized</span><span class="small">"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑("</span><span class="small italic">serial number match</span><span class="small">" (page doCommand: CCR error: false) and⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">correct page number</span><span class="small">" page pageNumber = 0) and⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[s &larr; page asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">last write was by us</span><span class="small">" type = (s next: 4) and⦂<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[s skip: 8.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">same name</span><span class="small">" (name compare: s nextString) = 2]]]</span></div>
<div class="line left">
<span class="small bold">Write: page </span><span class="small">| nextPage labelDirty returnPage [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(labelDirty &larr; page lastPage) and⦂ page full⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">last page can&rsquo;t be full, so glue on another page</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">returnPage &larr; nextPage &larr; self newPage.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">directory allocate: nextPage after: (directory realToVirtual: page address).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextPage init;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">header: backp &larr; page address;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pageNumber: (lastpn &larr; page pageNumber+1);<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">serialNumber: serialNumber;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">doCommand: CWW error: &rsquo;writePage: (allocate)&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">link to current page</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page header: nextp &larr; nextPage address.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pageAddresses⇒ [pageAddresses◦lastpn &larr; nextPage address]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small bold">growSmalltalkBy:</span><span class="small">"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">returnPage &larr; page].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">whenever a last (or second last) page is written, write label also</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self doCommand: [labelDirty⇒ [CWW] CCW] page: page error: &rsquo;writePage:&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">type &larr; read+write.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑returnPage]</span></div>
<div class="line left">
<span class="medium bold"><br>Alto</span></div>
<div class="line left">
<span class="small bold">dskprim: diskNumber </span><span class="small">"</span><span class="small italic">0/1</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small bold">address: a</span><span class="small"> "</span><span class="small italic">starting Alto disk address</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small bold">command: com</span><span class="small"> "</span><span class="small italic">disk command (usually CCR, CCW, CWW)</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small bold">page: string</span><span class="small"> "</span><span class="small italic">string containing label and data</span><span class="small">"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">["</span><span class="small italic">if disk routine encounters an error,</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">error &larr; (DCB status, to be interpreted by </span><span class="small bold">errorString:</span><span class="small">).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑false"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">if other error occurs, e.g. nil instead of Integer...</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">error &larr; ¬1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑false] primitive: 80</span></div>
<div class="line left">
<span class="small bold">errorString: status </span><span class="small">| t s [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">see Alto hardware manual for details on error word format</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">status=¬1⇒ [⇑&rsquo;primitive failure, bad args?&rsquo;]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; Stream default.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s append: ↪(&rsquo;&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;hardware error or sector overflow&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;check error&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;disk command specified illegal sector&rsquo;)◦(1 + (status land: 3)).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ t to: 6 do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">status allmask: (0200 lshift: 1-t)⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s space; append: ↪(<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;seek failed, possible illegal track&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;seek in progress&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;disk unit not ready&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;hardware late&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;hardware not transferring&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">&rsquo;checksum&rsquo;)◦t]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s space; append: status base8.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑s contents]</span></div>
<div class="line left">
<span class="small bold">leader </span><span class="small">[⇑leader]</span></div>
<div class="line left">
<span class="small bold">leader: leader</span></div>
<div class="line left">
<span class="small bold">pageAddresses: pageAddresses</span></div>
<div class="line left">
<span class="small bold">updateLeader: page </span><span class="small">| s time lastwrite [ <br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">see &lt;Alto&gt;AltoFileSys.D, (p.3 leader page) for further info</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">time &larr; user timewords.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; page asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[type anymask: write ⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">set creation/write read date and name</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">directory flush.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">lastwrite &larr; time.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s append: time; append: time; append: time.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">name empty⇒ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s nextString&larr; name]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">lastwrite &larr; s next: 4.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s skip: 4; append: time].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self Write: page.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑lastwrite]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪AltoFile under: &rsquo;Alto File System&rsquo;.</span></div>
<div class="line left">
<span class="small">AltoFile classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"AltoFileAddressTable"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;AltoFileAddressTable&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: RunVector<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>This class converts to virtual disk addrs which tend to come in consecutive<br>runs, and can thus use the compact representation of its superclass.</span></div>
<div class="line left">
<span class="medium bold"><br>Reading and writing</span></div>
<div class="line left">
<span class="small bold">◦i </span><span class="small">| base [base&larr; super◦i. ⇑dp0 virtualToReal: base+offset]</span></div>
<div class="line left">
<span class="small bold">◦i&larr; val </span><span class="small">| virt [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">virt&larr; dp0 realToVirtual: val.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">starts ≡ nil⇒[super◦i&larr; virt. ⇑val]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">super◦i&larr; virt-i+(starts last).</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"superclass tries for constant runs"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">offset&gt;0⇒[⇑val]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"OK if same run"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">values last&larr; virt. ⇑val]</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"else fix new run value base"</span></div>
<div class="line left">
<span class="small bold">position&larr; p </span><span class="small">| l</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"shortens (for file shorten)"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[p&gt;max⇒[user notify: &rsquo;invalid extension&rsquo;] max&larr; p.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(l&larr; starts findSorted: max)&lt;starts length⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[starts&larr; starts copy: 1 to: l.  values&larr; values copy: 1 to: l]]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪AltoFileAddressTable under: &rsquo;Alto File System&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"AltoFileDirectory"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;AltoFileDirectory&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: FileDirectory<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;dirFile bitsFile closed diskPages totalPages nSectors&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">sharing: AltoFilePool;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br></span></div>
<div class="line left">
<span class="medium bold"><br>Dictionary</span></div>
<div class="line left">
<span class="small bold">close </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self obsolete⇒ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile close.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[bitsFile ≡ nil⇒ ["an interrupted open?"] bitsFile close].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">super close]</span></div>
<div class="line left">
<span class="small bold">Delete: file </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(self deleteEntry: file) open; endFile: false.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile flush]</span></div>
<div class="line left">
<span class="small bold">entryClass </span><span class="small">[⇑AltoFile]</span></div>
<div class="line left">
<span class="small bold">entrySize: file </span><span class="small">["entry size in words" ⇑1 + (file fileSize / 2)]</span></div>
<div class="line left">
<span class="small bold">Insert: file </span><span class="small">| sn page [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file serialNumber: (sn &larr; self allocateSN: file).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">allocate a new page (more success after O.S. stuff, bittable etc.)</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self allocate: (page &larr; file newPage) after: 800.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">write 0th -- leader, in the process filling it in and then creating first page</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page init; serialNumber: sn; length: page dataLength.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file leader: page address; type: write; updateLeader: page.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self addEntry: file]</span></div>
<div class="line left">
<span class="small bold">nextEntry: file </span><span class="small">| s elen [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile≡nil⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(file name compare: dirname) = 2⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">return system directory file. known serialNumber and leader</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file serialNumber: 0100000, 0144; leader: 010000.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑file]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self error: &rsquo;directory not open&rsquo;]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">return the next file entry, ignore deleted entries,<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">and leave dirFile positioned before next entry</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (s &larr; dirFile nextword) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">elen &larr; s land: dfmask-1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s allmask: dfmask⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file readFrom: dirFile.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile skip: elen*2 - (file fileSize + 2).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑file]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">deleted entry, again</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile skipwords: elen-1].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑false]</span></div>
<div class="line left">
<span class="small bold">obsolete </span><span class="small">[⇑dirFile≡nil]</span></div>
<div class="line left">
<span class="small bold">open </span><span class="small">| f s a page len elen type [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nil ≠ dirFile⇒ []<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">assume some defaults in case DSHAPE is not in SysDir leader page.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">these should only be needed if the disk is old (and not scavenged).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">they will not work if a 14 sector system is missing DSHAPE (unlikely) since addresses of first page of directory and of DiskDescriptor might be computed incorrectly.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">in a Smalltalk-76 system, nSectors, diskPages had better eventually match:<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">| a. a &larr; Vmem specialLocs◦13. mem◦(a+5), (mem◦(a+6))<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nSectors &larr; 12.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">diskPages &larr; 812*nSectors.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">totalPages &larr; 2*diskPages.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">read SysDir leader page to find out file system configuration.  see AltoFileSys.D</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">f &larr; self find: dirname.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">to prevent address of page 1 from being stored</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">f pageAddresses: false.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">length of property list, in words</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page &larr; f read: 0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len &larr; page◦494.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[len ≠ 210⇒ []<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">scan file properties for DSHAPE</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; page asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s skipwords: page◦493.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ len &gt; 0 do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">type &larr; s next.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">type = 0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">0 terminates list.  property not found. try to read if from DiskDescriptor"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len &larr; 0]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">elen &larr; s next.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">type = 1 and⦂ elen = 5⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">DSHAPE. read property</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self configure: s.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">set flags so configure and loop are not done again</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s &larr; false. len &larr; 0]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">skip over other property</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">len &larr; len - elen.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s skipwords: elen-1]].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">now, with the correct (or default) file system configuration,<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">store the virtual address of next page (1), and create a FileStream on SysDir</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">a &larr; AltoFileAddressTable new.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">a◦1 &larr; page header: nextp.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">f pageAddresses: a.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(dirFile &larr; f asStream) readonly.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(bitsFile &larr; self oldFile: &rsquo;DiskDescriptor&rsquo;) readwrite.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[s⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">configuration not read from SysDir. this will work for 12 sector systems.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">14 sector systems should have had the DSHAPE property</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self configure: bitsFile]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">super open.<br>]</span></div>
<div class="line left">
<span class="small bold">Position &larr; entry </span><span class="small">| name elen s holepos holesize entrysize nlen sk [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">entry format<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">1</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">n (length in words, including this one) + undeleted bit (dfmask)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">2-3</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">serialNumber<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">4</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">version<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">5</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">0?<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">6</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">virtual address of page 0<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">7-n name as Bcpl string (extra 0 if length even)</span><span class="small">"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">name &larr; entry name.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile≡nil and⦂ (name compare: dirname) = 2⇒ [⇑true]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self reset.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">holepos &larr; false.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">holesize &larr; dfmask.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nlen &larr; name length.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">entrysize &larr; self entrySize: entry "</span><span class="small italic">desired entry size</span><span class="small">".<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (s &larr; dirFile nextword) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">entry length in words</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">elen &larr; s land: dfmask-1.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[entrysize &gt; elen⇒ ["</span><span class="small italic">entry too small</span><span class="small">" sk &larr; ¬2]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">s = elen⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">deleted entry. check hole size for later inserting or renaming</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sk &larr; ¬2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">elen &lt; holesize⇒[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">hole is the smallest so far</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">holesize &larr; elen. holepos &larr; dirFile position]]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">normal entry, big enough</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile skip: 10.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nlen ≠ dirFile next⇒ ["</span><span class="small italic">name wrong size</span><span class="small">" sk &larr; ¬13]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sk &larr; ¬13 - nlen.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(name compare: (dirFile next: nlen)) = 2⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">name match, position back to beginning of entry</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile skip: sk.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑entry]].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">sk is the character offset from the entry header word to the next entry</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile skip: elen*2 + sk].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[holepos⇒ [dirFile position &larr; holepos-2] "</span><span class="small italic">at end of dirFile</span><span class="small">"].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑false]</span></div>
<div class="line left">
<span class="small bold">release </span><span class="small">[dirFile &larr; bitsFile &larr; nil]</span></div>
<div class="line left">
<span class="small bold">reset </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[self obsolete⇒ [self open] self flush].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile readonly; reset]</span></div>
<div class="line left">
<span class="medium bold"><br>FileDirectory</span></div>
<div class="line left">
<span class="small bold">allocateSN: file </span><span class="small">| sn [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile position &larr; 010.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sn &larr; bitsFile next: 4.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(sn word: 2 &larr; (sn word: 2) + 1) = 0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">overflow</span><span class="small">" sn word: 1 &larr; (sn word: 1) + 1]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile skip: ¬4; append: sn.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑sn]</span></div>
<div class="line left">
<span class="small bold">checkName: s </span><span class="small">[⇑self checkName: s fixing: false]</span></div>
<div class="line left">
<span class="small bold">realToVirtual: adr </span><span class="small">["see </span><span class="small bold">virtualToReal:</span><span class="small">.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">Alto address format is<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">bits<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">0-3</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">sector number (0 - 015, i.e. 12 or 14 sectors)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">4-12</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">cylinder number (0 - 0312, Model 31; 0-0625, Model 44)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">13</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">head number (0-1)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">14</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">disk number</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">(0-1)<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">15</span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">restore bit.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">in a system with two separable disks, addresses on disk 1 have a 0 disk bit, which is complemented by the disk primitive</span><span class="small">"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑"vadr &larr;" ("</span><span class="small italic">sector: field</span><span class="small">" adr lshift: ¬12) +<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">("</span><span class="small italic">cylinder and head: field*</span><span class="small">" nSectors * ((adr land: 07774) lshift: ¬2)) +<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">("</span><span class="small italic">disk: field*pages per disk</span><span class="small">" [(adr land: 2) = 2⇒ [diskPages] 0]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"diskPages*(adr land: 2)/2")<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"vadr &lt; 0 or⦂ vadr ≥ totalPages⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self error: &rsquo;illegal disk address&rsquo;]"]</span></div>
<div class="line left">
<span class="small bold">rename: file newName: newName </span><span class="small">| holesize pos [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[newName &larr; self checkName: newName⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self position &larr; newName⇒ [self error: &rsquo;new name already exists: &rsquo; + newName]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">a possible insertion place</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pos &larr; dirFile position]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self error: &rsquo;illegal new name: &rsquo; + newName].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self Find: (file &larr; self makeEntry: file)⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">holesize &larr; dirFile nextword land: dfmask-1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile skip: ¬2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file name: newName.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(self entrySize: file "</span><span class="small italic">new size of entry</span><span class="small">") ≤ holesize⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">new entry will fit in current entry</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pos &larr; dirFile position.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">read and save entry</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self nextEntry: file]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">delete and save entry</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self deleteEntry: file].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">position to same entry or hole discovered earlier</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile position &larr; pos.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self addEntry: (file name: newName).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file type is: Integer⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"file is open. defer leader page change until someone closes it"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file type: write]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"close file: updating name in leader page" file type: write; close]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file error: &rsquo;rename: old name does not exist&rsquo;]</span></div>
<div class="line left">
<span class="small bold">virtualToReal: vadr </span><span class="small">| t2 d ["</span><span class="small italic">inverse of </span><span class="small bold">realToVirtual:</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"vadr &lt; 0 or⦂ vadr ≥ totalPages⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self error: &rsquo;illegal virtual address&rsquo;]"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"faster to do /\ for normal Integers"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"t &larr; vadr intdiv: diskPages.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">sec &larr; t◦2 intdiv: nSectors"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[vadr &lt; diskPages⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">d &larr; 0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t2 &larr; vadr]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">d &larr; 2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">t2 &larr; vadr \ diskPages].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑("</span><span class="small italic">sector</span><span class="small">" (t2 \ nSectors) lshift: 12) +<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">("</span><span class="small italic">cylinder & head</span><span class="small">" (t2 / nSectors) lshift: 2) +<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">("</span><span class="small italic">disk</span><span class="small">" d "(vadr / diskPages) lshift: 1")]</span></div>
<div class="line left">
<span class="medium bold"><br>Alto</span></div>
<div class="line left">
<span class="small bold">addEntry: file </span><span class="small">| entrysize holesize [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">called only by </span><span class="small bold">Insert:</span><span class="small italic"> and </span><span class="small bold">rename:newName:</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[holesize &larr; dirFile nextword⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">either a deleted entry or rename entry</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">holesize &larr; holesize land: dfmask-1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile skip: ¬2]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">at end</span><span class="small">"].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">entrysize &larr; self entrySize: file.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile readwrite;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nextword &larr; entrysize + dfmask.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file storeOn: dirFile.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[holesize and⦂ entrysize &lt; holesize⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">mark remaining hole</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile nextword &larr; holesize-entrysize]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile readonly.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile flush]</span></div>
<div class="line left">
<span class="small bold">allocate: nextPage after: address </span><span class="small">| index stop ch m vadr [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">index &larr; false.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ true do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">go around bittable from address to end, and beginning to address.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">we start over again if the table appears full or bitsFile is out of sync</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[index and⦂ stop ≥ totalPages⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"wrap around to where we started"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">stop &larr; address.</span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">index &larr; 0]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[index ≡ false⇒ ["</span><span class="small italic">first time or bitsFile out of sync</span><span class="small">"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">disk probabbly full</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user quitThen:<br>&rsquo;//   YOUR DISK IS FULL - Please make some space available.<br>//   Then resume Smalltalk and interrupt or continue as desired...&rsquo;].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self open.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">index by bits rather than bytes? close enough for now</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">index &larr; address land: 0177770.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">stop &larr; totalPages].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile position &larr; index/8 + boffset.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">while⦂ (index and⦂ (index &larr; index+8) ≤ stop) do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(ch &larr; bitsFile next) = 0377⇒ ["</span><span class="small italic">8 full</span><span class="small">"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">check that bitsFile position is correct --<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">possibly out of sync with index if  growSmalltalkBy: occurred?</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile position ≠ (index/8 + boffset)⇒ [index &larr; false]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">m &larr; 0200.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ vadr from: index-8 to: index-1 do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[(ch land: "nomask:" m) = 0⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">page appears free. first update DiskDescriptor</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile skip: ¬1; next &larr; ch &larr; ch lor: m.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"then check if page is really free"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">vadr=0⇒ ["</span><span class="small italic">O.S. boot</span><span class="small">"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">([nextPage init; freePage;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">address: (self virtualToReal: vadr);<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">doCommand: CCR error: false])⇒ [⇑vadr]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">page not really free</span><span class="small">"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">page not free according to bit</span><span class="small">"].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">m &larr; m lshift: ¬1].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">]]</span></div>
<div class="line left">
<span class="small bold">checkName: fname fixing: fixing </span><span class="small">| x copy special [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">fname empty⇒[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">fixing⇒ [⇑&rsquo;$&rsquo;]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"empty name" ⇑false]<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[fname length &gt; 38⇒<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[fixing⇒ [fname &larr; fname◦(1 to: 38)]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"name too long" ⇑false]].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">copy &larr; (String new: fname length+1) asStream.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">special &larr; &rsquo;.-+$!?&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ x from: fname do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"check characters: alphanumeric or 6 special"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">x isletter or⦂ ((special has: x) or⦂ x isdigit) ⇒ [copy next &larr; x]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">fixing⇒ [copy next &larr; special◦2]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"illegal character" ⇑false].<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[fixing⇒ [fname last = (special◦1)⇒ [copy skip: ¬1]]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">fname last ≠ (special◦1)⇒ [copy next &larr;  special◦1]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑copy contents]</span></div>
<div class="line left">
<span class="small bold">configure: s </span><span class="small">| nDisks nHeads nTracks [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"read disk configuration from a Stream:<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">either leader page of SysDir or beginning of DiskDescriptor"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nDisks &larr; s nextword.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nTracks &larr; s nextword.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nHeads &larr; s nextword.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">nSectors &larr; s nextword.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">diskPages &larr; nTracks * nHeads * nSectors.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">totalPages &larr; nDisks * diskPages]</span></div>
<div class="line left">
<span class="small bold">deallocate: page </span><span class="small">| index ch m [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">[dirFile≡nil⇒ [self open]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">index &larr; self realToVirtual: page address.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">character position</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile position &larr; index/8 + boffset.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">ch &larr; bitsFile next.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">bit position</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">m &larr; 0200 lshift: 0-(index land: 7).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">"make page free by turning off bit in DiskDescriptor"</span><span class="small"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(ch land: m) = m⇒ [bitsFile skip: ¬1; next&larr; ch - m]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user cr; show: &rsquo;page already free (dealloc:)&rsquo;]</span></div>
<div class="line left">
<span class="small bold">deleteEntry: file </span><span class="small">| p [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">called only by </span><span class="small bold">Delete:</span><span class="small italic"> and </span><span class="small bold">rename:newName:</span><span class="small italic"><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small italic">read and save</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">p &larr; dirFile position.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self nextEntry: file.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile position &larr; p.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">delete it from directory (turn off bit in entry length word)</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">p &larr; dirFile nextword land: dfmask-1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">dirFile skip: ¬2; readwrite; nextword &larr; p; readonly; skip: ¬2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑file]</span></div>
<div class="line left">
<span class="small bold">diskID </span><span class="small">| f u [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">return user name and disk name installed in O.S.</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(f &larr; self oldFile: &rsquo;sys.boot&rsquo;) readonly; position &larr; 512.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">u &larr; f nextString.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">f padNext.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">u &larr; u, f nextString.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">f close.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑u]</span></div>
<div class="line left">
<span class="small bold">diskNumber </span><span class="small">["directory is: Integer⇒ [" ⇑directory "] ⇑directory diskNumber"]</span></div>
<div class="line left">
<span class="small bold">filesMatching: pattern </span><span class="small">| files v i [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">files &larr; self match: [pattern last = (&rsquo;.&rsquo;◦1)⇒ [pattern] pattern + &rsquo;.&rsquo;].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">v &larr; Vector new: files length.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ i to: v length do⦂ [v◦i &larr; (files◦i) name].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑v]</span></div>
<div class="line left">
<span class="small bold">flush </span><span class="small">[bitsFile≡nil⇒ [] bitsFile flush]</span></div>
<div class="line left">
<span class="small bold">freePages </span><span class="small">| npages ch i [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self open.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">bitsFile position &larr; boffset.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">npages &larr; 0.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">for⦂ i from: 1 to: totalPages by: 8 do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">(ch &larr; bitsFile next) =0377⇒ ["</span><span class="small italic">all used</span><span class="small">"]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">possibly up to 8 unused</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">npages &larr; npages+8.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">until⦂ ch = 0 do⦂ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">npages &larr; npages - (ch land: 1).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">ch &larr; ch lshift: ¬1]].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">⇑npages]</span></div>
<div class="line left">
<span class="small bold">growSmalltalkBy: n </span><span class="small">| zfpt i file page a zlen ["dp0 growSmalltalkBy: 100."<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">find and read last page of small.boot, then extend file</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">i &larr; 1. zlen&larr; 96.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">zfpt &larr; CoreLocs new base: (Vmem specialLocs◦7) length: zlen*2.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">until⦂ zfpt◦(i+zlen) = 0 do⦂ [i &larr; i+1].<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">a &larr; (zfpt◦(i+zlen-1)) + (zfpt◦i) - (zfpt◦(i-1)) - 1.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self open.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file &larr; self makeEntry: &rsquo;small.boot.&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page &larr; file newPage.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page address: (self virtualToReal: a);<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">doCommand: CRR error: &rsquo;cannot read last page. growSmalltalkBy:&rsquo;.<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">bypass reading file and creating random access table, just extend it</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page lastPage⇒ [<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file serialNumber: page serialNumber;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">lastPage: page pageNumber;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">pageAddresses: false "</span><span class="small bold">Read:, Write:</span><span class="small italic"> check this</span><span class="small">";<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">Get: (page pageNumber: page pageNumber+n).<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">user space; print: self freePages; show: &rsquo; pages left.&rsquo;]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">self error: &rsquo;growSmalltalkBy:. last page not last or 2 successive user grows&rsquo;]</span></div>
<div class="line left">
<span class="small bold">stampBoot </span><span class="small">| a file page ["dp0 stampBoot."<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"update the time stamps in leader page of current boot file"<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"find SafeId for current boot file"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">a &larr; Vmem specialLocs◦13.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file &larr; self makeEntry: &rsquo;&rsquo;.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file serialNumber: mem◦a, (mem◦(a+1)).<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"read page one of the boot file to find out the leader address"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page &larr; file makeEntry: 1.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page address: mem◦(a+4).<br><br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"then set leader address and dirty flag, and close file<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">thereby updating create/write/read dates, but not name"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">file doCommand: CCR page: page error: &rsquo;cannot read page 1 of boot file&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">leader: (page header: backp);<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">type: write;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">close]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪AltoFileDirectory under: &rsquo;Alto File System&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"AltoFilePage"</span></div>
<div class="line left">
<span class="medium bold">Class new title: &rsquo;AltoFilePage&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">subclassof: FilePage<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">fields: &rsquo;address&rsquo;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">declare: &rsquo;&rsquo;;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">sharing: AltoFilePool;<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="medium bold">asFollows</span></div>
<div class="line left">
<span class="small italic"><br>A FilePage from an AltoFile consists of a header (2 words), a label (8 words) and data (512 characters)</span></div>
<div class="line left">
<span class="medium bold"><br>FilePage</span></div>
<div class="line left">
<span class="small bold">address </span><span class="small">[⇑address]</span></div>
<div class="line left">
<span class="small bold">address: address</span></div>
<div class="line left">
<span class="small bold">headerLength </span><span class="small">[⇑16]</span></div>
<div class="line left">
<span class="small bold">init </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page ≡ nil⇒ [super init]<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">nextp, backp, lnused, numch, pn</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page fill: 1 to: 10 with: 0]</span></div>
<div class="line left">
<span class="small bold">lastPage </span><span class="small">[⇑("self header:" page word: nextp) = 0]</span></div>
<div class="line left">
<span class="small bold">length </span><span class="small">[⇑"self header:" page word: numch]</span></div>
<div class="line left">
<span class="small bold">length: len </span><span class="small">["self header:" page word: numch &larr; len]</span></div>
<div class="line left">
<span class="small bold">pageNumber </span><span class="small">[⇑"self header:" page word: pagen]</span></div>
<div class="line left">
<span class="small bold">pageNumber: pn </span><span class="small">["self header:" page word: pagen &larr; pn]</span></div>
<div class="line left">
<span class="small bold">serialNumber </span><span class="small">[⇑page◦(13 to: 16)]</span></div>
<div class="line left">
<span class="small bold">serialNumber: sn </span><span class="small">["page◦(13 to: 16) &larr; sn"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page copy: 13 to: 16 with: sn from: 1 to: 4.<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"self header:" page word: vn &larr; 1 "fixed version"]</span></div>
<div class="line left">
<span class="medium bold"><br>Alto</span></div>
<div class="line left">
<span class="small bold">freePage </span><span class="small">[<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">"</span><span class="small italic">label for a free page: version, sn1, sn2 = ¬1</span><span class="small">"<br></span>&nbsp;&nbsp;&nbsp;&nbsp;<span class="small">page fill: 11 to: 16 with: 0377]</span></div>
<div class="line left">
<span class="small"></span></div>
<div class="line left">
<span class="small">SystemOrganization classify: ↪AltoFilePage under: &rsquo;Alto File System&rsquo;.</span></div>
  </body>
</html>
