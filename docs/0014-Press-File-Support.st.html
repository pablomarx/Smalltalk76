<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Press-File-Support.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"ParagraphScanner"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ParagraphScanner&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: Object<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;para "&lt;Paragraph&gt;"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">style "&lt;TextStyle&gt;"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">press "&lt;PressFile&gt; for output"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">runstrm "&lt;Stream&gt; of paragraph runs"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">textstrm "&lt;Stream&gt; of paragraph text"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">font "&lt;WidthTable&gt; current font"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">ascent "&lt;Integer&gt; max ascent"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">descent "&lt;Integer&gt; negative max descent"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">width "&lt;Integer&gt; total width"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">spaces "&lt;Integer&gt; number of spaces"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">rect "&lt;Rectangle&gt; for printing"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">tabpos "&lt;Stream&gt; (text position, new X position) of tabs"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Scans through a paragraph computing the dimensions of a partial line of text.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">in: rect</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init<br></span><span class="tab"></span><span class="small">[ascent &larr; descent &larr; width &larr; spaces &larr; 0. tabpos reset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: para to: press style: style<br></span><span class="tab"></span><span class="small">[textstrm &larr; &rsquo;&rsquo; asStream.<br></span><span class="tab"></span><span class="small">runstrm &larr; para runs asStream.<br></span><span class="tab"></span><span class="small">tabpos &larr; (Vector new: 10) asStream]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">position </span><span class="small">[⇑textstrm position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">width </span><span class="small">[⇑width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Scanning</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">backup<br></span><span class="tab"></span><span class="small">[textstrm skip: ¬1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">scan </span><span class="small italic">"Scan up to a zero-width character, back up to last blank if width exceeded"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">| maxw sp char t<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"Save state" spos slim srunpos sasc sdesc swidth ssp sfont stpos<br></span><span class="tab"></span><span class="small">[textstrm end and⦂ self newrun≡false⇒ [⇑false]<br></span><span class="tab"></span><span class="small">maxw &larr; rect width.<br></span><span class="tab"></span><span class="small">while⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[ascent &larr; ascent max: font ascent.<br></span><span class="tab"></span><span class="tab"></span><span class="small">descent &larr; descent max: font descent.<br></span><span class="tab"></span><span class="tab"></span><span class="small">sp &larr; font space.<br></span><span class="tab"></span><span class="tab"></span><span class="small">while⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">t &larr; font scan: textstrm until: width exceeds: maxw.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[(char &larr; t◦1) ≡ true⇒ [] width &larr; t◦2].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">char = 040] do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">["Save state"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">spos &larr; textstrm position. slim &larr; textstrm limit.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">srunpos &larr; runstrm position. stpos &larr; tabpos position.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">sasc &larr; ascent. sdesc &larr; descent.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">swidth &larr; width. ssp &larr; spaces. sfont &larr; font.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">spaces &larr; spaces+1.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">width &larr; width+sp].<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">char⇒<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[(char≡true and⦂ nil≠spos) and⦂ (2*ascent ≤ rect height)⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"Back up to just past last blank (if another line fits)"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">textstrm of: para text from: spos+1 to: slim.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">runstrm position &larr; srunpos. tabpos position &larr; stpos.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">ascent &larr; sasc. descent &larr; sdesc.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">width &larr; swidth. spaces &larr; ssp. font &larr; sfont.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">⇑040]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">⇑char]<br></span><span class="tab"></span><span class="tab"></span><span class="small">self newrun]<br></span><span class="tab"></span><span class="small"> do⦂ [].<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tab<br></span><span class="tab"></span><span class="small">[spaces &larr; 0.<br></span><span class="tab"></span><span class="small">tabpos next &larr; textstrm position;<br></span><span class="tab"></span><span class="tab"></span><span class="small">next &larr; (width &larr; width + font tab | font tab)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printfrom: charpos aligned: align skip: n </span><span class="small italic">"Returns false if goes below bottom"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">| ybot a b ix iy px xs sp rs len tpos ts ntab rval ifont w ps [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">this code basically writes the EL (entity list) for a line</span><span class="small">"<br></span><span class="tab"></span><span class="small">"bottom of character -- ascent not really ascent but height"<br></span><span class="tab"></span><span class="small">(ybot &larr; rect corner y - ascent) &lt; rect origin y ⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">won&rsquo;t fit</span><span class="small">" ⇑false]<br><br></span><span class="tab"></span><span class="small">a &larr; charpos + 1.<br></span><span class="tab"></span><span class="small">b &larr; textstrm position - n.<br></span><span class="tab"></span><span class="small">[a &gt; b ⇒ [</span><span class="small italic">"No text"</span><span class="small">]<br></span><span class="tab"></span><span class="small">ts &larr; tabpos viewer.<br></span><span class="tab"></span><span class="small">tpos &larr; ts next.<br><br></span><span class="tab"></span><span class="small">px &larr; false.<br></span><span class="tab"></span><span class="small">xs &larr; rect width - width.<br></span><span class="tab"></span><span class="small">ix &larr; rect minX + ["</span><span class="small italic">left margin offset</span><span class="small">" align=2⇒ [xs/2]; =4⇒[xs] 0].<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">set baseline of character.  do setx before showchars</span><span class="small">"<br></span><span class="tab"></span><span class="small">press sety: (iy &larr; ybot + descent).<br></span><span class="tab"></span><span class="small">sp &larr; font space "kludge?".<br></span><span class="tab"></span><span class="small">[align=1⇒ ["</span><span class="small italic">do setspacex before showchars</span><span class="small">"] press setspacex: sp].<br><br></span><span class="tab"></span><span class="small">rs &larr; (para run: a to: b) asStream.<br></span><span class="tab"></span><span class="small">while⦂ (len &larr; rs next) do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">press selectfont: (press fontindex: (rval &larr; rs next) style: style) - 1.<br></span><span class="tab"></span><span class="tab"></span><span class="small">b &larr; a+len.<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">[(rval land: 4) = 0⇒ ["no underlining"]<br></span><span class="tab"></span><span class="tab"></span><span class="small">"unfortunately, we must rescan this part of line to find out how wide it is"<br></span><span class="tab"></span><span class="tab"></span><span class="small">ifont &larr; press codefont: rval style: style "a WidthTable".<br></span><span class="tab"></span><span class="tab"></span><span class="small">ps &larr; (para◦(a to: b-1)) asStream.<br></span><span class="tab"></span><span class="tab"></span><span class="small">w &larr; true, 0.<br></span><span class="tab"></span><span class="tab"></span><span class="small">while⦂ w◦1 do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">w &larr; ifont scan: ps until: w◦2 exceeds: rect width.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">w◦1 = 040⇒ [w◦2 &larr; w◦2 + ifont space];<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">=011⇒ [w◦2 &larr; w◦2 + ifont tab | ifont tab]].<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">[px⇒ ["use current x position"] press setx: ix].<br></span><span class="tab"></span><span class="tab"></span><span class="small">"change y position to show rectangle, then change y back again"<br></span><span class="tab"></span><span class="tab"></span><span class="small">press sety: iy-40; showrectwidth: w◦2 height: 30; sety: iy].<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">ntab &larr; 0.<br></span><span class="tab"></span><span class="tab"></span><span class="small">while⦂ (tpos and⦂ tpos&lt;b) do⦂ [</span><span class="tab"></span><span class="small italic">"Put out tabs"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[tpos = a⇒ ["</span><span class="small italic">no text between this tab and last</span><span class="small">"]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">put out accumulated tabs or initial x</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[ntab&gt; 0⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">press skipchars: ntab; setx: px.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">ntab &larr; 0]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">px⇒ []<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">press setx: (px &larr; ix)].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">press showchars: tpos-a].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">ntab &larr; ntab+1.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">px &larr; ix + ts next.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">a &larr; tpos+1.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">tpos &larr; ts next].<br></span><span class="tab"></span><span class="tab"></span><span class="small">[ntab&gt; 0⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">press skipchars: ntab;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">setx: px]<br></span><span class="tab"></span><span class="tab"></span><span class="small">px⇒ []<br></span><span class="tab"></span><span class="tab"></span><span class="small">press setx: (px &larr; ix)].<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">[align=1 and⦂ tpos≡false ⇒</span><span class="tab"></span><span class="tab"></span><span class="small">[</span><span class="small italic">"Reset space width"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[spaces=0⇒ [] press setspacex: xs/spaces+sp].<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">align &larr; 0]].<br></span><span class="tab"></span><span class="tab"></span><span class="small">rs end⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">for more compactness, maybe</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">press showchars: b-a skip: n.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">⇑ybot]<br></span><span class="tab"></span><span class="tab"></span><span class="small">press showchars: b-a.<br></span><span class="tab"></span><span class="tab"></span><span class="small">a &larr; b]].<br></span><span class="tab"></span><span class="small">[n &gt; 0⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">skip over ending blank or carriage return</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">press skipchars: n]].<br></span><span class="tab"></span><span class="small">⇑ybot]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Private scanning</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">newrun </span><span class="small">| len pos [<br></span><span class="tab"></span><span class="small">len &larr; runstrm next⇒<br></span><span class="tab"></span><span class="tab"></span><span class="small">[pos &larr; textstrm position.<br></span><span class="tab"></span><span class="tab"></span><span class="small">textstrm of: para text from: pos+1 to: pos+len.<br></span><span class="tab"></span><span class="tab"></span><span class="small">font &larr; press codefont: (runstrm next) style: style]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪ParagraphScanner under: &rsquo;Press File Support&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"PressFile"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;PressFile&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: Object<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;DL "&lt;File&gt; stores data list"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">EL "&lt;Set&gt; accumulates entity list"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">parts "&lt;Set&gt; accumulates part directory"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">DLstart "&lt;Integer&gt; position of current entity in DL"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">ELstart "&lt;Integer&gt; word position of current entity in EL"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">Pstart "&lt;Integer&gt; record position of current page in DL"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">eorigin "&lt;Point&gt;"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">scale "&lt;Integer&gt; micas per Alto screen dot"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">boundbox "&lt;Rectangle&gt; bounding box for current page"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">fontcodes "&lt;Vector&gt; of run codes corresponding to current fonts"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">fontdefs "&lt;Vector of WidthTables&gt; corresponding to fontcodes"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">estate "&lt;Vector&gt; of some entity state"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">FL "&lt;Set&gt; accumulates strings for Ext. File part" &rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;prevstyle SMentity recordsize printers printerMenu &rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>There are two levels of code in this class: the low-level Press commands and the high level user commands.  At the moment, only text, lines and bitmaps are supported (see Paragraph presson:in: and class ParagraphScanner for the former).  ignores bounding box stuff. limited reading.<br><br>see &lt;GR-DOCS&gt;PressFormat.Press and PressFormat-figure.Press for more details</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: DL </span><span class="small">[<br></span><span class="tab"></span><span class="small">EL &larr; Set new string: 200.<br></span><span class="tab"></span><span class="small">FL &larr; Set new string: 40.<br></span><span class="tab"></span><span class="small">parts &larr; Set new string: 40.<br></span><span class="tab"></span><span class="small">fontcodes &larr; Vector new: 0.<br></span><span class="tab"></span><span class="small">fontdefs &larr; Vector new: 0.<br></span><span class="tab"></span><span class="small">estate &larr; Vector new: 3 "font, spacex, spacey, ...".<br></span><span class="tab"></span><span class="small">prevstyle&larr; nil.<br></span><span class="tab"></span><span class="small">self scale: PressScale;<br></span><span class="tab"></span><span class="tab"></span><span class="small">startPage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">reset </span><span class="small">[<br></span><span class="tab"></span><span class="small">DL readwriteshorten; reset.<br></span><span class="tab"></span><span class="small">self of: DL]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">scale: scale</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Aspects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">defaultPrinterName </span><span class="small">[<br></span><span class="tab"></span><span class="small">⇑[currentProfile ≡ nil⇒ [PrinterName] currentProfile printerName]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">name </span><span class="small">[⇑DL name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">scale </span><span class="small">[⇑scale]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Entity/Page/File Commands</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">box: rect hue: hue sat: sat bright: bright containing⦂ expr | w r</span><span class="small"><br></span><span class="tab"></span><span class="small">[self entity: (self transrect: (w&larr; rect inset: ¬2)) containing⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[for⦂ r from: (w minus: rect) do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[self showrect: r color: 0].<br></span><span class="tab"></span><span class="tab"></span><span class="small">[ColorPrint⇒<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[self hue: hue; saturation: sat;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">showrect: rect color: bright; brightness: 0]].<br></span><span class="tab"></span><span class="tab"></span><span class="small">expr eval]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">clip: boundingbox</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">close </span><span class="small">| p i font [<br></span><span class="tab"></span><span class="small">DL writing≡false⇒ [DL close]<br></span><span class="tab"></span><span class="small">self closePage.<br></span><span class="tab"></span><span class="small">parts≡false or⦂ parts empty⇒ []<br><br></span><span class="tab"></span><span class="small">"if present, include the external file part  --- added Sept 80"<br><br></span><span class="tab"></span><span class="small">[FL empty⇒[]<br></span><span class="tab"></span><span class="small">self part⦂ [DL append: FL] code: 2.<br></span><span class="tab"></span><span class="small">FL reset.<br></span><span class="tab"></span><span class="small">self padpage].<br><br></span><span class="tab"></span><span class="small italic">"put font names and descriptions into font directory (part)"</span><span class="small"><br></span><span class="tab"></span><span class="small">self part⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">for⦂ i to: fontdefs length do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">font &larr; fontdefs ◦ i.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">DL nextword&larr; 16; nextword&larr; i-1;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">next &larr; font min; next &larr; font max.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self Bcpl: font name pad: 20.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">DL next &larr; font face; next &larr; font min;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; font pointsize; nextword&larr; 0]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">code: 1.<br><br></span><span class="tab"></span><span class="small">"</span><span class="small italic">write part directory. Pstart is current page position</span><span class="small">"<br></span><span class="tab"></span><span class="small">DL append: parts asReadStream.<br></span><span class="tab"></span><span class="small">self padpage.<br></span><span class="tab"></span><span class="small">p &larr; self recordnum.<br><br></span><span class="tab"></span><span class="small">"</span><span class="small italic">document directory</span><span class="small">"<br></span><span class="tab"></span><span class="small">DL nextword&larr; 27183; </span><span class="small italic">"press password"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword&larr; p + 1 </span><span class="small italic">"number of records"</span><span class="small">;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword&larr; parts position / 8 </span><span class="small italic">"number of parts"</span><span class="small">;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword&larr; Pstart; </span><span class="small italic">"part dir and length"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword&larr; p - Pstart;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword&larr; ¬1; "</span><span class="small italic">backpointer to obsolete doc dir</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">append: user timewords; "2 time words"<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword&larr; 1; </span><span class="small italic">"first and last copies"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword&larr; 1;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword&larr; ¬1; </span><span class="small italic">"first and last pages"<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; ¬1;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; &rsquo;S&rsquo;◦1 "</span><span class="small italic">solid color (looked at by color printers)</span><span class="small">";<br></span><span class="tab"></span><span class="tab"></span><span class="small">next: 2*(0177-12) &larr; 0377.<br><br></span><span class="tab"></span><span class="small">p &larr; user now.<br></span><span class="tab"></span><span class="small">self Bcpl: self name pad: 52;<br></span><span class="tab"></span><span class="tab"></span><span class="small">Bcpl: [currentProfile≡nil⇒ [dp0 diskID◦1] currentProfile printedBy] pad: 32;<br></span><span class="tab"></span><span class="tab"></span><span class="small">Bcpl: [((String new: 40) asStream) print: p◦1; space; print: p◦2; contents] pad: 40;<br></span><span class="tab"></span><span class="tab"></span><span class="small">padpage.<br></span><span class="tab"></span><span class="small">DL close.<br></span><span class="tab"></span><span class="small">parts reset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">entity: box containing⦂ expr </span><span class="small">| v [<br></span><span class="tab"></span><span class="small">self startEntity.<br></span><span class="tab"></span><span class="small">boundbox &larr; box.<br></span><span class="tab"></span><span class="small">v &larr; expr eval.<br></span><span class="tab"></span><span class="small">self closeEntity.<br></span><span class="tab"></span><span class="small">⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">entityorigin: eorigin</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">page </span><span class="small">[self closePage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pictureinit </span><span class="small">[self pictureinit: user screenrect scale: PressScale]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pictureinit: rect scale: scale<br></span><span class="tab"></span><span class="small">[boundbox &larr; boundbox include: (self transrect: rect).<br></span><span class="tab"></span><span class="small">self somefont]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">screenout: rect scale: scale<br></span><span class="tab"></span><span class="small">[</span><span class="small italic">"puts a bit map image onto the PressFile.  The standard<br></span><span class="tab"></span><span class="small italic">scaling is 32 micas per Alto dot.  22 looks better, Dover only<br></span><span class="tab"></span><span class="small italic">works with 32"</span><span class="small"><br></span><span class="tab"></span><span class="small">user displayoffwhile⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">self somefont; setp: (self transrect: rect) origin; bitmap: rect bits: false; close]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">selectPrinter </span><span class="small">[⇑self selectPrinter: self defaultPrinterName]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">selectPrinter: oldName </span><span class="small">| t [<br></span><span class="tab"></span><span class="small">user cr; show: &rsquo;select a printer (currently &rsquo;;<br></span><span class="tab"></span><span class="tab"></span><span class="small">show: [oldName≡false or⦂ oldName empty⇒ [&rsquo;none&rsquo;] oldName]; show: &rsquo;)&rsquo;.<br></span><span class="tab"></span><span class="small">user cursorloc &larr; user screenrect center; restoredisplay.<br></span><span class="tab"></span><span class="small">t &larr; 0.<br></span><span class="tab"></span><span class="small">while⦂ t = 0 do⦂ [t &larr; printerMenu wbug].<br></span><span class="tab"></span><span class="small">⇑[t ≤ printers length⇒ [printers◦t]<br></span><span class="tab"></span><span class="tab"></span><span class="small">t = (printers length+1)⇒ ["same" oldName] "none" false]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">toPrinter </span><span class="small">[self toPrinter: self defaultPrinterName]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">toPrinter: ndest </span><span class="small">"a printer name" | psocket dest np t perr [<br></span><span class="tab"></span><span class="small">ndest ≡ false⇒ ["don&rsquo;t try to print" ⇑false]<br><br></span><span class="tab"></span><span class="small">E ≡ nil⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"use O.S. if Smalltalk ethercode not alive"<br></span><span class="tab"></span><span class="tab"></span><span class="small">t &larr; (String new: 100) asStream.<br></span><span class="tab"></span><span class="tab"></span><span class="small">t append: &rsquo;Empress. &rsquo;; append: self name.<br></span><span class="tab"></span><span class="tab"></span><span class="small">[ndest length &gt; 0⇒ [t space; append: ndest; append: &rsquo;/H&rsquo;]].<br></span><span class="tab"></span><span class="tab"></span><span class="small">t append: &rsquo;; Resume.~ Small.Boot&rsquo;.<br></span><span class="tab"></span><span class="tab"></span><span class="small">user quitThen: t asReadStream]<br><br></span><span class="tab"></span><span class="small">dest &larr; &rsquo;&rsquo;.<br></span><span class="tab"></span><span class="small">perr &larr; psocket &larr; false.<br></span><span class="tab"></span><span class="small">np &larr; printers length+1.<br></span><span class="tab"></span><span class="small">DL readonly.<br><br></span><span class="tab"></span><span class="small">while⦂ ndest do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">perr or⦂ ndest empty⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">perr &larr; false.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">ndest &larr; self selectPrinter: dest]<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">[dest = ndest⇒ ["to same printer"]<br></span><span class="tab"></span><span class="tab"></span><span class="small">dest &larr; ndest.<br></span><span class="tab"></span><span class="tab"></span><span class="small">"close previous socket"<br></span><span class="tab"></span><span class="tab"></span><span class="small">psocket⇒ [psocket close. psocket &larr; false]].<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">[psocket⇒ []<br></span><span class="tab"></span><span class="tab"></span><span class="small">"create new socket"<br></span><span class="tab"></span><span class="tab"></span><span class="small">psocket &larr; EFTPSender new hostName: dest⇒ [psocket wakeup]<br></span><span class="tab"></span><span class="tab"></span><span class="small">user cr; show: &rsquo;name lookup failure&rsquo;].<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">"send file"<br></span><span class="tab"></span><span class="tab"></span><span class="small">psocket and⦂ (user displayoffwhile⦂ [psocket send: DL reset])⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"success--stop" ndest &larr; false]<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">"failure--switch servers?"<br></span><span class="tab"></span><span class="tab"></span><span class="small">perr &larr; true].<br><br></span><span class="tab"></span><span class="small">"cleanup after success or abort"<br></span><span class="tab"></span><span class="small">DL close.<br></span><span class="tab"></span><span class="small">psocket⇒ [psocket close]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Fonts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">codefont: code style: style<br></span><span class="tab"></span><span class="small">[⇑fontdefs◦(self fontindex: code style: style)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fontindex: code style: style </span><span class="small">| ix font n<br></span><span class="tab"></span><span class="small">[</span><span class="small italic">"return index if in font dictionary"</span><span class="small"><br></span><span class="tab"></span><span class="small">code &larr; code land: 0363.</span><span class="tab"></span><span class="tab"></span><span class="small italic">"Remove underline and strikeout"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">[style=prevstyle⇒<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[(ix &larr; fontcodes find: code) &gt; 0 ⇒ [⇑ix]]<br></span><span class="tab"></span><span class="tab"></span><span class="small">fontcodes all&larr; nil. "invalid across style change"<br></span><span class="tab"></span><span class="tab"></span><span class="small">prevstyle&larr; style].<br></span><span class="tab"></span><span class="small">n &larr; code / 16 + 1.<br></span><span class="tab"></span><span class="small">font &larr; (WidthTable new<br></span><span class="tab"></span><span class="tab"></span><span class="small">named: (style fontfamily: n)<br></span><span class="tab"></span><span class="tab"></span><span class="small">pointsize: (style fontsize: n)<br></span><span class="tab"></span><span class="tab"></span><span class="small">face: (code / 2 land: 1) + (code * 2 land: 2))<br></span><span class="tab"></span><span class="small"> lookup.<br></span><span class="tab"></span><span class="small">(ix&larr; fontdefs find: font)&gt;0⇒<br></span><span class="tab"></span><span class="tab"></span><span class="small">[fontcodes◦ix&larr; code. ⇑ix]<br></span><span class="tab"></span><span class="small italic">"add entry to font dictionary"</span><span class="small"><br></span><span class="tab"></span><span class="small">fontdefs length=16⇒[user notify: &rsquo;too many fonts&rsquo;. ⇑1]<br></span><span class="tab"></span><span class="small">fontcodes &larr; fontcodes, code.<br></span><span class="tab"></span><span class="small">fontdefs &larr; fontdefs, font.<br></span><span class="tab"></span><span class="small">⇑fontcodes length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">selectfont: f </span><span class="small">[<br></span><span class="tab"></span><span class="small">estate◦1 = f⇒ []<br></span><span class="tab"></span><span class="small">EL next &larr; 0160 + (estate◦1 &larr; f)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">somefont</span><span class="tab"></span><span class="tab"></span><span class="small italic">"fool self into writing non-empty fontdir"</span><span class="small"><br></span><span class="tab"></span><span class="small">[self fontindex: 5*16 style: DefaultTextStyle]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Transformations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">transpt: p<br></span><span class="tab"></span><span class="small">[⇑ Point new x: (p x * scale) asInteger y: (25400 - (p y * scale)) asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">transrect: rect<br></span><span class="tab"></span><span class="small">[⇑ Rectangle new<br></span><span class="tab"></span><span class="tab"></span><span class="small">origin: (self transpt: rect minX ⌾ rect maxY)<br></span><span class="tab"></span><span class="tab"></span><span class="small">corner: (self transpt: rect maxX ⌾ rect minY)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>EL commands</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">brightness: b </span><span class="small">[EL next&larr; 0370; next&larr; b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hue: b </span><span class="small">[EL next&larr; 0371; next&larr; b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">onlyoncopy: n </span><span class="small">[EL next &larr; 0355; next &larr; n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">resetspace </span><span class="small">[EL next &larr; 0366]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">saturation: s </span><span class="small">[EL next&larr; 0372; next&larr; s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setp: p </span><span class="small">[<br></span><span class="tab"></span><span class="small">"self setx: p x; sety: p y"<br></span><span class="tab"></span><span class="small">EL next &larr; 0356; nextword &larr; p x;<br></span><span class="tab"></span><span class="tab"></span><span class="small">next &larr; 0357; nextword &larr; p y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setspacex: x </span><span class="small">[<br></span><span class="tab"></span><span class="small">estate◦2 = x⇒ []<br></span><span class="tab"></span><span class="small">estate◦2 &larr; x.<br></span><span class="tab"></span><span class="small">x ≥ 0 and⦂ x ≤ 2047⇒ ["</span><span class="small italic">short form</span><span class="small">" EL nextword &larr; 060000 + x]<br></span><span class="tab"></span><span class="small">EL next &larr; 0364; nextword &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setspacey: y </span><span class="small">[<br></span><span class="tab"></span><span class="small">estate◦3 = y⇒ []<br></span><span class="tab"></span><span class="small">estate◦3 &larr; y.<br></span><span class="tab"></span><span class="small">y ≥ 0 and⦂ y ≤ 2047⇒ ["</span><span class="small italic">short form</span><span class="small">" EL nextword &larr; 064000 + y]<br></span><span class="tab"></span><span class="small">EL next &larr; 0365; nextword &larr; y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setx: x </span><span class="small">[EL next &larr; 0356; nextword &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sety: y </span><span class="small">[EL next &larr; 0357; nextword &larr; y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showchar: char </span><span class="small">["immediate" EL next &larr; 0363; next &larr; char]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showchars: n </span><span class="small">[<br></span><span class="tab"></span><span class="small">n=0⇒ []<br></span><span class="tab"></span><span class="small">n ≥ 1 and⦂ n ≤ 32⇒ ["</span><span class="small italic">short form</span><span class="small">" EL next &larr; n-1]<br></span><span class="tab"></span><span class="small">EL next &larr; 0360; next &larr; n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showchars: n skip: t </span><span class="small">[<br></span><span class="tab"></span><span class="small">t=1 and⦂ (n ≥ 1 and⦂ n ≤ 32)⇒ [EL next &larr; 0100 + n-1]<br></span><span class="tab"></span><span class="small">self showchars: n; skipchars: t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showdots: nwords </span><span class="small">[EL next &larr; 0374; nextNumber: 4 &larr; nwords]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showdotsopaque: nwords </span><span class="small">[EL next &larr; 0375; nextNumber: 4 &larr; nwords]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showrect: rect </span><span class="small">[<br></span><span class="tab"></span><span class="small">self setp: rect origin.<br></span><span class="tab"></span><span class="small">EL next &larr; 0376;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; rect width;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; rect height]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showrect: rect color: c </span><span class="small">[<br></span><span class="tab"></span><span class="small">[ColorPrint⇒ [self brightness: c]].<br></span><span class="tab"></span><span class="small">self showrect: (self transrect: rect)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showrectwidth: w height: h </span><span class="small">[EL next &larr; 0376; nextword &larr; w; nextword &larr; h]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skipchars: n </span><span class="small">[<br></span><span class="tab"></span><span class="small">n=0⇒ []<br></span><span class="tab"></span><span class="small">n ≥ 1 and⦂ n ≤ 32⇒ ["</span><span class="small italic">short form</span><span class="small">" EL next  &larr; 040 + n-1]<br></span><span class="tab"></span><span class="small">EL next &larr; 0361; next &larr; n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skipcontrol: n </span><span class="small">[<br></span><span class="tab"></span><span class="small">"immediate"<br></span><span class="tab"></span><span class="small">EL next &larr; 0353; next &larr; n.<br></span><span class="tab"></span><span class="small">"now put n bytes in EL"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skipcontrol: n type: t </span><span class="small">[<br></span><span class="tab"></span><span class="small">"n bytes have been put in DL"<br></span><span class="tab"></span><span class="small">EL next &larr; 0362; nextword &larr; n; next &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">space </span><span class="small">[EL next &larr; 0367]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Bitmaps/Dots</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">AIS: file width: w height: h croprect: r at: pt scale: s<br></span><span class="tab"></span><span class="small">[self setp: (self transpt: pt); dots⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self setcoding: 8 "byte samples" dots: w lines: h;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">setmode: 3 "to right and to bottom of page";<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">setsizewidth: (s*r width*scale) asInteger height: (s*r height*scale) asInteger;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">setwindowwidth: r width height: r height skipdots: r minX skiplines: r minY;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">dotsfromAIS: file]]<br>"<br>(dp0 pressfile: &rsquo;pix.press&rsquo;) somefont; AIS: &rsquo;girl.ais&rsquo; width: 512 height: 512 croprect: (50⌾50 rect: 500⌾500) at: 36⌾80 scale: 0.65; close.<br>"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bitmap: rect bits: bits </span><span class="small">| w w16 h</span><span class="small italic"> </span><span class="small">[<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">some pecularities of spruce:<br></span><span class="tab"></span><span class="small italic">scale must be 32, and multiples of 16 for width (maybe extra stuff prints)</span><span class="small">"<br></span><span class="tab"></span><span class="small">w &larr; rect width.<br></span><span class="tab"></span><span class="small">w16 &larr; w + 15 | 16 "</span><span class="small italic">width to next word boundary</span><span class="small">".<br></span><span class="tab"></span><span class="small">h &larr; rect height.<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">origin should be set earlier</span><span class="small">"<br></span><span class="tab"></span><span class="small">self dots⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">self setcoding: 0 "</span><span class="small italic">bitmap</span><span class="small">" dots: w16 lines: h;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">setmode: 3 "</span><span class="small italic">to right and to bottom of page</span><span class="small">";<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">setsizewidth: scale * w16 height: scale * h;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">setwindowwidth: [ColorPrint⇒ [w] w16] height: h;<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">dotsfollow.<br></span><span class="tab"></span><span class="tab"></span><span class="small">bits⇒["</span><span class="small italic">bits supplied</span><span class="small">" DL append: bits]<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">else from screen</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">rect bitsOntoStream: DL]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dots⦂ exp </span><span class="small">| dlpos [<br></span><span class="tab"></span><span class="small">dlpos &larr; self padword.<br></span><span class="tab"></span><span class="small">exp eval.<br></span><span class="tab"></span><span class="small">self showdots: DL wordposition - dlpos]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dotsfollow </span><span class="small">[DL nextword &larr; 3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dotsfromAIS: file </span><span class="small">| f<br></span><span class="tab"></span><span class="small">[f&larr;file length inString+file+[file length even⇒[&rsquo; &rsquo;]&rsquo;&rsquo;]. "BCPLize"<br></span><span class="tab"></span><span class="small">DL nextword &larr; 4; nextword &larr; 4; append: f. FL append: f]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setcoding: c dots: d lines: l </span><span class="small">[<br></span><span class="tab"></span><span class="small">DL next &larr; 1; next &larr; c;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; d; nextword &larr; l]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setmode: m </span><span class="small">[DL next &larr; 2; next &larr; m]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setsizewidth: w height: h </span><span class="small">[<br></span><span class="tab"></span><span class="small">DL nextword &larr; 2; nextword &larr; w; nextword &larr; h]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setwindowwidth: w height: h </span><span class="small">[<br></span><span class="tab"></span><span class="small">self setwindowwidth: w height: h skipdots: 0 skiplines: 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setwindowwidth: w height: h skipdots: sd skiplines: sl<br></span><span class="tab"></span><span class="small">[DL nextword &larr; 1;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; sd; nextword &larr; w;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; sl; nextword &larr; h]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Lines/Objects</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">drawcurve: v </span><span class="small">[<br></span><span class="tab"></span><span class="small">v length ≠ 12⇒ [user notify: &rsquo;illegal drawcurve&rsquo;]<br></span><span class="tab"></span><span class="small">DL nextword &larr; 2.<br></span><span class="tab"></span><span class="small">for⦂ v from: v do⦂ [DL nextword &larr; v]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">drawdiscat: pt radius: radius | dx dy i<br></span><span class="tab"></span><span class="small">[radius ≤ 16 ⇒ []<br></span><span class="tab"></span><span class="small"> dx &larr; ↪(5 4 3 1 ¬1 ¬3 ¬4 ¬5 ¬5 ¬4 ¬3 ¬1 1 3 4 5).<br></span><span class="tab"></span><span class="small"> dy &larr; ↪(1 3 4 5 5 4 3 1 ¬1 ¬3 ¬4 ¬5 ¬5 ¬4 ¬3 ¬1).<br></span><span class="tab"></span><span class="small"> self showobject⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">self moveto: pt + ((dx◦16*radius/5) ⌾ (dy◦16*radius/5)).<br></span><span class="tab"></span><span class="small"> </span><span class="tab"></span><span class="small">for⦂ i to: 16 do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[self drawto: pt + ((dx◦i*radius/5) ⌾ (dy◦i*radius/5))]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">drawlinefrom: p1 to: p2 width: width | d length t1 t2<br></span><span class="tab"></span><span class="small">[[(d &larr; p2-p1) = (0⌾0) ⇒ []<br></span><span class="tab"></span><span class="tab"></span><span class="small">d x&larr; d x asFloat. d y&larr; d y asFloat. width &larr; width asFloat.<br></span><span class="tab"></span><span class="tab"></span><span class="small">length &larr; ((d x*d x)+(d y*d y)) sqrt.<br></span><span class="tab"></span><span class="tab"></span><span class="small">d x&larr; (d x*width/length) asInteger.<br></span><span class="tab"></span><span class="tab"></span><span class="small">d y&larr; (d y*width/length) asInteger.<br></span><span class="tab"></span><span class="tab"></span><span class="small">t1 &larr; d y ⌾ (0 - d x).<br></span><span class="tab"></span><span class="tab"></span><span class="small">t2 &larr; 0 - d y ⌾ d x.<br></span><span class="tab"></span><span class="tab"></span><span class="small">self showobject⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self moveto: p1 + t1.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self drawto: p2 + t1.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self drawto:  p2 + t2.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self drawto:  p1 + t2.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self drawto:  p1 + t1]].<br></span><span class="tab"></span><span class="small"> self drawdiscat: p2 radius: width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">drawlinefromscreen: p1 to: p2 width: width<br></span><span class="tab"></span><span class="small">[⇑self drawlinefrom: (self transpt: p1) to: (self transpt: p2) width: (width*scale)] </span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">drawto: p </span><span class="small">[DL nextword &larr; 1; nextPoint &larr; p]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">moveto: p </span><span class="small">[DL nextword &larr; 0; nextPoint &larr; p]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">object⦂ expr atScreen: p <br></span><span class="tab"></span><span class="small">[self showobject⦂ [self objectGotoScreen: p pen: 0. expr eval]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">objectGotoScreen: p pen: pen </span><span class="small">[<br></span><span class="tab"></span><span class="small">DL nextword&larr; pen; nextPoint &larr; (self transpt: p)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showobject⦂ exp </span><span class="small">| p [<br></span><span class="tab"></span><span class="small">p &larr; self padword.<br></span><span class="tab"></span><span class="small">"expression containing moveto, drawto, drawcurve"<br></span><span class="tab"></span><span class="small">exp eval.<br></span><span class="tab"></span><span class="small">EL next &larr; 0373; nextword &larr; DL wordposition - p]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">append: x<br></span><span class="tab"></span><span class="small">[⇑DL append: x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Bcpl: s pad: n </span><span class="small">| slen [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">write a Bcpl string and padding to fill n bytes (used by close)</span><span class="small">"<br></span><span class="tab"></span><span class="small">slen &larr; s length min: n-1.<br></span><span class="tab"></span><span class="small">DL next &larr; slen; append: s◦(1 to: slen); next: n-(slen+1) &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit </span><span class="small">| a p ["PressFile classInit."<br></span><span class="tab"></span><span class="small">Smalltalk declare: ↪PressScale as: 32.<br></span><span class="tab"></span><span class="small">recordsize &larr; 512.<br></span><span class="tab"></span><span class="small">SMentity &larr; 5.<br><br></span><span class="tab"></span><span class="small">a &larr; (String new: 250) asStream.<br>"from [Maxc1]&lt;Altodocs&gt;NetTopology.Press, October 1980. in order of net number"<br></span><span class="tab"></span><span class="small">printers &larr; ↪(<br></span><span class="tab"></span><span class="tab"></span><span class="small">"net #"</span><span class="tab"></span><span class="small">"printer names"<br></span><span class="tab"></span><span class="tab"></span><span class="small">" 1"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Navajo&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"HENRIETTA"<br></span><span class="tab"></span><span class="tab"></span><span class="small">" 3"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Menlo&rsquo; &rsquo;Clover&rsquo; &rsquo;Lilac&rsquo; "PARC: BLDG 35, FLOOR 2"<br></span><span class="tab"></span><span class="tab"></span><span class="small">" 5"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Kanji&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"PARC:  BLDG 34"<br></span><span class="tab"></span><span class="tab"></span><span class="small">" 6"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Wonder&rsquo; &rsquo;Quake&rsquo;</span><span class="tab"></span><span class="small">"PARC: BLDG 35, FLOOR 1&3"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"10"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Puff&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"A&E"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"12"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;White&rsquo; &rsquo;Colorado&rsquo;</span><span class="tab"></span><span class="small">"PASADENA"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"14"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Niagara&rsquo; &rsquo;Tioga&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="small">"WEBSTER"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"20"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Yoda&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"PARC: BLDG 32"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"21"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Lily&rsquo; </span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"SPG"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"23"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Ranger&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"DALLAS"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"26"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Windfall&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="small">"DC"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"27"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Genesee&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="small">"WEBSTER"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"33"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Amarok&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="small">"TORONTO"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"34"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Yankee&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="small">"STAMFORD"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"36"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Cyclops&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="small">"LEESBURG"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"54"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Rover&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"A&E"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"55"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;SPGEng&rsquo; &rsquo;Emperor&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="small">"A&E"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"56"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Thud&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"A&E"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"60"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Adelie&rsquo; &rsquo;Daisy&rsquo; &rsquo;RockHopper&rsquo; </span><span class="tab"></span><span class="small">"BAYHILL"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"62"</span><span class="tab"></span><span class="tab"></span><span class="small">&rsquo;Bud&rsquo;</span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"?"<br></span><span class="tab"></span><span class="small">).<br></span><span class="tab"></span><span class="small">for⦂ p from: printers do⦂ [a append: p; cr].<br></span><span class="tab"></span><span class="small">a append: &rsquo;same printer&rsquo;; cr; append: &rsquo;no printer&rsquo;.<br></span><span class="tab"></span><span class="small">printerMenu &larr; Menu new string: a contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">closeEntity </span><span class="small">[self closeEntity: SMentity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">closeEntity: etype </span><span class="small">[<br></span><span class="tab"></span><span class="small">EL wordposition = ELstart⇒ []<br></span><span class="tab"></span><span class="small italic">"Put a trailer into the EL"</span><span class="small"><br></span><span class="tab"></span><span class="small">EL</span><span class="tab"></span><span class="small">padNext &larr; 0377;</span><span class="tab"></span><span class="small italic">"word-pad EL with &lt;Nop&gt;"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">next &larr; etype;<br></span><span class="tab"></span><span class="tab"></span><span class="small">next&larr; 0; </span><span class="small italic">"fontset"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small italic">"dlstart relative to DL location in file"<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextNumber: 4 &larr; DLstart - (Pstart*recordsize);<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextNumber: 4 &larr; DL position - DLstart;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextPoint&larr; eorigin; </span><span class="small italic">"entity origin"</span><span class="small"><br></span><span class="tab"></span><span class="tab"></span><span class="small">nextPoint&larr; boundbox origin;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextPoint&larr; boundbox extent.<br></span><span class="tab"></span><span class="small">EL nextword &larr; EL wordposition - ELstart + 1.<br></span><span class="tab"></span><span class="small">self startEntity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">closePage </span><span class="small">[<br></span><span class="tab"></span><span class="small">self closeEntity.<br></span><span class="tab"></span><span class="small">EL empty⇒ []<br></span><span class="tab"></span><span class="small">DL</span><span class="tab"></span><span class="small">padNext &larr; 0;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; 0;<br></span><span class="tab"></span><span class="tab"></span><span class="small">append: EL asReadStream.<br></span><span class="tab"></span><span class="small">self part: 0 start: Pstart]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">data </span><span class="small">["slightly dangerous" ⇑DL]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">padpage </span><span class="small">["</span><span class="small italic">words of padding to end of page</span><span class="small">" ⇑(DL pad: recordsize with: 0) / 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">padword </span><span class="small">[<br></span><span class="tab"></span><span class="small">"make object (lines or dots) start on word boundary"<br></span><span class="tab"></span><span class="small">[DL padNext &larr; 0⇒ [self skipchars: 1]].<br></span><span class="tab"></span><span class="small">⇑DL wordposition]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">part⦂ exp code: c </span><span class="small">| fp [<br></span><span class="tab"></span><span class="small">self closePage.<br></span><span class="tab"></span><span class="small">fp &larr; self recordnum.<br></span><span class="tab"></span><span class="small">exp eval.<br></span><span class="tab"></span><span class="small">self part: c start: fp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">part: type start: start </span><span class="small">| padding</span><span class="small bold"> </span><span class="small">[<br></span><span class="tab"></span><span class="small">padding &larr; self padpage.<br></span><span class="tab"></span><span class="small">parts nextword &larr; type;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; start;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; self recordnum - start;<br></span><span class="tab"></span><span class="tab"></span><span class="small">nextword &larr; padding.<br></span><span class="tab"></span><span class="small">self startPage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">recordnum </span><span class="small">[⇑DL positionSize: recordsize]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skipcode: code data: s </span><span class="small">| t [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">called by </span><span class="small bold">hidePress:complete:</span><span class="small italic">. s is a String</span><span class="small">"<br></span><span class="tab"></span><span class="small">(t &larr; s length+1) &lt; 256⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">immediate, in EL</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">self skipcontrol: t.<br></span><span class="tab"></span><span class="tab"></span><span class="small">EL next &larr; code; append: s]<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">in DL</span><span class="small">"<br></span><span class="tab"></span><span class="small">DL next &larr; code; append: s.<br></span><span class="tab"></span><span class="small">self skipcontrol: t type: SMentity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">startEntity </span><span class="small">[<br></span><span class="tab"></span><span class="small">DLstart &larr; DL position.<br></span><span class="tab"></span><span class="small">ELstart &larr; EL wordposition.<br></span><span class="tab"></span><span class="small">boundbox &larr; 0 asRectangle.<br></span><span class="tab"></span><span class="small">eorigin &larr; 0⌾0.<br></span><span class="tab"></span><span class="small">estate all &larr; ¬1.<br></span><span class="tab"></span><span class="small">estate◦1 &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">startPage </span><span class="small">[<br></span><span class="tab"></span><span class="small">EL reset.<br></span><span class="tab"></span><span class="small">Pstart &larr; self recordnum.<br></span><span class="tab"></span><span class="small">self startEntity]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">filin </span><span class="small">| p [<br></span><span class="tab"></span><span class="small">self open.<br></span><span class="tab"></span><span class="small">while⦂ (p &larr; self nextParagraph) do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">FilinSource &larr; self.<br></span><span class="tab"></span><span class="tab"></span><span class="small">user print: nilⓢ p text; space].<br></span><span class="tab"></span><span class="small">FilinSource &larr; nil.<br></span><span class="tab"></span><span class="small">self close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextControl </span><span class="small">| command t entity [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">return the next skip-control information</span><span class="small">"<br></span><span class="tab"></span><span class="small">command &larr; nil.<br></span><span class="tab"></span><span class="small">while⦂ true do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">(estate and⦂ command)≡false⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">either or both false. get next entity</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">t &larr; EL next⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">estate &larr; EL next viewer. command &larr; nil.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">t◦1 ≠ SMentity⇒ ["ignore this entity" estate &larr; false]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">DLstart &larr; (t◦(3 to: 6)) asStream nextNumber: 4.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">DL position &larr; Pstart*recordsize + DLstart]<br><br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">no more entities on current part (page)</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">self readPart⇒ []<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">no more pages</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">⇑false]<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">entity &larr; estate.<br></span><span class="tab"></span><span class="small">while⦂ (command &larr; entity next) do⦂ [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">some stuff arranged by probable frequency</span><span class="small">"<br></span><span class="tab"></span><span class="small">command<br></span><span class="tab"></span><span class="small">&lt; 0100⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">show-characters-short</span><span class="small"> (0-037)<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">skip-characters-short</span><span class="small"> (040-077)"<br></span><span class="tab"></span><span class="tab"></span><span class="small">DL skip: (command land: 037) +1];<br></span><span class="tab"></span><span class="small">= 0356⇒ ["</span><span class="small bold">set-x"</span><span class="small"> entity nextword];<br></span><span class="tab"></span><span class="small">= 0357⇒ ["</span><span class="small bold">set-y</span><span class="small">" entity nextword];<br></span><span class="tab"></span><span class="small">&lt; 0140⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">show-characters-and-skip</span><span class="small"> (0100-0137)"<br></span><span class="tab"></span><span class="tab"></span><span class="small">DL skip: (command land: 037) +2];<br></span><span class="tab"></span><span class="small">&lt; 0160⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">set-space-x-short</span><span class="small"> (0140-0147)<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">set-space-y-short</span><span class="small">  (0150-0157)"<br></span><span class="tab"></span><span class="tab"></span><span class="small">"(command land: 7)*256 +" entity next];<br></span><span class="tab"></span><span class="small">&lt; 0200⇒ ["</span><span class="small bold">font</span><span class="small">" "command land: 017"];<br></span><span class="tab"></span><span class="small">= 0362⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">skip-control-bytes</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">t &larr; entity nextword.<br></span><span class="tab"></span><span class="tab"></span><span class="small">entity next≠SMentity⇒ ["ignore" DL skip: t]<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑DL next: t];<br></span><span class="tab"></span><span class="small">= 0360⇒ ["</span><span class="small bold">show-characters</span><span class="small">" DL skip: entity next];<br></span><span class="tab"></span><span class="small">= 0377⇒ ["</span><span class="small bold">nop</span><span class="small">"];<br><br></span><span class="tab"></span><span class="small">&lt; 0353⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">available</span><span class="small"> (0200-0237)<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">spare</span><span class="small"> (0240-0352)"];<br></span><span class="tab"></span><span class="small">= 0353⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">skip-control-bytes-immediate</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑entity next: entity next];<br></span><span class="tab"></span><span class="small">= 0354⇒ ["</span><span class="small bold">alternative</span><span class="small">" entity skipwords: 5];<br></span><span class="tab"></span><span class="small">= 0355⇒ ["</span><span class="small bold">only-on-copy</span><span class="small">" entity next];<br></span><span class="tab"></span><span class="small">= 0361⇒ ["</span><span class="small bold">skip characters</span><span class="small">" DL skip: entity next];<br><br></span><span class="tab"></span><span class="small">= 0363⇒ ["</span><span class="small bold">show-character-immediate</span><span class="small">" entity next];<br></span><span class="tab"></span><span class="small">&lt; 0366⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">set-space-x</span><span class="small"> (0364)<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">set-space-y</span><span class="small"> (0365)" entity nextword];<br></span><span class="tab"></span><span class="small">&lt; 0370⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">reset-space</span><span class="small"> (0366)<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">space</span><span class="small"> (0367)" ];<br></span><span class="tab"></span><span class="small">&lt; 0373⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">set-brightness</span><span class="small"> (0370)<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">set-hue</span><span class="small"> (0371)<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">set-saturation</span><span class="small"> (0372)" entity next];<br><br></span><span class="tab"></span><span class="small">= 0373⇒ ["</span><span class="small bold">show-object</span><span class="small">" DL skipwords: entity nextword];<br></span><span class="tab"></span><span class="small">&lt; 0376⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small bold">show-dots</span><span class="small"> (0374)<br></span><span class="tab"></span><span class="tab"></span><span class="small bold">show-dots-opaque</span><span class="small"> (0375)"<br></span><span class="tab"></span><span class="tab"></span><span class="small">DL skipwords: (entity nextNumber: 4)];<br></span><span class="tab"></span><span class="small">= 0376⇒ ["</span><span class="small bold">show-rectangle</span><span class="small">" entity skipwords: 2]<br></span><span class="tab"></span><span class="small">]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextParagraph </span><span class="small">| s p [<br></span><span class="tab"></span><span class="small">s &larr; self nextControl⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">s &larr; s asStream.<br></span><span class="tab"></span><span class="tab"></span><span class="small">p &larr; Paragraph new.<br></span><span class="tab"></span><span class="tab"></span><span class="small">s next = p pressCode⇒ [⇑p fromPress: self value: s]<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑false]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">open </span><span class="small">| t [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">read the parts (and font directory?)</span><span class="small">"<br></span><span class="tab"></span><span class="small">DL readonly; "reopen?" settoend; skip: 0 - recordsize.<br></span><span class="tab"></span><span class="small">DL nextword = 27183 and⦂ DL nextword = (self recordnum + 1)⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">t &larr; DL nextword.<br></span><span class="tab"></span><span class="tab"></span><span class="small">DL position: DL nextword size: recordsize.<br></span><span class="tab"></span><span class="tab"></span><span class="small">parts &larr; (DL next: t*8) viewer.<br></span><span class="tab"></span><span class="tab"></span><span class="small">self readPart]<br></span><span class="tab"></span><span class="small">self error: &rsquo;not a press file&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">readPart </span><span class="small">| t [<br></span><span class="tab"></span><span class="small">"</span><span class="small italic">read parts until we find a printed page or end</span><span class="small">"<br></span><span class="tab"></span><span class="small">estate &larr; false.<br></span><span class="tab"></span><span class="small">while⦂ (t &larr; parts nextword) do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">Pstart &larr; parts nextword.<br></span><span class="tab"></span><span class="tab"></span><span class="small">t ≠ 0⇒ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">not a printed page</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">parts skip: 4.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">t&gt; 0⇒ ["font or other part"]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">a non-standard part. let document (estate?) interpret</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"DL position &larr; Pstart*recordsize.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">estate fromPress: self name: t value: DL"]<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">go to end of last record of entity list, ignoring padding</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">t &larr; parts nextword "</span><span class="small italic">length</span><span class="small">".<br></span><span class="tab"></span><span class="tab"></span><span class="small">DL position &larr; Pstart+t * recordsize - ((1 + parts nextword) * 2).<br></span><span class="tab"></span><span class="tab"></span><span class="small">EL &larr; Set new vector: 50.<br><br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">scan backwards for beginning of entity list, reading entities</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">while⦂ (t &larr; DL nextword) &gt; 0 do⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">t &lt; 12⇒ [user notify: &rsquo;illegal entity&rsquo;]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">DL skipwords: 0-t.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">read entity and trailer (last 12 words of entity)</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">EL next &larr; DL next: t-12 *2.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">EL next &larr; DL next: 24.<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">DL skipwords: ¬1 - t].<br></span><span class="tab"></span><span class="tab"></span><span class="small">"</span><span class="small italic">now reverse:  trailer, entity (1st), ... (last)</span><span class="small">"<br></span><span class="tab"></span><span class="tab"></span><span class="small">⇑EL &larr; (EL asArray◦(EL length to: 1 by: ¬1)) asStream]<br></span><span class="tab"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪PressFile under: &rsquo;Press File Support&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">PressFile classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"WidthTable"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;WidthTable&rsquo;<br></span><span class="tab"></span><span class="medium bold">subclassof: Object<br></span><span class="tab"></span><span class="medium bold">fields: &rsquo;name "&lt;String&gt; name of font family"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">pointsize "&lt;Integer&gt; size in points"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">face "&lt;Integer&gt; Press face code"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">min "&lt;Integer&gt; min character code in font"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">max "&lt;integer&gt; max character code in font"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">"Ascent, descent, and width are in micas"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">ascent "&lt;Integer&gt; max ascent of characters in font"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">descent "&lt;Integer&gt; NEGATIVE max descent of characters in font"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">widths "&lt;Vector of Integers&gt; widths of characters"<br></span><span class="tab"></span><span class="tab"></span><span class="medium bold">&rsquo;<br></span><span class="tab"></span><span class="medium bold">declare: &rsquo;tab WidthDict &rsquo;;<br></span><span class="tab"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Holds font parameters and width table for a Press font.  It knows how to load itself from FONTS.WIDTHS.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit<br></span><span class="tab"></span><span class="small">[WidthDict &larr; Dictionary init.<br></span><span class="tab"></span><span class="small">tab &larr; 500]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lookup </span><span class="small">| key font i [<br></span><span class="tab"></span><span class="small">key &larr; name + pointsize asString + (↪(&rsquo;&rsquo; &rsquo;I&rsquo; &rsquo;B&rsquo; &rsquo;BI&rsquo;)◦(face+1)).<br></span><span class="tab"></span><span class="small">font &larr; WidthDict lookup: key⇒ [⇑font]<br></span><span class="tab"></span><span class="small">self fontfrom: (dp0 oldFile: &rsquo;Fonts.Widths&rsquo;) readonly.<br></span><span class="tab"></span><span class="small">for⦂ i from: ↪(011 015 040) do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[i ≥ min and⦂ i ≤ max ⇒ [widths◦(i-min+1) &larr; 0]].<br></span><span class="tab"></span><span class="small">WidthDict insert: key with: self.<br></span><span class="tab"></span><span class="small">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">named: name pointsize: pointsize face: face</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">ascent </span><span class="small">[⇑ascent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">descent </span><span class="small">[⇑descent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">face </span><span class="small">[⇑face]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">max </span><span class="small">[⇑max]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">min </span><span class="small">[⇑min]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">name </span><span class="small">[⇑name]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pointsize </span><span class="small">[⇑pointsize]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">scan: strm until: width exceeds: maxw </span><span class="small">| char w [<br></span><span class="tab"></span><span class="small">while⦂ (char &larr; strm next) do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[char &lt; min ⇒<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">[char=040 or⦂ (char=015 or⦂ char=011) ⇒ [⇑char, width]<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">user notify: &rsquo;char too low&rsquo;]<br></span><span class="tab"></span><span class="tab"></span><span class="small">char &gt; max ⇒ [user notify: &rsquo;char too high&rsquo;]<br></span><span class="tab"></span><span class="tab"></span><span class="small">(w &larr; widths◦(char+1-min)) = 0 ⇒ [⇑char, width]<br></span><span class="tab"></span><span class="tab"></span><span class="small">(width &larr; width + w) &gt; maxw ⇒ [⇑true, width]<br></span><span class="tab"></span><span class="tab"></span><span class="small">].<br></span><span class="tab"></span><span class="small">⇑false, width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">space </span><span class="small">[⇑150]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tab </span><span class="small">[⇑tab]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tab &larr; t </span><span class="small">[tab &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading FONTS.WIDTHS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findfield: n on: file </span><span class="small">| IXH [<br></span><span class="tab"></span><span class="small">while⦂ [<br></span><span class="tab"></span><span class="tab"></span><span class="small">IXH &larr; file nextword.<br></span><span class="tab"></span><span class="tab"></span><span class="small">(IXH bits: (0 to: 3)) "type"<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">= 0 ⇒ [user notify: &rsquo;field not found&rsquo;];<br></span><span class="tab"></span><span class="tab"></span><span class="tab"></span><span class="small">≠ n]<br></span><span class="tab"></span><span class="small"> do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[file skipwords: (IXH land: 07777 "length") - 1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fontfrom: file </span><span class="small">| i code fam fmin fmax start len found w scale<br></span><span class="tab"></span><span class="small">[</span><span class="small italic">"find code for font family"</span><span class="small"><br></span><span class="tab"></span><span class="small">file reset. fam &larr; &rsquo;&rsquo;.<br></span><span class="tab"></span><span class="small">until⦂ (fam = name) do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self findfield: 1 on: file.<br></span><span class="tab"></span><span class="tab"></span><span class="small">code &larr; file nextword.<br></span><span class="tab"></span><span class="tab"></span><span class="small">fam &larr; file next: (len &larr; file next).<br></span><span class="tab"></span><span class="tab"></span><span class="small">file skip: 19 - len].<br></span><span class="tab"></span><span class="small italic">"now search for proper face"</span><span class="small"><br></span><span class="tab"></span><span class="small">found &larr; false.<br></span><span class="tab"></span><span class="small italic">"Convert from points to micas"</span><span class="small"><br></span><span class="tab"></span><span class="small">scale &larr; (pointsize asFloat * 2540 / 72) asInteger.<br></span><span class="tab"></span><span class="small">until⦂ found do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[self findfield: 4 on: file.<br></span><span class="tab"></span><span class="tab"></span><span class="small">found &larr; [file next = code].<br></span><span class="tab"></span><span class="tab"></span><span class="small">[file next ≠ face ⇒ [found &larr; false]].<br></span><span class="tab"></span><span class="tab"></span><span class="small">fmin &larr; file next.<br></span><span class="tab"></span><span class="tab"></span><span class="small">fmax &larr; file next.<br></span><span class="tab"></span><span class="tab"></span><span class="small">i &larr; file nextword. [i ≠ scale and: i ≠ 0 ⇒ [found &larr; false]].<br></span><span class="tab"></span><span class="tab"></span><span class="small">file skip: 4. start &larr; file nextword. file skip: 4].<br></span><span class="tab"></span><span class="small">scale &larr; [i ≠ 0 ⇒ [1 </span><span class="small italic">"don&rsquo;t need to scale"</span><span class="small">] pointsize asFloat * 254 / 7200].<br></span><span class="tab"></span><span class="small">min &larr; fmin. max &larr; fmax.<br></span><span class="tab"></span><span class="small italic">"get bb and x-tables"</span><span class="small"><br></span><span class="tab"></span><span class="small">file wordposition&larr; start+1.<br></span><span class="tab"></span><span class="small">descent &larr; 0 - (scale * file nextword) asInteger.<br></span><span class="tab"></span><span class="small">file nextword.<br></span><span class="tab"></span><span class="small">ascent &larr; (scale * file nextword) asInteger.<br></span><span class="tab"></span><span class="small">file nextword.<br></span><span class="tab"></span><span class="small">widths &larr; Vector new: (max - min + 1).<br></span><span class="tab"></span><span class="small">for⦂ i to: widths length do⦂<br></span><span class="tab"></span><span class="tab"></span><span class="small">[w &larr; file nextword.<br></span><span class="tab"></span><span class="tab"></span><span class="small">widths◦i &larr; [w &gt; 0 ⇒ [(scale * w) asInteger] 0]].<br></span><span class="tab"></span><span class="small">file close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪WidthTable under: &rsquo;Press File Support&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">WidthTable classInit</span></div>
  </body>
</html>
