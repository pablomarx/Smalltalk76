<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/IFS-File-System.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"ILFile"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ILFile&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: File<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: ILFilePool;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>An IFS file accessed through the Leaf protocol, 12/79</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Dictionary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">entryClass </span><span class="small">[⇑ILFilePage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>File</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit </span><span class="small">| i sym names ["ILFile classInit."<br><br></span><span class="tab" val="79"></span><span class="small">ILFilePool declare: ↪NotFound as: &rsquo;207&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">names &larr; ↪(<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">1011 (BadLeafHandle)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">02000 (AnswerBit)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0176000 (RequestBits)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0260 (LeafType)<br>"5-bit operations for left field command block word"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0 (Error Open Close Delete)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">6 (Read Write Reset)<br><br>"read/write modes"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0140 (SetEof "no holes, set eof")<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0200 (NoExtend "don&rsquo;t extend file on read or write")<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0100 (NoHoles "for writing past end")<br><br>"open file modes"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0163400 (WriteOld "read, write, extend, any explicit, highest")<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0103400 (ReadOld "read, any explicit, highest")<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0167600 (CreateNew "read, write, extend, create, any explicit, next")<br><br>"control codes for left half of pupID1 field"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0 (Data Ack Noop)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">5 (OpenConnection "if Reset")<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">9 (DestroyConnection Dally Quit BrokenConnection)) asStream.<br><br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: names do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ sym from: names next do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">ILFilePool declare: sym as: i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i &larr; i+1]]]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">close </span><span class="small">["ignore errors if file was readonly" self close: [type = read⇒ [false] &rsquo;close&rsquo;]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">close: e </span><span class="small">| p ["close file, possibly ignoring errors"<br></span><span class="tab" val="79"></span><span class="small">"for next open"<br></span><span class="tab" val="79"></span><span class="small">type &larr; read.<br></span><span class="tab" val="79"></span><span class="small">"shorten header block to first 2 words: command&length,  file handle"<br></span><span class="tab" val="79"></span><span class="small">p &larr; self newPage.<br></span><span class="tab" val="79"></span><span class="small">p length: ¬6.<br></span><span class="tab" val="79"></span><span class="small">self doCommand: Close page: p error: e]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">doCommand: com page: page error: e </span><span class="small">| in ecode [<br></span><span class="tab" val="79"></span><span class="small">page command: com.<br></span><span class="tab" val="79"></span><span class="small">while⦂ true do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"make sure connection is open"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">directory open.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">error &larr; nullString.<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[in &larr; directory socket sendPacket: page packet⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">in◦11 = BrokenConnection⇒ [ecode &larr; ¬1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"turn packet into a ILFilePage"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">in &larr; [(self entryClass new) dictionary: self; page: in].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"check if answer is of same type as request"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">((page header: 1) land: RequestBits) + AnswerBit =<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">((in header: 1) land: RequestBits)⇒ [⇑in]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">ecode &larr; in header: 2]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"no response?"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">ecode &larr; false].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"some kind of problem"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">com = Quit⇒ ["ignore" ⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[ecode ≡ false or⦂ ecode = ¬1⇒ ["make new connection" directory release]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">ecode = ¬1 or⦂ ecode = 1011⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"try again after some reinitializing"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"reopen file"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self reopen.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"init page with new handle only -- don&rsquo;t lose mode, length, etc."<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">page serialNumber: serialNumber]<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">error &larr; [ecode⇒ [e⇒ [self errorString: ecode] ecode asString]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">directory directory + &rsquo; not responding&rsquo;].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">e⇒ [self error: e "proceeding tries again"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑false]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">endFile: page </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"make sure we can write"<br></span><span class="tab" val="79"></span><span class="small">self writeMode: page.<br></span><span class="tab" val="79"></span><span class="small">"update length. this will end file with this page"<br></span><span class="tab" val="79"></span><span class="small">lastpn &larr; page pageNumber.<br></span><span class="tab" val="79"></span><span class="small">⇑self Write: page]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">errorString: errorCode </span><span class="small">| ef ename errorString notfound dollar cr [<br></span><span class="tab" val="79"></span><span class="small">[errorCode is: String⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">errorString &larr; errorCode.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">errorCode &larr; [(errorString◦1) isdigit⇒ [errorString asInteger] 0]]<br></span><span class="tab" val="79"></span><span class="small">errorString &larr; errorCode asString].<br><br></span><span class="tab" val="79"></span><span class="small">ename &larr; &rsquo;&lt;System&gt;Ifs.Errors&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">(self name compare: ename) = 2⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"recursion" ⇑errorString + &rsquo; (cannot access Ifs.Errors !!!)&rsquo;]<br><br></span><span class="tab" val="79"></span><span class="small">notfound &larr; errorString + &rsquo;</span><span class="tab" val="79"></span><span class="small">(error code not found)&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">errorCode ≤ 0⇒ [⇑notfound]<br><br></span><span class="tab" val="79"></span><span class="small">dollar &larr; &rsquo;$&rsquo;◦1. cr &larr; 015.<br></span><span class="tab" val="79"></span><span class="small">ef &larr; directory oldFile: ename.<br></span><span class="tab" val="79"></span><span class="small">ef readonly.<br></span><span class="tab" val="79"></span><span class="small">errorString &larr; false.<br><br></span><span class="tab" val="79"></span><span class="small">"scan through the errors file looking for lines of the form:<br>$$nn</span><span class="tab" val="79"></span><span class="small">some message<br>"<br></span><span class="tab" val="79"></span><span class="small">until⦂ errorString do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">ef skipTo: dollar⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">ef next = dollar⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"valid line"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">ef integerScan<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt; errorCode⇒ ["since errors are ordered" errorString &larr; notfound];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">= errorCode⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">errorString &larr; (String new: 200) asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">errorString print: errorCode.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">until⦂ (ef peek = dollar or⦂ ef peek = cr) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">errorString append: (ef upto: cr); space].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">errorString &larr; errorString contents]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"end of file"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">errorString &larr; notfound].<br><br></span><span class="tab" val="79"></span><span class="small">ef close.<br></span><span class="tab" val="79"></span><span class="small">⇑errorString]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findLastPage </span><span class="small">["already known from open" ⇑lastpn]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">open </span><span class="small">"do nothing. lastpn set by </span><span class="small bold">ILFileDirectory Find:</span><span class="small">"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Read: page </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">page pageNumber &gt; lastpn⇒ ["no page" ⇑false]<br></span><span class="tab" val="79"></span><span class="small">"don&rsquo;t extend beyond eof. length of page is 0, but request is for 512 bytes"<br></span><span class="tab" val="79"></span><span class="small">page mode: NoExtend; header: 5 &larr; 512 "self dataLength".<br></span><span class="tab" val="79"></span><span class="small">⇑self doCommand: Read page: page error: &rsquo;Read:&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">release </span><span class="small">[self close: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Write: page </span><span class="small">| pn [<br></span><span class="tab" val="79"></span><span class="small">(pn &larr; page pageNumber) &gt; (lastpn+1)⇒ [self error: &rsquo;illegal page number&rsquo;]<br><br></span><span class="tab" val="79"></span><span class="small">"make sure we can write"<br></span><span class="tab" val="79"></span><span class="small">self writeMode: page.<br><br></span><span class="tab" val="79"></span><span class="small">page mode: [pn ≥ lastpn⇒ [SetEof] NoHoles].<br></span><span class="tab" val="79"></span><span class="small">self doCommand: Write page: page error: &rsquo;Write:&rsquo;.<br><br></span><span class="tab" val="79"></span><span class="small">"file possibly extended"<br></span><span class="tab" val="79"></span><span class="small">[pn = (lastpn+1)⇒ [lastpn &larr; pn]].<br></span><span class="tab" val="79"></span><span class="small">⇑page]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">writeMode: page </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"make sure we can write on file"<br></span><span class="tab" val="79"></span><span class="small">type = write⇒ []<br></span><span class="tab" val="79"></span><span class="small">"turn on writing by closing and reopening file. eventually there might be<br></span><span class="tab" val="79"></span><span class="small">a simpler way to change file mode"<br></span><span class="tab" val="79"></span><span class="small">self close.<br></span><span class="tab" val="79"></span><span class="small">type &larr; write.<br></span><span class="tab" val="79"></span><span class="small">directory Find: self⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"file handle changed"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">page serialNumber: serialNumber]<br></span><span class="tab" val="79"></span><span class="small">self error: &rsquo;file failed to reopen&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>IFS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">allocatePage </span><span class="small">[⇑directory allocatePage]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪ILFile under: &rsquo;IFS File System&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">ILFile classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"ILFileDirectory"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ILFileDirectory&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: FileDirectory<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;userName userPassword isocket&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: ILFilePool;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>IFS directory, 12/79</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Dictionary</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Delete: file </span><span class="small">["delete a file (highest version)<br></span><span class="tab" val="79"></span><span class="small">shorten header block to 2 words: command&length,  file handle"<br></span><span class="tab" val="79"></span><span class="small">(file newPage) length: ¬6; doCommand: Delete error: &rsquo;Delete:&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">entryClass </span><span class="small">[⇑ILFile]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Find: file </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"since there can be many readers but only one writer, default mode is for<br></span><span class="tab" val="79"></span><span class="small">read only. writing will cause file to be closed and reopened for writing"<br></span><span class="tab" val="79"></span><span class="small">⇑self openFile: file mode: [file type = write⇒ [WriteOld] ReadOld]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">Insert: file </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">file type: write.<br></span><span class="tab" val="79"></span><span class="small">self openFile: file mode: CreateNew⇒ [⇑file]<br></span><span class="tab" val="79"></span><span class="small">file error: &rsquo;Insert: cannot create&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">obsolete </span><span class="small">[⇑isocket ≡ nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">open </span><span class="small">| page [<br></span><span class="tab" val="79"></span><span class="small">isocket ≡ nil "self obsolete"⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[isocket &larr; ILSocket new hostName: directory "name of IFS/Leaf server"⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">isocket &larr; nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user notify: directory + &rsquo; (name not found)&rsquo;].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">super open.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">page &larr; self newPage.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"treat packet in page as a parameter block"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(ILParameterBlock new)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">packet &larr; page packet;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextword &larr; 0; "host number (0 = this, ¬1 = all)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextString &larr; self userName;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextString  &larr; self userPassword.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">page doCommand: Reset error: false⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">isocket &larr; nil.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;open (reset)&rsquo;<br></span><span class="tab" val="79"></span><span class="small">]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">release </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">self obsolete⇒ []<br></span><span class="tab" val="79"></span><span class="small">"shorten header block to 0 words.<br></span><span class="tab" val="79"></span><span class="small">DestroyConnection. after this the connection is gone"<br></span><span class="tab" val="79"></span><span class="small">(self newPage) length: ¬10; doCommand: Quit error: false.<br><br></span><span class="tab" val="79"></span><span class="small">isocket close.<br></span><span class="tab" val="79"></span><span class="small">isocket &larr; nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">versionNumbers </span><span class="small">[⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>IFS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">allocatePage </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[isocket≡nil⇒ [self open]].<br></span><span class="tab" val="79"></span><span class="small">"return a packet to be used by ILFilePage"<br></span><span class="tab" val="79"></span><span class="small">⇑isocket freePacket]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">name: userName password: userPassword</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">noAck </span><span class="small">["an optimization for intense ether activity" isocket noAck]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">openFile: file mode: m </span><span class="small">| page [<br></span><span class="tab" val="79"></span><span class="small">"open bit modes<br></span><span class="tab" val="79"></span><span class="small">read<br></span><span class="tab" val="79"></span><span class="small">write<br></span><span class="tab" val="79"></span><span class="small">extend<br></span><span class="tab" val="79"></span><span class="small">multiple (0)<br></span><span class="tab" val="79"></span><span class="small">create name<br></span><span class="tab" val="79"></span><span class="small">explicit version in name (2b)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">no, old, next or old, any<br></span><span class="tab" val="79"></span><span class="small">default (if no version specified) (2b)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">no, lowest, highest, next<br></span><span class="tab" val="79"></span><span class="small">unused (7b)"<br><br></span><span class="tab" val="79"></span><span class="small">self open.<br></span><span class="tab" val="79"></span><span class="small">page &larr; file newPage.<br></span><span class="tab" val="79"></span><span class="small">"treat packet in page as a parameter block"<br></span><span class="tab" val="79"></span><span class="small">(ILParameterBlock new)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">packet &larr; page packet;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextword &larr; 0; "file handle"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextword &larr; m; "modes"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextString &larr; self userName;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextString  &larr; self userPassword;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextString &larr; &rsquo;&rsquo;; "connect name"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextString &larr; &rsquo;&rsquo;; "connect password"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextString &larr; self checkName: file name.<br><br></span><span class="tab" val="79"></span><span class="small">"answer bits (in page header: 5)<br></span><span class="tab" val="79"></span><span class="small">same (5b)<br></span><span class="tab" val="79"></span><span class="small">version (4b)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">bad, default lowest, default highest, default next, !*, !L, !H, !N, explicit old, explicit lowest, explicit highest, explicit next, explicit new, explicit-less, explicit between, explicit greater"<br><br></span><span class="tab" val="79"></span><span class="small">page &larr; file doCommand: Open page: page error: false⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">file serialNumber: page serialNumber.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"open returns file length"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">file lastPage: (page pageNumber - [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">((page header: 4) land: 0777) =0⇒ ["full last page" 1] 0] max: 1)]<br><br></span><span class="tab" val="79"></span><span class="small">file error = NotFound⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small">⇑file error: &rsquo;open &rsquo; + (file errorString: file error)<br>]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">socket </span><span class="small">[⇑isocket]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">userName </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">userName ≡ nil or⦂ userName empty⇒ [⇑super userName]<br></span><span class="tab" val="79"></span><span class="small">⇑userName]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">userPassword </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">userPassword ≡ nil or⦂ userPassword empty⇒ [⇑super userPassword]<br></span><span class="tab" val="79"></span><span class="small">⇑userPassword]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪ILFileDirectory under: &rsquo;IFS File System&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"ILFilePage"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ILFilePage&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: EtherFilePage<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: ILFilePool;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>12/79, SAW.<br>Format of header is generally (for read/write)<br>1 operation (5 bits opcode, 1 bits request/answer, 10 bits inclusive byte length of block<br>2 file handle<br>3&4 byte address (mode in high 5 bits)<br>5 byte length</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>FilePage</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">headerLength </span><span class="small">[⇑34 "4+20+10"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small">["valid for read or write" ⇑self header: 5]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length: len </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"10 bytes in a normal header block. ILParameterBlock can change things.<br></span><span class="tab" val="79"></span><span class="small">also negative lengths can shorten it and change pupLength"<br><br></span><span class="tab" val="79"></span><span class="small">"length of command block, including data"<br></span><span class="tab" val="79"></span><span class="small">self header: 1 &larr; 10 + len.<br></span><span class="tab" val="79"></span><span class="small">"number of data bytes to read/write"<br></span><span class="tab" val="79"></span><span class="small">self header: 5 &larr; len.<br></span><span class="tab" val="79"></span><span class="small">"set pupLength"<br></span><span class="tab" val="79"></span><span class="small">super length: len]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pageNumber </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"extract page number from 27-bit byte address. ignore high 5 mode bits.<br></span><span class="tab" val="79"></span><span class="small">dividing byte adress (which may be a LargeInteger) by self dataLength (512)<br></span><span class="tab" val="79"></span><span class="small">is the correct but slow way to do this. byte address 0 = page 1"<br></span><span class="tab" val="79"></span><span class="small">⇑(((self header: 3) land: 03777) * 0200 "lshift: 7, maybe large") +<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">((self header: 4) lshift: ¬9) + 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pageNumber: pn </span><span class="small">["inverse of </span><span class="small bold">pageNumber</span><span class="small">. set 5 mode bits to 0"<br></span><span class="tab" val="79"></span><span class="small">pn &larr; pn-1.<br></span><span class="tab" val="79"></span><span class="small">self header: 3 &larr; pn / 0200 "lshift: ¬7, except for large pn".<br></span><span class="tab" val="79"></span><span class="small">self header: 4 &larr; pn lshift: 9]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">serialNumber </span><span class="small">| sn [<br></span><span class="tab" val="79"></span><span class="small">sn &larr; String new: 4.<br></span><span class="tab" val="79"></span><span class="small">sn◦1 &larr; sn◦2 &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">sn word: 2 &larr; self header: 2.<br></span><span class="tab" val="79"></span><span class="small">⇑sn]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">serialNumber: sn </span><span class="small">[self header: 2 &larr; sn word: 2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>IFS</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">command: com </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"operation word (header 1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0-4<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">opcode<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">5<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">0 request<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">1 answer<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">6-15<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">inclusive byte length of operation block"<br><br></span><span class="tab" val="79"></span><span class="small">page pupType &larr; LeafType.<br><br></span><span class="tab" val="79"></span><span class="small">"make operation a request, preserve length set earlier"<br></span><span class="tab" val="79"></span><span class="small">page◦25 &larr; (page◦25 land: 3) + (com lshift: 3).<br><br></span><span class="tab" val="79"></span><span class="small">"left half pupID1"<br></span><span class="tab" val="79"></span><span class="small">page◦11 &larr; [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">com = Reset⇒ [OpenConnection]; = Quit⇒ [DestroyConnection] Data]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">mode: m </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">current meaning of 5 read/write bits (from high to low):<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">0-1<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">0 read or write anywhere<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">1 no holes (read or write) zeros past end<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">2 don&rsquo;t extend on read or write<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">3 check extend (Error)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">2<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">1 set eof<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">3-4<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">0 undefined</span><span class="small">"<br><br></span><span class="tab" val="79"></span><span class="small">"m is a byte which is already shifted"<br></span><span class="tab" val="79"></span><span class="small">page◦29 &larr; (page◦29 land: 7) + m]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪ILFilePage under: &rsquo;IFS File System&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"ILParameterBlock"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ILParameterBlock&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;packet position&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: ILFilePool;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>for passing parameters to IFS. primarily used by ILFileDirectory open & openFile:</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">packet &larr; packet </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"default is an empty (data) packet, except first header word"<br></span><span class="tab" val="79"></span><span class="small">self position: 26]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Changing values</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextString &larr; s </span><span class="small">| strm [<br></span><span class="tab" val="79"></span><span class="small">strm &larr; packet pupString asStream.<br></span><span class="tab" val="79"></span><span class="small">strm skip: position; nextword &larr; s length; append: s; padNext &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">self position: strm position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextword &larr; w </span><span class="small">| strm [<br></span><span class="tab" val="79"></span><span class="small">strm &larr; packet pupString asStream.<br></span><span class="tab" val="79"></span><span class="small">strm skip: position; nextword &larr; w.<br></span><span class="tab" val="79"></span><span class="small">self position: strm position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">position: position </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"changing length of data in packet"<br></span><span class="tab" val="79"></span><span class="small">packet pupLength &larr; position - 2.<br></span><span class="tab" val="79"></span><span class="small">"set inclusive byte length in first command word; rest set later"<br></span><span class="tab" val="79"></span><span class="small">packet word: 13 &larr; position - 24]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪ILParameterBlock under: &rsquo;IFS File System&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"ILSocket"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ILSocket&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: RetransmitSocket<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;seqNum outPac result abortTransfer outAck&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">sharing: ILFilePool;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>for communicating with a Leaf socket on an IFS server, 12/79</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Socket</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">net: n host: h </span><span class="small">["usually called by </span><span class="small bold">hostName:</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">seqNum &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">super net: n host: h soc: 043 asInt32.<br></span><span class="tab" val="79"></span><span class="small">self retransmit: 8 every: [n = NETNUM⇒ ["same net" 400] 1800].<br></span><span class="tab" val="79"></span><span class="small">self setAck]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">noAck </span><span class="small">["if acknowledgements are not needed" outAck &larr; false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sendPacket: outPac </span><span class="small">| nseq [<br></span><span class="tab" val="79"></span><span class="small">"send a packet, wait for result, and acknowledge.<br></span><span class="tab" val="79"></span><span class="small bold">RetransmitSocket setAddressesAndComplete:</span><span class="small"> sets timer<br></span><span class="tab" val="79"></span><span class="small bold">ILSocket socProcess:</span><span class="small"> receives answers<br></span><span class="tab" val="79"></span><span class="small bold">ILSocket timerFired</span><span class="small"> handles retransmissions"<br><br></span><span class="tab" val="79"></span><span class="small">result &larr; abortTransfer &larr; false.<br></span><span class="tab" val="79"></span><span class="small">"alloc, receiver seq"<br></span><span class="tab" val="79"></span><span class="small">outPac pupID0 &larr; <br></span><span class="tab" val="79"></span><span class="small">"command, send seq"<br></span><span class="tab" val="79"></span><span class="small">outPac◦12 &larr; "pupID1 &larr; (outPac pupID1 land: 0177400) +" seqNum.<br></span><span class="tab" val="79"></span><span class="small">self setAddressesAndComplete: outPac.<br><br></span><span class="tab" val="79"></span><span class="small">"while waiting for packet to arrive, set up ack"<br></span><span class="tab" val="79"></span><span class="small">nseq &larr; (seqNum +1) \ 256.<br></span><span class="tab" val="79"></span><span class="small">[outPac◦11 = DestroyConnection⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"assume reply will be Dally. send Quit to shut down connection a little faster"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[outAck⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"create ack"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self setAck.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">outAck pupID0 &larr; outAck◦12 &larr; seqNum].<br><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">outAck◦11 &larr; Quit.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">retransMax &larr; 0.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"same sequence numbers as previous"]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">outAck⇒ ["acknowledgement for Open & Data"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">outAck pupID0 &larr; outAck◦12 &larr; nseq]<br><br></span><span class="tab" val="79"></span><span class="small">"in rapid interchanges, the next request is an implicit ack, so it&rsquo;s faster not to send one. however, packets unacknowledged for ~5 secs. at the server end can cause degraded performance"].<br> <br></span><span class="tab" val="79"></span><span class="small">"now wait for </span><span class="small bold">socProcess:</span><span class="small"> to set result, or </span><span class="small bold">timerFired</span><span class="small"> to set abortTransfer"<br></span><span class="tab" val="79"></span><span class="small">until⦂ (result or⦂ abortTransfer) do⦂ [].<br><br></span><span class="tab" val="79"></span><span class="small">[result⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">seqNum &larr; nseq.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">outAck⇒ ["send ack" self completePup: outAck]]].<br></span><span class="tab" val="79"></span><span class="small">⇑result]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setAck </span><span class="small">["create acknowledgement packet"<br></span><span class="tab" val="79"></span><span class="small">outAck &larr; self freePacket.<br></span><span class="tab" val="79"></span><span class="small">outAck pupType &larr; LeafType.<br></span><span class="tab" val="79"></span><span class="small">outAck dataString &larr; &rsquo;&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">"control code"<br></span><span class="tab" val="79"></span><span class="small">outAck◦11 &larr; Ack.<br></span><span class="tab" val="79"></span><span class="small">self setAddresses: outAck]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">socProcess: Ipac </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"check if this is a packet we want. normally left half of pupID1 = Data (0).<br></span><span class="tab" val="79"></span><span class="small">in case of DestroyConnection, control code might be Dallying (10)"<br><br></span><span class="tab" val="79"></span><span class="small">Ipac◦12 "pupID1" = seqNum and⦂ Ipac pupType = LeafType⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"turn off timer, save result"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self timerOff.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">result &larr; Ipac]<br><br></span><span class="tab" val="79"></span><span class="small">"recycle packet"<br></span><span class="tab" val="79"></span><span class="small">self freePacket: Ipac]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">timerFired </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"timer has fired -- retransmit or abort"<br><br></span><span class="tab" val="79"></span><span class="small">result or⦂ abortTransfer⇒ ["bug?--timer may not have been disabled yet"]<br><br></span><span class="tab" val="79"></span><span class="small">self timerOn⇒ ["retransmit" self completePup: outPac]<br><br></span><span class="tab" val="79"></span><span class="small">"abort"<br></span><span class="tab" val="79"></span><span class="small">abortTransfer &larr; true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪ILSocket under: &rsquo;IFS File System&rsquo;.</span></div>
  </body>
</html>
