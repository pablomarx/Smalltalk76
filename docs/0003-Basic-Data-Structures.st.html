<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Basic-Data-Structures.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"Array"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Array&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Array is an abstract class in the sense that it has no state, and instantiation is consequently not meaningful.  However it defines the default message set inherited by its subclasses, notably String, Vector, and UniqueString.  Notice that subscripting is not done here, except to handle the exceptional cases such as subscripting by other types as in a◦(1 to: 3).</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ x<br></span><span class="tab" val="79"></span><span class="small">[⇑x subscripts: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ x &larr; val<br></span><span class="tab" val="79"></span><span class="small">[⇑x subscripts: self &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&lt; v </span><span class="small italic">"for sorting vectors by first element"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑(self◦1)&lt;(v◦1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= arg </span><span class="small">| x<br></span><span class="tab" val="79"></span><span class="small">[arg isArray⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self length ≠ arg length⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ x to: self length do⦂ <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[(self◦x) = (arg◦x)⇒ [] ⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑true]<br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&gt; v </span><span class="small italic">"for sorting vectors by first element"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑(self◦1)&gt;(v◦1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">all &larr; val </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self◦i &larr; val]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">last<br></span><span class="tab" val="79"></span><span class="small">[⇑self◦self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">last &larr; val<br></span><span class="tab" val="79"></span><span class="small">[⇑self◦self length &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length  </span><span class="small">[user notify: &rsquo;message not understood.&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Copying and Altering</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">+ arg </span><span class="small">[⇑self concat: arg]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">concat: arg </span><span class="small">| x s [<br></span><span class="tab" val="79"></span><span class="small">x &larr; self species new: self length + arg length.<br></span><span class="tab" val="79"></span><span class="small">self copyto: (s &larr; x asStream).<br></span><span class="tab" val="79"></span><span class="small">arg copyto: s.<br></span><span class="tab" val="79"></span><span class="small">⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy<br></span><span class="tab" val="79"></span><span class="small">[⇑self copy: 1 to: self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy: a to: b<br></span><span class="tab" val="79"></span><span class="small">[⇑self copy: a to: b to: (self species new: b-a+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy: a to: b to: t </span><span class="small">| i s me<br></span><span class="tab" val="79"></span><span class="small">[s &larr; t asStream.<br></span><span class="tab" val="79"></span><span class="small">me &larr; Stream new of: self from: a to: b.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: a to: b do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"general code wont stop at false"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[s next &larr; me next]<br></span><span class="tab" val="79"></span><span class="small">⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copyto: t<br></span><span class="tab" val="79"></span><span class="small">[⇑self copy: 1 to: self length to: t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">delete: obj </span><span class="small">| s each<br></span><span class="tab" val="79"></span><span class="small">[s &larr; (self species new: self length) asStream.<br></span><span class="tab" val="79"></span><span class="small">for⦂ each from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[obj=each⇒[] s next&larr; each]<br></span><span class="tab" val="79"></span><span class="small">⇑ s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">grow </span><span class="small">[⇑self growto: (4 max: self length*2)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growby: n </span><span class="small">[⇑self growto: self length + n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growto: n </span><span class="small">[⇑self "copyto:" copy: 1 to: self length to: (self species new: n)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insertNonDescending: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"self is assumed to be sorted"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self insertSorted: x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insertSorted: x </span><span class="small">| a c i</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"self is assumed to be sorted"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[i &larr; self findSorted: x.<br></span><span class="tab" val="79"></span><span class="small">c &larr; (a &larr; self species new: self length+1) asStream.<br></span><span class="tab" val="79"></span><span class="small">self◦(1 to: i) copyto: c. c next &larr; x. self◦(i+1 to: self length) copyto: c.<br></span><span class="tab" val="79"></span><span class="small">⇑a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">notNil </span><span class="small">| t i  </span><span class="small italic">"copy self (which contains no falses) removing all nils"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[t &larr; (self species new: (self length-(self count: nil))) asStream.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: self do⦂ [i≡nil ⇒[] t next&larr; i].<br></span><span class="tab" val="79"></span><span class="small">⇑t asArray]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">replace: a to: b by: s </span><span class="small">| x xs<br></span><span class="tab" val="79"></span><span class="small">[x &larr; self species new: self length+s length -(1+b-a).<br></span><span class="tab" val="79"></span><span class="small">xs &larr; x asStream.<br></span><span class="tab" val="79"></span><span class="small">self copy: 1 to: a-1 to: xs.<br></span><span class="tab" val="79"></span><span class="small">s copy: 1 to: s length to: xs.<br></span><span class="tab" val="79"></span><span class="small">self copy: b+1 to: self length to: xs.<br></span><span class="tab" val="79"></span><span class="small">⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">without: index </span><span class="small">| s me i  </span><span class="small italic">"if index in range, return self without ◦index"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[index cansubscript: self⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[s &larr; (self species new: self length-1) asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">me &larr; self asStream.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ i to: self length do⦂ [i=index⇒ [me next] s next &larr; me next].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑s asArray]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">all⦂ variable suchThat⦂ expr </span><span class="small">| s i x  </span><span class="small italic">"a copy of some of me"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[s &larr; (self species new: self length) asStream.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[x &larr; self◦i. variable value &larr; x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">expr eval⇒ [s next &larr; x]].<br></span><span class="tab" val="79"></span><span class="small">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">count: x </span><span class="small">| i n<br></span><span class="tab" val="79"></span><span class="small">[n&larr;0.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[x=(self◦i)⇒ [n&larr;n+1]].<br></span><span class="tab" val="79"></span><span class="small">⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">find⦂ x suchThat⦂ predicate </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[x value &larr; self◦i. predicate eval⇒ [⇑i]].<br></span><span class="tab" val="79"></span><span class="small">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">find: x </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self◦i=x⇒ [⇑i]].<br></span><span class="tab" val="79"></span><span class="small">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findnon: x </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self◦i≠x⇒ [⇑i]].<br></span><span class="tab" val="79"></span><span class="small">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findSorted: x </span><span class="small">| lo mid hi</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">" returns index of largest element ≤ x "<br></span><span class="tab" val="79"></span><span class="small">[hi &larr; self length+1.  lo &larr; 1.<br></span><span class="tab" val="79"></span><span class="small">while⦂ lo &lt; hi do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"binary search; self must be sorted"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self◦(mid&larr;lo+hi/2) &gt; x⇒[hi &larr; mid]  lo &larr; mid+1].<br></span><span class="tab" val="79"></span><span class="small">⇑hi-1]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">" 0≤result≤length "</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">first⦂ x suchThat⦂ predicate </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[x value &larr; self◦i. predicate eval⇒ [⇑self◦i]].<br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">has: x </span><span class="small">[⇑(self find: x)≠0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Permutation</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">permutationToSort<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"Return a Vector, permutation, such that self◦permutation is sorted nondescending.  Do not alter self."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑((self◦((1 to: self length) copy)) sort: 1 to: self length) map.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">promote: t </span><span class="small">| n<br></span><span class="tab" val="79"></span><span class="small">[n &larr; self find: t. n=0⇒ []<br></span><span class="tab" val="79"></span><span class="small">self◦(n to: 2 by: ¬1) &larr; self◦(n-1 to: 1 by: ¬1).<br></span><span class="tab" val="79"></span><span class="small">self◦1 &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">reverse</span><span class="tab" val="79"></span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[⇑Substring new data: self map: (self length to: 1 by: ¬1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sort<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"Permute my elements so they are sorted nondescending.  Note: if I am a substring, only my map will be permuted.  In certain situations, this may not be what you expect."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">self sort: 1 to: self length.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sort: i to: j </span><span class="small">| di dij dj tt ij k l n<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"Sort elements i through j of self to be nondescending."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="small italic">"The prefix d means the data at."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">(n&larr;j+1-i)≤1⇒ [</span><span class="small italic">"Nothing to sort."</span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small italic">"Sort di,dj."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">di &larr; self◦i. dj &larr; self◦j.<br></span><span class="tab" val="79"></span><span class="small">[di&gt;dj⇒ [self swap: i with: j. tt&larr;di. di&larr;dj. dj&larr;tt]].<br></span><span class="tab" val="79"></span><span class="small">n=2⇒ [</span><span class="small italic">"They are the only two elements."</span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small">ij &larr; (i+j) lshift: ¬1. </span><span class="small italic">"ij is the midpoint of i and j."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small italic">"Sort di,dij,dj.  Make dij be their median."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">dij &larr; self◦ij.<br></span><span class="tab" val="79"></span><span class="small">[di&gt;dij⇒ [self swap: i with: ij. dij&larr;di] dj&lt;dij⇒ [self swap: j with: ij. dij&larr;dj]].<br></span><span class="tab" val="79"></span><span class="small">n=3⇒ [</span><span class="small italic">"They are the only three elements."</span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small italic">"Find k&gt;i and l&lt;j such that dk,dij,dl are in reverse order.  Swap k and l.  Repeat this procedure until j and k pass each other."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">k &larr; i. l &larr; j.<br></span><span class="tab" val="79"></span><span class="small">while⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ self◦(l&larr;l-1) &gt; dij do⦂ [].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ self◦(k&larr;k+1) &lt; dij do⦂ [].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">k≤l<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small">do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self swap: k with: l].<br></span><span class="tab" val="79"></span><span class="small italic">"Now l&lt;k (either 1 or 2 less), and di through dl are all less than dk through dj.  Sort those two segments."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">self sort: i to: l.<br></span><span class="tab" val="79"></span><span class="small">self sort: k to: j.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">swap: i with: j </span><span class="small">| t<br></span><span class="tab" val="79"></span><span class="small">[t &larr; self◦i. self◦i &larr; self◦j. self◦j &larr; t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asSet </span><span class="small">[⇑Set new of: self to: self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asStream<br></span><span class="tab" val="79"></span><span class="small">[⇑Stream new of: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">frequencies </span><span class="small">| d x  </span><span class="small italic">"return a sorted vector ((freq item) (freq item) ...)"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[d &larr; Dictionary new init: 64.<br></span><span class="tab" val="79"></span><span class="small">for⦂ x from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[d tally: x].<br></span><span class="tab" val="79"></span><span class="small">⇑d asInvertedVector sort]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sum </span><span class="small">[⇑self sumTo: 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sumTo: subTotal </span><span class="small">| x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"add all my elements to this subTotal (usually 0 or 0.0)"<br></span><span class="tab" val="79"></span><span class="small">[for⦂ x from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[subTotal&larr; subTotal+x].<br></span><span class="tab" val="79"></span><span class="small">⇑subTotal]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">transform⦂ each to⦂ expr </span><span class="small">| s i  </span><span class="small italic">"a copy of me with each element transformed"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[s &larr; (self species new: self length) asStream.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[each value &larr; self◦i. s next &larr; expr eval].<br></span><span class="tab" val="79"></span><span class="small">⇑s asArray]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">viewer </span><span class="small">[⇑SetReader new of: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Mapping</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">cansubscript: a </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[for⦂ i from: self do⦂ [i cansubscript: a⇒ [] ⇑false]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">subscripts: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"subarrays"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑Substring new data: x map: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">subscripts: x &larr; val</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"subrange replacement"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self length≠val length⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[user notify: &rsquo;lengths not commensurate&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">val copyto: (Substring new data: x map: self).<br></span><span class="tab" val="79"></span><span class="small">⇑val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isArray</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isIntervalBy1<br></span><span class="tab" val="79"></span><span class="small">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">species<br></span><span class="tab" val="79"></span><span class="small">[⇑Vector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Comparing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small italic">"make sure = arrays hash =ly"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self length=0⇒[⇑17171]<br></span><span class="tab" val="79"></span><span class="small">⇑(self◦1) hash + (self◦self length) hash]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Array under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"FieldReference"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;FieldReference&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;object offset&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>I reference a field of an instance</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">object: object offset: offset</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Indirection</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">eval <br></span><span class="tab" val="79"></span><span class="small">[⇑object instfield: offset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">value </span><span class="small">[⇑object instfield: offset]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">value &larr; value<br></span><span class="tab" val="79"></span><span class="small">[object instfield: offset &larr; value. ⇑value]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪FieldReference under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Interval"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Interval&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Array<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;start stop step length&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>I am an arithmetic progression from start in steps of step, not exceeding stop</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">from: start to: stop by: step<br></span><span class="tab" val="79"></span><span class="small">[length &larr; 1+(stop-start/step).<br></span><span class="tab" val="79"></span><span class="small">step&lt;0⇒[start&lt;stop⇒[length&larr; 0]]<br></span><span class="tab" val="79"></span><span class="small">stop&lt;start⇒[length&larr; 0]<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ x<br></span><span class="tab" val="79"></span><span class="small">[x is: Integer⇒[x&lt;1⇒ [⇑nil]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">x&gt;length⇒ [⇑nil]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑start+(step*(x-1))]<br></span><span class="tab" val="79"></span><span class="small">⇑super◦x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ x &larr; val<br></span><span class="tab" val="79"></span><span class="small">[user notify: &rsquo;Intervals are not for writing into&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small">[⇑length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">start </span><span class="small">[⇑start]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">stop </span><span class="small">[⇑stop]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= int </span><span class="small">[⇑start = int start and⦂ (stop = int stop and⦂ length = int length)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">cansubscript: a<br></span><span class="tab" val="79"></span><span class="small">[⇑length≤0 or⦂ ((start cansubscript: a) and⦂ (length-1*step+start cansubscript: a))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small">[⇑(((start lshift: 2) lxor: stop) lshift: 1) lxor: length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isIntervalBy1<br></span><span class="tab" val="79"></span><span class="small">[⇑step=1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Random Numbers</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">random</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"See Lehmers linear congruential method, Knuth Vol. 1:<br></span><span class="tab" val="79"></span><span class="small italic">modulus m=2&uarr;16<br></span><span class="tab" val="79"></span><span class="small italic">a=27181 odd, and 5 = a mod 8<br></span><span class="tab" val="79"></span><span class="small italic">c=13849 odd, and c/m around 0.21132"</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[step&larr; (13849 + (27181*step)) asSmall.<br></span><span class="tab" val="79"></span><span class="small">⇑(start + ((length asFloat*(32768.0+step))/65536.0)) asSmall]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">randomInit </span><span class="small">[self randomInit: mem◦0430]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">randomInit: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"Call with const to get repeatable sequence"</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[step&larr; x.</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"step holds the current state"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">start is: Float⇒[length&larr;stop-start]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"for Float intervals"</span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Interval under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"ObjectReference"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;ObjectReference&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;object&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>I am an indirect reference</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">object: object</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Indirection</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">eval <br></span><span class="tab" val="79"></span><span class="small">[⇑object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">value </span><span class="small">[⇑object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">value &larr; object<br></span><span class="tab" val="79"></span><span class="small">[⇑object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm<br></span><span class="tab" val="79"></span><span class="small">[strm append: &rsquo;-&gt;&rsquo;; print: object]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪ObjectReference under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"RunVector"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;RunVector&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Array<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo; min max starts values offset&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>RunVectors compactly store data which tends to be constant over much<br>of its domain.  They may have any range of subscript, but must be stored<br>into consecutively.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading and writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦i | index</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[index&larr; starts findSorted: i.<br></span><span class="tab" val="79"></span><span class="small">offset&larr; i-(starts◦index).</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"distance into run"<br></span><span class="tab" val="79"></span><span class="small">⇑values◦index]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦i&larr; val<br></span><span class="tab" val="79"></span><span class="small">[offset&larr; 0.<br></span><span class="tab" val="79"></span><span class="small">min≡nil⇒[min&larr; max&larr; i. starts&larr; i inVector. values&larr; val inVector]<br></span><span class="tab" val="79"></span><span class="small">i-1≠max⇒[user notify: &rsquo;RunVectors must be loaded sequentially&rsquo;. ⇑val]<br></span><span class="tab" val="79"></span><span class="small">max&larr; i.<br></span><span class="tab" val="79"></span><span class="small">val=values last⇒[offset&larr; i-starts last. ⇑val]<br></span><span class="tab" val="79"></span><span class="small">starts&larr; starts , i.<br></span><span class="tab" val="79"></span><span class="small">values&larr; values , val. ⇑val]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small">[max≡nil⇒[⇑0]<br></span><span class="tab" val="79"></span><span class="small">⇑max-min+1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">max </span><span class="small">[⇑max]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">min </span><span class="small">[⇑min]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪RunVector under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Stream"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Stream&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;array position limit&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Streams provide fast sequential access to arrays (implemented in microcode for Strings and Vectors).  A subclass can handle end conditions if desired (disk files do this).</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">close<br></span><span class="tab" val="79"></span><span class="small">[limit&larr; position. position&larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">default<br></span><span class="tab" val="79"></span><span class="small">[self of: (String new: 16)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: array<br></span><span class="tab" val="79"></span><span class="small">[position &larr; 0. limit &larr; array length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: array from: pos to: lim </span><span class="small">| len</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[limit &larr; [lim &gt; (len &larr; array length)⇒ [len] lim].<br></span><span class="tab" val="79"></span><span class="small">position &larr; [pos≤1⇒ [0] pos-1]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">release </span><span class="small">[array &larr; nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Sequential reading and writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">∢ x </span><span class="small">| y<br></span><span class="tab" val="79"></span><span class="small">[y&larr; self next⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"peek for matching element"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[x=y⇒ [⇑y]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"gobble it if found"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">position &larr; position-1. ⇑false]<br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">append: x </span><span class="small">| i</span><span class="tab" val="79"></span><span class="small italic">"Array arg"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[for⦂ i from: x do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self next &larr; i].<br></span><span class="tab" val="79"></span><span class="small">⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dequeue</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"use it as a FIFO"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self dequeue: 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dequeue: n </span><span class="small">| t<br></span><span class="tab" val="79"></span><span class="small">[position&lt;n⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small">t &larr; (array◦(1 to: n)) copy.<br></span><span class="tab" val="79"></span><span class="small">array◦(1 to: position-n) &larr; array◦(n+1 to: position).<br></span><span class="tab" val="79"></span><span class="small">position &larr; position-n. ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">integerScan </span><span class="small">| sign base maxdigit c val [<br></span><span class="tab" val="79"></span><span class="small">"get the next Integer or LargeInteger (Float?) from a Stream.<br></span><span class="tab" val="79"></span><span class="small">copied from String asInteger"<br><br></span><span class="tab" val="79"></span><span class="small">sign&larr; [self∢025⇒[¬1] 1].<br></span><span class="tab" val="79"></span><span class="small">base&larr; [self∢060⇒[8] 10].<br></span><span class="tab" val="79"></span><span class="small">maxdigit&larr; 060+base.<br></span><span class="tab" val="79"></span><span class="small">val&larr; 0.<br><br></span><span class="tab" val="79"></span><span class="small">while⦂ ((c &larr; self next) and⦂ (c ≥ 060 and⦂ c &lt; maxdigit)) do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">val&larr; val*base+(c-060)].<br></span><span class="tab" val="79"></span><span class="small">[c⇒ [self skip: ¬1]].<br><br></span><span class="tab" val="79"></span><span class="small">"Some special maneuvering to keep 01ddddd and ¬32768 (and nothing else)<br></span><span class="tab" val="79"></span><span class="small">from overflowing."<br></span><span class="tab" val="79"></span><span class="small">base=8 and⦂ (val&gt;077777 and⦂ (sign=1 and⦂ val&lt;65536))⇒[⇑val asSmall]<br></span><span class="tab" val="79"></span><span class="small">⇑(val*sign) asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">into: x </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"generate an error if the Stream is exhausted before x is filled"<br></span><span class="tab" val="79"></span><span class="small">⇑self into: x endError: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: justify">
<span class="small bold">into: x endError: err </span><span class="small">| i t len [</span><span class="small italic">"Array result"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">i &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">len &larr; x length.<br></span><span class="tab" val="79"></span><span class="small">"read until count or stream is exhausted"<br></span><span class="tab" val="79"></span><span class="small">while⦂ (i &lt; len and⦂ (t &larr; self next)) do⦂ [x◦(i&larr;i+1) &larr;t].<br><br></span><span class="tab" val="79"></span><span class="small">err⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">t⇒ [⇑x]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;only read first &rsquo; + i asString]<br><br></span><span class="tab" val="79"></span><span class="small">"return number that were read"<br></span><span class="tab" val="79"></span><span class="small">⇑i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next</span><span class="tab" val="79"></span><span class="small italic">"simple result"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self myend⇒ [⇑self pastend]<br></span><span class="tab" val="79"></span><span class="small">⇑array◦(position &larr; position+1)] primitive: 17</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next: n </span><span class="small">[⇑self into: (array species new: n) endError: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next: n from: strm </span><span class="small">[for⦂ n to: n do⦂ [self next &larr; strm next]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next: n &larr; v </span><span class="small">[for⦂ n to: n do⦂ [self next &larr; v]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextNumber: n </span><span class="small">| i s t [<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">return next n characters s as a positive Integer or LargeInteger</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">s &larr; false.<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">scan for first non-zero byte, then collect rest appropriately</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: n do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">t &larr; self next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">s⇒ ["</span><span class="small italic">more LargeInteger: reverse order of significance</span><span class="small">" s◦(n+1-i) &larr; t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i=n⇒ [⇑t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">t=0⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i ≤ (n-2) or⦂ "i=n-1" (t land: 0200) ≠ 0⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">LargeInteger of 2 or more bytes</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">s &larr; Natural new: n+1-i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">s last &larr; t]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">positive Integer</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑(t lshift: 8) + self next].<br></span><span class="tab" val="79"></span><span class="small">⇑LargeInteger new bytes: s neg: false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextNumber: n &larr; v </span><span class="small">| vlen [<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">write a positive Integer or LargeInteger as n characters</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">v &larr; v bytes.<br></span><span class="tab" val="79"></span><span class="small">vlen &larr; v length.<br><br></span><span class="tab" val="79"></span><span class="small">[n &lt; vlen⇒ [user notify: &rsquo;number too big&rsquo;];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt; vlen⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">pad beginning with 0&rsquo;s</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self next: n - vlen &larr; 0]].<br><br></span><span class="tab" val="79"></span><span class="small">vlen = 1⇒ [self next &larr; v]<br></span><span class="tab" val="79"></span><span class="small">vlen = 2 and⦂ (v is: Integer)⇒ [self nextword &larr; v]<br><br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">LargeInteger (assume pos, no negative convention)</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">self append: v reverse]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextPoint </span><span class="small">| x [<br></span><span class="tab" val="79"></span><span class="small">x &larr; self nextword.<br></span><span class="tab" val="79"></span><span class="small">⇑Point new x: x y: self nextword]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextPoint&larr;p </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">self nextword &larr; p x;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">nextword &larr; p y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextString </span><span class="small">| len [<br></span><span class="tab" val="79"></span><span class="small">⇑self into: (String new: [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(len &larr; self next)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&lt;192⇒[len]</span><span class="tab" val="79"></span><span class="small italic">"up to 191 chars (BCPL compat)"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">len-192*256 + self next]) endError: true]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"up to 16383 chars"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextString&larr; s </span><span class="small">| len [<br></span><span class="tab" val="79"></span><span class="small">[(len &larr; s length) &lt; 192⇒[self next&larr; len]<br></span><span class="tab" val="79"></span><span class="small">self next&larr; len/256+192; next&larr; len\256].<br></span><span class="tab" val="79"></span><span class="small">self append: s.<br></span><span class="tab" val="79"></span><span class="small">⇑s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextword </span><span class="small">| hi lo<br></span><span class="tab" val="79"></span><span class="small">[hi &larr; self next⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[lo &larr; self next⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[⇑(hi lshift: 8)+lo]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑false]<br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nextword&larr; val<br></span><span class="tab" val="79"></span><span class="small">[self next&larr; val lshift: ¬8.<br></span><span class="tab" val="79"></span><span class="small">self next&larr; val land: 0377. ⇑val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next &larr; x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"simple arg"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self myend⇒ [⇑self pastend &larr; x]<br></span><span class="tab" val="79"></span><span class="small">⇑array◦(position &larr; position+1) &larr; x] primitive: 18</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">padNext </span><span class="small">["make position even (on word boundary), returning padding character if any"<br></span><span class="tab" val="79"></span><span class="small">position even⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small">⇑self next]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">padNext&larr; c </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">position even⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small">⇑self next&larr; c]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">peek </span><span class="small">| x<br></span><span class="tab" val="79"></span><span class="small">[x&larr; self next⇒ [position &larr; position-1.  ⇑x]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"peek at next element"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pop</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"use it as a LIFO"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[position&lt;1⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small">position &larr; position-1. ⇑array◦(position+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pop: n </span><span class="small">| t<br></span><span class="tab" val="79"></span><span class="small">[position&lt;n⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small">t &larr; self last: n.<br></span><span class="tab" val="79"></span><span class="small">position &larr; position-n. ⇑t]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">upto: x </span><span class="small">| y s<br></span><span class="tab" val="79"></span><span class="small">[s &larr; (String new: 250) asStream.<br></span><span class="tab" val="79"></span><span class="small">for⦂ y from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[y=x⇒[⇑s contents]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">s next &larr; y].<br></span><span class="tab" val="79"></span><span class="small">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Test and alter position</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">empty</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"for"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑position=0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">end<br></span><span class="tab" val="79"></span><span class="small">[⇑position≥limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">limit<br></span><span class="tab" val="79"></span><span class="small">[⇑limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">loc</span><span class="tab" val="79"></span><span class="small italic">"synonym for compiler"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">myend<br></span><span class="tab" val="79"></span><span class="small">[⇑position≥limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pastend<br></span><span class="tab" val="79"></span><span class="small">[⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pastend &larr; x<br></span><span class="tab" val="79"></span><span class="small">[array &larr; array grow. limit &larr; array length.<br></span><span class="tab" val="79"></span><span class="small">⇑self next &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">position<br></span><span class="tab" val="79"></span><span class="small">[⇑position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">position&larr; position</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">reset<br></span><span class="tab" val="79"></span><span class="small">[position &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">settoend </span><span class="small">[position&larr; limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skip: x<br></span><span class="tab" val="79"></span><span class="small">[position &larr; position+x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skipTo: x </span><span class="small">| y [<br></span><span class="tab" val="79"></span><span class="small">for⦂ y from: self do⦂ [y=x⇒[⇑true]].<br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skipwords: w </span><span class="small">[self skip: 2*w]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">wordposition </span><span class="small">[⇑self position/2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">wordposition&larr; w </span><span class="small">[self position&larr; w*2]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Static reading and writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ x<br></span><span class="tab" val="79"></span><span class="small">[⇑array◦x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ x &larr; val<br></span><span class="tab" val="79"></span><span class="small">[⇑array◦x &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">contents </span><span class="small">[⇑array copy: 1 to: position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">first<br></span><span class="tab" val="79"></span><span class="small">[position ≠ 0 ⇒ [⇑array◦1] ⇑nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: x </span><span class="small">| i  </span><span class="small italic">"treat as LIFO queue, insert in front"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">["</span><span class="small italic">grow array if necessary</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small"> [position=limit⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[array&larr;array grow.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">limit&larr;array length]].<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: position do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[array◦(position-i+2) &larr; array◦(position-i+1)].<br></span><span class="tab" val="79"></span><span class="small">array◦1 &larr; x.<br></span><span class="tab" val="79"></span><span class="small">position&larr;position+1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">last<br></span><span class="tab" val="79"></span><span class="small">[position≠ 0 ⇒ [⇑array◦position] ⇑nil]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">last: n<br></span><span class="tab" val="79"></span><span class="small">[⇑(array◦(position-n+1 to: position)) copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">rest </span><span class="small">[⇑array copy: position+1 to: limit]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Character printing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">cr<br></span><span class="tab" val="79"></span><span class="small">[self next &larr; 015]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">crtab: n </span><span class="small">| i</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[self next&larr;13.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: n do⦂ [self next&larr;9]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">print: obj<br></span><span class="tab" val="79"></span><span class="small">[obj printon: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">semicrtab<br></span><span class="tab" val="79"></span><span class="small">[self append: &rsquo;;<br></span><span class="tab" val="79"></span><span class="small">&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">space<br></span><span class="tab" val="79"></span><span class="small">[self next &larr; 040]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tab<br></span><span class="tab" val="79"></span><span class="small">[self next &larr; 011]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Coercions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asArray<br></span><span class="tab" val="79"></span><span class="small">[⇑array]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asReadStream </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"an alternative to Set/SetReader.<br></span><span class="tab" val="79"></span><span class="small">create another Stream which reads the contents of this one"<br></span><span class="tab" val="79"></span><span class="small">⇑Stream new of: array from: 1 to: position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asStream</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asVector </span><span class="small italic">"Convert a string to a vector of tokens"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑(Reader new of: self) read]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">viewer </span><span class="small">[⇑SetReader new of: array from: 1 to: position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compiler object code</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">emitLong: jmpOrBfp by: dist<br></span><span class="tab" val="79"></span><span class="small">[[dist&lt;0⇒ [dist&larr;dist+1024]; &gt;1023⇒ [dist&larr;¬1] jmpOrBfp&larr;jmpOrBfp+4].<br></span><span class="tab" val="79"></span><span class="small">dist&lt;0⇒ [user notify: &rsquo;A block compiles more than 1K bytes of code&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">self next &larr; dist/256 + jmpOrBfp. self next &larr; dist\256]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Stream under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"PQueue"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;PQueue&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Stream<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;readposition&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>A PQueue is a First In First Out list of objects implemented as an array and a read pointer and write pointer. PQueue is a subclass of Stream and uses Streamⓢstandard method for inserting a new item (next&larr;, i.e. Streamⓢposition is the write pointer). A PQueue also has a read pointer which it uses for accessing objects with the messages next or dequeue (which are identical). All messages to a PQueue that change its state are declared as critical sections to avoid race conditions</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>FIFO access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dequeue: num </span><span class="small">| n<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[position-readposition &lt; num ⇒ [n &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> n &larr; (array◦(readposition+1 to: readposition + num)) copy.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> readposition &larr; readposition + num].<br></span><span class="tab" val="79"></span><span class="small"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small">| l<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [l &larr; position-readposition]. ⇑l]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">myend </span><span class="small">[⇑true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next </span><span class="small">| n<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[readposition≥position⇒ [readposition&larr;position&larr;0. n &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> n &larr; array◦(readposition &larr; readposition+1)].<br></span><span class="tab" val="79"></span><span class="small"> ⇑n] primitive: 98</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pastend &larr; x</span><span class="tab" val="79"></span><span class="small bold"> </span><span class="small">| n i</span><span class="tab" val="79"></span><span class="small italic">"simple arg"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[position≥limit⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[readposition=0⇒[super pastend &larr; x]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> n &larr; position-readposition.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> for⦂ i to: n do⦂ [array◦i &larr; array◦(readposition+i)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> readposition &larr; 0. position &larr; n.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> self next &larr; x]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> array◦(position &larr; position+1) &larr; x].<br></span><span class="tab" val="79"></span><span class="small"> ⇑x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">peek </span><span class="small">| n<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[readposition≥position⇒ [readposition&larr;position&larr;0. n &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> n &larr; array◦(readposition + 1)].<br></span><span class="tab" val="79"></span><span class="small"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skip: x<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [readposition &larr; readposition+x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>LIFO access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">push: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"treat as LIFO queue"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[readposition &gt; 0 ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[array◦readposition &larr; x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> readposition &larr; readposition - 1]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"readpositon &gt; 0, just jam it in"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> self insert: x]]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"otherwise insert on front"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Stream protocol</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">contents </span><span class="small">| n<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [n &larr; (array◦(readposition+1 to: position)) copy]. ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">empty </span><span class="small">| l<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [l &larr; readposition≥position]. ⇑l] primitive: 99</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">end </span><span class="small">| n<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [n &larr; readposition≥position]. ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: array<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [position &larr; 0. readposition &larr; 0. limit &larr; array length]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: array from: position to: limit<br></span><span class="tab" val="79"></span><span class="small">[user notify: &rsquo;of:from:to: is not appropriate for PQueues&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">reset<br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [readposition &larr; position &larr; 0]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪PQueue under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Queue"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Queue&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Stream<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;readposition&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>A Queue is a First In First Out list of objects implemented as an array and a read pointer and write pointer. Queue is a subclass of Stream and uses Streamⓢstandard method for inserting a new item (next&larr;, i.e. Streamⓢposition is the write pointer). A Queue also has a read pointer which it uses for accessing objects with the messages next or dequeue (which are identical)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>FIFO access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">deQ1 </span><span class="small">| n</span><span class="tab" val="79"></span><span class="small italic">"A noninterruptable dequeue"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [n &larr; self dequeue].<br></span><span class="tab" val="79"></span><span class="small"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dequeue<br></span><span class="tab" val="79"></span><span class="small">[readposition≥position⇒ [readposition&larr;position&larr;0. ⇑false]<br></span><span class="tab" val="79"></span><span class="small"> ⇑array◦(readposition &larr; readposition+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dequeue: num </span><span class="small">| n<br></span><span class="tab" val="79"></span><span class="small">[position-readposition &lt; num ⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small"> n &larr; (array◦(readposition+1 to: readposition + num)) copy.<br></span><span class="tab" val="79"></span><span class="small"> readposition &larr; readposition + num.<br></span><span class="tab" val="79"></span><span class="small"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">enQ1: n</span><span class="tab" val="79"></span><span class="small italic">"A noninterruptable enqueue"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[Top critical⦂ [super next&larr; n].<br></span><span class="tab" val="79"></span><span class="small"> ⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length<br></span><span class="tab" val="79"></span><span class="small">[⇑position-readposition]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next<br></span><span class="tab" val="79"></span><span class="small">[readposition≥position⇒ [readposition&larr;position&larr;0. ⇑false]<br></span><span class="tab" val="79"></span><span class="small"> ⇑array◦(readposition &larr; readposition+1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">peek<br></span><span class="tab" val="79"></span><span class="small">[readposition≥position⇒ [readposition&larr;position&larr;0. ⇑false]<br></span><span class="tab" val="79"></span><span class="small"> ⇑array◦(readposition + 1)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">skip: x<br></span><span class="tab" val="79"></span><span class="small">[readposition &larr; readposition+x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>LIFO access</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">push: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"treat as LIFO queue"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[readposition &gt; 0 ⇒<br></span><span class="tab" val="79"></span><span class="small">[array◦readposition &larr; x.  readposition &larr; readposition - 1]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"readpositon &gt; 0, just jam it in"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">self insert: x]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"otherwise insert on front"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Stream protocol</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">contents<br></span><span class="tab" val="79"></span><span class="small">[⇑(array◦(readposition+1 to: position)) copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">empty<br></span><span class="tab" val="79"></span><span class="small">[⇑readposition≥position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">end<br></span><span class="tab" val="79"></span><span class="small">[⇑readposition≥position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: array<br></span><span class="tab" val="79"></span><span class="small">[position &larr; 0. readposition &larr; 0. limit &larr; array length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: array from: position to: limit<br></span><span class="tab" val="79"></span><span class="small">[user notify: &rsquo;of:from:to: is not appropriate for Queues&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pastend &larr; x </span><span class="small">| n<br></span><span class="tab" val="79"></span><span class="small">[readposition=0⇒[⇑super pastend &larr; x]<br></span><span class="tab" val="79"></span><span class="small"> n &larr; position-readposition.<br></span><span class="tab" val="79"></span><span class="small"> array◦(1 to: n) &larr; array◦(readposition+1 to: position).<br></span><span class="tab" val="79"></span><span class="small"> readposition &larr; 0.<br></span><span class="tab" val="79"></span><span class="small"> position &larr; n.<br></span><span class="tab" val="79"></span><span class="small"> ⇑self next &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">reset<br></span><span class="tab" val="79"></span><span class="small">[readposition &larr; position &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Queue under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Set"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Set&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Stream<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;views&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>For storing/collecting, read by a SetReader.<br>Use no messages from Stream except of:, empty, next&larr;, contents, space, nextword&larr;</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">default </span><span class="small">[self vector: 8]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: array to: position </span><span class="small">[limit &larr; array length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">string: limit </span><span class="small">[self of: (String new: limit)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">vector: limit </span><span class="small">[self of: (Vector new: limit)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Index operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦i </span><span class="small">[⇑array◦("self checkIndex:" i)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦i &larr; val </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">position+1 = i⇒ [self next &larr; val]<br></span><span class="tab" val="79"></span><span class="small">⇑array◦("self checkIndex:" i) &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">deleteI: i </span><span class="small">| v j<br></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">v &larr; self◦i.<br></span><span class="tab" val="79"></span><span class="small">for⦂ j from: i to: position-1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[array◦j &larr; array◦(j+1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">array◦position &larr; nil.<br></span><span class="tab" val="79"></span><span class="small">position &larr; position-1.<br></span><span class="tab" val="79"></span><span class="small">⇑v<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">deleteI: i to: j</span><span class="small">| n k<br></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">n &larr; j-i+1.<br></span><span class="tab" val="79"></span><span class="small">for⦂ k from: i to: position-n do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[array◦k &larr; array◦(k+n)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">for⦂ k from: position-n+1 to: position do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[array◦k &larr; nil<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">position &larr; position-n.<br></span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insertI: i value: v </span><span class="small">| old j <br></span><span class="tab" val="79"></span><span class="small">[i &gt; position ⇒ [ self next &larr; v ]<br></span><span class="tab" val="79"></span><span class="small">old&larr;array.<br></span><span class="tab" val="79"></span><span class="small">[position = limit⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[limit&larr; limit+(10 max: limit/4).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">array &larr; array species new: limit.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ j to: i-1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[array◦j &larr; old◦j<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">for⦂ j from: position  to: i by: ¬1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[array◦(j+1) &larr; old◦j<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">].<br></span><span class="tab" val="79"></span><span class="small">array◦i &larr; v.<br></span><span class="tab" val="79"></span><span class="small">position  &larr; position +1<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Value operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">add: x  </span><span class="small">[self next &larr; x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">append: x  </span><span class="small">[for⦂ x from: x do⦂ [self next &larr; x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">delete: x </span><span class="small">| i [<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: position do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">array◦i ≡ x⇒ [⇑self deleteI: i]].<br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">find: v </span><span class="small">| i [<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: position do⦂ [array◦i = v⇒ [⇑i]].<br></span><span class="tab" val="79"></span><span class="small">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">has: x </span><span class="small">[⇑(self find: x) &gt; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">insert: x </span><span class="small">[(self find: x) = 0⇒ [self next&larr; x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Viewing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asSet</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asStream </span><span class="small">[⇑self viewer]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy </span><span class="small">[⇑self viewer copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">initView: v </span><span class="small">[⇑v of: array to: position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small">[⇑position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">notViewed: v </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">views delete: v;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">empty⇒ [views &larr; nil]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm </span><span class="small">| t [<br></span><span class="tab" val="79"></span><span class="small">strm append: &rsquo;a Set: &rsquo;.<br></span><span class="tab" val="79"></span><span class="small">array is: String⇒ [strm append: self]<br></span><span class="tab" val="79"></span><span class="small">for⦂ t from: self do⦂ [strm space; print: t]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">species </span><span class="small">[⇑array species]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">viewer </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑SetReader new of: array from: 1 to: position<br></span><span class="tab" val="79"></span><span class="small">"self viewRange: 1 to: position"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">viewer: v </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">[views≡nil⇒ [views &larr; Set default]].<br></span><span class="tab" val="79"></span><span class="small">views next &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">viewRange: i to: j </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑"self viewer:" (<br></span><span class="tab" val="79"></span><span class="small">SetReader new of: array from: (i "max: 1") to: (j "min: position"))]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">checkIndex: i </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">i ≥ 1 and⦂ i ≤ position⇒ [⇑i]<br></span><span class="tab" val="79"></span><span class="small">⇑user notify: &rsquo;illegal index&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">grow </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"self grown and reset. returns another Set with old contents"<br></span><span class="tab" val="79"></span><span class="small">⇑self growby: (10 max: limit/4)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growby: n | old </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"grow and reset self. return old Set for copying"<br></span><span class="tab" val="79"></span><span class="small">old &larr; Set new of: array to: position.<br></span><span class="tab" val="79"></span><span class="small">self of: (array species new: limit+n) to: 0.<br></span><span class="tab" val="79"></span><span class="small">⇑old]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">next </span><span class="small">[user notify: &rsquo;no direct reading of a Set&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">pastend &larr; x </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">⇑[self append: self grow; next &larr; x]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Arithmetic operations</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">dotproduct: s </span><span class="small">| i dotproduct<br></span><span class="tab" val="79"></span><span class="small">["dot product of two sets ... sets must be of equal length"<br></span><span class="tab" val="79"></span><span class="small">dotproduct &larr; 0.0.<br></span><span class="tab" val="79"></span><span class="small">self length = s length ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ i to: position do⦂ [dotproduct &larr; dotproduct + ((s◦i)*(self◦i))].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ dotproduct  <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;dot product undefined...sets are not of equal length&rsquo;. <br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">product: s </span><span class="small">| product i<br></span><span class="tab" val="79"></span><span class="small">["product of two sets ... sets must be of equal length"<br></span><span class="tab" val="79"></span><span class="small">product &larr; Set new default.<br></span><span class="tab" val="79"></span><span class="small">self length = s length ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ i to: position do⦂ [product add: (s◦i)*(self◦i)].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑ product<br>  <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;product undefined...sets are not of equal length&rsquo;. <br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">summation</span><span class="small">| i summation<br></span><span class="tab" val="79"></span><span class="small">["sum of the values in the set"<br></span><span class="tab" val="79"></span><span class="small">summation &larr; 0.0.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: position do⦂ [summation &larr; summation + (self◦i)].<br></span><span class="tab" val="79"></span><span class="small">⇑ summation<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Set under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"SetReader"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;SetReader&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Stream<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Read a Set; no edits occur to set. (see Steve for ISetReader (interruptible))<br>Inherit of:from:to:, next, next:, end, pastend, skip:, ∢, asStream, viewer</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">of: array from: position for: n </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">position &larr; position-1.<br></span><span class="tab" val="79"></span><span class="small">limit &larr; position+n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asSet </span><span class="small">[⇑self copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy </span><span class="small">"yield contents all at once as a Set" [<br></span><span class="tab" val="79"></span><span class="small">⇑[Set new of: (array species new: limit-position); append: self]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">"how much left"<br></span><span class="tab" val="79"></span><span class="small">⇑limit-position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪SetReader under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"String"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">VariableLengthClass new title: &rsquo;String&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Array<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;StringBlter &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">bytesize: 8;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>I am an array of bytes, integers between 0 and 255 usually representing ascii characters</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">all&larr; val </span><span class="small">[self fill: 1 to: self length with: val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fill: a to: b with: val </span><span class="small">| i [<br></span><span class="tab" val="79"></span><span class="small">"eventually use BitBlt?"<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: a to: b do⦂ [self◦i &larr; val]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small">[⇑self length </span><span class="small italic">"In case this is reached by perform:"</span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">word: x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"read word in String"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self◦(x+x) + (self◦(x+x-1) lshift: 8)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">word: x &larr; y</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"write word in String"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self◦(x+x-1) &larr; y lshift: ¬8.<br></span><span class="tab" val="79"></span><span class="small">self◦(x+x) &larr; y land: 0377. ⇑y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Copying and Altering</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">concat: s </span><span class="small">| len [<br></span><span class="tab" val="79"></span><span class="small">(len &larr; self length) + s length &gt; 20 and⦂ (s Is: String)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"this concatenates more quickly if BitBlt is used"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑self replace: len+1 to: len by: s from: 1 to: s length]<br></span><span class="tab" val="79"></span><span class="small">⇑super concat: s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy: a to: b </span><span class="small">[⇑(self species new: 1+b-a) copy: 1 to: 1+b-a with: self from: a to: b]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy: a to: b with: s from: c to: d </span><span class="small">| i [<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">like replace, except in place. self◦(a to: b) &larr; s◦(c to: d).<br></span><span class="tab" val="79"></span><span class="small italic">use BitBlt unless size too small, StringBlter≡false, or index/sizes too large</span><span class="small">"<br><br></span><span class="tab" val="79"></span><span class="small">(b-a &gt; 12 and⦂ StringBlter) and⦂ (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">BitBlt new stringCopy: self from: a to: b with: s from: c to: d)⇒ []<br><br></span><span class="tab" val="79"></span><span class="small">self ≡ s and⦂ (c &lt; a and⦂ d ≥ a)⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">overlap of second range with below first in same string.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">copy in reverse order: self◦(b to: a by: ¬1) &larr; self◦(d to: c by: ¬1)</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ i from: b-a to: 0 by: ¬1 do⦂ [self◦(a+i) &larr; self◦(c+i)]]<br><br></span><span class="tab" val="79"></span><span class="small">s copy: c to: d to: (Stream new of: self from: a to: b)]</span><span class="tab" val="79"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">findString: str startingAt: start </span><span class="small">| i t<br></span><span class="tab" val="79"></span><span class="small">[str length=0⇒[⇑0] t&larr; str◦1.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: start to: self length-str length+1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self◦i=t⇒[self◦(i to: i+str length-1)=str⇒[⇑i]]]<br></span><span class="tab" val="79"></span><span class="small">⇑0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growto: n </span><span class="small">| len [<br></span><span class="tab" val="79"></span><span class="small">[(len &larr; self length) ≤ n⇒ [] len &larr; n].<br></span><span class="tab" val="79"></span><span class="small">⇑(self species new: n) copy: 1 to: len with: self from: 1 to: len]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">recopy<br></span><span class="tab" val="79"></span><span class="small">[⇑self copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">replace: a to: b by: s <br></span><span class="tab" val="79"></span><span class="small">[s Is: String ⇒[<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑self replace: a to: b by: s from: 1 to: s length]<br></span><span class="tab" val="79"></span><span class="small">⇑self replace: a to: b by: s asArray from: 1 to: s position]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">replace: a to: b by: r from: c to: d </span><span class="small">| s t [</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">s &larr; self species new: self length + (d-c) - (b-a).<br><br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">use BitBlt unless StringBlter≡false or index/sizes too large</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">StringBlter and⦂ (<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">BitBlt new stringReplace: s with: self from: a to: b and: r from: c to: d)⇒ [⇑s]<br><br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">see Array concat:</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">t &larr; Stream new of: s.<br></span><span class="tab" val="79"></span><span class="small">self copy: 1 to: a-1 to: t.<br></span><span class="tab" val="79"></span><span class="small">r copy: c to: d to: t.<br></span><span class="tab" val="79"></span><span class="small">self copy: b+1 to: self length to: t.<br></span><span class="tab" val="79"></span><span class="small">⇑s]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">subst: repl for: key </span><span class="small">| key1 i nskip result<br></span><span class="tab" val="79"></span><span class="small">[nskip &larr; 0. key1 &larr; key◦1. result &larr; Stream default.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: self length do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">" the Boyer Slow string replacement "</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[nskip&gt;0⇒ [nskip &larr; nskip-1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self◦i = key1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[self◦(i to: (self length min: i+key length-1)) = key⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[result append: repl. nskip &larr; key length-1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">result next&larr; self◦i]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">result next&larr; self◦i]<br></span><span class="tab" val="79"></span><span class="small">⇑result contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Comparison</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">- s </span><span class="small">| i c ldiff</span><span class="tab" val="79"></span><span class="small"> [<br></span><span class="tab" val="79"></span><span class="small italic">"Return a negative, zero, or positive integer as I compare &lt; = or &gt; s"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small italic">"The collation sequence is ascii with case differences ignored."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(ldiff &larr; self length-s length) &lt; 0⇒ [self length] s length] do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(c&larr; UpperCase◦(self◦i + 1) -(UpperCase◦(s◦i + 1)))<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">≠0⇒ [⇑c]].<br></span><span class="tab" val="79"></span><span class="small">⇑ldiff]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&lt; s<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"Return true iff I collate before s.  The collation sequence is ascii with case differences ignored."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑(self compare: s) = 1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">&gt; s<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"Return true iff I collate after s.  The collation sequence is ascii with case differences ignored."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑(self compare: s) = 3]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">compare: s </span><span class="small">| i len lcomp u1 u2 [<br></span><span class="tab" val="79"></span><span class="small">lcomp &larr; [self length &lt; (len &larr; s length)⇒ [len &larr; self length. 1]; =len⇒ [2] 3].<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: len do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(u1 &larr; UpperCase◦(self◦i + 1)) = (u2 &larr; UpperCase◦(s◦i + 1))⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">u1 &lt; u2⇒ [⇑1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑3]<br></span><span class="tab" val="79"></span><span class="small">⇑lcomp]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small">| l m<br></span><span class="tab" val="79"></span><span class="small">[[(l&larr; m&larr; self length)≤2⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[l=2⇒[m&larr;3]; =1⇒[⇑((self◦1) land: 0177)*0152] ⇑052525]].<br></span><span class="tab" val="79"></span><span class="small"> ⇑(self◦1)*060+(self◦(m-1)+l)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">match: text </span><span class="small">| star pound pattern scanning p t back [<br></span><span class="tab" val="79"></span><span class="small">star &larr; 052 "*".  pound &larr; 043 "#".<br></span><span class="tab" val="79"></span><span class="small">pattern &larr; self asStream.  text &larr; text asStream.<br></span><span class="tab" val="79"></span><span class="small">scanning &larr; false.<br></span><span class="tab" val="79"></span><span class="small">while⦂ true do⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(p &larr; pattern next)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">=star⇒ [pattern end⇒ [⇑true] scanning &larr; pattern position]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(t &larr; text next)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">≡false⇒ [⇑t≡p]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">p≡false⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">scanning⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">back &larr; scanning - pattern position.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pattern skip: back. text skip: back]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">UpperCase◦(t+1) = (UpperCase◦(p+1)) or⦂ p=pound⇒ []<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">scanning⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">back &larr; scanning - pattern position.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pattern skip: back. text skip: back+1]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑false]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">systemRehash </span><span class="small">| dicts d left loop<br></span><span class="tab" val="79"></span><span class="small">["change the meaning of hash for Strings"<br></span><span class="tab" val="79"></span><span class="small">String understands:</span><span class="small bold"><br></span><span class="small">&rsquo;</span><span class="small bold">hash </span><span class="small">| l m<br></span><span class="tab" val="79"></span><span class="small">[[(l&larr; m&larr; self length)≤2⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[l=2⇒[m&larr;3]; =1⇒[⇑((self◦1) land: 0177)*0152] ⇑052525]].<br></span><span class="tab" val="79"></span><span class="small"> ⇑(self◦1)*060+(self◦(m-1)+l)]&rsquo;.<br><br></span><span class="tab" val="79"></span><span class="small">"rehash the atom table"<br></span><span class="tab" val="79"></span><span class="small"> ↪a rehash.<br><br></span><span class="tab" val="79"></span><span class="small">"rehash all dictionaries which have strings in them"<br></span><span class="tab" val="79"></span><span class="small"> dicts &larr; HashSet allInstances+Dictionary allInstances<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">+SymbolTable allInstances.<br></span><span class="tab" val="79"></span><span class="small"> for⦂ d from: dicts do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[left &larr; d objects asStream. loop &larr; left next.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> while⦂ loop do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[loop is: String⇒[d rehash. loop &larr; false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> loop &larr; left next]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asBytes </span><span class="small">| s c<br></span><span class="tab" val="79"></span><span class="small">[s &larr; Stream default.<br></span><span class="tab" val="79"></span><span class="small">for⦂ c from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[s append: c base8; space]<br></span><span class="tab" val="79"></span><span class="small">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asDecimalDigits </span><span class="small italic">"Not asInteger, because the result may be a Float if it&rsquo;s too big"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">| strm sign c val<br></span><span class="tab" val="79"></span><span class="small">[strm&larr; Stream new of: self.<br></span><span class="tab" val="79"></span><span class="small">sign&larr; strm∢025.<br></span><span class="tab" val="79"></span><span class="small">val&larr; [self length&gt;4⇒[0.0]0].<br></span><span class="tab" val="79"></span><span class="small">for⦂ c from: strm do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[c&lt;060 or: c&gt;071⇒[user notify: self + &rsquo; isn&rsquo;&rsquo;t a valid integer&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">val&larr; val*10+(c-060)]<br></span><span class="tab" val="79"></span><span class="small">sign⇒[⇑val*¬1]<br></span><span class="tab" val="79"></span><span class="small">⇑val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asFileName </span><span class="small">[⇑dp0 checkName: self fixing: true]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asFloat </span><span class="small">| strm int frac exp<br></span><span class="tab" val="79"></span><span class="small">[strm&larr; Stream new of: self.<br></span><span class="tab" val="79"></span><span class="small">int&larr; strm upto: 056.<br></span><span class="tab" val="79"></span><span class="small">frac&larr; strm upto: 0145.<br></span><span class="tab" val="79"></span><span class="small">exp&larr; strm rest asInteger - frac length.<br></span><span class="tab" val="79"></span><span class="small">int&larr; (int concat: frac) asDecimalDigits asFloat.<br></span><span class="tab" val="79"></span><span class="small">exp=0⇒[⇑int];<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">&gt;0⇒[⇑int*(10.0 ipow: exp)].<br></span><span class="tab" val="79"></span><span class="small">⇑int/(10.0 ipow: 0-exp)<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asInteger </span><span class="small">| strm sign base maxdigit c val<br></span><span class="tab" val="79"></span><span class="small">[strm&larr; Stream new of: self.<br></span><span class="tab" val="79"></span><span class="small">sign&larr; [strm∢025⇒[¬1]1].<br></span><span class="tab" val="79"></span><span class="small">base&larr; [strm∢060⇒[8]10]. maxdigit&larr; 060+base.<br></span><span class="tab" val="79"></span><span class="small">val&larr; 0.<br></span><span class="tab" val="79"></span><span class="small">for⦂ c from: strm do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[c&lt;060 or: c≥maxdigit⇒[user notify: self + &rsquo; isn&rsquo;&rsquo;t a valid Integer&rsquo;]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">val&larr; val*base+(c-060)]<br></span><span class="tab" val="79"></span><span class="small italic">"Some special maneuvering to keep 01ddddd and ¬32768 (and nothing else) from overflowing."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[val&gt;077777⇒[base=8⇒[sign=1⇒[val&lt;65536⇒[⇑val asSmall]]]]].<br></span><span class="tab" val="79"></span><span class="small">⇑(val*sign) asInteger]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asLarge </span><span class="small">"convert to a LargeInteger"<br></span><span class="tab" val="79"></span><span class="small">| neg i large large10<br></span><span class="tab" val="79"></span><span class="small">[[self◦1=025⇒[neg&larr;true] neg&larr;false].<br></span><span class="tab" val="79"></span><span class="small"> large &larr; 0 asLarge. large10 &larr; 10 asLarge.<br></span><span class="tab" val="79"></span><span class="small"> for⦂ i from: [neg⇒[2]1] to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[large &larr; (large*large10)+(self◦i-060)].<br></span><span class="tab" val="79"></span><span class="small"> neg⇒[⇑large negated] ⇑large]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asParagraph<br></span><span class="tab" val="79"></span><span class="small">[⇑Paragraph new text: self alignment: 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asUppercase </span><span class="small">| s c<br></span><span class="tab" val="79"></span><span class="small">[s &larr; Stream default.<br></span><span class="tab" val="79"></span><span class="small">for⦂ c from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[s next &larr; UpperCase◦(c+1)]<br></span><span class="tab" val="79"></span><span class="small">⇑s contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asVector<br></span><span class="tab" val="79"></span><span class="small">[⇑self asStream asVector]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">base8: i  </span><span class="small italic">"word: i  in base 8 as a String"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑(self word: i) base8]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hasBeenUniqued<br></span><span class="tab" val="79"></span><span class="small">[⇑↪a hasInterned: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm </span><span class="small">| x</span><span class="tab" val="79"></span><span class="small italic">"print inside string quotes"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[strm next&larr; 047.<br></span><span class="tab" val="79"></span><span class="small">for⦂ x from: self do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[strm next&larr; x.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">x=047⇒[strm next&larr; x]]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"imbedded quotes get doubled"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">strm next&larr; 047]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">unique </span><span class="small">| u</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"copy and intern"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑↪a intern: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">species<br></span><span class="tab" val="79"></span><span class="small">[⇑String]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>System primitives</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lock </span><span class="small">[] primitive: 31</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">unlock </span><span class="small">[] primitive: 32</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪String under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Substring"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;Substring&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Array<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;data map&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>I am an array that consists of a set of elements (specified by map) of an array (data)</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">data: data map: map</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ x<br></span><span class="tab" val="79"></span><span class="small">[⇑data◦(map◦x)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦ x &larr; val<br></span><span class="tab" val="79"></span><span class="small">[⇑data◦(map◦x) &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length<br></span><span class="tab" val="79"></span><span class="small">[⇑map length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">map<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"Return my map."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">⇑map]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Copying and Altering</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">swap: i with: j </span><span class="small">| t<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"By permuting my map (a writable Array), swap elements i and j."</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">t &larr; map◦i. map◦i &larr; map◦j. map◦j &larr; t.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asStream<br></span><span class="tab" val="79"></span><span class="small">[map isIntervalBy1⇒</span><span class="tab" val="79"></span><span class="small italic">"direct stream for simple substrings"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[⇑Stream new of: data from: map start to: map stop]<br></span><span class="tab" val="79"></span><span class="small">⇑Stream new of: self from: 1 to: map length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compatability</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">species<br></span><span class="tab" val="79"></span><span class="small">[⇑data species]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Substring under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"UniqueString"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">VariableLengthClass new title: &rsquo;UniqueString&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: String<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">bytesize: 8;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>I am a string that is unequal to every other instance of my subclass</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit </span><span class="small">| i a v</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"make up table of 1-char atoms"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[v &larr; Vector new: 128. a &larr; String new: 1.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: 128 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[a◦1 &larr; i-1. v◦i &larr; a unique]<br></span><span class="tab" val="79"></span><span class="small">UST1 &larr; v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hasInterned: s </span><span class="small">| h i v n<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"⇑false if String s hasnt been interned, else ⇑s unique"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[</span><span class="tab" val="79"></span><span class="small">[s length=1⇒[s◦1&lt;128⇒[⇑UST1◦(s◦1+1)]]].<br></span><span class="tab" val="79"></span><span class="small">h&larr; s hash.<br></span><span class="tab" val="79"></span><span class="small">v &larr; USTable◦(h\USTable length+1).<br></span><span class="tab" val="79"></span><span class="small">i&larr; h\v length+1.<br></span><span class="tab" val="79"></span><span class="small">for⦂ n to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[v◦i≡nil⇒</span><span class="tab" val="79"></span><span class="small">[⇑false]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[s length=(v◦i) length⇒ [s=(v◦i)⇒[⇑v◦i]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i&larr; [i=v length⇒[1] i+1]]<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;USTable is jammed&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">intern: s </span><span class="small">| h i j v n</span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[</span><span class="tab" val="79"></span><span class="small">[s length=1⇒[s◦1&lt;128⇒[⇑UST1◦(s◦1+1)]]].<br></span><span class="tab" val="79"></span><span class="small">h&larr; [s is: String⇒[s hash] s stringhash].<br></span><span class="tab" val="79"></span><span class="small">v &larr; USTable◦(h\USTable length+1).<br></span><span class="tab" val="79"></span><span class="small">i&larr; h\v length+1.<br></span><span class="tab" val="79"></span><span class="small">for⦂ n to: v length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[v◦i≡nil⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"empty slot"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[n&larr; ¬4.  for⦂ j from: v do⦂ [j≡nil⇒ [n &larr; n+4]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">n &lt; v length⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"grow bucket if &gt; 3/4 full"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[USTable◦(h\USTable length+1) &larr; Vector new: 2*v length.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">for⦂ n from: v do⦂</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"rehash all its contents"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[n≡nil⇒ [] self intern: n]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑self intern: s]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑v◦i &larr; [s is: UniqueString⇒[s]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"install new entry"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(UniqueString new: s length) str: s]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[s length=(v◦i) length⇒ [s=(v◦i)⇒[⇑v◦i]]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i&larr; [i=v length⇒[1] i+1]]<br></span><span class="tab" val="79"></span><span class="small">user notify: &rsquo;USTable is jammed&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">rehash </span><span class="small">| oldTable v i<br></span><span class="tab" val="79"></span><span class="small">[oldTable &larr; USTable.<br></span><span class="tab" val="79"></span><span class="small"> USTable &larr; Vector new: oldTable length.<br></span><span class="tab" val="79"></span><span class="small"> for⦂ i to: USTable length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[USTable◦i &larr; Vector new: 4].<br></span><span class="tab" val="79"></span><span class="small"> for⦂ v from: oldTable do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[for⦂ i from: v do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[i≡nil⇒[] self intern: i]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">str: s </span><span class="small">| j<br></span><span class="tab" val="79"></span><span class="small">[for⦂ j to: s length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[super◦j &larr; s◦j]<br></span><span class="tab" val="79"></span><span class="small">⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">unique</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">◦x &larr; val<br></span><span class="tab" val="79"></span><span class="small">[user notify: &rsquo;UniqueStrings are not for writing into&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Selectors</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isarrow</span><span class="tab" val="79"></span><span class="small bold"> </span><span class="small italic">"ends with &larr;"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self length≤1⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small">⇑self◦self length=95]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isinfix </span><span class="small">| x<br></span><span class="tab" val="79"></span><span class="small">[self length≠1⇒ [⇑false]  ⇑(self◦1) isletter≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">iskeyword </span><span class="small">| x</span><span class="tab" val="79"></span><span class="small italic">"ends with colon"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self length≤1⇒ [⇑false]<br></span><span class="tab" val="79"></span><span class="small">x &larr; self◦self length.<br></span><span class="tab" val="79"></span><span class="small">x=072⇒[⇑true] ⇑x=03]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">isuneval </span><span class="small">| x</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"ends with open colon"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self◦self length=03]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">keywords  </span><span class="small">"</span><span class="small italic">return a vector of the keywords that compose me</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">| result strm i l char colon ocolon<br></span><span class="tab" val="79"></span><span class="small">[&rsquo;◦&larr;&rsquo;=self⇒[⇑↪(&rsquo;◦&rsquo; &rsquo;&larr;&rsquo;)]<br></span><span class="tab" val="79"></span><span class="small">result&larr;(Vector new: 10) asStream.  strm&larr;Stream default.<br></span><span class="tab" val="79"></span><span class="small">colon&larr;&rsquo;:&rsquo;◦1.  ocolon&larr;&rsquo;⦂&rsquo;◦1.<br></span><span class="tab" val="79"></span><span class="small">i&larr;1.  l&larr;self length.<br></span><span class="tab" val="79"></span><span class="small">while⦂ i≤l do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[char&larr;self◦i.  strm append: char.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> [(char=colon or⦂ char=ocolon) or⦂ i=l⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[result next&larr; strm contents.  strm reset]].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">i&larr;i+1].<br></span><span class="tab" val="79"></span><span class="small">⇑result contents]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">mustTake: nargs </span><span class="small italic">"fatal error if I am not a selector that takes nargs arguments"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[self numArgs≠nargs⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[user notify: self + &rsquo; does not take &rsquo; + nargs asString + &rsquo; arguments&rsquo;]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">numArgs  </span><span class="small">| len n i </span><span class="small italic">"the number of arguments I take when I am a selector"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[len &larr; self length.<br></span><span class="tab" val="79"></span><span class="small">len=1⇒ [⇑[(self◦1) isletter⇒ [0] 1]]<br></span><span class="tab" val="79"></span><span class="small">n &larr; 0. </span><span class="small italic">"count colons, dots, and arrows"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: len do⦂ [self◦i=072⇒ [n&larr;n+1]; =03⇒ [n&larr;n+1]; =0137⇒[n&larr;n+1]; =07⇒[n&larr;n+1]].<br></span><span class="tab" val="79"></span><span class="small">⇑n]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Comparison</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= x </span><span class="small">[⇑self≡x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small">[] primitive: 46</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">stringhash<br></span><span class="tab" val="79"></span><span class="small">[⇑super hash]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compatibility</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copy </span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">recopy </span><span class="small">[⇑self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">species<br></span><span class="tab" val="79"></span><span class="small">[⇑String]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asString<br></span><span class="small">[⇑super copy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm<br></span><span class="tab" val="79"></span><span class="small">[strm append: self]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪UniqueString under: &rsquo;Basic Data Structures&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">UniqueString classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"Vector"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">VariableLengthClass new title: &rsquo;Vector&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Array<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>Vector is a VariableLengthClass.  The length of a Vector may not be less than 0,<br>nor may it be greater than 8196.  <br>A field of a Vector may contain any other object.<br>A new Vector contains nil in every field.  <br>To create a new Vector of length 8, say:<br></span><span class="tab" val="79"></span><span class="small italic">Vector new: 8<br><br>Microcode Primitives<br>◦ x   "subscript"<br></span><span class="tab" val="79"></span><span class="small italic">[0 &gt; x or: x &gt; self length ⇒[user notify: &rsquo;Subscript out of bounds&rsquo;]<br></span><span class="tab" val="79"></span><span class="small italic">x class ≡ Integer ⇒[Return the xth element of the Vector]<br></span><span class="tab" val="79"></span><span class="small italic">⇑ super ◦ x]<br>◦ x &larr; val  "assign value to element"<br></span><span class="tab" val="79"></span><span class="small italic">[0 &gt; x or: x &gt; self length ⇒[user notify: &rsquo;Subscript out of bounds&rsquo;]<br></span><span class="tab" val="79"></span><span class="small italic">x class ≡ Integer ⇒[Store the value val as the xth element. ⇑val]<br></span><span class="tab" val="79"></span><span class="small italic">⇑ super ◦ x &larr; val]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Reading and Writing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small italic">"This is actually done in microcode"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑self length </span><span class="small italic">"perform: needs this"</span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Copying and Altering</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">, x </span><span class="small">| v<br></span><span class="tab" val="79"></span><span class="small">[v &larr; self growby: 1.</span><span class="tab" val="79"></span><span class="small italic">"use a stream if youre in a hurry"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">v last &larr; x. ⇑v]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Searching</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">max</span><span class="small">| biggest i<br></span><span class="tab" val="79"></span><span class="small">[biggest &larr; self◦1.</span><span class="tab" val="79"></span><span class="small italic">"return largest value in a vector"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[(self◦i) &gt; biggest ⇒[biggest &larr; self◦i]].<br></span><span class="tab" val="79"></span><span class="small"> ⇑biggest]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Conversion</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">asVector</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[strm append: &rsquo;(&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: self length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[strm print: self◦i; space]<br></span><span class="tab" val="79"></span><span class="small">strm append: &rsquo;)&rsquo; ]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>System primitives</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">nail </span><span class="small">[user croak] primitive: 31</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"Nail me in core and return my core address"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">unNail </span><span class="small">[user croak] primitive: 32</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">"Release me from being nailed"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Compiler argument list</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">argsOff: stack<br></span><span class="tab" val="79"></span><span class="small">[stack pop: self length]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">emitForValue: code on: stack  </span><span class="small">| x<br></span><span class="tab" val="79"></span><span class="small">[for⦂ x from: self do⦂ [x emitForValue: code on: stack]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">firstPush<br></span><span class="tab" val="79"></span><span class="small">[⇑(self◦1) firstPush]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">remote: generator  </span><span class="small">| x<br></span><span class="tab" val="79"></span><span class="small">[for⦂ x from: self do⦂ [x remote: generator]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">sizeForValue  </span><span class="small">| size x<br></span><span class="tab" val="79"></span><span class="small">[size &larr; 0. for⦂ x from: self do⦂ [size &larr; size+ x sizeForValue]. ⇑size]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪Vector under: &rsquo;Basic Data Structures&rsquo;.</span></div>
  </body>
</html>
