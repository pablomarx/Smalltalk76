<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN">
<html>
  <head>
    <meta http-equiv="Content-type" content="text/html;charset=UTF-8">
    <title>Smalltalk76/Picture-Editor.st</title>
	<link rel="stylesheet" type="text/css" href="font.css"/>
  </head>
  <body>
    <div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">&rsquo;From Smalltalk 5.5k XM November 24 on 22 November 1980 at 2:57:08 am.&rsquo;<br></span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold">"BitRect"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;BitRect&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Rectangle<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;title  "&lt;String&gt; title of picture"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">stripheight  "&lt;Integer&gt; scan lines in a buffer (private)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">data  "&lt;Vector&gt; of Strings.  Saves the bits in the Rectangle"&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;defaultpic &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>BitRect is a Rectangle that remembers the bits within it.<br>To create and edit one, say:<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">BitRect new fromuser edit.<br>This installs a BitRectEditor in the scheduler and starts it up.<br>The editor is explained in BitRectEditor.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit<br></span><span class="tab" val="79"></span><span class="small">["</span><span class="small italic">the default picture is a gray rectangle</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">defaultpic &larr; BitRect new filin: &rsquo;defaultpic&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">default </span><span class="small">[⇑defaultpic recopy]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fromuser<br></span><span class="tab" val="79"></span><span class="small">[self title: &rsquo;BitRect&rsquo; in: Rectangle new fromuser.<br></span><span class="tab" val="79"></span><span class="small">self saveScreenBits]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">origin: origin corner: corner title: title stripheight: stripheight data: data</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">title: title in: rect </span><span class="small">| nStrips i strips<br></span><span class="tab" val="79"></span><span class="small">[origin&larr;rect origin.  corner&larr;rect corner.<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">the strip height is chosen so that each bitstring is about 2048 bytes</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">stripheight&larr;1023/((self extent x + 15)/16).<br></span><span class="tab" val="79"></span><span class="small">nStrips&larr;(self extent y+stripheight-1)/stripheight.<br></span><span class="tab" val="79"></span><span class="small">data&larr;Vector new: nStrips.<br></span><span class="tab" val="79"></span><span class="small">strips&larr;self strips.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: nStrips do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[data◦i&larr;String new: (strips◦i) bitStringLength]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Access to parts</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">data </span><span class="small">[⇑data]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">title </span><span class="small">[⇑title]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Rectangle Protocol</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">= x </span><span class="small">[⇑self≡x]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bitsOntoStream: strm </span><span class="small">| bits<br></span><span class="tab" val="79"></span><span class="small">[for⦂ bits from: data do⦂ [strm append: bits]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">corner&larr;x </span><span class="small">[self growby: x-corner]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">extent&larr;x </span><span class="small">[self growby: x-self extent]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growby: change </span><span class="small">| old<br></span><span class="tab" val="79"></span><span class="small">[old&larr;BitRect new origin: origin corner: corner title: title<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">stripheight: stripheight data: data.<br></span><span class="tab" val="79"></span><span class="small">self title: title in: (origin rect: corner+change).<br></span><span class="tab" val="79"></span><span class="small">self copyBitsFrom: old]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">growto: x </span><span class="small">[self growby: x-corner]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">hash </span><span class="small">[user croak] primitive: 46</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">height&larr;h </span><span class="small">[self growby: 0⌾(h-self extent y)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">printon: strm<br></span><span class="tab" val="79"></span><span class="small">[strm append: &rsquo;a BitRect&rsquo;]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">width&larr;w </span><span class="small">[self growby: (w-self extent x)⌾0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Editing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">copyBitsFrom: other<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">| clippedStrip i j myStrips otherStrips myStrip otherStrip<br></span><span class="tab" val="79"></span><span class="small">["</span><span class="small italic">copy all bits from </span><span class="small italic underline">other</span><span class="small italic"> that are within my area</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">myStrips&larr;self strips.  otherStrips&larr;other strips.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: myStrips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[for⦂ j to: otherStrips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[myStrip&larr;myStrips◦i.  otherStrip&larr;otherStrips◦j.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">clippedStrip&larr;myStrip intersect: otherStrip.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">clippedStrip empty⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">BitBlt init function&larr;0;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">destbase&larr;data◦i;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">destraster&larr;myStrip width+15/16;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">dest&larr;clippedStrip origin-myStrip origin;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">extent&larr;clippedStrip extent;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">sourcebase&larr;other data◦j;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">sourceraster&larr;otherStrip width+15/16;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">source&larr;clippedStrip origin-otherStrip origin;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">checksandcall]]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">edit </span><span class="small">| a<br></span><span class="tab" val="79"></span><span class="small">[user leaveTop.<br></span><span class="tab" val="79"></span><span class="small">a&larr;BitRectEditor new picture: self.<br></span><span class="tab" val="79"></span><span class="small">a takeCursor; enter.<br></span><span class="tab" val="79"></span><span class="small">user restartup: a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Showing</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">saveScreenBits </span><span class="small">| strips i<br></span><span class="tab" val="79"></span><span class="small">[strips&larr;self strips.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: strips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[strips◦i bitsIntoString: data◦i mode: storing clippedBy: nil]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">show </span><span class="small">| strips i<br></span><span class="tab" val="79"></span><span class="small">[strips&larr;self strips.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: strips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[strips◦i bitsFromString: data◦i]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">strips   </span><span class="small">"</span><span class="small italic">return a vector of strips (Rectangles)</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">| nStrips strips stripOrigin stripExtent i<br></span><span class="tab" val="79"></span><span class="small">[(nStrips&larr;data length)=1⇒[⇑self inVector]<br></span><span class="tab" val="79"></span><span class="small">strips&larr;Vector new: nStrips.<br></span><span class="tab" val="79"></span><span class="small">stripOrigin&larr;origin.  stripExtent&larr;self width⌾stripheight.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: nStrips-1 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[strips◦i&larr;Rectangle new origin: stripOrigin extent: stripExtent.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">stripOrigin&larr;stripOrigin+(0⌾stripheight)].<br></span><span class="tab" val="79"></span><span class="small">strips◦nStrips&larr;Rectangle new origin: stripOrigin corner: corner.<br></span><span class="tab" val="79"></span><span class="small">⇑strips]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Filin and filout</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">filin: title </span><span class="small">| f i x y rect strips  </span><span class="small italic">"read bits from a file"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[f&larr;dp0 oldFile: (title concat: &rsquo;.pic.&rsquo;).<br></span><span class="tab" val="79"></span><span class="small">f readonly.<br></span><span class="tab" val="79"></span><span class="small">f end⇒[f close. user notify: &rsquo;no data&rsquo;]<br><br></span><span class="tab" val="79"></span><span class="small">x&larr;f nextword.  y&larr;f nextword.<br></span><span class="tab" val="79"></span><span class="small">rect&larr;Rectangle new origin: [origin is: Point⇒[origin] 0⌾0] extent: x⌾y.<br></span><span class="tab" val="79"></span><span class="small">self title: title in: rect.<br></span><span class="tab" val="79"></span><span class="small">stripheight≠f nextword⇒[user notify: &rsquo;strip heights dont match&rsquo;]<br></span><span class="tab" val="79"></span><span class="small">strips &larr; self strips.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: strips length do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[f into: data◦i].<br></span><span class="tab" val="79"></span><span class="small">f close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">filout </span><span class="small">| f i  "</span><span class="small italic">write bits on a file</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">[f &larr; dp0 file: (title concat: &rsquo;.pic.&rsquo;).<br></span><span class="tab" val="79"></span><span class="small">f nextword &larr; self extent x.<br></span><span class="tab" val="79"></span><span class="small">f nextword &larr; self extent y.<br></span><span class="tab" val="79"></span><span class="small">f nextword &larr; stripheight.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i from: data do⦂ [f append: i].<br></span><span class="tab" val="79"></span><span class="small">f close]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Press</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">length </span><span class="small">[⇑self bitStringLength]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">presson: press in: r </span><span class="small">| w h hs scale w16 y [<br></span><span class="tab" val="79"></span><span class="small">scale &larr; press scale.<br></span><span class="tab" val="79"></span><span class="small">h &larr; self height.<br></span><span class="tab" val="79"></span><span class="small">(hs  &larr; scale*h) &gt; r height⇒ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"not enough room left on current page.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">assume for now that it will at least fit on an entire page"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">⇑self]<br><br></span><span class="tab" val="79"></span><span class="small">w &larr; self width.<br></span><span class="tab" val="79"></span><span class="small">w16 &larr; w + 15 | 16 "width to next word boundary".<br></span><span class="tab" val="79"></span><span class="small">"with w, prints on viola but not on spruce.<br></span><span class="tab" val="79"></span><span class="small">with w16, prints on spruce with garbage on end"<br></span><span class="tab" val="79"></span><span class="small">press setp: 0⌾(y &larr; r corner y - hs);<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">dots⦂ [<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">press setcoding: 1 "bitmap" dots: w16 lines: h;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">setmode: 3 "to right and to bottom";<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">setsizewidth: scale*w16 height: hs;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">setwindowwidth: w16 height: h;<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">dotsfollow.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">self bitsOntoStream: press data].<br></span><span class="tab" val="79"></span><span class="small">⇑y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪BitRect under: &rsquo;Picture Editor&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">BitRect classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"BitRectEditor"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;BitRectEditor&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Window<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;tool  "&lt;BitRectTool&gt; the current tool"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">picture  "&lt;BitRect&gt; the picture we are working on"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">dirty  "false if picture has not been modified"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">saveActionPic saveToolPic  "buffers for saving background" &rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;tools toolpic actionbuttons actionpic windowmenu &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>BitRectEditor edits BitRects.<br>To create, say:<br></span><span class="tab" val="79"></span><span class="small italic">BitRect new fromuser edit.<br>This installs a BitRectEditor in the scheduler and starts it up.<br>The editing tools are to the left of the picture.  (The first one looks like a doodle).  They are: draw-thin, erase, straightedge, gray-block, paintbrush, magnifier.  The actions for the tools are displayed above the picture.<br>See BitRectTool for explanations of the actions.<br><br>CAUTION: this ordering is arbitrary.  It is currently possible to set a new action for any of the tools, so that if you are not careful, the straightedge will start being a magnifier or whatever.  This should get fixed eventually.<br><br>tools = a RadioButtons. Each button owns a BitRectTool (the active one is held in tool).<br>actionbuttons = a Vector of RadioButtons.  The groups of buttons are: action, mode, pen width, gray, and grid.<br>toolpic = BitRect of icons for the tools (at side of picture).<br>actionpic = BitRect of icons for the parts of a tool (above picture)<br>windowmenu = menu for bluebug.<br><br>To edit a copy of the tool picture, say<br></span><span class="tab" val="79"></span><span class="small italic">newpic&larr;(BitRectEditor◦↪toolpic) recopy.<br></span><span class="tab" val="79"></span><span class="small italic">newpic edit.<br>To install this copy as the menu picture, say<br></span><span class="tab" val="79"></span><span class="small italic">BitRectEditor new toolpic: newpic recopy.<br>Do the analogous thing to edit the action picture.<br>Caution: the editor blows up if you edit the tool picture itself and not a copy.<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">actionpic: a </span><span class="small">[actionpic &larr; a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit </span><span class="small">| t i<br></span><span class="tab" val="79"></span><span class="small">[t &larr; Vector new: 6.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: t length do⦂ [t◦i &larr; BitRectTool new init].<br></span><span class="tab" val="79"></span><span class="small">tools &larr; (RadioButtons new) vec: t at: 0⌾0 width: 20.<br></span><span class="tab" val="79"></span><span class="small">windowmenu &larr; Menu new string: &rsquo;under<br>move<br>grow<br>close<br>filout<br>printbits&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">actionpic&larr;BitRect new filin: &rsquo;actionpic&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">toolpic&larr;BitRect new filin: &rsquo;toolpic&rsquo;.<br></span><span class="tab" val="79"></span><span class="small">self initmenu1]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">initmenu1 </span><span class="small">| s z<br></span><span class="tab" val="79"></span><span class="small">[s &larr; Vector new: 5. z &larr; 20.<br></span><span class="tab" val="79"></span><span class="small">s◦1 &larr; (RadioButtons new) vec: ↪(setbrush paint block draw line blowup) at: 0⌾0 height: z. "</span><span class="small italic">action</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">s◦2 &larr; (RadioButtons new) vec: (black, dkgray, gray, ltgray, white) at: 0⌾0 height: z. "</span><span class="small italic">tone</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">s◦3 &larr; (RadioButtons new) vec: (0, 1, 2, 3) at: 0⌾0 height: z. "</span><span class="small italic">mode</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">s◦4 &larr; (RadioButtons new) vec: (1, 2, 4, 8) at: 0⌾0 height: z. "</span><span class="small italic">width</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">s◦5 &larr; (RadioButtons new) vec: (1, 2, 4, 8, 16, 32) at: 0⌾0 height: z. "</span><span class="small italic">grid</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">actionbuttons &larr; s.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">picture: picture<br></span><span class="tab" val="79"></span><span class="small">[tool &larr; tools push: 1.<br></span><span class="tab" val="79"></span><span class="small">self frame: (picture origin rect: picture corner)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">toolpic: a </span><span class="small">[toolpic &larr; a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Window protocol</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bluebug </span><span class="small">| <br></span><span class="tab" val="79"></span><span class="small">[<br></span><span class="tab" val="79"></span><span class="small">picture is: BitImage⇒ [ ⇑ picture fromrectangle: (picture rectangle)]<br></span><span class="tab" val="79"></span><span class="small">windowmenu bug<br></span><span class="tab" val="79"></span><span class="small"> =1 ⇒[self leave. ⇑exitflag &larr; false];  "</span><span class="small italic">under</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">=2 ⇒[self leave; newframe; enter];  "</span><span class="small italic">move</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">=3 ⇒[self grow  "</span><span class="small italic">grow</span><span class="small">"];<br></span><span class="tab" val="79"></span><span class="small">=4 ⇒[self leave; erase.   "</span><span class="small italic">close</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"> user unschedule: self. ⇑false];<br></span><span class="tab" val="79"></span><span class="small">=5 ⇒[self leave. picture filout. self enter];  "</span><span class="small italic">filout</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">=6 ⇒[self print]</span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">press file</span><span class="small">"]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">enter </span><span class="small">| start pt b<br></span><span class="tab" val="79"></span><span class="small">["</span><span class="small italic">Periodically check if the mouse is still in the frame.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">If not, stop showing the picture</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">super show.  self lostMouse⇒[⇑false]<br></span><span class="tab" val="79"></span><span class="small">picture show.  dirty&larr;false.  self lostMouse⇒[⇑false]<br></span><span class="tab" val="79"></span><span class="small">for⦂ b from: actionbuttons do⦂ [b reset].<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">show action menu above the picture</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">start&larr;frame origin-1.<br></span><span class="tab" val="79"></span><span class="small">pt &larr; start-(0⌾actionpic extent y).<br></span><span class="tab" val="79"></span><span class="small">actionpic moveto: pt.<br></span><span class="tab" val="79"></span><span class="small">saveActionPic&larr;actionpic bitsIntoString.<br></span><span class="tab" val="79"></span><span class="small">self lostMouse⇒[⇑false]<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">last point I can return before having to restore bits under menus</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">actionpic show.<br></span><span class="tab" val="79"></span><span class="small">pt &larr; actionbuttons◦1 moveto: pt. "</span><span class="small italic">action</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">pt &larr; actionbuttons◦3 moveto: pt. "</span><span class="small italic">mode</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">pt &larr; actionbuttons◦4 moveto: pt. "</span><span class="small italic">width</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">show the next bank of action buttons</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">pt &larr; start-(0⌾(actionpic extent y+1/2)).<br></span><span class="tab" val="79"></span><span class="small">pt &larr; actionbuttons◦2 moveto: pt.  "</span><span class="small italic">tone</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">pt &larr; actionbuttons◦5 moveto: pt.  "</span><span class="small italic">grid</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">tool brushpt: (pt &larr; pt+(7⌾7)).<br></span><span class="tab" val="79"></span><span class="small">(tool brush) moveto: pt; show.<br></span><span class="tab" val="79"></span><span class="small">"show the tool pic"<br></span><span class="tab" val="79"></span><span class="small">pt &larr; start-(toolpic extent x⌾0).<br></span><span class="tab" val="79"></span><span class="small">toolpic moveto: pt.<br></span><span class="tab" val="79"></span><span class="small">saveToolPic &larr; toolpic bitsIntoString.<br></span><span class="tab" val="79"></span><span class="small">toolpic show.<br></span><span class="tab" val="79"></span><span class="small">tools moveto: pt;  setvalue: tool.<br></span><span class="tab" val="79"></span><span class="small">tool frame: frame; showon: actionbuttons.]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">fixframe: r<br></span><span class="tab" val="79"></span><span class="small">[picture moveto: r origin.<br></span><span class="tab" val="79"></span><span class="small">r corner&larr;picture corner.<br></span><span class="tab" val="79"></span><span class="small">⇑r]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">grow </span><span class="small">| oldframe newframe pt r<br></span><span class="tab" val="79"></span><span class="small">[self leave.<br></span><span class="tab" val="79"></span><span class="small">newframe&larr;picture origin rect: picture corner.<br></span><span class="tab" val="79"></span><span class="small">CornerCursor showwhile⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[pt&larr;user mp+16.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ user nobug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[newframe corner&larr;pt.  newframe comp.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pt&larr;user mp+16.  newframe comp].<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ user anybug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[newframe corner&larr;pt.  newframe comp.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pt&larr;user mp+16.  newframe comp]].<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">clear unused areas from old picture to background,<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">and clear new picture areas to white</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">oldframe&larr;picture inset: ¬2⌾¬2.  "</span><span class="small italic">¬2 is for erasing old border</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">for⦂ r from: (oldframe minus: newframe) do⦂ [r clear: background].<br></span><span class="tab" val="79"></span><span class="small">for⦂ r from: (newframe minus: picture) do⦂ [r clear: white].<br></span><span class="tab" val="79"></span><span class="small">picture title: picture title in: newframe; saveScreenBits.<br></span><span class="tab" val="79"></span><span class="small">self frame: newframe; show; takeCursor; enter]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">leave<br></span><span class="tab" val="79"></span><span class="small">[[nil≡saveActionPic⇒[]<br></span><span class="tab" val="79"></span><span class="small"> actionpic bitsFromString: saveActionPic.<br></span><span class="tab" val="79"></span><span class="small"> saveActionPic &larr; nil.].<br></span><span class="tab" val="79"></span><span class="small"> [nil≡ saveToolPic⇒[]<br></span><span class="tab" val="79"></span><span class="small"> toolpic bitsFromString: saveToolPic.<br></span><span class="tab" val="79"></span><span class="small"> saveToolPic&larr;nil].<br></span><span class="tab" val="79"></span><span class="small">[dirty⇒[picture saveScreenBits. dirty &larr; false]].<br></span><span class="tab" val="79"></span><span class="small">frame border: 3 color: white]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">lostMouse </span><span class="small">[⇑(frame has: user mp)≡false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">outside </span><span class="small">| pt<br></span><span class="tab" val="79"></span><span class="small">[toolpic has: (pt&larr;user mp)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[user redbug⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[tool&larr;tools bug: pt. tool frame: frame; showon: actionbuttons]]<br></span><span class="tab" val="79"></span><span class="small">actionpic has: pt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[user redbug⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[tool setfrom: actionbuttons]]<br></span><span class="tab" val="79"></span><span class="small">⇑false]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">redbug </span><span class="small">[dirty&larr;true.  tool redbug]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showtitle   </span><span class="small italic">"The BitRectEditor have a menu where the title used to be"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">title </span><span class="small">[⇑picture title]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tool </span><span class="small">[⇑ tool]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">yellowbug<br></span><span class="tab" val="79"></span><span class="small">[picture is: BitImage⇒ [ picture yellowbug] <br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪BitRectEditor under: &rsquo;Picture Editor&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">BitRectEditor classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"BitRectTool"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;BitRectTool&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;action "&lt;UniqueString&gt; the current action"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">pencil  "&lt;Turtle&gt; used for draw or straight-edge"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">brush  "&lt;BitRect&gt; source for painting"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">mode  "&lt;Integer&gt; how brush combines with the destination"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">tone  "&lt;Integer&gt; a spatial half-tone color (4 bits by 4 bits)"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">grid  "&lt;Integer&gt; all mouse points are rounded to this"&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;blowupScale graypens brushpt &rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>A BitRectTool paints on the screen.<br>A tool is a combination of action, mode, pen-width, gray, and grid.<br></span><span class="tab" val="79"></span><span class="small italic">action is one of: make-brush, paint, block-of-gray, draw, straight-edge, magnify.<br></span><span class="tab" val="79"></span><span class="small italic">mode is one of: store, or, xor, and.  (how tool is combined with picture)<br></span><span class="tab" val="79"></span><span class="small italic">pen-width is 1, 2, 4, or 8.  (width of the pen)<br></span><span class="tab" val="79"></span><span class="small italic">gray is one of: black, darkgray, gray, lightgray, white.<br></span><span class="tab" val="79"></span><span class="small italic">grid is one of: 1, 2, 4, 8, 16, 32.   (minimum spacing of mouse points)<br>Menus for each part of a tool appear above the picture (in the same order).<br>Some actions do not use certain of the other parts of a tool.<br>(example: Block-of-gray does not use pen-width.)<br><br>brushpt = Point in the menu where brush is shown.<br>graypens = Vector of Strings of bits in pens.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Tool action</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">block </span><span class="small">[self getRectangle color: tone mode: mode]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">blowup </span><span class="small">| smallRect bigRectFrame<br></span><span class="tab" val="79"></span><span class="small">[smallRect&larr;self getRectangle.<br></span><span class="tab" val="79"></span><span class="small">bigRectFrame &larr; Rectangle new origin: smallRect corner<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">extent: 4⌾4 + (smallRect  extent*blowupScale).<br></span><span class="tab" val="79"></span><span class="small">smallRect empty or⦂ bigRectFrame bitStringLength&gt;4000⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[pencil frame flash.  ⇑nil].<br></span><span class="tab" val="79"></span><span class="small">[user screenrect has: bigRectFrame corner⇒[] <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">bigRectFrame moveto: smallRect origin-bigRectFrame extent.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user screenrect has: bigRectFrame origin⇒[]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">can&rsquo;t find a space for blown up image</span><span class="small">"</span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pencil frame flash.  ⇑nil].<br></span><span class="tab" val="79"></span><span class="small">self blowup: smallRect to: bigRectFrame]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">blowup: smallRect to: bigRectFrame<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">| bigRect box pt i turt flag bits<br></span><span class="tab" val="79"></span><span class="small">[bits &larr; bigRectFrame bitsIntoString.<br></span><span class="tab" val="79"></span><span class="small">bigRect &larr; bigRectFrame inset: 2⌾2.<br></span><span class="tab" val="79"></span><span class="small">smallRect blowup: bigRect origin by: blowupScale.<br></span><span class="tab" val="79"></span><span class="small">turt&larr;Turtle init.<br></span><span class="tab" val="79"></span><span class="small">box &larr; 0⌾0 rect: (blowupScale-1)⌾(blowupScale-1).<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">keep editing in blowup mode until the user presses a button<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">outside the big rect</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">while⦂ flag do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[bigRect has: (pt &larr; user mp)⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[box moveto: bigRect origin + (i &larr; pt-bigRect origin|blowupScale).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">turt place: smallRect origin + (i/blowupScale).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user redbug⇒[box color: black mode: storing. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">turt black; go: 0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user yellowbug⇒[box color: white mode: storing. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">turt white; go: 0]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user bluebug⇒[bigRect flash]]</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">user anybug ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[(bigRect inset: ¬5⌾¬5) has: pt⇒[bigRect flash]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">quit</span><span class="small">" flag&larr;false]].<br></span><span class="tab" val="79"></span><span class="small">bigRectFrame bitsFromString: bits]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">brush </span><span class="small">[⇑brush]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">brush: sourceRect   </span><span class="small">"</span><span class="small italic">use the bits in the BitRect </span><span class="small italic underline">sourceRect</span><span class="small italic"> as a brush</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">| minpt maxpt pt offset<br></span><span class="tab" val="79"></span><span class="small">["</span><span class="small italic">The inner painting loop should be fast - all the extra foliage below<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">is to move tests outside of the inner loop</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">sourceRect moveto: brushpt; show.<br></span><span class="tab" val="79"></span><span class="small">minpt&larr;self frame origin.<br></span><span class="tab" val="79"></span><span class="small">maxpt&larr;self frame corner-sourceRect extent.<br></span><span class="tab" val="79"></span><span class="small">offset&larr;sourceRect extent/2.<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">If mode is storing or oring, use brush command, otherwise blt.</span><span class="small"><br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">Use the unclipped form of brushing  and grid=1 when possible</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">[mode&lt;xoring and⦂ grid=1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[minpt≤(pt&larr;user mp-offset) and⦂ pt≤maxpt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[sourceRect brush: pt mode: mode color: tone]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">sourceRect brush: pt mode: mode color: tone clippedBy: self frame]]<br></span><span class="tab" val="79"></span><span class="small"> mode≥xoring and⦂ grid=1⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[minpt≤(pt&larr;user mp-offset) and⦂ pt≤maxpt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[sourceRect blt: pt mode: mode]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">sourceRect blt: pt mode: mode clippedBy: self frame]]<br></span><span class="tab" val="79"></span><span class="small"> mode&lt;xoring⇒   "</span><span class="small italic">grid is &gt; 1</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[minpt≤(pt&larr;self mpOnGrid-offset) and⦂ pt≤maxpt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[sourceRect brush: pt mode: mode color: tone]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">sourceRect brush: pt mode: mode color: tone clippedBy: self frame]]<br></span><span class="tab" val="79"></span><span class="small"> "</span><span class="small italic">grid is &gt; 1 and mode≥xoring</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[minpt≤(pt&larr;self mpOnGrid-offset) and⦂ pt≤maxpt⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[sourceRect blt: pt mode: mode]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">sourceRect blt: pt mode: mode clippedBy: self frame]].<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">draw<br></span><span class="tab" val="79"></span><span class="small">[tone=white or⦂ tone=black⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[pencil place: self mpOnGrid-pencil frame origin.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">grid=1⇒</span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">make drawing with grid 1 fast</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[pencil goto: user mp-pencil frame origin]]<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[pencil goto: self mpOnGrid-pencil frame origin]]<br></span><span class="tab" val="79"></span><span class="small">self brush: graypens◦pencil width]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">getRectangle </span><span class="small">| rect newrect start t   </span><span class="small italic">"rect must be in my frame"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">["</span><span class="small italic">the rect-newrect stuff is so that the complementing stays<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">on for a while</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">start&larr;self mpOnGrid.<br></span><span class="tab" val="79"></span><span class="small">rect&larr;newrect&larr;(Rectangle new origin: start corner: start)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">intersect: self frame.<br></span><span class="tab" val="79"></span><span class="small">"</span><span class="small italic">move the cursor slightly so that the user will notice the rectangle<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small italic">being complemented</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">user cursorloc&larr;start+4.<br></span><span class="tab" val="79"></span><span class="small">while⦂ user anybug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[rect&larr;newrect.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">rect comp.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">t&larr;self mpOnGrid.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">newrect&larr;(Rectangle new origin: (start min: t) corner: (start max: t))<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">intersect: self frame.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">rect comp].<br></span><span class="tab" val="79"></span><span class="small">⇑rect]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">line </span><span class="small">| start end width</span><span class="small bold"><br></span><span class="tab" val="79"></span><span class="small">[start&larr;end&larr;self mpOnGrid-pencil frame origin.<br></span><span class="tab" val="79"></span><span class="small">width&larr;pencil width.  pencil xor; width: 1.<br></span><span class="tab" val="79"></span><span class="small">while⦂ user redbug do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[end&larr;self mpOnGrid-pencil frame origin.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">pencil xor; place: start; goto: end; place: start; goto: end].<br></span><span class="tab" val="79"></span><span class="small">[tone=white⇒[pencil white] pencil black].<br></span><span class="tab" val="79"></span><span class="small">pencil width: width; place: start; goto: end]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">mode<br></span><span class="tab" val="79"></span><span class="small">[⇑ mode]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">mpOnGrid   </span><span class="small italic">"return mouse point rounded to </span><span class="small italic underline">grid</span><span class="small italic">"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">[⇑user mp+(grid/2) | grid]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">paint<br></span><span class="tab" val="79"></span><span class="small">[self brush: brush]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">redbug </span><span class="small">[self perform: action]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setbrush </span><span class="small">| rect<br></span><span class="tab" val="79"></span><span class="small">[rect&larr;self getRectangle.<br></span><span class="tab" val="79"></span><span class="small">rect empty or⦂ 50⌾50&lt;rect extent⇒[pencil frame flash].<br></span><span class="tab" val="79"></span><span class="small">brush color: white mode: storing.<br></span><span class="tab" val="79"></span><span class="small">brush title: &rsquo;brush&rsquo; in: rect; saveScreenBits.<br></span><span class="tab" val="79"></span><span class="small">brush moveto: brushpt; show.<br></span><span class="tab" val="79"></span><span class="small">action &larr; ↪paint]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">shade </span><span class="small">| p1 p2 a b t p r vs "down on redbug is black place.<br></span><span class="tab" val="79"></span><span class="small">up on redbug is white place.  Subsequent redbugs<br></span><span class="tab" val="79"></span><span class="small">paint a shade of gray depending on position between<br></span><span class="tab" val="79"></span><span class="small">black and white (and beyond white to black again).<br></span><span class="tab" val="79"></span><span class="small">Yellow or blue bug terminates."<br></span><span class="tab" val="79"></span><span class="small">[until⦂ user redbug do⦂ [p1 &larr; user mp]. "black"<br></span><span class="tab" val="79"></span><span class="small">until⦂ user nobug do⦂ [p2 &larr; user mp]. "white"<br><br></span><span class="tab" val="79"></span><span class="small">vs &larr; ↪( ¬1  ¬1025  ¬1089  ¬585  ¬4681  ¬6731  ¬22058  ¬27031   ¬26986  ¬31191  ¬32108   5160  5128  8321  1025 01 0).<br></span><span class="tab" val="79"></span><span class="small">r &larr; 0⌾0 rect: 10⌾10.<br></span><span class="tab" val="79"></span><span class="small">b&larr;(p1-p2). b &larr; b x asFloat ⌾ b y asFloat.<br></span><span class="tab" val="79"></span><span class="small">a &larr; b x * b x + (b y * b y) /16.0.<br></span><span class="tab" val="79"></span><span class="small">until⦂ (user yellowbug or⦂ user bluebug) do⦂<br></span><span class="tab" val="79"></span><span class="small">[user redbug ⇒[p&larr;user mp.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">t &larr; b* (p-p2).<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">t &larr; (t x + t y /a) asInteger abs min: 16.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">brush brush: p mode: mode color: vs◦(17-t)]<br></span><span class="tab" val="79"></span><span class="small">]<br></span><span class="tab" val="79"></span><span class="small">]<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">tone<br></span><span class="tab" val="79"></span><span class="small">[⇑ tone]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Tool selection</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">brushpt: pt  </span><span class="small">"</span><span class="small italic">set the point at which the current brush will be shown</span><span class="small">"<br></span><span class="tab" val="79"></span><span class="small">[brushpt&larr;pt]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">frame </span><span class="small">[⇑pencil frame]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">frame: f </span><span class="small">[pencil frame: f]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setfrom: butvec </span><span class="small">| pt<br></span><span class="tab" val="79"></span><span class="small">[butvec◦1 has: (pt &larr; user mp) ⇒<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[action &larr; butvec◦1 bug: pt]<br></span><span class="tab" val="79"></span><span class="small">butvec◦2 has: pt ⇒[tone &larr; butvec◦2 bug: pt.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">tone=white ⇒[pencil white] pencil black]<br></span><span class="tab" val="79"></span><span class="small">butvec◦3 has: pt ⇒[mode &larr; butvec◦3 bug: pt]<br></span><span class="tab" val="79"></span><span class="small">butvec◦4 has: pt ⇒[pencil width: (butvec◦4 bug: pt)]<br></span><span class="tab" val="79"></span><span class="small">butvec◦5 has: pt ⇒[grid &larr; butvec◦5 bug: pt]<br></span><span class="tab" val="79"></span><span class="small">]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">showon: butvec<br></span><span class="tab" val="79"></span><span class="small">[butvec◦1 setvalue: action.<br></span><span class="tab" val="79"></span><span class="small">butvec◦2 setvalue: tone.<br></span><span class="tab" val="79"></span><span class="small">butvec◦3 setvalue: mode.<br></span><span class="tab" val="79"></span><span class="small">butvec◦4 setvalue: pencil width.<br></span><span class="tab" val="79"></span><span class="small">butvec◦5 setvalue: grid]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Class initialization</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">classInit </span><span class="small">| rect saveBits t i<br></span><span class="tab" val="79"></span><span class="small">[blowupScale&larr;4.<br></span><span class="tab" val="79"></span><span class="small italic">"make a vector of gray pens"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">rect &larr; 0⌾0 rect: 9⌾9.<br></span><span class="tab" val="79"></span><span class="small">saveBits&larr;rect bitsIntoString.<br></span><span class="tab" val="79"></span><span class="small">t &larr; Turtle init.<br></span><span class="tab" val="79"></span><span class="small">graypens &larr; Vector new: 8.<br></span><span class="tab" val="79"></span><span class="small">for⦂ i to: 8 do⦂<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">[t width: i.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">rect clear: white. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">t place: 4⌾4; go: 0. <br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">graypens◦i &larr; BitRect new title: &rsquo;graypen&rsquo; in: rect.<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">(graypens◦i) saveScreenBits].<br></span><span class="tab" val="79"></span><span class="small">rect bitsFromString: saveBits]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">init<br></span><span class="tab" val="79"></span><span class="small">[(pencil &larr; Turtle new) init; black; width: 2.<br></span><span class="tab" val="79"></span><span class="small">(brush &larr; BitRect new) title: &rsquo;brush&rsquo; in: (0⌾0 rect: 16⌾16).<br></span><span class="tab" val="79"></span><span class="small">tone &larr; black. mode &larr; 0. grid &larr; 1. action &larr; ↪draw]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪BitRectTool under: &rsquo;Picture Editor&rsquo;.</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">BitRectTool classInit</span></div>
<div style="width: 141pt; margin-left: 425pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>"RadioButtons"</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold">Class new title: &rsquo;RadioButtons&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">subclassof: Object<br></span><span class="tab" val="79"></span><span class="medium bold">fields: &rsquo;vec  "&lt;Vector&gt; values corresponding to the buttons"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">cur  "&lt;Integer&gt; button currently selected"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">rect  "&lt;Rectangle&gt; contains all the buttons"<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="medium bold">size  "&lt;Integer&gt; width or height of a button"&rsquo;<br></span><span class="tab" val="79"></span><span class="medium bold">declare: &rsquo;&rsquo;;<br></span><span class="tab" val="79"></span><span class="medium bold">asFollows</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small italic"><br>A RadioButtons is a row or column of square regions ("buttons") on the display screen.  There is always exactly one button pushed.  (RadioButtons is a model of the station selection buttons on a car radio.)  The pushed button has a black box around it.  Each button has a value associated with it, which is returned when the button is pressed.  RadioButtons will not destroy a menu picture (BitRect) displayed in its area, but the RadioButtons has no knowledge of the picture.<br></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Pushing a Button</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">bug: pt </span><span class="small">| r a<br></span><span class="tab" val="79"></span><span class="small">[r &larr; (pt - rect origin - (1⌾1)) / size.<br></span><span class="tab" val="79"></span><span class="small">a &larr; r x + r y + 1.<br></span><span class="tab" val="79"></span><span class="small">⇑self push: a]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">push: a<br></span><span class="tab" val="79"></span><span class="small">[self release: cur thenPush: a.<br></span><span class="tab" val="79"></span><span class="small">⇑vec◦(cur &larr; a)]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">setvalue: v </span><span class="small">| i<br></span><span class="tab" val="79"></span><span class="small">[</span><span class="small italic">"if value has been lost, set self to 1"</span><span class="small"><br></span><span class="tab" val="79"></span><span class="small">i&larr;(vec find: v) max: 1.<br></span><span class="tab" val="79"></span><span class="small">self push: i.  ⇑i]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Init and State</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">has: pt </span><span class="small">[⇑rect has: pt]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">moveto: pt<br></span><span class="tab" val="79"></span><span class="small">[rect moveto: pt.<br></span><span class="tab" val="79"></span><span class="small">cur &larr; 0.<br></span><span class="tab" val="79"></span><span class="small">⇑rect corner x ⌾ rect origin y]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">reset </span><span class="small">[cur&larr;0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">value </span><span class="small">[⇑vec◦cur]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">vec </span><span class="small">[⇑vec]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">vec: vec at: r height: size<br></span><span class="tab" val="79"></span><span class="small">[rect &larr; r rect: r+ ((vec length ⌾ 1)*size).<br></span><span class="tab" val="79"></span><span class="small">cur &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">vec: vec at: r width: size<br></span><span class="tab" val="79"></span><span class="small">[rect &larr; r rect: r+ ((1 ⌾ vec length)*size).<br></span><span class="tab" val="79"></span><span class="small">cur &larr; 0]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="medium bold"><br>Private</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small bold">release: a thenPush: b </span><span class="small">| boxer offset<br></span><span class="tab" val="79"></span><span class="small">[a=b⇒[]<br></span><span class="tab" val="79"></span><span class="small">offset &larr; [size=rect extent y⇒[size⌾0] 0⌾size].<br></span><span class="tab" val="79"></span><span class="small">[a≠0⇒[boxer &larr; Rectangle new origin: (offset*(a-1)+rect origin+1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">extent: size⌾size-1.  boxer comp.  (boxer inset: 1⌾1) comp]].<br></span><span class="tab" val="79"></span><span class="small">b≠0⇒[boxer &larr; Rectangle new origin: (offset*(b-1)+rect origin+1)<br></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="tab" val="79"></span><span class="small">extent: size⌾size-1.  boxer comp.  (boxer inset: 1⌾1) comp]]</span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small"></span></div>
<div style="width: 442pt; margin-left: 84pt; margin-top: 0pt; text-align: left">
<span class="small">SystemOrganization classify: ↪RadioButtons under: &rsquo;Picture Editor&rsquo;.</span></div>
  </body>
</html>
